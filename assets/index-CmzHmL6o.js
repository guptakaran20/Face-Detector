var Cw=(r,n)=>()=>(n||r((n={exports:{}}).exports,n),n.exports);var cD=Cw((hD,ux)=>{(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))e(a);new MutationObserver(a=>{for(const u of a)if(u.type==="childList")for(const s of u.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&e(s)}).observe(document,{childList:!0,subtree:!0});function t(a){const u={};return a.integrity&&(u.integrity=a.integrity),a.referrerPolicy&&(u.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?u.credentials="include":a.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function e(a){if(a.ep)return;a.ep=!0;const u=t(a);fetch(a.href,u)}})();var Ah={exports:{}},xu={};var O0;function Sw(){if(O0)return xu;O0=1;var r=Symbol.for("react.transitional.element"),n=Symbol.for("react.fragment");function t(e,a,u){var s=null;if(u!==void 0&&(s=""+u),a.key!==void 0&&(s=""+a.key),"key"in a){u={};for(var l in a)l!=="key"&&(u[l]=a[l])}else u=a;return a=u.ref,{$$typeof:r,type:e,key:s,ref:a!==void 0?a:null,props:u}}return xu.Fragment=n,xu.jsx=t,xu.jsxs=t,xu}var k0;function Rw(){return k0||(k0=1,Ah.exports=Sw()),Ah.exports}var Me=Rw(),Th={exports:{}},Ot={};var I0;function Aw(){if(I0)return Ot;I0=1;var r=Symbol.for("react.transitional.element"),n=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),e=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),u=Symbol.for("react.consumer"),s=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),f=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),v=Symbol.for("react.activity"),m=Symbol.iterator;function y(z){return z===null||typeof z!="object"?null:(z=m&&z[m]||z["@@iterator"],typeof z=="function"?z:null)}var x={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},w=Object.assign,_={};function E(z,X,it){this.props=z,this.context=X,this.refs=_,this.updater=it||x}E.prototype.isReactComponent={},E.prototype.setState=function(z,X){if(typeof z!="object"&&typeof z!="function"&&z!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,z,X,"setState")},E.prototype.forceUpdate=function(z){this.updater.enqueueForceUpdate(this,z,"forceUpdate")};function R(){}R.prototype=E.prototype;function A(z,X,it){this.props=z,this.context=X,this.refs=_,this.updater=it||x}var S=A.prototype=new R;S.constructor=A,w(S,E.prototype),S.isPureReactComponent=!0;var T=Array.isArray;function N(){}var O={H:null,A:null,T:null,S:null},B=Object.prototype.hasOwnProperty;function I(z,X,it){var ht=it.ref;return{$$typeof:r,type:z,key:X,ref:ht!==void 0?ht:null,props:it}}function F(z,X){return I(z.type,X,z.props)}function G(z){return typeof z=="object"&&z!==null&&z.$$typeof===r}function H(z){var X={"=":"=0",":":"=2"};return"$"+z.replace(/[=:]/g,function(it){return X[it]})}var at=/\/+/g;function et(z,X){return typeof z=="object"&&z!==null&&z.key!=null?H(""+z.key):X.toString(36)}function nt(z){switch(z.status){case"fulfilled":return z.value;case"rejected":throw z.reason;default:switch(typeof z.status=="string"?z.then(N,N):(z.status="pending",z.then(function(X){z.status==="pending"&&(z.status="fulfilled",z.value=X)},function(X){z.status==="pending"&&(z.status="rejected",z.reason=X)})),z.status){case"fulfilled":return z.value;case"rejected":throw z.reason}}throw z}function L(z,X,it,ht,dt){var vt=typeof z;(vt==="undefined"||vt==="boolean")&&(z=null);var gt=!1;if(z===null)gt=!0;else switch(vt){case"bigint":case"string":case"number":gt=!0;break;case"object":switch(z.$$typeof){case r:case n:gt=!0;break;case p:return gt=z._init,L(gt(z._payload),X,it,ht,dt)}}if(gt)return dt=dt(z),gt=ht===""?"."+et(z,0):ht,T(dt)?(it="",gt!=null&&(it=gt.replace(at,"$&/")+"/"),L(dt,X,it,"",function(ie){return ie})):dt!=null&&(G(dt)&&(dt=F(dt,it+(dt.key==null||z&&z.key===dt.key?"":(""+dt.key).replace(at,"$&/")+"/")+gt)),X.push(dt)),1;gt=0;var Tt=ht===""?".":ht+":";if(T(z))for(var Rt=0;Rt<z.length;Rt++)ht=z[Rt],vt=Tt+et(ht,Rt),gt+=L(ht,X,it,vt,dt);else if(Rt=y(z),typeof Rt=="function")for(z=Rt.call(z),Rt=0;!(ht=z.next()).done;)ht=ht.value,vt=Tt+et(ht,Rt++),gt+=L(ht,X,it,vt,dt);else if(vt==="object"){if(typeof z.then=="function")return L(nt(z),X,it,ht,dt);throw X=String(z),Error("Objects are not valid as a React child (found: "+(X==="[object Object]"?"object with keys {"+Object.keys(z).join(", ")+"}":X)+"). If you meant to render a collection of children, use an array instead.")}return gt}function q(z,X,it){if(z==null)return z;var ht=[],dt=0;return L(z,ht,"","",function(vt){return X.call(it,vt,dt++)}),ht}function K(z){if(z._status===-1){var X=z._result;X=X(),X.then(function(it){(z._status===0||z._status===-1)&&(z._status=1,z._result=it)},function(it){(z._status===0||z._status===-1)&&(z._status=2,z._result=it)}),z._status===-1&&(z._status=0,z._result=X)}if(z._status===1)return z._result.default;throw z._result}var rt=typeof reportError=="function"?reportError:function(z){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var X=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof z=="object"&&z!==null&&typeof z.message=="string"?String(z.message):String(z),error:z});if(!window.dispatchEvent(X))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",z);return}console.error(z)},ot={map:q,forEach:function(z,X,it){q(z,function(){X.apply(this,arguments)},it)},count:function(z){var X=0;return q(z,function(){X++}),X},toArray:function(z){return q(z,function(X){return X})||[]},only:function(z){if(!G(z))throw Error("React.Children.only expected to receive a single React element child.");return z}};return Ot.Activity=v,Ot.Children=ot,Ot.Component=E,Ot.Fragment=t,Ot.Profiler=a,Ot.PureComponent=A,Ot.StrictMode=e,Ot.Suspense=f,Ot.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=O,Ot.__COMPILER_RUNTIME={__proto__:null,c:function(z){return O.H.useMemoCache(z)}},Ot.cache=function(z){return function(){return z.apply(null,arguments)}},Ot.cacheSignal=function(){return null},Ot.cloneElement=function(z,X,it){if(z==null)throw Error("The argument must be a React element, but you passed "+z+".");var ht=w({},z.props),dt=z.key;if(X!=null)for(vt in X.key!==void 0&&(dt=""+X.key),X)!B.call(X,vt)||vt==="key"||vt==="__self"||vt==="__source"||vt==="ref"&&X.ref===void 0||(ht[vt]=X[vt]);var vt=arguments.length-2;if(vt===1)ht.children=it;else if(1<vt){for(var gt=Array(vt),Tt=0;Tt<vt;Tt++)gt[Tt]=arguments[Tt+2];ht.children=gt}return I(z.type,dt,ht)},Ot.createContext=function(z){return z={$$typeof:s,_currentValue:z,_currentValue2:z,_threadCount:0,Provider:null,Consumer:null},z.Provider=z,z.Consumer={$$typeof:u,_context:z},z},Ot.createElement=function(z,X,it){var ht,dt={},vt=null;if(X!=null)for(ht in X.key!==void 0&&(vt=""+X.key),X)B.call(X,ht)&&ht!=="key"&&ht!=="__self"&&ht!=="__source"&&(dt[ht]=X[ht]);var gt=arguments.length-2;if(gt===1)dt.children=it;else if(1<gt){for(var Tt=Array(gt),Rt=0;Rt<gt;Rt++)Tt[Rt]=arguments[Rt+2];dt.children=Tt}if(z&&z.defaultProps)for(ht in gt=z.defaultProps,gt)dt[ht]===void 0&&(dt[ht]=gt[ht]);return I(z,vt,dt)},Ot.createRef=function(){return{current:null}},Ot.forwardRef=function(z){return{$$typeof:l,render:z}},Ot.isValidElement=G,Ot.lazy=function(z){return{$$typeof:p,_payload:{_status:-1,_result:z},_init:K}},Ot.memo=function(z,X){return{$$typeof:h,type:z,compare:X===void 0?null:X}},Ot.startTransition=function(z){var X=O.T,it={};O.T=it;try{var ht=z(),dt=O.S;dt!==null&&dt(it,ht),typeof ht=="object"&&ht!==null&&typeof ht.then=="function"&&ht.then(N,rt)}catch(vt){rt(vt)}finally{X!==null&&it.types!==null&&(X.types=it.types),O.T=X}},Ot.unstable_useCacheRefresh=function(){return O.H.useCacheRefresh()},Ot.use=function(z){return O.H.use(z)},Ot.useActionState=function(z,X,it){return O.H.useActionState(z,X,it)},Ot.useCallback=function(z,X){return O.H.useCallback(z,X)},Ot.useContext=function(z){return O.H.useContext(z)},Ot.useDebugValue=function(){},Ot.useDeferredValue=function(z,X){return O.H.useDeferredValue(z,X)},Ot.useEffect=function(z,X){return O.H.useEffect(z,X)},Ot.useEffectEvent=function(z){return O.H.useEffectEvent(z)},Ot.useId=function(){return O.H.useId()},Ot.useImperativeHandle=function(z,X,it){return O.H.useImperativeHandle(z,X,it)},Ot.useInsertionEffect=function(z,X){return O.H.useInsertionEffect(z,X)},Ot.useLayoutEffect=function(z,X){return O.H.useLayoutEffect(z,X)},Ot.useMemo=function(z,X){return O.H.useMemo(z,X)},Ot.useOptimistic=function(z,X){return O.H.useOptimistic(z,X)},Ot.useReducer=function(z,X,it){return O.H.useReducer(z,X,it)},Ot.useRef=function(z){return O.H.useRef(z)},Ot.useState=function(z){return O.H.useState(z)},Ot.useSyncExternalStore=function(z,X,it){return O.H.useSyncExternalStore(z,X,it)},Ot.useTransition=function(){return O.H.useTransition()},Ot.version="19.2.3",Ot}var B0;function Dd(){return B0||(B0=1,Th.exports=Aw()),Th.exports}var pi=Dd(),Dh={exports:{}},wu={},Nh={exports:{}},Mh={};var F0;function Tw(){return F0||(F0=1,(function(r){function n(L,q){var K=L.length;L.push(q);t:for(;0<K;){var rt=K-1>>>1,ot=L[rt];if(0<a(ot,q))L[rt]=q,L[K]=ot,K=rt;else break t}}function t(L){return L.length===0?null:L[0]}function e(L){if(L.length===0)return null;var q=L[0],K=L.pop();if(K!==q){L[0]=K;t:for(var rt=0,ot=L.length,z=ot>>>1;rt<z;){var X=2*(rt+1)-1,it=L[X],ht=X+1,dt=L[ht];if(0>a(it,K))ht<ot&&0>a(dt,it)?(L[rt]=dt,L[ht]=K,rt=ht):(L[rt]=it,L[X]=K,rt=X);else if(ht<ot&&0>a(dt,K))L[rt]=dt,L[ht]=K,rt=ht;else break t}}return q}function a(L,q){var K=L.sortIndex-q.sortIndex;return K!==0?K:L.id-q.id}if(r.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var u=performance;r.unstable_now=function(){return u.now()}}else{var s=Date,l=s.now();r.unstable_now=function(){return s.now()-l}}var f=[],h=[],p=1,v=null,m=3,y=!1,x=!1,w=!1,_=!1,E=typeof setTimeout=="function"?setTimeout:null,R=typeof clearTimeout=="function"?clearTimeout:null,A=typeof setImmediate<"u"?setImmediate:null;function S(L){for(var q=t(h);q!==null;){if(q.callback===null)e(h);else if(q.startTime<=L)e(h),q.sortIndex=q.expirationTime,n(f,q);else break;q=t(h)}}function T(L){if(w=!1,S(L),!x)if(t(f)!==null)x=!0,N||(N=!0,H());else{var q=t(h);q!==null&&nt(T,q.startTime-L)}}var N=!1,O=-1,B=5,I=-1;function F(){return _?!0:!(r.unstable_now()-I<B)}function G(){if(_=!1,N){var L=r.unstable_now();I=L;var q=!0;try{t:{x=!1,w&&(w=!1,R(O),O=-1),y=!0;var K=m;try{e:{for(S(L),v=t(f);v!==null&&!(v.expirationTime>L&&F());){var rt=v.callback;if(typeof rt=="function"){v.callback=null,m=v.priorityLevel;var ot=rt(v.expirationTime<=L);if(L=r.unstable_now(),typeof ot=="function"){v.callback=ot,S(L),q=!0;break e}v===t(f)&&e(f),S(L)}else e(f);v=t(f)}if(v!==null)q=!0;else{var z=t(h);z!==null&&nt(T,z.startTime-L),q=!1}}break t}finally{v=null,m=K,y=!1}q=void 0}}finally{q?H():N=!1}}}var H;if(typeof A=="function")H=function(){A(G)};else if(typeof MessageChannel<"u"){var at=new MessageChannel,et=at.port2;at.port1.onmessage=G,H=function(){et.postMessage(null)}}else H=function(){E(G,0)};function nt(L,q){O=E(function(){L(r.unstable_now())},q)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(L){L.callback=null},r.unstable_forceFrameRate=function(L){0>L||125<L?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):B=0<L?Math.floor(1e3/L):5},r.unstable_getCurrentPriorityLevel=function(){return m},r.unstable_next=function(L){switch(m){case 1:case 2:case 3:var q=3;break;default:q=m}var K=m;m=q;try{return L()}finally{m=K}},r.unstable_requestPaint=function(){_=!0},r.unstable_runWithPriority=function(L,q){switch(L){case 1:case 2:case 3:case 4:case 5:break;default:L=3}var K=m;m=L;try{return q()}finally{m=K}},r.unstable_scheduleCallback=function(L,q,K){var rt=r.unstable_now();switch(typeof K=="object"&&K!==null?(K=K.delay,K=typeof K=="number"&&0<K?rt+K:rt):K=rt,L){case 1:var ot=-1;break;case 2:ot=250;break;case 5:ot=1073741823;break;case 4:ot=1e4;break;default:ot=5e3}return ot=K+ot,L={id:p++,callback:q,priorityLevel:L,startTime:K,expirationTime:ot,sortIndex:-1},K>rt?(L.sortIndex=K,n(h,L),t(f)===null&&L===t(h)&&(w?(R(O),O=-1):w=!0,nt(T,K-rt))):(L.sortIndex=ot,n(f,L),x||y||(x=!0,N||(N=!0,H()))),L},r.unstable_shouldYield=F,r.unstable_wrapCallback=function(L){var q=m;return function(){var K=m;m=q;try{return L.apply(this,arguments)}finally{m=K}}}})(Mh)),Mh}var z0;function Dw(){return z0||(z0=1,Nh.exports=Tw()),Nh.exports}var Oh={exports:{}},Je={};var L0;function Nw(){if(L0)return Je;L0=1;var r=Dd();function n(f){var h="https://react.dev/errors/"+f;if(1<arguments.length){h+="?args[]="+encodeURIComponent(arguments[1]);for(var p=2;p<arguments.length;p++)h+="&args[]="+encodeURIComponent(arguments[p])}return"Minified React error #"+f+"; visit "+h+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var e={d:{f:t,r:function(){throw Error(n(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},a=Symbol.for("react.portal");function u(f,h,p){var v=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:a,key:v==null?null:""+v,children:f,containerInfo:h,implementation:p}}var s=r.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function l(f,h){if(f==="font")return"";if(typeof h=="string")return h==="use-credentials"?h:""}return Je.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=e,Je.createPortal=function(f,h){var p=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11)throw Error(n(299));return u(f,h,null,p)},Je.flushSync=function(f){var h=s.T,p=e.p;try{if(s.T=null,e.p=2,f)return f()}finally{s.T=h,e.p=p,e.d.f()}},Je.preconnect=function(f,h){typeof f=="string"&&(h?(h=h.crossOrigin,h=typeof h=="string"?h==="use-credentials"?h:"":void 0):h=null,e.d.C(f,h))},Je.prefetchDNS=function(f){typeof f=="string"&&e.d.D(f)},Je.preinit=function(f,h){if(typeof f=="string"&&h&&typeof h.as=="string"){var p=h.as,v=l(p,h.crossOrigin),m=typeof h.integrity=="string"?h.integrity:void 0,y=typeof h.fetchPriority=="string"?h.fetchPriority:void 0;p==="style"?e.d.S(f,typeof h.precedence=="string"?h.precedence:void 0,{crossOrigin:v,integrity:m,fetchPriority:y}):p==="script"&&e.d.X(f,{crossOrigin:v,integrity:m,fetchPriority:y,nonce:typeof h.nonce=="string"?h.nonce:void 0})}},Je.preinitModule=function(f,h){if(typeof f=="string")if(typeof h=="object"&&h!==null){if(h.as==null||h.as==="script"){var p=l(h.as,h.crossOrigin);e.d.M(f,{crossOrigin:p,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0})}}else h==null&&e.d.M(f)},Je.preload=function(f,h){if(typeof f=="string"&&typeof h=="object"&&h!==null&&typeof h.as=="string"){var p=h.as,v=l(p,h.crossOrigin);e.d.L(f,p,{crossOrigin:v,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0,type:typeof h.type=="string"?h.type:void 0,fetchPriority:typeof h.fetchPriority=="string"?h.fetchPriority:void 0,referrerPolicy:typeof h.referrerPolicy=="string"?h.referrerPolicy:void 0,imageSrcSet:typeof h.imageSrcSet=="string"?h.imageSrcSet:void 0,imageSizes:typeof h.imageSizes=="string"?h.imageSizes:void 0,media:typeof h.media=="string"?h.media:void 0})}},Je.preloadModule=function(f,h){if(typeof f=="string")if(h){var p=l(h.as,h.crossOrigin);e.d.m(f,{as:typeof h.as=="string"&&h.as!=="script"?h.as:void 0,crossOrigin:p,integrity:typeof h.integrity=="string"?h.integrity:void 0})}else e.d.m(f)},Je.requestFormReset=function(f){e.d.r(f)},Je.unstable_batchedUpdates=function(f,h){return f(h)},Je.useFormState=function(f,h,p){return s.H.useFormState(f,h,p)},Je.useFormStatus=function(){return s.H.useHostTransitionStatus()},Je.version="19.2.3",Je}var U0;function Mw(){if(U0)return Oh.exports;U0=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(n){console.error(n)}}return r(),Oh.exports=Nw(),Oh.exports}var P0;function Ow(){if(P0)return wu;P0=1;var r=Dw(),n=Dd(),t=Mw();function e(i){var o="https://react.dev/errors/"+i;if(1<arguments.length){o+="?args[]="+encodeURIComponent(arguments[1]);for(var c=2;c<arguments.length;c++)o+="&args[]="+encodeURIComponent(arguments[c])}return"Minified React error #"+i+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function a(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function u(i){var o=i,c=i;if(i.alternate)for(;o.return;)o=o.return;else{i=o;do o=i,(o.flags&4098)!==0&&(c=o.return),i=o.return;while(i)}return o.tag===3?c:null}function s(i){if(i.tag===13){var o=i.memoizedState;if(o===null&&(i=i.alternate,i!==null&&(o=i.memoizedState)),o!==null)return o.dehydrated}return null}function l(i){if(i.tag===31){var o=i.memoizedState;if(o===null&&(i=i.alternate,i!==null&&(o=i.memoizedState)),o!==null)return o.dehydrated}return null}function f(i){if(u(i)!==i)throw Error(e(188))}function h(i){var o=i.alternate;if(!o){if(o=u(i),o===null)throw Error(e(188));return o!==i?null:i}for(var c=i,d=o;;){var g=c.return;if(g===null)break;var b=g.alternate;if(b===null){if(d=g.return,d!==null){c=d;continue}break}if(g.child===b.child){for(b=g.child;b;){if(b===c)return f(g),i;if(b===d)return f(g),o;b=b.sibling}throw Error(e(188))}if(c.return!==d.return)c=g,d=b;else{for(var C=!1,D=g.child;D;){if(D===c){C=!0,c=g,d=b;break}if(D===d){C=!0,d=g,c=b;break}D=D.sibling}if(!C){for(D=b.child;D;){if(D===c){C=!0,c=b,d=g;break}if(D===d){C=!0,d=b,c=g;break}D=D.sibling}if(!C)throw Error(e(189))}}if(c.alternate!==d)throw Error(e(190))}if(c.tag!==3)throw Error(e(188));return c.stateNode.current===c?i:o}function p(i){var o=i.tag;if(o===5||o===26||o===27||o===6)return i;for(i=i.child;i!==null;){if(o=p(i),o!==null)return o;i=i.sibling}return null}var v=Object.assign,m=Symbol.for("react.element"),y=Symbol.for("react.transitional.element"),x=Symbol.for("react.portal"),w=Symbol.for("react.fragment"),_=Symbol.for("react.strict_mode"),E=Symbol.for("react.profiler"),R=Symbol.for("react.consumer"),A=Symbol.for("react.context"),S=Symbol.for("react.forward_ref"),T=Symbol.for("react.suspense"),N=Symbol.for("react.suspense_list"),O=Symbol.for("react.memo"),B=Symbol.for("react.lazy"),I=Symbol.for("react.activity"),F=Symbol.for("react.memo_cache_sentinel"),G=Symbol.iterator;function H(i){return i===null||typeof i!="object"?null:(i=G&&i[G]||i["@@iterator"],typeof i=="function"?i:null)}var at=Symbol.for("react.client.reference");function et(i){if(i==null)return null;if(typeof i=="function")return i.$$typeof===at?null:i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case w:return"Fragment";case E:return"Profiler";case _:return"StrictMode";case T:return"Suspense";case N:return"SuspenseList";case I:return"Activity"}if(typeof i=="object")switch(i.$$typeof){case x:return"Portal";case A:return i.displayName||"Context";case R:return(i._context.displayName||"Context")+".Consumer";case S:var o=i.render;return i=i.displayName,i||(i=o.displayName||o.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case O:return o=i.displayName||null,o!==null?o:et(i.type)||"Memo";case B:o=i._payload,i=i._init;try{return et(i(o))}catch{}}return null}var nt=Array.isArray,L=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,q=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,K={pending:!1,data:null,method:null,action:null},rt=[],ot=-1;function z(i){return{current:i}}function X(i){0>ot||(i.current=rt[ot],rt[ot]=null,ot--)}function it(i,o){ot++,rt[ot]=i.current,i.current=o}var ht=z(null),dt=z(null),vt=z(null),gt=z(null);function Tt(i,o){switch(it(vt,o),it(dt,i),it(ht,null),o.nodeType){case 9:case 11:i=(i=o.documentElement)&&(i=i.namespaceURI)?e0(i):0;break;default:if(i=o.tagName,o=o.namespaceURI)o=e0(o),i=n0(o,i);else switch(i){case"svg":i=1;break;case"math":i=2;break;default:i=0}}X(ht),it(ht,i)}function Rt(){X(ht),X(dt),X(vt)}function ie(i){i.memoizedState!==null&&it(gt,i);var o=ht.current,c=n0(o,i.type);o!==c&&(it(dt,i),it(ht,c))}function zt(i){dt.current===i&&(X(ht),X(dt)),gt.current===i&&(X(gt),mu._currentValue=K)}var Xt,qt;function Jt(i){if(Xt===void 0)try{throw Error()}catch(c){var o=c.stack.trim().match(/\n( *(at )?)/);Xt=o&&o[1]||"",qt=-1<c.stack.indexOf(`
    at`)?" (<anonymous>)":-1<c.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Xt+i+qt}var oe=!1;function ue(i,o){if(!i||oe)return"";oe=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var d={DetermineComponentFrameRoot:function(){try{if(o){var ct=function(){throw Error()};if(Object.defineProperty(ct.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(ct,[])}catch($){var Z=$}Reflect.construct(i,[],ct)}else{try{ct.call()}catch($){Z=$}i.call(ct.prototype)}}else{try{throw Error()}catch($){Z=$}(ct=i())&&typeof ct.catch=="function"&&ct.catch(function(){})}}catch($){if($&&Z&&typeof $.stack=="string")return[$.stack,Z.stack]}return[null,null]}};d.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var g=Object.getOwnPropertyDescriptor(d.DetermineComponentFrameRoot,"name");g&&g.configurable&&Object.defineProperty(d.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var b=d.DetermineComponentFrameRoot(),C=b[0],D=b[1];if(C&&D){var U=C.split(`
`),Q=D.split(`
`);for(g=d=0;d<U.length&&!U[d].includes("DetermineComponentFrameRoot");)d++;for(;g<Q.length&&!Q[g].includes("DetermineComponentFrameRoot");)g++;if(d===U.length||g===Q.length)for(d=U.length-1,g=Q.length-1;1<=d&&0<=g&&U[d]!==Q[g];)g--;for(;1<=d&&0<=g;d--,g--)if(U[d]!==Q[g]){if(d!==1||g!==1)do if(d--,g--,0>g||U[d]!==Q[g]){var ut=`
`+U[d].replace(" at new "," at ");return i.displayName&&ut.includes("<anonymous>")&&(ut=ut.replace("<anonymous>",i.displayName)),ut}while(1<=d&&0<=g);break}}}finally{oe=!1,Error.prepareStackTrace=c}return(c=i?i.displayName||i.name:"")?Jt(c):""}function Ln(i,o){switch(i.tag){case 26:case 27:case 5:return Jt(i.type);case 16:return Jt("Lazy");case 13:return i.child!==o&&o!==null?Jt("Suspense Fallback"):Jt("Suspense");case 19:return Jt("SuspenseList");case 0:case 15:return ue(i.type,!1);case 11:return ue(i.type.render,!1);case 1:return ue(i.type,!0);case 31:return Jt("Activity");default:return""}}function wn(i){try{var o="",c=null;do o+=Ln(i,c),c=i,i=i.return;while(i);return o}catch(d){return`
Error generating stack: `+d.message+`
`+d.stack}}var Ve=Object.prototype.hasOwnProperty,cr=r.unstable_scheduleCallback,_n=r.unstable_cancelCallback,fr=r.unstable_shouldYield,tr=r.unstable_requestPaint,Ee=r.unstable_now,er=r.unstable_getCurrentPriorityLevel,wi=r.unstable_ImmediatePriority,Nr=r.unstable_UserBlockingPriority,un=r.unstable_NormalPriority,To=r.unstable_LowPriority,Yu=r.unstable_IdlePriority,hc=r.log,dc=r.unstable_setDisableYieldValue,Mr=null,Ge=null;function Un(i){if(typeof hc=="function"&&dc(i),Ge&&typeof Ge.setStrictMode=="function")try{Ge.setStrictMode(Mr,i)}catch{}}var En=Math.clz32?Math.clz32:cx,sx=Math.log,lx=Math.LN2;function cx(i){return i>>>=0,i===0?32:31-(sx(i)/lx|0)|0}var Qu=256,Zu=262144,Ju=4194304;function Va(i){var o=i&42;if(o!==0)return o;switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return i&261888;case 262144:case 524288:case 1048576:case 2097152:return i&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return i&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return i}}function $u(i,o,c){var d=i.pendingLanes;if(d===0)return 0;var g=0,b=i.suspendedLanes,C=i.pingedLanes;i=i.warmLanes;var D=d&134217727;return D!==0?(d=D&~b,d!==0?g=Va(d):(C&=D,C!==0?g=Va(C):c||(c=D&~i,c!==0&&(g=Va(c))))):(D=d&~b,D!==0?g=Va(D):C!==0?g=Va(C):c||(c=d&~i,c!==0&&(g=Va(c)))),g===0?0:o!==0&&o!==g&&(o&b)===0&&(b=g&-g,c=o&-o,b>=c||b===32&&(c&4194048)!==0)?o:g}function Do(i,o){return(i.pendingLanes&~(i.suspendedLanes&~i.pingedLanes)&o)===0}function fx(i,o){switch(i){case 1:case 2:case 4:case 8:case 64:return o+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Fp(){var i=Ju;return Ju<<=1,(Ju&62914560)===0&&(Ju=4194304),i}function pc(i){for(var o=[],c=0;31>c;c++)o.push(i);return o}function No(i,o){i.pendingLanes|=o,o!==268435456&&(i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0)}function hx(i,o,c,d,g,b){var C=i.pendingLanes;i.pendingLanes=c,i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0,i.expiredLanes&=c,i.entangledLanes&=c,i.errorRecoveryDisabledLanes&=c,i.shellSuspendCounter=0;var D=i.entanglements,U=i.expirationTimes,Q=i.hiddenUpdates;for(c=C&~c;0<c;){var ut=31-En(c),ct=1<<ut;D[ut]=0,U[ut]=-1;var Z=Q[ut];if(Z!==null)for(Q[ut]=null,ut=0;ut<Z.length;ut++){var $=Z[ut];$!==null&&($.lane&=-536870913)}c&=~ct}d!==0&&zp(i,d,0),b!==0&&g===0&&i.tag!==0&&(i.suspendedLanes|=b&~(C&~o))}function zp(i,o,c){i.pendingLanes|=o,i.suspendedLanes&=~o;var d=31-En(o);i.entangledLanes|=o,i.entanglements[d]=i.entanglements[d]|1073741824|c&261930}function Lp(i,o){var c=i.entangledLanes|=o;for(i=i.entanglements;c;){var d=31-En(c),g=1<<d;g&o|i[d]&o&&(i[d]|=o),c&=~g}}function Up(i,o){var c=o&-o;return c=(c&42)!==0?1:vc(c),(c&(i.suspendedLanes|o))!==0?0:c}function vc(i){switch(i){case 2:i=1;break;case 8:i=4;break;case 32:i=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:i=128;break;case 268435456:i=134217728;break;default:i=0}return i}function mc(i){return i&=-i,2<i?8<i?(i&134217727)!==0?32:268435456:8:2}function Pp(){var i=q.p;return i!==0?i:(i=window.event,i===void 0?32:S0(i.type))}function Hp(i,o){var c=q.p;try{return q.p=i,o()}finally{q.p=c}}var oa=Math.random().toString(36).slice(2),We="__reactFiber$"+oa,ln="__reactProps$"+oa,_i="__reactContainer$"+oa,gc="__reactEvents$"+oa,dx="__reactListeners$"+oa,px="__reactHandles$"+oa,Vp="__reactResources$"+oa,Mo="__reactMarker$"+oa;function yc(i){delete i[We],delete i[ln],delete i[gc],delete i[dx],delete i[px]}function Ei(i){var o=i[We];if(o)return o;for(var c=i.parentNode;c;){if(o=c[_i]||c[We]){if(c=o.alternate,o.child!==null||c!==null&&c.child!==null)for(i=l0(i);i!==null;){if(c=i[We])return c;i=l0(i)}return o}i=c,c=i.parentNode}return null}function Ci(i){if(i=i[We]||i[_i]){var o=i.tag;if(o===5||o===6||o===13||o===31||o===26||o===27||o===3)return i}return null}function Oo(i){var o=i.tag;if(o===5||o===26||o===27||o===6)return i.stateNode;throw Error(e(33))}function Si(i){var o=i[Vp];return o||(o=i[Vp]={hoistableStyles:new Map,hoistableScripts:new Map}),o}function ze(i){i[Mo]=!0}var Gp=new Set,Wp={};function Ga(i,o){Ri(i,o),Ri(i+"Capture",o)}function Ri(i,o){for(Wp[i]=o,i=0;i<o.length;i++)Gp.add(o[i])}var vx=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),qp={},jp={};function mx(i){return Ve.call(jp,i)?!0:Ve.call(qp,i)?!1:vx.test(i)?jp[i]=!0:(qp[i]=!0,!1)}function ts(i,o,c){if(mx(o))if(c===null)i.removeAttribute(o);else{switch(typeof c){case"undefined":case"function":case"symbol":i.removeAttribute(o);return;case"boolean":var d=o.toLowerCase().slice(0,5);if(d!=="data-"&&d!=="aria-"){i.removeAttribute(o);return}}i.setAttribute(o,""+c)}}function es(i,o,c){if(c===null)i.removeAttribute(o);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(o);return}i.setAttribute(o,""+c)}}function Or(i,o,c,d){if(d===null)i.removeAttribute(c);else{switch(typeof d){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(c);return}i.setAttributeNS(o,c,""+d)}}function Pn(i){switch(typeof i){case"bigint":case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function Xp(i){var o=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function gx(i,o,c){var d=Object.getOwnPropertyDescriptor(i.constructor.prototype,o);if(!i.hasOwnProperty(o)&&typeof d<"u"&&typeof d.get=="function"&&typeof d.set=="function"){var g=d.get,b=d.set;return Object.defineProperty(i,o,{configurable:!0,get:function(){return g.call(this)},set:function(C){c=""+C,b.call(this,C)}}),Object.defineProperty(i,o,{enumerable:d.enumerable}),{getValue:function(){return c},setValue:function(C){c=""+C},stopTracking:function(){i._valueTracker=null,delete i[o]}}}}function bc(i){if(!i._valueTracker){var o=Xp(i)?"checked":"value";i._valueTracker=gx(i,o,""+i[o])}}function Kp(i){if(!i)return!1;var o=i._valueTracker;if(!o)return!0;var c=o.getValue(),d="";return i&&(d=Xp(i)?i.checked?"true":"false":i.value),i=d,i!==c?(o.setValue(i),!0):!1}function ns(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}var yx=/[\n"\\]/g;function Hn(i){return i.replace(yx,function(o){return"\\"+o.charCodeAt(0).toString(16)+" "})}function xc(i,o,c,d,g,b,C,D){i.name="",C!=null&&typeof C!="function"&&typeof C!="symbol"&&typeof C!="boolean"?i.type=C:i.removeAttribute("type"),o!=null?C==="number"?(o===0&&i.value===""||i.value!=o)&&(i.value=""+Pn(o)):i.value!==""+Pn(o)&&(i.value=""+Pn(o)):C!=="submit"&&C!=="reset"||i.removeAttribute("value"),o!=null?wc(i,C,Pn(o)):c!=null?wc(i,C,Pn(c)):d!=null&&i.removeAttribute("value"),g==null&&b!=null&&(i.defaultChecked=!!b),g!=null&&(i.checked=g&&typeof g!="function"&&typeof g!="symbol"),D!=null&&typeof D!="function"&&typeof D!="symbol"&&typeof D!="boolean"?i.name=""+Pn(D):i.removeAttribute("name")}function Yp(i,o,c,d,g,b,C,D){if(b!=null&&typeof b!="function"&&typeof b!="symbol"&&typeof b!="boolean"&&(i.type=b),o!=null||c!=null){if(!(b!=="submit"&&b!=="reset"||o!=null)){bc(i);return}c=c!=null?""+Pn(c):"",o=o!=null?""+Pn(o):c,D||o===i.value||(i.value=o),i.defaultValue=o}d=d??g,d=typeof d!="function"&&typeof d!="symbol"&&!!d,i.checked=D?i.checked:!!d,i.defaultChecked=!!d,C!=null&&typeof C!="function"&&typeof C!="symbol"&&typeof C!="boolean"&&(i.name=C),bc(i)}function wc(i,o,c){o==="number"&&ns(i.ownerDocument)===i||i.defaultValue===""+c||(i.defaultValue=""+c)}function Ai(i,o,c,d){if(i=i.options,o){o={};for(var g=0;g<c.length;g++)o["$"+c[g]]=!0;for(c=0;c<i.length;c++)g=o.hasOwnProperty("$"+i[c].value),i[c].selected!==g&&(i[c].selected=g),g&&d&&(i[c].defaultSelected=!0)}else{for(c=""+Pn(c),o=null,g=0;g<i.length;g++){if(i[g].value===c){i[g].selected=!0,d&&(i[g].defaultSelected=!0);return}o!==null||i[g].disabled||(o=i[g])}o!==null&&(o.selected=!0)}}function Qp(i,o,c){if(o!=null&&(o=""+Pn(o),o!==i.value&&(i.value=o),c==null)){i.defaultValue!==o&&(i.defaultValue=o);return}i.defaultValue=c!=null?""+Pn(c):""}function Zp(i,o,c,d){if(o==null){if(d!=null){if(c!=null)throw Error(e(92));if(nt(d)){if(1<d.length)throw Error(e(93));d=d[0]}c=d}c==null&&(c=""),o=c}c=Pn(o),i.defaultValue=c,d=i.textContent,d===c&&d!==""&&d!==null&&(i.value=d),bc(i)}function Ti(i,o){if(o){var c=i.firstChild;if(c&&c===i.lastChild&&c.nodeType===3){c.nodeValue=o;return}}i.textContent=o}var bx=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Jp(i,o,c){var d=o.indexOf("--")===0;c==null||typeof c=="boolean"||c===""?d?i.setProperty(o,""):o==="float"?i.cssFloat="":i[o]="":d?i.setProperty(o,c):typeof c!="number"||c===0||bx.has(o)?o==="float"?i.cssFloat=c:i[o]=(""+c).trim():i[o]=c+"px"}function $p(i,o,c){if(o!=null&&typeof o!="object")throw Error(e(62));if(i=i.style,c!=null){for(var d in c)!c.hasOwnProperty(d)||o!=null&&o.hasOwnProperty(d)||(d.indexOf("--")===0?i.setProperty(d,""):d==="float"?i.cssFloat="":i[d]="");for(var g in o)d=o[g],o.hasOwnProperty(g)&&c[g]!==d&&Jp(i,g,d)}else for(var b in o)o.hasOwnProperty(b)&&Jp(i,b,o[b])}function _c(i){if(i.indexOf("-")===-1)return!1;switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var xx=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),wx=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function rs(i){return wx.test(""+i)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":i}function kr(){}var Ec=null;function Cc(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var Di=null,Ni=null;function tv(i){var o=Ci(i);if(o&&(i=o.stateNode)){var c=i[ln]||null;t:switch(i=o.stateNode,o.type){case"input":if(xc(i,c.value,c.defaultValue,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name),o=c.name,c.type==="radio"&&o!=null){for(c=i;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll('input[name="'+Hn(""+o)+'"][type="radio"]'),o=0;o<c.length;o++){var d=c[o];if(d!==i&&d.form===i.form){var g=d[ln]||null;if(!g)throw Error(e(90));xc(d,g.value,g.defaultValue,g.defaultValue,g.checked,g.defaultChecked,g.type,g.name)}}for(o=0;o<c.length;o++)d=c[o],d.form===i.form&&Kp(d)}break t;case"textarea":Qp(i,c.value,c.defaultValue);break t;case"select":o=c.value,o!=null&&Ai(i,!!c.multiple,o,!1)}}}var Sc=!1;function ev(i,o,c){if(Sc)return i(o,c);Sc=!0;try{var d=i(o);return d}finally{if(Sc=!1,(Di!==null||Ni!==null)&&(Ws(),Di&&(o=Di,i=Ni,Ni=Di=null,tv(o),i)))for(o=0;o<i.length;o++)tv(i[o])}}function ko(i,o){var c=i.stateNode;if(c===null)return null;var d=c[ln]||null;if(d===null)return null;c=d[o];t:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(d=!d.disabled)||(i=i.type,d=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!d;break t;default:i=!1}if(i)return null;if(c&&typeof c!="function")throw Error(e(231,o,typeof c));return c}var Ir=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Rc=!1;if(Ir)try{var Io={};Object.defineProperty(Io,"passive",{get:function(){Rc=!0}}),window.addEventListener("test",Io,Io),window.removeEventListener("test",Io,Io)}catch{Rc=!1}var ua=null,Ac=null,as=null;function nv(){if(as)return as;var i,o=Ac,c=o.length,d,g="value"in ua?ua.value:ua.textContent,b=g.length;for(i=0;i<c&&o[i]===g[i];i++);var C=c-i;for(d=1;d<=C&&o[c-d]===g[b-d];d++);return as=g.slice(i,1<d?1-d:void 0)}function is(i){var o=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&o===13&&(i=13)):i=o,i===10&&(i=13),32<=i||i===13?i:0}function os(){return!0}function rv(){return!1}function cn(i){function o(c,d,g,b,C){this._reactName=c,this._targetInst=g,this.type=d,this.nativeEvent=b,this.target=C,this.currentTarget=null;for(var D in i)i.hasOwnProperty(D)&&(c=i[D],this[D]=c?c(b):b[D]);return this.isDefaultPrevented=(b.defaultPrevented!=null?b.defaultPrevented:b.returnValue===!1)?os:rv,this.isPropagationStopped=rv,this}return v(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=os)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=os)},persist:function(){},isPersistent:os}),o}var Wa={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},us=cn(Wa),Bo=v({},Wa,{view:0,detail:0}),_x=cn(Bo),Tc,Dc,Fo,ss=v({},Bo,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Mc,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==Fo&&(Fo&&i.type==="mousemove"?(Tc=i.screenX-Fo.screenX,Dc=i.screenY-Fo.screenY):Dc=Tc=0,Fo=i),Tc)},movementY:function(i){return"movementY"in i?i.movementY:Dc}}),av=cn(ss),Ex=v({},ss,{dataTransfer:0}),Cx=cn(Ex),Sx=v({},Bo,{relatedTarget:0}),Nc=cn(Sx),Rx=v({},Wa,{animationName:0,elapsedTime:0,pseudoElement:0}),Ax=cn(Rx),Tx=v({},Wa,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),Dx=cn(Tx),Nx=v({},Wa,{data:0}),iv=cn(Nx),Mx={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Ox={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},kx={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Ix(i){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(i):(i=kx[i])?!!o[i]:!1}function Mc(){return Ix}var Bx=v({},Bo,{key:function(i){if(i.key){var o=Mx[i.key]||i.key;if(o!=="Unidentified")return o}return i.type==="keypress"?(i=is(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?Ox[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Mc,charCode:function(i){return i.type==="keypress"?is(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?is(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),Fx=cn(Bx),zx=v({},ss,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),ov=cn(zx),Lx=v({},Bo,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Mc}),Ux=cn(Lx),Px=v({},Wa,{propertyName:0,elapsedTime:0,pseudoElement:0}),Hx=cn(Px),Vx=v({},ss,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),Gx=cn(Vx),Wx=v({},Wa,{newState:0,oldState:0}),qx=cn(Wx),jx=[9,13,27,32],Oc=Ir&&"CompositionEvent"in window,zo=null;Ir&&"documentMode"in document&&(zo=document.documentMode);var Xx=Ir&&"TextEvent"in window&&!zo,uv=Ir&&(!Oc||zo&&8<zo&&11>=zo),sv=" ",lv=!1;function cv(i,o){switch(i){case"keyup":return jx.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function fv(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var Mi=!1;function Kx(i,o){switch(i){case"compositionend":return fv(o);case"keypress":return o.which!==32?null:(lv=!0,sv);case"textInput":return i=o.data,i===sv&&lv?null:i;default:return null}}function Yx(i,o){if(Mi)return i==="compositionend"||!Oc&&cv(i,o)?(i=nv(),as=Ac=ua=null,Mi=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return uv&&o.locale!=="ko"?null:o.data;default:return null}}var Qx={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function hv(i){var o=i&&i.nodeName&&i.nodeName.toLowerCase();return o==="input"?!!Qx[i.type]:o==="textarea"}function dv(i,o,c,d){Di?Ni?Ni.push(d):Ni=[d]:Di=d,o=Zs(o,"onChange"),0<o.length&&(c=new us("onChange","change",null,c,d),i.push({event:c,listeners:o}))}var Lo=null,Uo=null;function Zx(i){Yg(i,0)}function ls(i){var o=Oo(i);if(Kp(o))return i}function pv(i,o){if(i==="change")return o}var vv=!1;if(Ir){var kc;if(Ir){var Ic="oninput"in document;if(!Ic){var mv=document.createElement("div");mv.setAttribute("oninput","return;"),Ic=typeof mv.oninput=="function"}kc=Ic}else kc=!1;vv=kc&&(!document.documentMode||9<document.documentMode)}function gv(){Lo&&(Lo.detachEvent("onpropertychange",yv),Uo=Lo=null)}function yv(i){if(i.propertyName==="value"&&ls(Uo)){var o=[];dv(o,Uo,i,Cc(i)),ev(Zx,o)}}function Jx(i,o,c){i==="focusin"?(gv(),Lo=o,Uo=c,Lo.attachEvent("onpropertychange",yv)):i==="focusout"&&gv()}function $x(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return ls(Uo)}function t2(i,o){if(i==="click")return ls(o)}function e2(i,o){if(i==="input"||i==="change")return ls(o)}function n2(i,o){return i===o&&(i!==0||1/i===1/o)||i!==i&&o!==o}var Cn=typeof Object.is=="function"?Object.is:n2;function Po(i,o){if(Cn(i,o))return!0;if(typeof i!="object"||i===null||typeof o!="object"||o===null)return!1;var c=Object.keys(i),d=Object.keys(o);if(c.length!==d.length)return!1;for(d=0;d<c.length;d++){var g=c[d];if(!Ve.call(o,g)||!Cn(i[g],o[g]))return!1}return!0}function bv(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function xv(i,o){var c=bv(i);i=0;for(var d;c;){if(c.nodeType===3){if(d=i+c.textContent.length,i<=o&&d>=o)return{node:c,offset:o-i};i=d}t:{for(;c;){if(c.nextSibling){c=c.nextSibling;break t}c=c.parentNode}c=void 0}c=bv(c)}}function wv(i,o){return i&&o?i===o?!0:i&&i.nodeType===3?!1:o&&o.nodeType===3?wv(i,o.parentNode):"contains"in i?i.contains(o):i.compareDocumentPosition?!!(i.compareDocumentPosition(o)&16):!1:!1}function _v(i){i=i!=null&&i.ownerDocument!=null&&i.ownerDocument.defaultView!=null?i.ownerDocument.defaultView:window;for(var o=ns(i.document);o instanceof i.HTMLIFrameElement;){try{var c=typeof o.contentWindow.location.href=="string"}catch{c=!1}if(c)i=o.contentWindow;else break;o=ns(i.document)}return o}function Bc(i){var o=i&&i.nodeName&&i.nodeName.toLowerCase();return o&&(o==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||o==="textarea"||i.contentEditable==="true")}var r2=Ir&&"documentMode"in document&&11>=document.documentMode,Oi=null,Fc=null,Ho=null,zc=!1;function Ev(i,o,c){var d=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;zc||Oi==null||Oi!==ns(d)||(d=Oi,"selectionStart"in d&&Bc(d)?d={start:d.selectionStart,end:d.selectionEnd}:(d=(d.ownerDocument&&d.ownerDocument.defaultView||window).getSelection(),d={anchorNode:d.anchorNode,anchorOffset:d.anchorOffset,focusNode:d.focusNode,focusOffset:d.focusOffset}),Ho&&Po(Ho,d)||(Ho=d,d=Zs(Fc,"onSelect"),0<d.length&&(o=new us("onSelect","select",null,o,c),i.push({event:o,listeners:d}),o.target=Oi)))}function qa(i,o){var c={};return c[i.toLowerCase()]=o.toLowerCase(),c["Webkit"+i]="webkit"+o,c["Moz"+i]="moz"+o,c}var ki={animationend:qa("Animation","AnimationEnd"),animationiteration:qa("Animation","AnimationIteration"),animationstart:qa("Animation","AnimationStart"),transitionrun:qa("Transition","TransitionRun"),transitionstart:qa("Transition","TransitionStart"),transitioncancel:qa("Transition","TransitionCancel"),transitionend:qa("Transition","TransitionEnd")},Lc={},Cv={};Ir&&(Cv=document.createElement("div").style,"AnimationEvent"in window||(delete ki.animationend.animation,delete ki.animationiteration.animation,delete ki.animationstart.animation),"TransitionEvent"in window||delete ki.transitionend.transition);function ja(i){if(Lc[i])return Lc[i];if(!ki[i])return i;var o=ki[i],c;for(c in o)if(o.hasOwnProperty(c)&&c in Cv)return Lc[i]=o[c];return i}var Sv=ja("animationend"),Rv=ja("animationiteration"),Av=ja("animationstart"),a2=ja("transitionrun"),i2=ja("transitionstart"),o2=ja("transitioncancel"),Tv=ja("transitionend"),Dv=new Map,Uc="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Uc.push("scrollEnd");function nr(i,o){Dv.set(i,o),Ga(o,[i])}var cs=typeof reportError=="function"?reportError:function(i){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var o=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof i=="object"&&i!==null&&typeof i.message=="string"?String(i.message):String(i),error:i});if(!window.dispatchEvent(o))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",i);return}console.error(i)},Vn=[],Ii=0,Pc=0;function fs(){for(var i=Ii,o=Pc=Ii=0;o<i;){var c=Vn[o];Vn[o++]=null;var d=Vn[o];Vn[o++]=null;var g=Vn[o];Vn[o++]=null;var b=Vn[o];if(Vn[o++]=null,d!==null&&g!==null){var C=d.pending;C===null?g.next=g:(g.next=C.next,C.next=g),d.pending=g}b!==0&&Nv(c,g,b)}}function hs(i,o,c,d){Vn[Ii++]=i,Vn[Ii++]=o,Vn[Ii++]=c,Vn[Ii++]=d,Pc|=d,i.lanes|=d,i=i.alternate,i!==null&&(i.lanes|=d)}function Hc(i,o,c,d){return hs(i,o,c,d),ds(i)}function Xa(i,o){return hs(i,null,null,o),ds(i)}function Nv(i,o,c){i.lanes|=c;var d=i.alternate;d!==null&&(d.lanes|=c);for(var g=!1,b=i.return;b!==null;)b.childLanes|=c,d=b.alternate,d!==null&&(d.childLanes|=c),b.tag===22&&(i=b.stateNode,i===null||i._visibility&1||(g=!0)),i=b,b=b.return;return i.tag===3?(b=i.stateNode,g&&o!==null&&(g=31-En(c),i=b.hiddenUpdates,d=i[g],d===null?i[g]=[o]:d.push(o),o.lane=c|536870912),b):null}function ds(i){if(50<lu)throw lu=0,Zf=null,Error(e(185));for(var o=i.return;o!==null;)i=o,o=i.return;return i.tag===3?i.stateNode:null}var Bi={};function u2(i,o,c,d){this.tag=i,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=d,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Sn(i,o,c,d){return new u2(i,o,c,d)}function Vc(i){return i=i.prototype,!(!i||!i.isReactComponent)}function Br(i,o){var c=i.alternate;return c===null?(c=Sn(i.tag,o,i.key,i.mode),c.elementType=i.elementType,c.type=i.type,c.stateNode=i.stateNode,c.alternate=i,i.alternate=c):(c.pendingProps=o,c.type=i.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=i.flags&65011712,c.childLanes=i.childLanes,c.lanes=i.lanes,c.child=i.child,c.memoizedProps=i.memoizedProps,c.memoizedState=i.memoizedState,c.updateQueue=i.updateQueue,o=i.dependencies,c.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},c.sibling=i.sibling,c.index=i.index,c.ref=i.ref,c.refCleanup=i.refCleanup,c}function Mv(i,o){i.flags&=65011714;var c=i.alternate;return c===null?(i.childLanes=0,i.lanes=o,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=c.childLanes,i.lanes=c.lanes,i.child=c.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=c.memoizedProps,i.memoizedState=c.memoizedState,i.updateQueue=c.updateQueue,i.type=c.type,o=c.dependencies,i.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext}),i}function ps(i,o,c,d,g,b){var C=0;if(d=i,typeof i=="function")Vc(i)&&(C=1);else if(typeof i=="string")C=hw(i,c,ht.current)?26:i==="html"||i==="head"||i==="body"?27:5;else t:switch(i){case I:return i=Sn(31,c,o,g),i.elementType=I,i.lanes=b,i;case w:return Ka(c.children,g,b,o);case _:C=8,g|=24;break;case E:return i=Sn(12,c,o,g|2),i.elementType=E,i.lanes=b,i;case T:return i=Sn(13,c,o,g),i.elementType=T,i.lanes=b,i;case N:return i=Sn(19,c,o,g),i.elementType=N,i.lanes=b,i;default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case A:C=10;break t;case R:C=9;break t;case S:C=11;break t;case O:C=14;break t;case B:C=16,d=null;break t}C=29,c=Error(e(130,i===null?"null":typeof i,"")),d=null}return o=Sn(C,c,o,g),o.elementType=i,o.type=d,o.lanes=b,o}function Ka(i,o,c,d){return i=Sn(7,i,d,o),i.lanes=c,i}function Gc(i,o,c){return i=Sn(6,i,null,o),i.lanes=c,i}function Ov(i){var o=Sn(18,null,null,0);return o.stateNode=i,o}function Wc(i,o,c){return o=Sn(4,i.children!==null?i.children:[],i.key,o),o.lanes=c,o.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},o}var kv=new WeakMap;function Gn(i,o){if(typeof i=="object"&&i!==null){var c=kv.get(i);return c!==void 0?c:(o={value:i,source:o,stack:wn(o)},kv.set(i,o),o)}return{value:i,source:o,stack:wn(o)}}var Fi=[],zi=0,vs=null,Vo=0,Wn=[],qn=0,sa=null,hr=1,dr="";function Fr(i,o){Fi[zi++]=Vo,Fi[zi++]=vs,vs=i,Vo=o}function Iv(i,o,c){Wn[qn++]=hr,Wn[qn++]=dr,Wn[qn++]=sa,sa=i;var d=hr;i=dr;var g=32-En(d)-1;d&=~(1<<g),c+=1;var b=32-En(o)+g;if(30<b){var C=g-g%5;b=(d&(1<<C)-1).toString(32),d>>=C,g-=C,hr=1<<32-En(o)+g|c<<g|d,dr=b+i}else hr=1<<b|c<<g|d,dr=i}function qc(i){i.return!==null&&(Fr(i,1),Iv(i,1,0))}function jc(i){for(;i===vs;)vs=Fi[--zi],Fi[zi]=null,Vo=Fi[--zi],Fi[zi]=null;for(;i===sa;)sa=Wn[--qn],Wn[qn]=null,dr=Wn[--qn],Wn[qn]=null,hr=Wn[--qn],Wn[qn]=null}function Bv(i,o){Wn[qn++]=hr,Wn[qn++]=dr,Wn[qn++]=sa,hr=o.id,dr=o.overflow,sa=i}var qe=null,ce=null,Wt=!1,la=null,jn=!1,Xc=Error(e(519));function ca(i){var o=Error(e(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Go(Gn(o,i)),Xc}function Fv(i){var o=i.stateNode,c=i.type,d=i.memoizedProps;switch(o[We]=i,o[ln]=d,c){case"dialog":Pt("cancel",o),Pt("close",o);break;case"iframe":case"object":case"embed":Pt("load",o);break;case"video":case"audio":for(c=0;c<fu.length;c++)Pt(fu[c],o);break;case"source":Pt("error",o);break;case"img":case"image":case"link":Pt("error",o),Pt("load",o);break;case"details":Pt("toggle",o);break;case"input":Pt("invalid",o),Yp(o,d.value,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name,!0);break;case"select":Pt("invalid",o);break;case"textarea":Pt("invalid",o),Zp(o,d.value,d.defaultValue,d.children)}c=d.children,typeof c!="string"&&typeof c!="number"&&typeof c!="bigint"||o.textContent===""+c||d.suppressHydrationWarning===!0||$g(o.textContent,c)?(d.popover!=null&&(Pt("beforetoggle",o),Pt("toggle",o)),d.onScroll!=null&&Pt("scroll",o),d.onScrollEnd!=null&&Pt("scrollend",o),d.onClick!=null&&(o.onclick=kr),o=!0):o=!1,o||ca(i,!0)}function zv(i){for(qe=i.return;qe;)switch(qe.tag){case 5:case 31:case 13:jn=!1;return;case 27:case 3:jn=!0;return;default:qe=qe.return}}function Li(i){if(i!==qe)return!1;if(!Wt)return zv(i),Wt=!0,!1;var o=i.tag,c;if((c=o!==3&&o!==27)&&((c=o===5)&&(c=i.type,c=!(c!=="form"&&c!=="button")||hh(i.type,i.memoizedProps)),c=!c),c&&ce&&ca(i),zv(i),o===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(e(317));ce=s0(i)}else if(o===31){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(e(317));ce=s0(i)}else o===27?(o=ce,Ca(i.type)?(i=gh,gh=null,ce=i):ce=o):ce=qe?Kn(i.stateNode.nextSibling):null;return!0}function Ya(){ce=qe=null,Wt=!1}function Kc(){var i=la;return i!==null&&(pn===null?pn=i:pn.push.apply(pn,i),la=null),i}function Go(i){la===null?la=[i]:la.push(i)}var Yc=z(null),Qa=null,zr=null;function fa(i,o,c){it(Yc,o._currentValue),o._currentValue=c}function Lr(i){i._currentValue=Yc.current,X(Yc)}function Qc(i,o,c){for(;i!==null;){var d=i.alternate;if((i.childLanes&o)!==o?(i.childLanes|=o,d!==null&&(d.childLanes|=o)):d!==null&&(d.childLanes&o)!==o&&(d.childLanes|=o),i===c)break;i=i.return}}function Zc(i,o,c,d){var g=i.child;for(g!==null&&(g.return=i);g!==null;){var b=g.dependencies;if(b!==null){var C=g.child;b=b.firstContext;t:for(;b!==null;){var D=b;b=g;for(var U=0;U<o.length;U++)if(D.context===o[U]){b.lanes|=c,D=b.alternate,D!==null&&(D.lanes|=c),Qc(b.return,c,i),d||(C=null);break t}b=D.next}}else if(g.tag===18){if(C=g.return,C===null)throw Error(e(341));C.lanes|=c,b=C.alternate,b!==null&&(b.lanes|=c),Qc(C,c,i),C=null}else C=g.child;if(C!==null)C.return=g;else for(C=g;C!==null;){if(C===i){C=null;break}if(g=C.sibling,g!==null){g.return=C.return,C=g;break}C=C.return}g=C}}function Ui(i,o,c,d){i=null;for(var g=o,b=!1;g!==null;){if(!b){if((g.flags&524288)!==0)b=!0;else if((g.flags&262144)!==0)break}if(g.tag===10){var C=g.alternate;if(C===null)throw Error(e(387));if(C=C.memoizedProps,C!==null){var D=g.type;Cn(g.pendingProps.value,C.value)||(i!==null?i.push(D):i=[D])}}else if(g===gt.current){if(C=g.alternate,C===null)throw Error(e(387));C.memoizedState.memoizedState!==g.memoizedState.memoizedState&&(i!==null?i.push(mu):i=[mu])}g=g.return}i!==null&&Zc(o,i,c,d),o.flags|=262144}function ms(i){for(i=i.firstContext;i!==null;){if(!Cn(i.context._currentValue,i.memoizedValue))return!0;i=i.next}return!1}function Za(i){Qa=i,zr=null,i=i.dependencies,i!==null&&(i.firstContext=null)}function je(i){return Lv(Qa,i)}function gs(i,o){return Qa===null&&Za(i),Lv(i,o)}function Lv(i,o){var c=o._currentValue;if(o={context:o,memoizedValue:c,next:null},zr===null){if(i===null)throw Error(e(308));zr=o,i.dependencies={lanes:0,firstContext:o},i.flags|=524288}else zr=zr.next=o;return c}var s2=typeof AbortController<"u"?AbortController:function(){var i=[],o=this.signal={aborted:!1,addEventListener:function(c,d){i.push(d)}};this.abort=function(){o.aborted=!0,i.forEach(function(c){return c()})}},l2=r.unstable_scheduleCallback,c2=r.unstable_NormalPriority,Ce={$$typeof:A,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Jc(){return{controller:new s2,data:new Map,refCount:0}}function Wo(i){i.refCount--,i.refCount===0&&l2(c2,function(){i.controller.abort()})}var qo=null,$c=0,Pi=0,Hi=null;function f2(i,o){if(qo===null){var c=qo=[];$c=0,Pi=rh(),Hi={status:"pending",value:void 0,then:function(d){c.push(d)}}}return $c++,o.then(Uv,Uv),o}function Uv(){if(--$c===0&&qo!==null){Hi!==null&&(Hi.status="fulfilled");var i=qo;qo=null,Pi=0,Hi=null;for(var o=0;o<i.length;o++)(0,i[o])()}}function h2(i,o){var c=[],d={status:"pending",value:null,reason:null,then:function(g){c.push(g)}};return i.then(function(){d.status="fulfilled",d.value=o;for(var g=0;g<c.length;g++)(0,c[g])(o)},function(g){for(d.status="rejected",d.reason=g,g=0;g<c.length;g++)(0,c[g])(void 0)}),d}var Pv=L.S;L.S=function(i,o){Eg=Ee(),typeof o=="object"&&o!==null&&typeof o.then=="function"&&f2(i,o),Pv!==null&&Pv(i,o)};var Ja=z(null);function tf(){var i=Ja.current;return i!==null?i:se.pooledCache}function ys(i,o){o===null?it(Ja,Ja.current):it(Ja,o.pool)}function Hv(){var i=tf();return i===null?null:{parent:Ce._currentValue,pool:i}}var Vi=Error(e(460)),ef=Error(e(474)),bs=Error(e(542)),xs={then:function(){}};function Vv(i){return i=i.status,i==="fulfilled"||i==="rejected"}function Gv(i,o,c){switch(c=i[c],c===void 0?i.push(o):c!==o&&(o.then(kr,kr),o=c),o.status){case"fulfilled":return o.value;case"rejected":throw i=o.reason,qv(i),i;default:if(typeof o.status=="string")o.then(kr,kr);else{if(i=se,i!==null&&100<i.shellSuspendCounter)throw Error(e(482));i=o,i.status="pending",i.then(function(d){if(o.status==="pending"){var g=o;g.status="fulfilled",g.value=d}},function(d){if(o.status==="pending"){var g=o;g.status="rejected",g.reason=d}})}switch(o.status){case"fulfilled":return o.value;case"rejected":throw i=o.reason,qv(i),i}throw ti=o,Vi}}function $a(i){try{var o=i._init;return o(i._payload)}catch(c){throw c!==null&&typeof c=="object"&&typeof c.then=="function"?(ti=c,Vi):c}}var ti=null;function Wv(){if(ti===null)throw Error(e(459));var i=ti;return ti=null,i}function qv(i){if(i===Vi||i===bs)throw Error(e(483))}var Gi=null,jo=0;function ws(i){var o=jo;return jo+=1,Gi===null&&(Gi=[]),Gv(Gi,i,o)}function Xo(i,o){o=o.props.ref,i.ref=o!==void 0?o:null}function _s(i,o){throw o.$$typeof===m?Error(e(525)):(i=Object.prototype.toString.call(o),Error(e(31,i==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":i)))}function jv(i){function o(j,V){if(i){var Y=j.deletions;Y===null?(j.deletions=[V],j.flags|=16):Y.push(V)}}function c(j,V){if(!i)return null;for(;V!==null;)o(j,V),V=V.sibling;return null}function d(j){for(var V=new Map;j!==null;)j.key!==null?V.set(j.key,j):V.set(j.index,j),j=j.sibling;return V}function g(j,V){return j=Br(j,V),j.index=0,j.sibling=null,j}function b(j,V,Y){return j.index=Y,i?(Y=j.alternate,Y!==null?(Y=Y.index,Y<V?(j.flags|=67108866,V):Y):(j.flags|=67108866,V)):(j.flags|=1048576,V)}function C(j){return i&&j.alternate===null&&(j.flags|=67108866),j}function D(j,V,Y,lt){return V===null||V.tag!==6?(V=Gc(Y,j.mode,lt),V.return=j,V):(V=g(V,Y),V.return=j,V)}function U(j,V,Y,lt){var At=Y.type;return At===w?ut(j,V,Y.props.children,lt,Y.key):V!==null&&(V.elementType===At||typeof At=="object"&&At!==null&&At.$$typeof===B&&$a(At)===V.type)?(V=g(V,Y.props),Xo(V,Y),V.return=j,V):(V=ps(Y.type,Y.key,Y.props,null,j.mode,lt),Xo(V,Y),V.return=j,V)}function Q(j,V,Y,lt){return V===null||V.tag!==4||V.stateNode.containerInfo!==Y.containerInfo||V.stateNode.implementation!==Y.implementation?(V=Wc(Y,j.mode,lt),V.return=j,V):(V=g(V,Y.children||[]),V.return=j,V)}function ut(j,V,Y,lt,At){return V===null||V.tag!==7?(V=Ka(Y,j.mode,lt,At),V.return=j,V):(V=g(V,Y),V.return=j,V)}function ct(j,V,Y){if(typeof V=="string"&&V!==""||typeof V=="number"||typeof V=="bigint")return V=Gc(""+V,j.mode,Y),V.return=j,V;if(typeof V=="object"&&V!==null){switch(V.$$typeof){case y:return Y=ps(V.type,V.key,V.props,null,j.mode,Y),Xo(Y,V),Y.return=j,Y;case x:return V=Wc(V,j.mode,Y),V.return=j,V;case B:return V=$a(V),ct(j,V,Y)}if(nt(V)||H(V))return V=Ka(V,j.mode,Y,null),V.return=j,V;if(typeof V.then=="function")return ct(j,ws(V),Y);if(V.$$typeof===A)return ct(j,gs(j,V),Y);_s(j,V)}return null}function Z(j,V,Y,lt){var At=V!==null?V.key:null;if(typeof Y=="string"&&Y!==""||typeof Y=="number"||typeof Y=="bigint")return At!==null?null:D(j,V,""+Y,lt);if(typeof Y=="object"&&Y!==null){switch(Y.$$typeof){case y:return Y.key===At?U(j,V,Y,lt):null;case x:return Y.key===At?Q(j,V,Y,lt):null;case B:return Y=$a(Y),Z(j,V,Y,lt)}if(nt(Y)||H(Y))return At!==null?null:ut(j,V,Y,lt,null);if(typeof Y.then=="function")return Z(j,V,ws(Y),lt);if(Y.$$typeof===A)return Z(j,V,gs(j,Y),lt);_s(j,Y)}return null}function $(j,V,Y,lt,At){if(typeof lt=="string"&&lt!==""||typeof lt=="number"||typeof lt=="bigint")return j=j.get(Y)||null,D(V,j,""+lt,At);if(typeof lt=="object"&&lt!==null){switch(lt.$$typeof){case y:return j=j.get(lt.key===null?Y:lt.key)||null,U(V,j,lt,At);case x:return j=j.get(lt.key===null?Y:lt.key)||null,Q(V,j,lt,At);case B:return lt=$a(lt),$(j,V,Y,lt,At)}if(nt(lt)||H(lt))return j=j.get(Y)||null,ut(V,j,lt,At,null);if(typeof lt.then=="function")return $(j,V,Y,ws(lt),At);if(lt.$$typeof===A)return $(j,V,Y,gs(V,lt),At);_s(V,lt)}return null}function yt(j,V,Y,lt){for(var At=null,Kt=null,wt=V,Bt=V=0,Gt=null;wt!==null&&Bt<Y.length;Bt++){wt.index>Bt?(Gt=wt,wt=null):Gt=wt.sibling;var Yt=Z(j,wt,Y[Bt],lt);if(Yt===null){wt===null&&(wt=Gt);break}i&&wt&&Yt.alternate===null&&o(j,wt),V=b(Yt,V,Bt),Kt===null?At=Yt:Kt.sibling=Yt,Kt=Yt,wt=Gt}if(Bt===Y.length)return c(j,wt),Wt&&Fr(j,Bt),At;if(wt===null){for(;Bt<Y.length;Bt++)wt=ct(j,Y[Bt],lt),wt!==null&&(V=b(wt,V,Bt),Kt===null?At=wt:Kt.sibling=wt,Kt=wt);return Wt&&Fr(j,Bt),At}for(wt=d(wt);Bt<Y.length;Bt++)Gt=$(wt,j,Bt,Y[Bt],lt),Gt!==null&&(i&&Gt.alternate!==null&&wt.delete(Gt.key===null?Bt:Gt.key),V=b(Gt,V,Bt),Kt===null?At=Gt:Kt.sibling=Gt,Kt=Gt);return i&&wt.forEach(function(Da){return o(j,Da)}),Wt&&Fr(j,Bt),At}function Dt(j,V,Y,lt){if(Y==null)throw Error(e(151));for(var At=null,Kt=null,wt=V,Bt=V=0,Gt=null,Yt=Y.next();wt!==null&&!Yt.done;Bt++,Yt=Y.next()){wt.index>Bt?(Gt=wt,wt=null):Gt=wt.sibling;var Da=Z(j,wt,Yt.value,lt);if(Da===null){wt===null&&(wt=Gt);break}i&&wt&&Da.alternate===null&&o(j,wt),V=b(Da,V,Bt),Kt===null?At=Da:Kt.sibling=Da,Kt=Da,wt=Gt}if(Yt.done)return c(j,wt),Wt&&Fr(j,Bt),At;if(wt===null){for(;!Yt.done;Bt++,Yt=Y.next())Yt=ct(j,Yt.value,lt),Yt!==null&&(V=b(Yt,V,Bt),Kt===null?At=Yt:Kt.sibling=Yt,Kt=Yt);return Wt&&Fr(j,Bt),At}for(wt=d(wt);!Yt.done;Bt++,Yt=Y.next())Yt=$(wt,j,Bt,Yt.value,lt),Yt!==null&&(i&&Yt.alternate!==null&&wt.delete(Yt.key===null?Bt:Yt.key),V=b(Yt,V,Bt),Kt===null?At=Yt:Kt.sibling=Yt,Kt=Yt);return i&&wt.forEach(function(Ew){return o(j,Ew)}),Wt&&Fr(j,Bt),At}function ae(j,V,Y,lt){if(typeof Y=="object"&&Y!==null&&Y.type===w&&Y.key===null&&(Y=Y.props.children),typeof Y=="object"&&Y!==null){switch(Y.$$typeof){case y:t:{for(var At=Y.key;V!==null;){if(V.key===At){if(At=Y.type,At===w){if(V.tag===7){c(j,V.sibling),lt=g(V,Y.props.children),lt.return=j,j=lt;break t}}else if(V.elementType===At||typeof At=="object"&&At!==null&&At.$$typeof===B&&$a(At)===V.type){c(j,V.sibling),lt=g(V,Y.props),Xo(lt,Y),lt.return=j,j=lt;break t}c(j,V);break}else o(j,V);V=V.sibling}Y.type===w?(lt=Ka(Y.props.children,j.mode,lt,Y.key),lt.return=j,j=lt):(lt=ps(Y.type,Y.key,Y.props,null,j.mode,lt),Xo(lt,Y),lt.return=j,j=lt)}return C(j);case x:t:{for(At=Y.key;V!==null;){if(V.key===At)if(V.tag===4&&V.stateNode.containerInfo===Y.containerInfo&&V.stateNode.implementation===Y.implementation){c(j,V.sibling),lt=g(V,Y.children||[]),lt.return=j,j=lt;break t}else{c(j,V);break}else o(j,V);V=V.sibling}lt=Wc(Y,j.mode,lt),lt.return=j,j=lt}return C(j);case B:return Y=$a(Y),ae(j,V,Y,lt)}if(nt(Y))return yt(j,V,Y,lt);if(H(Y)){if(At=H(Y),typeof At!="function")throw Error(e(150));return Y=At.call(Y),Dt(j,V,Y,lt)}if(typeof Y.then=="function")return ae(j,V,ws(Y),lt);if(Y.$$typeof===A)return ae(j,V,gs(j,Y),lt);_s(j,Y)}return typeof Y=="string"&&Y!==""||typeof Y=="number"||typeof Y=="bigint"?(Y=""+Y,V!==null&&V.tag===6?(c(j,V.sibling),lt=g(V,Y),lt.return=j,j=lt):(c(j,V),lt=Gc(Y,j.mode,lt),lt.return=j,j=lt),C(j)):c(j,V)}return function(j,V,Y,lt){try{jo=0;var At=ae(j,V,Y,lt);return Gi=null,At}catch(wt){if(wt===Vi||wt===bs)throw wt;var Kt=Sn(29,wt,null,j.mode);return Kt.lanes=lt,Kt.return=j,Kt}}}var ei=jv(!0),Xv=jv(!1),ha=!1;function nf(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function rf(i,o){i=i.updateQueue,o.updateQueue===i&&(o.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,callbacks:null})}function da(i){return{lane:i,tag:0,payload:null,callback:null,next:null}}function pa(i,o,c){var d=i.updateQueue;if(d===null)return null;if(d=d.shared,(Zt&2)!==0){var g=d.pending;return g===null?o.next=o:(o.next=g.next,g.next=o),d.pending=o,o=ds(i),Nv(i,null,c),o}return hs(i,d,o,c),ds(i)}function Ko(i,o,c){if(o=o.updateQueue,o!==null&&(o=o.shared,(c&4194048)!==0)){var d=o.lanes;d&=i.pendingLanes,c|=d,o.lanes=c,Lp(i,c)}}function af(i,o){var c=i.updateQueue,d=i.alternate;if(d!==null&&(d=d.updateQueue,c===d)){var g=null,b=null;if(c=c.firstBaseUpdate,c!==null){do{var C={lane:c.lane,tag:c.tag,payload:c.payload,callback:null,next:null};b===null?g=b=C:b=b.next=C,c=c.next}while(c!==null);b===null?g=b=o:b=b.next=o}else g=b=o;c={baseState:d.baseState,firstBaseUpdate:g,lastBaseUpdate:b,shared:d.shared,callbacks:d.callbacks},i.updateQueue=c;return}i=c.lastBaseUpdate,i===null?c.firstBaseUpdate=o:i.next=o,c.lastBaseUpdate=o}var of=!1;function Yo(){if(of){var i=Hi;if(i!==null)throw i}}function Qo(i,o,c,d){of=!1;var g=i.updateQueue;ha=!1;var b=g.firstBaseUpdate,C=g.lastBaseUpdate,D=g.shared.pending;if(D!==null){g.shared.pending=null;var U=D,Q=U.next;U.next=null,C===null?b=Q:C.next=Q,C=U;var ut=i.alternate;ut!==null&&(ut=ut.updateQueue,D=ut.lastBaseUpdate,D!==C&&(D===null?ut.firstBaseUpdate=Q:D.next=Q,ut.lastBaseUpdate=U))}if(b!==null){var ct=g.baseState;C=0,ut=Q=U=null,D=b;do{var Z=D.lane&-536870913,$=Z!==D.lane;if($?(Vt&Z)===Z:(d&Z)===Z){Z!==0&&Z===Pi&&(of=!0),ut!==null&&(ut=ut.next={lane:0,tag:D.tag,payload:D.payload,callback:null,next:null});t:{var yt=i,Dt=D;Z=o;var ae=c;switch(Dt.tag){case 1:if(yt=Dt.payload,typeof yt=="function"){ct=yt.call(ae,ct,Z);break t}ct=yt;break t;case 3:yt.flags=yt.flags&-65537|128;case 0:if(yt=Dt.payload,Z=typeof yt=="function"?yt.call(ae,ct,Z):yt,Z==null)break t;ct=v({},ct,Z);break t;case 2:ha=!0}}Z=D.callback,Z!==null&&(i.flags|=64,$&&(i.flags|=8192),$=g.callbacks,$===null?g.callbacks=[Z]:$.push(Z))}else $={lane:Z,tag:D.tag,payload:D.payload,callback:D.callback,next:null},ut===null?(Q=ut=$,U=ct):ut=ut.next=$,C|=Z;if(D=D.next,D===null){if(D=g.shared.pending,D===null)break;$=D,D=$.next,$.next=null,g.lastBaseUpdate=$,g.shared.pending=null}}while(!0);ut===null&&(U=ct),g.baseState=U,g.firstBaseUpdate=Q,g.lastBaseUpdate=ut,b===null&&(g.shared.lanes=0),ba|=C,i.lanes=C,i.memoizedState=ct}}function Kv(i,o){if(typeof i!="function")throw Error(e(191,i));i.call(o)}function Yv(i,o){var c=i.callbacks;if(c!==null)for(i.callbacks=null,i=0;i<c.length;i++)Kv(c[i],o)}var Wi=z(null),Es=z(0);function Qv(i,o){i=Xr,it(Es,i),it(Wi,o),Xr=i|o.baseLanes}function uf(){it(Es,Xr),it(Wi,Wi.current)}function sf(){Xr=Es.current,X(Wi),X(Es)}var Rn=z(null),Xn=null;function va(i){var o=i.alternate;it(xe,xe.current&1),it(Rn,i),Xn===null&&(o===null||Wi.current!==null||o.memoizedState!==null)&&(Xn=i)}function lf(i){it(xe,xe.current),it(Rn,i),Xn===null&&(Xn=i)}function Zv(i){i.tag===22?(it(xe,xe.current),it(Rn,i),Xn===null&&(Xn=i)):ma()}function ma(){it(xe,xe.current),it(Rn,Rn.current)}function An(i){X(Rn),Xn===i&&(Xn=null),X(xe)}var xe=z(0);function Cs(i){for(var o=i;o!==null;){if(o.tag===13){var c=o.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||vh(c)||mh(c)))return o}else if(o.tag===19&&(o.memoizedProps.revealOrder==="forwards"||o.memoizedProps.revealOrder==="backwards"||o.memoizedProps.revealOrder==="unstable_legacy-backwards"||o.memoizedProps.revealOrder==="together")){if((o.flags&128)!==0)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===i)break;for(;o.sibling===null;){if(o.return===null||o.return===i)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}var Ur=0,It=null,ne=null,Se=null,Ss=!1,qi=!1,ni=!1,Rs=0,Zo=0,ji=null,d2=0;function ge(){throw Error(e(321))}function cf(i,o){if(o===null)return!1;for(var c=0;c<o.length&&c<i.length;c++)if(!Cn(i[c],o[c]))return!1;return!0}function ff(i,o,c,d,g,b){return Ur=b,It=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,L.H=i===null||i.memoizedState===null?Im:Rf,ni=!1,b=c(d,g),ni=!1,qi&&(b=$v(o,c,d,g)),Jv(i),b}function Jv(i){L.H=tu;var o=ne!==null&&ne.next!==null;if(Ur=0,Se=ne=It=null,Ss=!1,Zo=0,ji=null,o)throw Error(e(300));i===null||Re||(i=i.dependencies,i!==null&&ms(i)&&(Re=!0))}function $v(i,o,c,d){It=i;var g=0;do{if(qi&&(ji=null),Zo=0,qi=!1,25<=g)throw Error(e(301));if(g+=1,Se=ne=null,i.updateQueue!=null){var b=i.updateQueue;b.lastEffect=null,b.events=null,b.stores=null,b.memoCache!=null&&(b.memoCache.index=0)}L.H=Bm,b=o(c,d)}while(qi);return b}function p2(){var i=L.H,o=i.useState()[0];return o=typeof o.then=="function"?Jo(o):o,i=i.useState()[0],(ne!==null?ne.memoizedState:null)!==i&&(It.flags|=1024),o}function hf(){var i=Rs!==0;return Rs=0,i}function df(i,o,c){o.updateQueue=i.updateQueue,o.flags&=-2053,i.lanes&=~c}function pf(i){if(Ss){for(i=i.memoizedState;i!==null;){var o=i.queue;o!==null&&(o.pending=null),i=i.next}Ss=!1}Ur=0,Se=ne=It=null,qi=!1,Zo=Rs=0,ji=null}function sn(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Se===null?It.memoizedState=Se=i:Se=Se.next=i,Se}function we(){if(ne===null){var i=It.alternate;i=i!==null?i.memoizedState:null}else i=ne.next;var o=Se===null?It.memoizedState:Se.next;if(o!==null)Se=o,ne=i;else{if(i===null)throw It.alternate===null?Error(e(467)):Error(e(310));ne=i,i={memoizedState:ne.memoizedState,baseState:ne.baseState,baseQueue:ne.baseQueue,queue:ne.queue,next:null},Se===null?It.memoizedState=Se=i:Se=Se.next=i}return Se}function As(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Jo(i){var o=Zo;return Zo+=1,ji===null&&(ji=[]),i=Gv(ji,i,o),o=It,(Se===null?o.memoizedState:Se.next)===null&&(o=o.alternate,L.H=o===null||o.memoizedState===null?Im:Rf),i}function Ts(i){if(i!==null&&typeof i=="object"){if(typeof i.then=="function")return Jo(i);if(i.$$typeof===A)return je(i)}throw Error(e(438,String(i)))}function vf(i){var o=null,c=It.updateQueue;if(c!==null&&(o=c.memoCache),o==null){var d=It.alternate;d!==null&&(d=d.updateQueue,d!==null&&(d=d.memoCache,d!=null&&(o={data:d.data.map(function(g){return g.slice()}),index:0})))}if(o==null&&(o={data:[],index:0}),c===null&&(c=As(),It.updateQueue=c),c.memoCache=o,c=o.data[o.index],c===void 0)for(c=o.data[o.index]=Array(i),d=0;d<i;d++)c[d]=F;return o.index++,c}function Pr(i,o){return typeof o=="function"?o(i):o}function Ds(i){var o=we();return mf(o,ne,i)}function mf(i,o,c){var d=i.queue;if(d===null)throw Error(e(311));d.lastRenderedReducer=c;var g=i.baseQueue,b=d.pending;if(b!==null){if(g!==null){var C=g.next;g.next=b.next,b.next=C}o.baseQueue=g=b,d.pending=null}if(b=i.baseState,g===null)i.memoizedState=b;else{o=g.next;var D=C=null,U=null,Q=o,ut=!1;do{var ct=Q.lane&-536870913;if(ct!==Q.lane?(Vt&ct)===ct:(Ur&ct)===ct){var Z=Q.revertLane;if(Z===0)U!==null&&(U=U.next={lane:0,revertLane:0,gesture:null,action:Q.action,hasEagerState:Q.hasEagerState,eagerState:Q.eagerState,next:null}),ct===Pi&&(ut=!0);else if((Ur&Z)===Z){Q=Q.next,Z===Pi&&(ut=!0);continue}else ct={lane:0,revertLane:Q.revertLane,gesture:null,action:Q.action,hasEagerState:Q.hasEagerState,eagerState:Q.eagerState,next:null},U===null?(D=U=ct,C=b):U=U.next=ct,It.lanes|=Z,ba|=Z;ct=Q.action,ni&&c(b,ct),b=Q.hasEagerState?Q.eagerState:c(b,ct)}else Z={lane:ct,revertLane:Q.revertLane,gesture:Q.gesture,action:Q.action,hasEagerState:Q.hasEagerState,eagerState:Q.eagerState,next:null},U===null?(D=U=Z,C=b):U=U.next=Z,It.lanes|=ct,ba|=ct;Q=Q.next}while(Q!==null&&Q!==o);if(U===null?C=b:U.next=D,!Cn(b,i.memoizedState)&&(Re=!0,ut&&(c=Hi,c!==null)))throw c;i.memoizedState=b,i.baseState=C,i.baseQueue=U,d.lastRenderedState=b}return g===null&&(d.lanes=0),[i.memoizedState,d.dispatch]}function gf(i){var o=we(),c=o.queue;if(c===null)throw Error(e(311));c.lastRenderedReducer=i;var d=c.dispatch,g=c.pending,b=o.memoizedState;if(g!==null){c.pending=null;var C=g=g.next;do b=i(b,C.action),C=C.next;while(C!==g);Cn(b,o.memoizedState)||(Re=!0),o.memoizedState=b,o.baseQueue===null&&(o.baseState=b),c.lastRenderedState=b}return[b,d]}function tm(i,o,c){var d=It,g=we(),b=Wt;if(b){if(c===void 0)throw Error(e(407));c=c()}else c=o();var C=!Cn((ne||g).memoizedState,c);if(C&&(g.memoizedState=c,Re=!0),g=g.queue,xf(rm.bind(null,d,g,i),[i]),g.getSnapshot!==o||C||Se!==null&&Se.memoizedState.tag&1){if(d.flags|=2048,Xi(9,{destroy:void 0},nm.bind(null,d,g,c,o),null),se===null)throw Error(e(349));b||(Ur&127)!==0||em(d,o,c)}return c}function em(i,o,c){i.flags|=16384,i={getSnapshot:o,value:c},o=It.updateQueue,o===null?(o=As(),It.updateQueue=o,o.stores=[i]):(c=o.stores,c===null?o.stores=[i]:c.push(i))}function nm(i,o,c,d){o.value=c,o.getSnapshot=d,am(o)&&im(i)}function rm(i,o,c){return c(function(){am(o)&&im(i)})}function am(i){var o=i.getSnapshot;i=i.value;try{var c=o();return!Cn(i,c)}catch{return!0}}function im(i){var o=Xa(i,2);o!==null&&vn(o,i,2)}function yf(i){var o=sn();if(typeof i=="function"){var c=i;if(i=c(),ni){Un(!0);try{c()}finally{Un(!1)}}}return o.memoizedState=o.baseState=i,o.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Pr,lastRenderedState:i},o}function om(i,o,c,d){return i.baseState=c,mf(i,ne,typeof d=="function"?d:Pr)}function v2(i,o,c,d,g){if(Os(i))throw Error(e(485));if(i=o.action,i!==null){var b={payload:g,action:i,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(C){b.listeners.push(C)}};L.T!==null?c(!0):b.isTransition=!1,d(b),c=o.pending,c===null?(b.next=o.pending=b,um(o,b)):(b.next=c.next,o.pending=c.next=b)}}function um(i,o){var c=o.action,d=o.payload,g=i.state;if(o.isTransition){var b=L.T,C={};L.T=C;try{var D=c(g,d),U=L.S;U!==null&&U(C,D),sm(i,o,D)}catch(Q){bf(i,o,Q)}finally{b!==null&&C.types!==null&&(b.types=C.types),L.T=b}}else try{b=c(g,d),sm(i,o,b)}catch(Q){bf(i,o,Q)}}function sm(i,o,c){c!==null&&typeof c=="object"&&typeof c.then=="function"?c.then(function(d){lm(i,o,d)},function(d){return bf(i,o,d)}):lm(i,o,c)}function lm(i,o,c){o.status="fulfilled",o.value=c,cm(o),i.state=c,o=i.pending,o!==null&&(c=o.next,c===o?i.pending=null:(c=c.next,o.next=c,um(i,c)))}function bf(i,o,c){var d=i.pending;if(i.pending=null,d!==null){d=d.next;do o.status="rejected",o.reason=c,cm(o),o=o.next;while(o!==d)}i.action=null}function cm(i){i=i.listeners;for(var o=0;o<i.length;o++)(0,i[o])()}function fm(i,o){return o}function hm(i,o){if(Wt){var c=se.formState;if(c!==null){t:{var d=It;if(Wt){if(ce){e:{for(var g=ce,b=jn;g.nodeType!==8;){if(!b){g=null;break e}if(g=Kn(g.nextSibling),g===null){g=null;break e}}b=g.data,g=b==="F!"||b==="F"?g:null}if(g){ce=Kn(g.nextSibling),d=g.data==="F!";break t}}ca(d)}d=!1}d&&(o=c[0])}}return c=sn(),c.memoizedState=c.baseState=o,d={pending:null,lanes:0,dispatch:null,lastRenderedReducer:fm,lastRenderedState:o},c.queue=d,c=Mm.bind(null,It,d),d.dispatch=c,d=yf(!1),b=Sf.bind(null,It,!1,d.queue),d=sn(),g={state:o,dispatch:null,action:i,pending:null},d.queue=g,c=v2.bind(null,It,g,b,c),g.dispatch=c,d.memoizedState=i,[o,c,!1]}function dm(i){var o=we();return pm(o,ne,i)}function pm(i,o,c){if(o=mf(i,o,fm)[0],i=Ds(Pr)[0],typeof o=="object"&&o!==null&&typeof o.then=="function")try{var d=Jo(o)}catch(C){throw C===Vi?bs:C}else d=o;o=we();var g=o.queue,b=g.dispatch;return c!==o.memoizedState&&(It.flags|=2048,Xi(9,{destroy:void 0},m2.bind(null,g,c),null)),[d,b,i]}function m2(i,o){i.action=o}function vm(i){var o=we(),c=ne;if(c!==null)return pm(o,c,i);we(),o=o.memoizedState,c=we();var d=c.queue.dispatch;return c.memoizedState=i,[o,d,!1]}function Xi(i,o,c,d){return i={tag:i,create:c,deps:d,inst:o,next:null},o=It.updateQueue,o===null&&(o=As(),It.updateQueue=o),c=o.lastEffect,c===null?o.lastEffect=i.next=i:(d=c.next,c.next=i,i.next=d,o.lastEffect=i),i}function mm(){return we().memoizedState}function Ns(i,o,c,d){var g=sn();It.flags|=i,g.memoizedState=Xi(1|o,{destroy:void 0},c,d===void 0?null:d)}function Ms(i,o,c,d){var g=we();d=d===void 0?null:d;var b=g.memoizedState.inst;ne!==null&&d!==null&&cf(d,ne.memoizedState.deps)?g.memoizedState=Xi(o,b,c,d):(It.flags|=i,g.memoizedState=Xi(1|o,b,c,d))}function gm(i,o){Ns(8390656,8,i,o)}function xf(i,o){Ms(2048,8,i,o)}function g2(i){It.flags|=4;var o=It.updateQueue;if(o===null)o=As(),It.updateQueue=o,o.events=[i];else{var c=o.events;c===null?o.events=[i]:c.push(i)}}function ym(i){var o=we().memoizedState;return g2({ref:o,nextImpl:i}),function(){if((Zt&2)!==0)throw Error(e(440));return o.impl.apply(void 0,arguments)}}function bm(i,o){return Ms(4,2,i,o)}function xm(i,o){return Ms(4,4,i,o)}function wm(i,o){if(typeof o=="function"){i=i();var c=o(i);return function(){typeof c=="function"?c():o(null)}}if(o!=null)return i=i(),o.current=i,function(){o.current=null}}function _m(i,o,c){c=c!=null?c.concat([i]):null,Ms(4,4,wm.bind(null,o,i),c)}function wf(){}function Em(i,o){var c=we();o=o===void 0?null:o;var d=c.memoizedState;return o!==null&&cf(o,d[1])?d[0]:(c.memoizedState=[i,o],i)}function Cm(i,o){var c=we();o=o===void 0?null:o;var d=c.memoizedState;if(o!==null&&cf(o,d[1]))return d[0];if(d=i(),ni){Un(!0);try{i()}finally{Un(!1)}}return c.memoizedState=[d,o],d}function _f(i,o,c){return c===void 0||(Ur&1073741824)!==0&&(Vt&261930)===0?i.memoizedState=o:(i.memoizedState=c,i=Sg(),It.lanes|=i,ba|=i,c)}function Sm(i,o,c,d){return Cn(c,o)?c:Wi.current!==null?(i=_f(i,c,d),Cn(i,o)||(Re=!0),i):(Ur&42)===0||(Ur&1073741824)!==0&&(Vt&261930)===0?(Re=!0,i.memoizedState=c):(i=Sg(),It.lanes|=i,ba|=i,o)}function Rm(i,o,c,d,g){var b=q.p;q.p=b!==0&&8>b?b:8;var C=L.T,D={};L.T=D,Sf(i,!1,o,c);try{var U=g(),Q=L.S;if(Q!==null&&Q(D,U),U!==null&&typeof U=="object"&&typeof U.then=="function"){var ut=h2(U,d);$o(i,o,ut,Nn(i))}else $o(i,o,d,Nn(i))}catch(ct){$o(i,o,{then:function(){},status:"rejected",reason:ct},Nn())}finally{q.p=b,C!==null&&D.types!==null&&(C.types=D.types),L.T=C}}function y2(){}function Ef(i,o,c,d){if(i.tag!==5)throw Error(e(476));var g=Am(i).queue;Rm(i,g,o,K,c===null?y2:function(){return Tm(i),c(d)})}function Am(i){var o=i.memoizedState;if(o!==null)return o;o={memoizedState:K,baseState:K,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Pr,lastRenderedState:K},next:null};var c={};return o.next={memoizedState:c,baseState:c,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Pr,lastRenderedState:c},next:null},i.memoizedState=o,i=i.alternate,i!==null&&(i.memoizedState=o),o}function Tm(i){var o=Am(i);o.next===null&&(o=i.alternate.memoizedState),$o(i,o.next.queue,{},Nn())}function Cf(){return je(mu)}function Dm(){return we().memoizedState}function Nm(){return we().memoizedState}function b2(i){for(var o=i.return;o!==null;){switch(o.tag){case 24:case 3:var c=Nn();i=da(c);var d=pa(o,i,c);d!==null&&(vn(d,o,c),Ko(d,o,c)),o={cache:Jc()},i.payload=o;return}o=o.return}}function x2(i,o,c){var d=Nn();c={lane:d,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null},Os(i)?Om(o,c):(c=Hc(i,o,c,d),c!==null&&(vn(c,i,d),km(c,o,d)))}function Mm(i,o,c){var d=Nn();$o(i,o,c,d)}function $o(i,o,c,d){var g={lane:d,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null};if(Os(i))Om(o,g);else{var b=i.alternate;if(i.lanes===0&&(b===null||b.lanes===0)&&(b=o.lastRenderedReducer,b!==null))try{var C=o.lastRenderedState,D=b(C,c);if(g.hasEagerState=!0,g.eagerState=D,Cn(D,C))return hs(i,o,g,0),se===null&&fs(),!1}catch{}if(c=Hc(i,o,g,d),c!==null)return vn(c,i,d),km(c,o,d),!0}return!1}function Sf(i,o,c,d){if(d={lane:2,revertLane:rh(),gesture:null,action:d,hasEagerState:!1,eagerState:null,next:null},Os(i)){if(o)throw Error(e(479))}else o=Hc(i,c,d,2),o!==null&&vn(o,i,2)}function Os(i){var o=i.alternate;return i===It||o!==null&&o===It}function Om(i,o){qi=Ss=!0;var c=i.pending;c===null?o.next=o:(o.next=c.next,c.next=o),i.pending=o}function km(i,o,c){if((c&4194048)!==0){var d=o.lanes;d&=i.pendingLanes,c|=d,o.lanes=c,Lp(i,c)}}var tu={readContext:je,use:Ts,useCallback:ge,useContext:ge,useEffect:ge,useImperativeHandle:ge,useLayoutEffect:ge,useInsertionEffect:ge,useMemo:ge,useReducer:ge,useRef:ge,useState:ge,useDebugValue:ge,useDeferredValue:ge,useTransition:ge,useSyncExternalStore:ge,useId:ge,useHostTransitionStatus:ge,useFormState:ge,useActionState:ge,useOptimistic:ge,useMemoCache:ge,useCacheRefresh:ge};tu.useEffectEvent=ge;var Im={readContext:je,use:Ts,useCallback:function(i,o){return sn().memoizedState=[i,o===void 0?null:o],i},useContext:je,useEffect:gm,useImperativeHandle:function(i,o,c){c=c!=null?c.concat([i]):null,Ns(4194308,4,wm.bind(null,o,i),c)},useLayoutEffect:function(i,o){return Ns(4194308,4,i,o)},useInsertionEffect:function(i,o){Ns(4,2,i,o)},useMemo:function(i,o){var c=sn();o=o===void 0?null:o;var d=i();if(ni){Un(!0);try{i()}finally{Un(!1)}}return c.memoizedState=[d,o],d},useReducer:function(i,o,c){var d=sn();if(c!==void 0){var g=c(o);if(ni){Un(!0);try{c(o)}finally{Un(!1)}}}else g=o;return d.memoizedState=d.baseState=g,i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:g},d.queue=i,i=i.dispatch=x2.bind(null,It,i),[d.memoizedState,i]},useRef:function(i){var o=sn();return i={current:i},o.memoizedState=i},useState:function(i){i=yf(i);var o=i.queue,c=Mm.bind(null,It,o);return o.dispatch=c,[i.memoizedState,c]},useDebugValue:wf,useDeferredValue:function(i,o){var c=sn();return _f(c,i,o)},useTransition:function(){var i=yf(!1);return i=Rm.bind(null,It,i.queue,!0,!1),sn().memoizedState=i,[!1,i]},useSyncExternalStore:function(i,o,c){var d=It,g=sn();if(Wt){if(c===void 0)throw Error(e(407));c=c()}else{if(c=o(),se===null)throw Error(e(349));(Vt&127)!==0||em(d,o,c)}g.memoizedState=c;var b={value:c,getSnapshot:o};return g.queue=b,gm(rm.bind(null,d,b,i),[i]),d.flags|=2048,Xi(9,{destroy:void 0},nm.bind(null,d,b,c,o),null),c},useId:function(){var i=sn(),o=se.identifierPrefix;if(Wt){var c=dr,d=hr;c=(d&~(1<<32-En(d)-1)).toString(32)+c,o="_"+o+"R_"+c,c=Rs++,0<c&&(o+="H"+c.toString(32)),o+="_"}else c=d2++,o="_"+o+"r_"+c.toString(32)+"_";return i.memoizedState=o},useHostTransitionStatus:Cf,useFormState:hm,useActionState:hm,useOptimistic:function(i){var o=sn();o.memoizedState=o.baseState=i;var c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return o.queue=c,o=Sf.bind(null,It,!0,c),c.dispatch=o,[i,o]},useMemoCache:vf,useCacheRefresh:function(){return sn().memoizedState=b2.bind(null,It)},useEffectEvent:function(i){var o=sn(),c={impl:i};return o.memoizedState=c,function(){if((Zt&2)!==0)throw Error(e(440));return c.impl.apply(void 0,arguments)}}},Rf={readContext:je,use:Ts,useCallback:Em,useContext:je,useEffect:xf,useImperativeHandle:_m,useInsertionEffect:bm,useLayoutEffect:xm,useMemo:Cm,useReducer:Ds,useRef:mm,useState:function(){return Ds(Pr)},useDebugValue:wf,useDeferredValue:function(i,o){var c=we();return Sm(c,ne.memoizedState,i,o)},useTransition:function(){var i=Ds(Pr)[0],o=we().memoizedState;return[typeof i=="boolean"?i:Jo(i),o]},useSyncExternalStore:tm,useId:Dm,useHostTransitionStatus:Cf,useFormState:dm,useActionState:dm,useOptimistic:function(i,o){var c=we();return om(c,ne,i,o)},useMemoCache:vf,useCacheRefresh:Nm};Rf.useEffectEvent=ym;var Bm={readContext:je,use:Ts,useCallback:Em,useContext:je,useEffect:xf,useImperativeHandle:_m,useInsertionEffect:bm,useLayoutEffect:xm,useMemo:Cm,useReducer:gf,useRef:mm,useState:function(){return gf(Pr)},useDebugValue:wf,useDeferredValue:function(i,o){var c=we();return ne===null?_f(c,i,o):Sm(c,ne.memoizedState,i,o)},useTransition:function(){var i=gf(Pr)[0],o=we().memoizedState;return[typeof i=="boolean"?i:Jo(i),o]},useSyncExternalStore:tm,useId:Dm,useHostTransitionStatus:Cf,useFormState:vm,useActionState:vm,useOptimistic:function(i,o){var c=we();return ne!==null?om(c,ne,i,o):(c.baseState=i,[i,c.queue.dispatch])},useMemoCache:vf,useCacheRefresh:Nm};Bm.useEffectEvent=ym;function Af(i,o,c,d){o=i.memoizedState,c=c(d,o),c=c==null?o:v({},o,c),i.memoizedState=c,i.lanes===0&&(i.updateQueue.baseState=c)}var Tf={enqueueSetState:function(i,o,c){i=i._reactInternals;var d=Nn(),g=da(d);g.payload=o,c!=null&&(g.callback=c),o=pa(i,g,d),o!==null&&(vn(o,i,d),Ko(o,i,d))},enqueueReplaceState:function(i,o,c){i=i._reactInternals;var d=Nn(),g=da(d);g.tag=1,g.payload=o,c!=null&&(g.callback=c),o=pa(i,g,d),o!==null&&(vn(o,i,d),Ko(o,i,d))},enqueueForceUpdate:function(i,o){i=i._reactInternals;var c=Nn(),d=da(c);d.tag=2,o!=null&&(d.callback=o),o=pa(i,d,c),o!==null&&(vn(o,i,c),Ko(o,i,c))}};function Fm(i,o,c,d,g,b,C){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(d,b,C):o.prototype&&o.prototype.isPureReactComponent?!Po(c,d)||!Po(g,b):!0}function zm(i,o,c,d){i=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(c,d),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(c,d),o.state!==i&&Tf.enqueueReplaceState(o,o.state,null)}function ri(i,o){var c=o;if("ref"in o){c={};for(var d in o)d!=="ref"&&(c[d]=o[d])}if(i=i.defaultProps){c===o&&(c=v({},c));for(var g in i)c[g]===void 0&&(c[g]=i[g])}return c}function Lm(i){cs(i)}function Um(i){console.error(i)}function Pm(i){cs(i)}function ks(i,o){try{var c=i.onUncaughtError;c(o.value,{componentStack:o.stack})}catch(d){setTimeout(function(){throw d})}}function Hm(i,o,c){try{var d=i.onCaughtError;d(c.value,{componentStack:c.stack,errorBoundary:o.tag===1?o.stateNode:null})}catch(g){setTimeout(function(){throw g})}}function Df(i,o,c){return c=da(c),c.tag=3,c.payload={element:null},c.callback=function(){ks(i,o)},c}function Vm(i){return i=da(i),i.tag=3,i}function Gm(i,o,c,d){var g=c.type.getDerivedStateFromError;if(typeof g=="function"){var b=d.value;i.payload=function(){return g(b)},i.callback=function(){Hm(o,c,d)}}var C=c.stateNode;C!==null&&typeof C.componentDidCatch=="function"&&(i.callback=function(){Hm(o,c,d),typeof g!="function"&&(xa===null?xa=new Set([this]):xa.add(this));var D=d.stack;this.componentDidCatch(d.value,{componentStack:D!==null?D:""})})}function w2(i,o,c,d,g){if(c.flags|=32768,d!==null&&typeof d=="object"&&typeof d.then=="function"){if(o=c.alternate,o!==null&&Ui(o,c,g,!0),c=Rn.current,c!==null){switch(c.tag){case 31:case 13:return Xn===null?qs():c.alternate===null&&ye===0&&(ye=3),c.flags&=-257,c.flags|=65536,c.lanes=g,d===xs?c.flags|=16384:(o=c.updateQueue,o===null?c.updateQueue=new Set([d]):o.add(d),th(i,d,g)),!1;case 22:return c.flags|=65536,d===xs?c.flags|=16384:(o=c.updateQueue,o===null?(o={transitions:null,markerInstances:null,retryQueue:new Set([d])},c.updateQueue=o):(c=o.retryQueue,c===null?o.retryQueue=new Set([d]):c.add(d)),th(i,d,g)),!1}throw Error(e(435,c.tag))}return th(i,d,g),qs(),!1}if(Wt)return o=Rn.current,o!==null?((o.flags&65536)===0&&(o.flags|=256),o.flags|=65536,o.lanes=g,d!==Xc&&(i=Error(e(422),{cause:d}),Go(Gn(i,c)))):(d!==Xc&&(o=Error(e(423),{cause:d}),Go(Gn(o,c))),i=i.current.alternate,i.flags|=65536,g&=-g,i.lanes|=g,d=Gn(d,c),g=Df(i.stateNode,d,g),af(i,g),ye!==4&&(ye=2)),!1;var b=Error(e(520),{cause:d});if(b=Gn(b,c),su===null?su=[b]:su.push(b),ye!==4&&(ye=2),o===null)return!0;d=Gn(d,c),c=o;do{switch(c.tag){case 3:return c.flags|=65536,i=g&-g,c.lanes|=i,i=Df(c.stateNode,d,i),af(c,i),!1;case 1:if(o=c.type,b=c.stateNode,(c.flags&128)===0&&(typeof o.getDerivedStateFromError=="function"||b!==null&&typeof b.componentDidCatch=="function"&&(xa===null||!xa.has(b))))return c.flags|=65536,g&=-g,c.lanes|=g,g=Vm(g),Gm(g,i,c,d),af(c,g),!1}c=c.return}while(c!==null);return!1}var Nf=Error(e(461)),Re=!1;function Xe(i,o,c,d){o.child=i===null?Xv(o,null,c,d):ei(o,i.child,c,d)}function Wm(i,o,c,d,g){c=c.render;var b=o.ref;if("ref"in d){var C={};for(var D in d)D!=="ref"&&(C[D]=d[D])}else C=d;return Za(o),d=ff(i,o,c,C,b,g),D=hf(),i!==null&&!Re?(df(i,o,g),Hr(i,o,g)):(Wt&&D&&qc(o),o.flags|=1,Xe(i,o,d,g),o.child)}function qm(i,o,c,d,g){if(i===null){var b=c.type;return typeof b=="function"&&!Vc(b)&&b.defaultProps===void 0&&c.compare===null?(o.tag=15,o.type=b,jm(i,o,b,d,g)):(i=ps(c.type,null,d,o,o.mode,g),i.ref=o.ref,i.return=o,o.child=i)}if(b=i.child,!Lf(i,g)){var C=b.memoizedProps;if(c=c.compare,c=c!==null?c:Po,c(C,d)&&i.ref===o.ref)return Hr(i,o,g)}return o.flags|=1,i=Br(b,d),i.ref=o.ref,i.return=o,o.child=i}function jm(i,o,c,d,g){if(i!==null){var b=i.memoizedProps;if(Po(b,d)&&i.ref===o.ref)if(Re=!1,o.pendingProps=d=b,Lf(i,g))(i.flags&131072)!==0&&(Re=!0);else return o.lanes=i.lanes,Hr(i,o,g)}return Mf(i,o,c,d,g)}function Xm(i,o,c,d){var g=d.children,b=i!==null?i.memoizedState:null;if(i===null&&o.stateNode===null&&(o.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),d.mode==="hidden"){if((o.flags&128)!==0){if(b=b!==null?b.baseLanes|c:c,i!==null){for(d=o.child=i.child,g=0;d!==null;)g=g|d.lanes|d.childLanes,d=d.sibling;d=g&~b}else d=0,o.child=null;return Km(i,o,b,c,d)}if((c&536870912)!==0)o.memoizedState={baseLanes:0,cachePool:null},i!==null&&ys(o,b!==null?b.cachePool:null),b!==null?Qv(o,b):uf(),Zv(o);else return d=o.lanes=536870912,Km(i,o,b!==null?b.baseLanes|c:c,c,d)}else b!==null?(ys(o,b.cachePool),Qv(o,b),ma(),o.memoizedState=null):(i!==null&&ys(o,null),uf(),ma());return Xe(i,o,g,c),o.child}function eu(i,o){return i!==null&&i.tag===22||o.stateNode!==null||(o.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),o.sibling}function Km(i,o,c,d,g){var b=tf();return b=b===null?null:{parent:Ce._currentValue,pool:b},o.memoizedState={baseLanes:c,cachePool:b},i!==null&&ys(o,null),uf(),Zv(o),i!==null&&Ui(i,o,d,!0),o.childLanes=g,null}function Is(i,o){return o=Fs({mode:o.mode,children:o.children},i.mode),o.ref=i.ref,i.child=o,o.return=i,o}function Ym(i,o,c){return ei(o,i.child,null,c),i=Is(o,o.pendingProps),i.flags|=2,An(o),o.memoizedState=null,i}function _2(i,o,c){var d=o.pendingProps,g=(o.flags&128)!==0;if(o.flags&=-129,i===null){if(Wt){if(d.mode==="hidden")return i=Is(o,d),o.lanes=536870912,eu(null,i);if(lf(o),(i=ce)?(i=u0(i,jn),i=i!==null&&i.data==="&"?i:null,i!==null&&(o.memoizedState={dehydrated:i,treeContext:sa!==null?{id:hr,overflow:dr}:null,retryLane:536870912,hydrationErrors:null},c=Ov(i),c.return=o,o.child=c,qe=o,ce=null)):i=null,i===null)throw ca(o);return o.lanes=536870912,null}return Is(o,d)}var b=i.memoizedState;if(b!==null){var C=b.dehydrated;if(lf(o),g)if(o.flags&256)o.flags&=-257,o=Ym(i,o,c);else if(o.memoizedState!==null)o.child=i.child,o.flags|=128,o=null;else throw Error(e(558));else if(Re||Ui(i,o,c,!1),g=(c&i.childLanes)!==0,Re||g){if(d=se,d!==null&&(C=Up(d,c),C!==0&&C!==b.retryLane))throw b.retryLane=C,Xa(i,C),vn(d,i,C),Nf;qs(),o=Ym(i,o,c)}else i=b.treeContext,ce=Kn(C.nextSibling),qe=o,Wt=!0,la=null,jn=!1,i!==null&&Bv(o,i),o=Is(o,d),o.flags|=4096;return o}return i=Br(i.child,{mode:d.mode,children:d.children}),i.ref=o.ref,o.child=i,i.return=o,i}function Bs(i,o){var c=o.ref;if(c===null)i!==null&&i.ref!==null&&(o.flags|=4194816);else{if(typeof c!="function"&&typeof c!="object")throw Error(e(284));(i===null||i.ref!==c)&&(o.flags|=4194816)}}function Mf(i,o,c,d,g){return Za(o),c=ff(i,o,c,d,void 0,g),d=hf(),i!==null&&!Re?(df(i,o,g),Hr(i,o,g)):(Wt&&d&&qc(o),o.flags|=1,Xe(i,o,c,g),o.child)}function Qm(i,o,c,d,g,b){return Za(o),o.updateQueue=null,c=$v(o,d,c,g),Jv(i),d=hf(),i!==null&&!Re?(df(i,o,b),Hr(i,o,b)):(Wt&&d&&qc(o),o.flags|=1,Xe(i,o,c,b),o.child)}function Zm(i,o,c,d,g){if(Za(o),o.stateNode===null){var b=Bi,C=c.contextType;typeof C=="object"&&C!==null&&(b=je(C)),b=new c(d,b),o.memoizedState=b.state!==null&&b.state!==void 0?b.state:null,b.updater=Tf,o.stateNode=b,b._reactInternals=o,b=o.stateNode,b.props=d,b.state=o.memoizedState,b.refs={},nf(o),C=c.contextType,b.context=typeof C=="object"&&C!==null?je(C):Bi,b.state=o.memoizedState,C=c.getDerivedStateFromProps,typeof C=="function"&&(Af(o,c,C,d),b.state=o.memoizedState),typeof c.getDerivedStateFromProps=="function"||typeof b.getSnapshotBeforeUpdate=="function"||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(C=b.state,typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount(),C!==b.state&&Tf.enqueueReplaceState(b,b.state,null),Qo(o,d,b,g),Yo(),b.state=o.memoizedState),typeof b.componentDidMount=="function"&&(o.flags|=4194308),d=!0}else if(i===null){b=o.stateNode;var D=o.memoizedProps,U=ri(c,D);b.props=U;var Q=b.context,ut=c.contextType;C=Bi,typeof ut=="object"&&ut!==null&&(C=je(ut));var ct=c.getDerivedStateFromProps;ut=typeof ct=="function"||typeof b.getSnapshotBeforeUpdate=="function",D=o.pendingProps!==D,ut||typeof b.UNSAFE_componentWillReceiveProps!="function"&&typeof b.componentWillReceiveProps!="function"||(D||Q!==C)&&zm(o,b,d,C),ha=!1;var Z=o.memoizedState;b.state=Z,Qo(o,d,b,g),Yo(),Q=o.memoizedState,D||Z!==Q||ha?(typeof ct=="function"&&(Af(o,c,ct,d),Q=o.memoizedState),(U=ha||Fm(o,c,U,d,Z,Q,C))?(ut||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount()),typeof b.componentDidMount=="function"&&(o.flags|=4194308)):(typeof b.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=d,o.memoizedState=Q),b.props=d,b.state=Q,b.context=C,d=U):(typeof b.componentDidMount=="function"&&(o.flags|=4194308),d=!1)}else{b=o.stateNode,rf(i,o),C=o.memoizedProps,ut=ri(c,C),b.props=ut,ct=o.pendingProps,Z=b.context,Q=c.contextType,U=Bi,typeof Q=="object"&&Q!==null&&(U=je(Q)),D=c.getDerivedStateFromProps,(Q=typeof D=="function"||typeof b.getSnapshotBeforeUpdate=="function")||typeof b.UNSAFE_componentWillReceiveProps!="function"&&typeof b.componentWillReceiveProps!="function"||(C!==ct||Z!==U)&&zm(o,b,d,U),ha=!1,Z=o.memoizedState,b.state=Z,Qo(o,d,b,g),Yo();var $=o.memoizedState;C!==ct||Z!==$||ha||i!==null&&i.dependencies!==null&&ms(i.dependencies)?(typeof D=="function"&&(Af(o,c,D,d),$=o.memoizedState),(ut=ha||Fm(o,c,ut,d,Z,$,U)||i!==null&&i.dependencies!==null&&ms(i.dependencies))?(Q||typeof b.UNSAFE_componentWillUpdate!="function"&&typeof b.componentWillUpdate!="function"||(typeof b.componentWillUpdate=="function"&&b.componentWillUpdate(d,$,U),typeof b.UNSAFE_componentWillUpdate=="function"&&b.UNSAFE_componentWillUpdate(d,$,U)),typeof b.componentDidUpdate=="function"&&(o.flags|=4),typeof b.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof b.componentDidUpdate!="function"||C===i.memoizedProps&&Z===i.memoizedState||(o.flags|=4),typeof b.getSnapshotBeforeUpdate!="function"||C===i.memoizedProps&&Z===i.memoizedState||(o.flags|=1024),o.memoizedProps=d,o.memoizedState=$),b.props=d,b.state=$,b.context=U,d=ut):(typeof b.componentDidUpdate!="function"||C===i.memoizedProps&&Z===i.memoizedState||(o.flags|=4),typeof b.getSnapshotBeforeUpdate!="function"||C===i.memoizedProps&&Z===i.memoizedState||(o.flags|=1024),d=!1)}return b=d,Bs(i,o),d=(o.flags&128)!==0,b||d?(b=o.stateNode,c=d&&typeof c.getDerivedStateFromError!="function"?null:b.render(),o.flags|=1,i!==null&&d?(o.child=ei(o,i.child,null,g),o.child=ei(o,null,c,g)):Xe(i,o,c,g),o.memoizedState=b.state,i=o.child):i=Hr(i,o,g),i}function Jm(i,o,c,d){return Ya(),o.flags|=256,Xe(i,o,c,d),o.child}var Of={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function kf(i){return{baseLanes:i,cachePool:Hv()}}function If(i,o,c){return i=i!==null?i.childLanes&~c:0,o&&(i|=Dn),i}function $m(i,o,c){var d=o.pendingProps,g=!1,b=(o.flags&128)!==0,C;if((C=b)||(C=i!==null&&i.memoizedState===null?!1:(xe.current&2)!==0),C&&(g=!0,o.flags&=-129),C=(o.flags&32)!==0,o.flags&=-33,i===null){if(Wt){if(g?va(o):ma(),(i=ce)?(i=u0(i,jn),i=i!==null&&i.data!=="&"?i:null,i!==null&&(o.memoizedState={dehydrated:i,treeContext:sa!==null?{id:hr,overflow:dr}:null,retryLane:536870912,hydrationErrors:null},c=Ov(i),c.return=o,o.child=c,qe=o,ce=null)):i=null,i===null)throw ca(o);return mh(i)?o.lanes=32:o.lanes=536870912,null}var D=d.children;return d=d.fallback,g?(ma(),g=o.mode,D=Fs({mode:"hidden",children:D},g),d=Ka(d,g,c,null),D.return=o,d.return=o,D.sibling=d,o.child=D,d=o.child,d.memoizedState=kf(c),d.childLanes=If(i,C,c),o.memoizedState=Of,eu(null,d)):(va(o),Bf(o,D))}var U=i.memoizedState;if(U!==null&&(D=U.dehydrated,D!==null)){if(b)o.flags&256?(va(o),o.flags&=-257,o=Ff(i,o,c)):o.memoizedState!==null?(ma(),o.child=i.child,o.flags|=128,o=null):(ma(),D=d.fallback,g=o.mode,d=Fs({mode:"visible",children:d.children},g),D=Ka(D,g,c,null),D.flags|=2,d.return=o,D.return=o,d.sibling=D,o.child=d,ei(o,i.child,null,c),d=o.child,d.memoizedState=kf(c),d.childLanes=If(i,C,c),o.memoizedState=Of,o=eu(null,d));else if(va(o),mh(D)){if(C=D.nextSibling&&D.nextSibling.dataset,C)var Q=C.dgst;C=Q,d=Error(e(419)),d.stack="",d.digest=C,Go({value:d,source:null,stack:null}),o=Ff(i,o,c)}else if(Re||Ui(i,o,c,!1),C=(c&i.childLanes)!==0,Re||C){if(C=se,C!==null&&(d=Up(C,c),d!==0&&d!==U.retryLane))throw U.retryLane=d,Xa(i,d),vn(C,i,d),Nf;vh(D)||qs(),o=Ff(i,o,c)}else vh(D)?(o.flags|=192,o.child=i.child,o=null):(i=U.treeContext,ce=Kn(D.nextSibling),qe=o,Wt=!0,la=null,jn=!1,i!==null&&Bv(o,i),o=Bf(o,d.children),o.flags|=4096);return o}return g?(ma(),D=d.fallback,g=o.mode,U=i.child,Q=U.sibling,d=Br(U,{mode:"hidden",children:d.children}),d.subtreeFlags=U.subtreeFlags&65011712,Q!==null?D=Br(Q,D):(D=Ka(D,g,c,null),D.flags|=2),D.return=o,d.return=o,d.sibling=D,o.child=d,eu(null,d),d=o.child,D=i.child.memoizedState,D===null?D=kf(c):(g=D.cachePool,g!==null?(U=Ce._currentValue,g=g.parent!==U?{parent:U,pool:U}:g):g=Hv(),D={baseLanes:D.baseLanes|c,cachePool:g}),d.memoizedState=D,d.childLanes=If(i,C,c),o.memoizedState=Of,eu(i.child,d)):(va(o),c=i.child,i=c.sibling,c=Br(c,{mode:"visible",children:d.children}),c.return=o,c.sibling=null,i!==null&&(C=o.deletions,C===null?(o.deletions=[i],o.flags|=16):C.push(i)),o.child=c,o.memoizedState=null,c)}function Bf(i,o){return o=Fs({mode:"visible",children:o},i.mode),o.return=i,i.child=o}function Fs(i,o){return i=Sn(22,i,null,o),i.lanes=0,i}function Ff(i,o,c){return ei(o,i.child,null,c),i=Bf(o,o.pendingProps.children),i.flags|=2,o.memoizedState=null,i}function tg(i,o,c){i.lanes|=o;var d=i.alternate;d!==null&&(d.lanes|=o),Qc(i.return,o,c)}function zf(i,o,c,d,g,b){var C=i.memoizedState;C===null?i.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:d,tail:c,tailMode:g,treeForkCount:b}:(C.isBackwards=o,C.rendering=null,C.renderingStartTime=0,C.last=d,C.tail=c,C.tailMode=g,C.treeForkCount=b)}function eg(i,o,c){var d=o.pendingProps,g=d.revealOrder,b=d.tail;d=d.children;var C=xe.current,D=(C&2)!==0;if(D?(C=C&1|2,o.flags|=128):C&=1,it(xe,C),Xe(i,o,d,c),d=Wt?Vo:0,!D&&i!==null&&(i.flags&128)!==0)t:for(i=o.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&tg(i,c,o);else if(i.tag===19)tg(i,c,o);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===o)break t;for(;i.sibling===null;){if(i.return===null||i.return===o)break t;i=i.return}i.sibling.return=i.return,i=i.sibling}switch(g){case"forwards":for(c=o.child,g=null;c!==null;)i=c.alternate,i!==null&&Cs(i)===null&&(g=c),c=c.sibling;c=g,c===null?(g=o.child,o.child=null):(g=c.sibling,c.sibling=null),zf(o,!1,g,c,b,d);break;case"backwards":case"unstable_legacy-backwards":for(c=null,g=o.child,o.child=null;g!==null;){if(i=g.alternate,i!==null&&Cs(i)===null){o.child=g;break}i=g.sibling,g.sibling=c,c=g,g=i}zf(o,!0,c,null,b,d);break;case"together":zf(o,!1,null,null,void 0,d);break;default:o.memoizedState=null}return o.child}function Hr(i,o,c){if(i!==null&&(o.dependencies=i.dependencies),ba|=o.lanes,(c&o.childLanes)===0)if(i!==null){if(Ui(i,o,c,!1),(c&o.childLanes)===0)return null}else return null;if(i!==null&&o.child!==i.child)throw Error(e(153));if(o.child!==null){for(i=o.child,c=Br(i,i.pendingProps),o.child=c,c.return=o;i.sibling!==null;)i=i.sibling,c=c.sibling=Br(i,i.pendingProps),c.return=o;c.sibling=null}return o.child}function Lf(i,o){return(i.lanes&o)!==0?!0:(i=i.dependencies,!!(i!==null&&ms(i)))}function E2(i,o,c){switch(o.tag){case 3:Tt(o,o.stateNode.containerInfo),fa(o,Ce,i.memoizedState.cache),Ya();break;case 27:case 5:ie(o);break;case 4:Tt(o,o.stateNode.containerInfo);break;case 10:fa(o,o.type,o.memoizedProps.value);break;case 31:if(o.memoizedState!==null)return o.flags|=128,lf(o),null;break;case 13:var d=o.memoizedState;if(d!==null)return d.dehydrated!==null?(va(o),o.flags|=128,null):(c&o.child.childLanes)!==0?$m(i,o,c):(va(o),i=Hr(i,o,c),i!==null?i.sibling:null);va(o);break;case 19:var g=(i.flags&128)!==0;if(d=(c&o.childLanes)!==0,d||(Ui(i,o,c,!1),d=(c&o.childLanes)!==0),g){if(d)return eg(i,o,c);o.flags|=128}if(g=o.memoizedState,g!==null&&(g.rendering=null,g.tail=null,g.lastEffect=null),it(xe,xe.current),d)break;return null;case 22:return o.lanes=0,Xm(i,o,c,o.pendingProps);case 24:fa(o,Ce,i.memoizedState.cache)}return Hr(i,o,c)}function ng(i,o,c){if(i!==null)if(i.memoizedProps!==o.pendingProps)Re=!0;else{if(!Lf(i,c)&&(o.flags&128)===0)return Re=!1,E2(i,o,c);Re=(i.flags&131072)!==0}else Re=!1,Wt&&(o.flags&1048576)!==0&&Iv(o,Vo,o.index);switch(o.lanes=0,o.tag){case 16:t:{var d=o.pendingProps;if(i=$a(o.elementType),o.type=i,typeof i=="function")Vc(i)?(d=ri(i,d),o.tag=1,o=Zm(null,o,i,d,c)):(o.tag=0,o=Mf(null,o,i,d,c));else{if(i!=null){var g=i.$$typeof;if(g===S){o.tag=11,o=Wm(null,o,i,d,c);break t}else if(g===O){o.tag=14,o=qm(null,o,i,d,c);break t}}throw o=et(i)||i,Error(e(306,o,""))}}return o;case 0:return Mf(i,o,o.type,o.pendingProps,c);case 1:return d=o.type,g=ri(d,o.pendingProps),Zm(i,o,d,g,c);case 3:t:{if(Tt(o,o.stateNode.containerInfo),i===null)throw Error(e(387));d=o.pendingProps;var b=o.memoizedState;g=b.element,rf(i,o),Qo(o,d,null,c);var C=o.memoizedState;if(d=C.cache,fa(o,Ce,d),d!==b.cache&&Zc(o,[Ce],c,!0),Yo(),d=C.element,b.isDehydrated)if(b={element:d,isDehydrated:!1,cache:C.cache},o.updateQueue.baseState=b,o.memoizedState=b,o.flags&256){o=Jm(i,o,d,c);break t}else if(d!==g){g=Gn(Error(e(424)),o),Go(g),o=Jm(i,o,d,c);break t}else for(i=o.stateNode.containerInfo,i.nodeType===9?i=i.body:i=i.nodeName==="HTML"?i.ownerDocument.body:i,ce=Kn(i.firstChild),qe=o,Wt=!0,la=null,jn=!0,c=Xv(o,null,d,c),o.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling;else{if(Ya(),d===g){o=Hr(i,o,c);break t}Xe(i,o,d,c)}o=o.child}return o;case 26:return Bs(i,o),i===null?(c=d0(o.type,null,o.pendingProps,null))?o.memoizedState=c:Wt||(c=o.type,i=o.pendingProps,d=Js(vt.current).createElement(c),d[We]=o,d[ln]=i,Ke(d,c,i),ze(d),o.stateNode=d):o.memoizedState=d0(o.type,i.memoizedProps,o.pendingProps,i.memoizedState),null;case 27:return ie(o),i===null&&Wt&&(d=o.stateNode=c0(o.type,o.pendingProps,vt.current),qe=o,jn=!0,g=ce,Ca(o.type)?(gh=g,ce=Kn(d.firstChild)):ce=g),Xe(i,o,o.pendingProps.children,c),Bs(i,o),i===null&&(o.flags|=4194304),o.child;case 5:return i===null&&Wt&&((g=d=ce)&&(d=$2(d,o.type,o.pendingProps,jn),d!==null?(o.stateNode=d,qe=o,ce=Kn(d.firstChild),jn=!1,g=!0):g=!1),g||ca(o)),ie(o),g=o.type,b=o.pendingProps,C=i!==null?i.memoizedProps:null,d=b.children,hh(g,b)?d=null:C!==null&&hh(g,C)&&(o.flags|=32),o.memoizedState!==null&&(g=ff(i,o,p2,null,null,c),mu._currentValue=g),Bs(i,o),Xe(i,o,d,c),o.child;case 6:return i===null&&Wt&&((i=c=ce)&&(c=tw(c,o.pendingProps,jn),c!==null?(o.stateNode=c,qe=o,ce=null,i=!0):i=!1),i||ca(o)),null;case 13:return $m(i,o,c);case 4:return Tt(o,o.stateNode.containerInfo),d=o.pendingProps,i===null?o.child=ei(o,null,d,c):Xe(i,o,d,c),o.child;case 11:return Wm(i,o,o.type,o.pendingProps,c);case 7:return Xe(i,o,o.pendingProps,c),o.child;case 8:return Xe(i,o,o.pendingProps.children,c),o.child;case 12:return Xe(i,o,o.pendingProps.children,c),o.child;case 10:return d=o.pendingProps,fa(o,o.type,d.value),Xe(i,o,d.children,c),o.child;case 9:return g=o.type._context,d=o.pendingProps.children,Za(o),g=je(g),d=d(g),o.flags|=1,Xe(i,o,d,c),o.child;case 14:return qm(i,o,o.type,o.pendingProps,c);case 15:return jm(i,o,o.type,o.pendingProps,c);case 19:return eg(i,o,c);case 31:return _2(i,o,c);case 22:return Xm(i,o,c,o.pendingProps);case 24:return Za(o),d=je(Ce),i===null?(g=tf(),g===null&&(g=se,b=Jc(),g.pooledCache=b,b.refCount++,b!==null&&(g.pooledCacheLanes|=c),g=b),o.memoizedState={parent:d,cache:g},nf(o),fa(o,Ce,g)):((i.lanes&c)!==0&&(rf(i,o),Qo(o,null,null,c),Yo()),g=i.memoizedState,b=o.memoizedState,g.parent!==d?(g={parent:d,cache:d},o.memoizedState=g,o.lanes===0&&(o.memoizedState=o.updateQueue.baseState=g),fa(o,Ce,d)):(d=b.cache,fa(o,Ce,d),d!==g.cache&&Zc(o,[Ce],c,!0))),Xe(i,o,o.pendingProps.children,c),o.child;case 29:throw o.pendingProps}throw Error(e(156,o.tag))}function Vr(i){i.flags|=4}function Uf(i,o,c,d,g){if((o=(i.mode&32)!==0)&&(o=!1),o){if(i.flags|=16777216,(g&335544128)===g)if(i.stateNode.complete)i.flags|=8192;else if(Dg())i.flags|=8192;else throw ti=xs,ef}else i.flags&=-16777217}function rg(i,o){if(o.type!=="stylesheet"||(o.state.loading&4)!==0)i.flags&=-16777217;else if(i.flags|=16777216,!y0(o))if(Dg())i.flags|=8192;else throw ti=xs,ef}function zs(i,o){o!==null&&(i.flags|=4),i.flags&16384&&(o=i.tag!==22?Fp():536870912,i.lanes|=o,Zi|=o)}function nu(i,o){if(!Wt)switch(i.tailMode){case"hidden":o=i.tail;for(var c=null;o!==null;)o.alternate!==null&&(c=o),o=o.sibling;c===null?i.tail=null:c.sibling=null;break;case"collapsed":c=i.tail;for(var d=null;c!==null;)c.alternate!==null&&(d=c),c=c.sibling;d===null?o||i.tail===null?i.tail=null:i.tail.sibling=null:d.sibling=null}}function fe(i){var o=i.alternate!==null&&i.alternate.child===i.child,c=0,d=0;if(o)for(var g=i.child;g!==null;)c|=g.lanes|g.childLanes,d|=g.subtreeFlags&65011712,d|=g.flags&65011712,g.return=i,g=g.sibling;else for(g=i.child;g!==null;)c|=g.lanes|g.childLanes,d|=g.subtreeFlags,d|=g.flags,g.return=i,g=g.sibling;return i.subtreeFlags|=d,i.childLanes=c,o}function C2(i,o,c){var d=o.pendingProps;switch(jc(o),o.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return fe(o),null;case 1:return fe(o),null;case 3:return c=o.stateNode,d=null,i!==null&&(d=i.memoizedState.cache),o.memoizedState.cache!==d&&(o.flags|=2048),Lr(Ce),Rt(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(i===null||i.child===null)&&(Li(o)?Vr(o):i===null||i.memoizedState.isDehydrated&&(o.flags&256)===0||(o.flags|=1024,Kc())),fe(o),null;case 26:var g=o.type,b=o.memoizedState;return i===null?(Vr(o),b!==null?(fe(o),rg(o,b)):(fe(o),Uf(o,g,null,d,c))):b?b!==i.memoizedState?(Vr(o),fe(o),rg(o,b)):(fe(o),o.flags&=-16777217):(i=i.memoizedProps,i!==d&&Vr(o),fe(o),Uf(o,g,i,d,c)),null;case 27:if(zt(o),c=vt.current,g=o.type,i!==null&&o.stateNode!=null)i.memoizedProps!==d&&Vr(o);else{if(!d){if(o.stateNode===null)throw Error(e(166));return fe(o),null}i=ht.current,Li(o)?Fv(o):(i=c0(g,d,c),o.stateNode=i,Vr(o))}return fe(o),null;case 5:if(zt(o),g=o.type,i!==null&&o.stateNode!=null)i.memoizedProps!==d&&Vr(o);else{if(!d){if(o.stateNode===null)throw Error(e(166));return fe(o),null}if(b=ht.current,Li(o))Fv(o);else{var C=Js(vt.current);switch(b){case 1:b=C.createElementNS("http://www.w3.org/2000/svg",g);break;case 2:b=C.createElementNS("http://www.w3.org/1998/Math/MathML",g);break;default:switch(g){case"svg":b=C.createElementNS("http://www.w3.org/2000/svg",g);break;case"math":b=C.createElementNS("http://www.w3.org/1998/Math/MathML",g);break;case"script":b=C.createElement("div"),b.innerHTML="<script><\/script>",b=b.removeChild(b.firstChild);break;case"select":b=typeof d.is=="string"?C.createElement("select",{is:d.is}):C.createElement("select"),d.multiple?b.multiple=!0:d.size&&(b.size=d.size);break;default:b=typeof d.is=="string"?C.createElement(g,{is:d.is}):C.createElement(g)}}b[We]=o,b[ln]=d;t:for(C=o.child;C!==null;){if(C.tag===5||C.tag===6)b.appendChild(C.stateNode);else if(C.tag!==4&&C.tag!==27&&C.child!==null){C.child.return=C,C=C.child;continue}if(C===o)break t;for(;C.sibling===null;){if(C.return===null||C.return===o)break t;C=C.return}C.sibling.return=C.return,C=C.sibling}o.stateNode=b;t:switch(Ke(b,g,d),g){case"button":case"input":case"select":case"textarea":d=!!d.autoFocus;break t;case"img":d=!0;break t;default:d=!1}d&&Vr(o)}}return fe(o),Uf(o,o.type,i===null?null:i.memoizedProps,o.pendingProps,c),null;case 6:if(i&&o.stateNode!=null)i.memoizedProps!==d&&Vr(o);else{if(typeof d!="string"&&o.stateNode===null)throw Error(e(166));if(i=vt.current,Li(o)){if(i=o.stateNode,c=o.memoizedProps,d=null,g=qe,g!==null)switch(g.tag){case 27:case 5:d=g.memoizedProps}i[We]=o,i=!!(i.nodeValue===c||d!==null&&d.suppressHydrationWarning===!0||$g(i.nodeValue,c)),i||ca(o,!0)}else i=Js(i).createTextNode(d),i[We]=o,o.stateNode=i}return fe(o),null;case 31:if(c=o.memoizedState,i===null||i.memoizedState!==null){if(d=Li(o),c!==null){if(i===null){if(!d)throw Error(e(318));if(i=o.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(e(557));i[We]=o}else Ya(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;fe(o),i=!1}else c=Kc(),i!==null&&i.memoizedState!==null&&(i.memoizedState.hydrationErrors=c),i=!0;if(!i)return o.flags&256?(An(o),o):(An(o),null);if((o.flags&128)!==0)throw Error(e(558))}return fe(o),null;case 13:if(d=o.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(g=Li(o),d!==null&&d.dehydrated!==null){if(i===null){if(!g)throw Error(e(318));if(g=o.memoizedState,g=g!==null?g.dehydrated:null,!g)throw Error(e(317));g[We]=o}else Ya(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;fe(o),g=!1}else g=Kc(),i!==null&&i.memoizedState!==null&&(i.memoizedState.hydrationErrors=g),g=!0;if(!g)return o.flags&256?(An(o),o):(An(o),null)}return An(o),(o.flags&128)!==0?(o.lanes=c,o):(c=d!==null,i=i!==null&&i.memoizedState!==null,c&&(d=o.child,g=null,d.alternate!==null&&d.alternate.memoizedState!==null&&d.alternate.memoizedState.cachePool!==null&&(g=d.alternate.memoizedState.cachePool.pool),b=null,d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(b=d.memoizedState.cachePool.pool),b!==g&&(d.flags|=2048)),c!==i&&c&&(o.child.flags|=8192),zs(o,o.updateQueue),fe(o),null);case 4:return Rt(),i===null&&uh(o.stateNode.containerInfo),fe(o),null;case 10:return Lr(o.type),fe(o),null;case 19:if(X(xe),d=o.memoizedState,d===null)return fe(o),null;if(g=(o.flags&128)!==0,b=d.rendering,b===null)if(g)nu(d,!1);else{if(ye!==0||i!==null&&(i.flags&128)!==0)for(i=o.child;i!==null;){if(b=Cs(i),b!==null){for(o.flags|=128,nu(d,!1),i=b.updateQueue,o.updateQueue=i,zs(o,i),o.subtreeFlags=0,i=c,c=o.child;c!==null;)Mv(c,i),c=c.sibling;return it(xe,xe.current&1|2),Wt&&Fr(o,d.treeForkCount),o.child}i=i.sibling}d.tail!==null&&Ee()>Vs&&(o.flags|=128,g=!0,nu(d,!1),o.lanes=4194304)}else{if(!g)if(i=Cs(b),i!==null){if(o.flags|=128,g=!0,i=i.updateQueue,o.updateQueue=i,zs(o,i),nu(d,!0),d.tail===null&&d.tailMode==="hidden"&&!b.alternate&&!Wt)return fe(o),null}else 2*Ee()-d.renderingStartTime>Vs&&c!==536870912&&(o.flags|=128,g=!0,nu(d,!1),o.lanes=4194304);d.isBackwards?(b.sibling=o.child,o.child=b):(i=d.last,i!==null?i.sibling=b:o.child=b,d.last=b)}return d.tail!==null?(i=d.tail,d.rendering=i,d.tail=i.sibling,d.renderingStartTime=Ee(),i.sibling=null,c=xe.current,it(xe,g?c&1|2:c&1),Wt&&Fr(o,d.treeForkCount),i):(fe(o),null);case 22:case 23:return An(o),sf(),d=o.memoizedState!==null,i!==null?i.memoizedState!==null!==d&&(o.flags|=8192):d&&(o.flags|=8192),d?(c&536870912)!==0&&(o.flags&128)===0&&(fe(o),o.subtreeFlags&6&&(o.flags|=8192)):fe(o),c=o.updateQueue,c!==null&&zs(o,c.retryQueue),c=null,i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(c=i.memoizedState.cachePool.pool),d=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(d=o.memoizedState.cachePool.pool),d!==c&&(o.flags|=2048),i!==null&&X(Ja),null;case 24:return c=null,i!==null&&(c=i.memoizedState.cache),o.memoizedState.cache!==c&&(o.flags|=2048),Lr(Ce),fe(o),null;case 25:return null;case 30:return null}throw Error(e(156,o.tag))}function S2(i,o){switch(jc(o),o.tag){case 1:return i=o.flags,i&65536?(o.flags=i&-65537|128,o):null;case 3:return Lr(Ce),Rt(),i=o.flags,(i&65536)!==0&&(i&128)===0?(o.flags=i&-65537|128,o):null;case 26:case 27:case 5:return zt(o),null;case 31:if(o.memoizedState!==null){if(An(o),o.alternate===null)throw Error(e(340));Ya()}return i=o.flags,i&65536?(o.flags=i&-65537|128,o):null;case 13:if(An(o),i=o.memoizedState,i!==null&&i.dehydrated!==null){if(o.alternate===null)throw Error(e(340));Ya()}return i=o.flags,i&65536?(o.flags=i&-65537|128,o):null;case 19:return X(xe),null;case 4:return Rt(),null;case 10:return Lr(o.type),null;case 22:case 23:return An(o),sf(),i!==null&&X(Ja),i=o.flags,i&65536?(o.flags=i&-65537|128,o):null;case 24:return Lr(Ce),null;case 25:return null;default:return null}}function ag(i,o){switch(jc(o),o.tag){case 3:Lr(Ce),Rt();break;case 26:case 27:case 5:zt(o);break;case 4:Rt();break;case 31:o.memoizedState!==null&&An(o);break;case 13:An(o);break;case 19:X(xe);break;case 10:Lr(o.type);break;case 22:case 23:An(o),sf(),i!==null&&X(Ja);break;case 24:Lr(Ce)}}function ru(i,o){try{var c=o.updateQueue,d=c!==null?c.lastEffect:null;if(d!==null){var g=d.next;c=g;do{if((c.tag&i)===i){d=void 0;var b=c.create,C=c.inst;d=b(),C.destroy=d}c=c.next}while(c!==g)}}catch(D){ee(o,o.return,D)}}function ga(i,o,c){try{var d=o.updateQueue,g=d!==null?d.lastEffect:null;if(g!==null){var b=g.next;d=b;do{if((d.tag&i)===i){var C=d.inst,D=C.destroy;if(D!==void 0){C.destroy=void 0,g=o;var U=c,Q=D;try{Q()}catch(ut){ee(g,U,ut)}}}d=d.next}while(d!==b)}}catch(ut){ee(o,o.return,ut)}}function ig(i){var o=i.updateQueue;if(o!==null){var c=i.stateNode;try{Yv(o,c)}catch(d){ee(i,i.return,d)}}}function og(i,o,c){c.props=ri(i.type,i.memoizedProps),c.state=i.memoizedState;try{c.componentWillUnmount()}catch(d){ee(i,o,d)}}function au(i,o){try{var c=i.ref;if(c!==null){switch(i.tag){case 26:case 27:case 5:var d=i.stateNode;break;case 30:d=i.stateNode;break;default:d=i.stateNode}typeof c=="function"?i.refCleanup=c(d):c.current=d}}catch(g){ee(i,o,g)}}function pr(i,o){var c=i.ref,d=i.refCleanup;if(c!==null)if(typeof d=="function")try{d()}catch(g){ee(i,o,g)}finally{i.refCleanup=null,i=i.alternate,i!=null&&(i.refCleanup=null)}else if(typeof c=="function")try{c(null)}catch(g){ee(i,o,g)}else c.current=null}function ug(i){var o=i.type,c=i.memoizedProps,d=i.stateNode;try{t:switch(o){case"button":case"input":case"select":case"textarea":c.autoFocus&&d.focus();break t;case"img":c.src?d.src=c.src:c.srcSet&&(d.srcset=c.srcSet)}}catch(g){ee(i,i.return,g)}}function Pf(i,o,c){try{var d=i.stateNode;X2(d,i.type,c,o),d[ln]=o}catch(g){ee(i,i.return,g)}}function sg(i){return i.tag===5||i.tag===3||i.tag===26||i.tag===27&&Ca(i.type)||i.tag===4}function Hf(i){t:for(;;){for(;i.sibling===null;){if(i.return===null||sg(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.tag===27&&Ca(i.type)||i.flags&2||i.child===null||i.tag===4)continue t;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function Vf(i,o,c){var d=i.tag;if(d===5||d===6)i=i.stateNode,o?(c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c).insertBefore(i,o):(o=c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c,o.appendChild(i),c=c._reactRootContainer,c!=null||o.onclick!==null||(o.onclick=kr));else if(d!==4&&(d===27&&Ca(i.type)&&(c=i.stateNode,o=null),i=i.child,i!==null))for(Vf(i,o,c),i=i.sibling;i!==null;)Vf(i,o,c),i=i.sibling}function Ls(i,o,c){var d=i.tag;if(d===5||d===6)i=i.stateNode,o?c.insertBefore(i,o):c.appendChild(i);else if(d!==4&&(d===27&&Ca(i.type)&&(c=i.stateNode),i=i.child,i!==null))for(Ls(i,o,c),i=i.sibling;i!==null;)Ls(i,o,c),i=i.sibling}function lg(i){var o=i.stateNode,c=i.memoizedProps;try{for(var d=i.type,g=o.attributes;g.length;)o.removeAttributeNode(g[0]);Ke(o,d,c),o[We]=i,o[ln]=c}catch(b){ee(i,i.return,b)}}var Gr=!1,Ae=!1,Gf=!1,cg=typeof WeakSet=="function"?WeakSet:Set,Le=null;function R2(i,o){if(i=i.containerInfo,ch=il,i=_v(i),Bc(i)){if("selectionStart"in i)var c={start:i.selectionStart,end:i.selectionEnd};else t:{c=(c=i.ownerDocument)&&c.defaultView||window;var d=c.getSelection&&c.getSelection();if(d&&d.rangeCount!==0){c=d.anchorNode;var g=d.anchorOffset,b=d.focusNode;d=d.focusOffset;try{c.nodeType,b.nodeType}catch{c=null;break t}var C=0,D=-1,U=-1,Q=0,ut=0,ct=i,Z=null;e:for(;;){for(var $;ct!==c||g!==0&&ct.nodeType!==3||(D=C+g),ct!==b||d!==0&&ct.nodeType!==3||(U=C+d),ct.nodeType===3&&(C+=ct.nodeValue.length),($=ct.firstChild)!==null;)Z=ct,ct=$;for(;;){if(ct===i)break e;if(Z===c&&++Q===g&&(D=C),Z===b&&++ut===d&&(U=C),($=ct.nextSibling)!==null)break;ct=Z,Z=ct.parentNode}ct=$}c=D===-1||U===-1?null:{start:D,end:U}}else c=null}c=c||{start:0,end:0}}else c=null;for(fh={focusedElem:i,selectionRange:c},il=!1,Le=o;Le!==null;)if(o=Le,i=o.child,(o.subtreeFlags&1028)!==0&&i!==null)i.return=o,Le=i;else for(;Le!==null;){switch(o=Le,b=o.alternate,i=o.flags,o.tag){case 0:if((i&4)!==0&&(i=o.updateQueue,i=i!==null?i.events:null,i!==null))for(c=0;c<i.length;c++)g=i[c],g.ref.impl=g.nextImpl;break;case 11:case 15:break;case 1:if((i&1024)!==0&&b!==null){i=void 0,c=o,g=b.memoizedProps,b=b.memoizedState,d=c.stateNode;try{var yt=ri(c.type,g);i=d.getSnapshotBeforeUpdate(yt,b),d.__reactInternalSnapshotBeforeUpdate=i}catch(Dt){ee(c,c.return,Dt)}}break;case 3:if((i&1024)!==0){if(i=o.stateNode.containerInfo,c=i.nodeType,c===9)ph(i);else if(c===1)switch(i.nodeName){case"HEAD":case"HTML":case"BODY":ph(i);break;default:i.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((i&1024)!==0)throw Error(e(163))}if(i=o.sibling,i!==null){i.return=o.return,Le=i;break}Le=o.return}}function fg(i,o,c){var d=c.flags;switch(c.tag){case 0:case 11:case 15:qr(i,c),d&4&&ru(5,c);break;case 1:if(qr(i,c),d&4)if(i=c.stateNode,o===null)try{i.componentDidMount()}catch(C){ee(c,c.return,C)}else{var g=ri(c.type,o.memoizedProps);o=o.memoizedState;try{i.componentDidUpdate(g,o,i.__reactInternalSnapshotBeforeUpdate)}catch(C){ee(c,c.return,C)}}d&64&&ig(c),d&512&&au(c,c.return);break;case 3:if(qr(i,c),d&64&&(i=c.updateQueue,i!==null)){if(o=null,c.child!==null)switch(c.child.tag){case 27:case 5:o=c.child.stateNode;break;case 1:o=c.child.stateNode}try{Yv(i,o)}catch(C){ee(c,c.return,C)}}break;case 27:o===null&&d&4&&lg(c);case 26:case 5:qr(i,c),o===null&&d&4&&ug(c),d&512&&au(c,c.return);break;case 12:qr(i,c);break;case 31:qr(i,c),d&4&&pg(i,c);break;case 13:qr(i,c),d&4&&vg(i,c),d&64&&(i=c.memoizedState,i!==null&&(i=i.dehydrated,i!==null&&(c=B2.bind(null,c),ew(i,c))));break;case 22:if(d=c.memoizedState!==null||Gr,!d){o=o!==null&&o.memoizedState!==null||Ae,g=Gr;var b=Ae;Gr=d,(Ae=o)&&!b?jr(i,c,(c.subtreeFlags&8772)!==0):qr(i,c),Gr=g,Ae=b}break;case 30:break;default:qr(i,c)}}function hg(i){var o=i.alternate;o!==null&&(i.alternate=null,hg(o)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(o=i.stateNode,o!==null&&yc(o)),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}var de=null,fn=!1;function Wr(i,o,c){for(c=c.child;c!==null;)dg(i,o,c),c=c.sibling}function dg(i,o,c){if(Ge&&typeof Ge.onCommitFiberUnmount=="function")try{Ge.onCommitFiberUnmount(Mr,c)}catch{}switch(c.tag){case 26:Ae||pr(c,o),Wr(i,o,c),c.memoizedState?c.memoizedState.count--:c.stateNode&&(c=c.stateNode,c.parentNode.removeChild(c));break;case 27:Ae||pr(c,o);var d=de,g=fn;Ca(c.type)&&(de=c.stateNode,fn=!1),Wr(i,o,c),du(c.stateNode),de=d,fn=g;break;case 5:Ae||pr(c,o);case 6:if(d=de,g=fn,de=null,Wr(i,o,c),de=d,fn=g,de!==null)if(fn)try{(de.nodeType===9?de.body:de.nodeName==="HTML"?de.ownerDocument.body:de).removeChild(c.stateNode)}catch(b){ee(c,o,b)}else try{de.removeChild(c.stateNode)}catch(b){ee(c,o,b)}break;case 18:de!==null&&(fn?(i=de,i0(i.nodeType===9?i.body:i.nodeName==="HTML"?i.ownerDocument.body:i,c.stateNode),io(i)):i0(de,c.stateNode));break;case 4:d=de,g=fn,de=c.stateNode.containerInfo,fn=!0,Wr(i,o,c),de=d,fn=g;break;case 0:case 11:case 14:case 15:ga(2,c,o),Ae||ga(4,c,o),Wr(i,o,c);break;case 1:Ae||(pr(c,o),d=c.stateNode,typeof d.componentWillUnmount=="function"&&og(c,o,d)),Wr(i,o,c);break;case 21:Wr(i,o,c);break;case 22:Ae=(d=Ae)||c.memoizedState!==null,Wr(i,o,c),Ae=d;break;default:Wr(i,o,c)}}function pg(i,o){if(o.memoizedState===null&&(i=o.alternate,i!==null&&(i=i.memoizedState,i!==null))){i=i.dehydrated;try{io(i)}catch(c){ee(o,o.return,c)}}}function vg(i,o){if(o.memoizedState===null&&(i=o.alternate,i!==null&&(i=i.memoizedState,i!==null&&(i=i.dehydrated,i!==null))))try{io(i)}catch(c){ee(o,o.return,c)}}function A2(i){switch(i.tag){case 31:case 13:case 19:var o=i.stateNode;return o===null&&(o=i.stateNode=new cg),o;case 22:return i=i.stateNode,o=i._retryCache,o===null&&(o=i._retryCache=new cg),o;default:throw Error(e(435,i.tag))}}function Us(i,o){var c=A2(i);o.forEach(function(d){if(!c.has(d)){c.add(d);var g=F2.bind(null,i,d);d.then(g,g)}})}function hn(i,o){var c=o.deletions;if(c!==null)for(var d=0;d<c.length;d++){var g=c[d],b=i,C=o,D=C;t:for(;D!==null;){switch(D.tag){case 27:if(Ca(D.type)){de=D.stateNode,fn=!1;break t}break;case 5:de=D.stateNode,fn=!1;break t;case 3:case 4:de=D.stateNode.containerInfo,fn=!0;break t}D=D.return}if(de===null)throw Error(e(160));dg(b,C,g),de=null,fn=!1,b=g.alternate,b!==null&&(b.return=null),g.return=null}if(o.subtreeFlags&13886)for(o=o.child;o!==null;)mg(o,i),o=o.sibling}var rr=null;function mg(i,o){var c=i.alternate,d=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:hn(o,i),dn(i),d&4&&(ga(3,i,i.return),ru(3,i),ga(5,i,i.return));break;case 1:hn(o,i),dn(i),d&512&&(Ae||c===null||pr(c,c.return)),d&64&&Gr&&(i=i.updateQueue,i!==null&&(d=i.callbacks,d!==null&&(c=i.shared.hiddenCallbacks,i.shared.hiddenCallbacks=c===null?d:c.concat(d))));break;case 26:var g=rr;if(hn(o,i),dn(i),d&512&&(Ae||c===null||pr(c,c.return)),d&4){var b=c!==null?c.memoizedState:null;if(d=i.memoizedState,c===null)if(d===null)if(i.stateNode===null){t:{d=i.type,c=i.memoizedProps,g=g.ownerDocument||g;e:switch(d){case"title":b=g.getElementsByTagName("title")[0],(!b||b[Mo]||b[We]||b.namespaceURI==="http://www.w3.org/2000/svg"||b.hasAttribute("itemprop"))&&(b=g.createElement(d),g.head.insertBefore(b,g.querySelector("head > title"))),Ke(b,d,c),b[We]=i,ze(b),d=b;break t;case"link":var C=m0("link","href",g).get(d+(c.href||""));if(C){for(var D=0;D<C.length;D++)if(b=C[D],b.getAttribute("href")===(c.href==null||c.href===""?null:c.href)&&b.getAttribute("rel")===(c.rel==null?null:c.rel)&&b.getAttribute("title")===(c.title==null?null:c.title)&&b.getAttribute("crossorigin")===(c.crossOrigin==null?null:c.crossOrigin)){C.splice(D,1);break e}}b=g.createElement(d),Ke(b,d,c),g.head.appendChild(b);break;case"meta":if(C=m0("meta","content",g).get(d+(c.content||""))){for(D=0;D<C.length;D++)if(b=C[D],b.getAttribute("content")===(c.content==null?null:""+c.content)&&b.getAttribute("name")===(c.name==null?null:c.name)&&b.getAttribute("property")===(c.property==null?null:c.property)&&b.getAttribute("http-equiv")===(c.httpEquiv==null?null:c.httpEquiv)&&b.getAttribute("charset")===(c.charSet==null?null:c.charSet)){C.splice(D,1);break e}}b=g.createElement(d),Ke(b,d,c),g.head.appendChild(b);break;default:throw Error(e(468,d))}b[We]=i,ze(b),d=b}i.stateNode=d}else g0(g,i.type,i.stateNode);else i.stateNode=v0(g,d,i.memoizedProps);else b!==d?(b===null?c.stateNode!==null&&(c=c.stateNode,c.parentNode.removeChild(c)):b.count--,d===null?g0(g,i.type,i.stateNode):v0(g,d,i.memoizedProps)):d===null&&i.stateNode!==null&&Pf(i,i.memoizedProps,c.memoizedProps)}break;case 27:hn(o,i),dn(i),d&512&&(Ae||c===null||pr(c,c.return)),c!==null&&d&4&&Pf(i,i.memoizedProps,c.memoizedProps);break;case 5:if(hn(o,i),dn(i),d&512&&(Ae||c===null||pr(c,c.return)),i.flags&32){g=i.stateNode;try{Ti(g,"")}catch(yt){ee(i,i.return,yt)}}d&4&&i.stateNode!=null&&(g=i.memoizedProps,Pf(i,g,c!==null?c.memoizedProps:g)),d&1024&&(Gf=!0);break;case 6:if(hn(o,i),dn(i),d&4){if(i.stateNode===null)throw Error(e(162));d=i.memoizedProps,c=i.stateNode;try{c.nodeValue=d}catch(yt){ee(i,i.return,yt)}}break;case 3:if(el=null,g=rr,rr=$s(o.containerInfo),hn(o,i),rr=g,dn(i),d&4&&c!==null&&c.memoizedState.isDehydrated)try{io(o.containerInfo)}catch(yt){ee(i,i.return,yt)}Gf&&(Gf=!1,gg(i));break;case 4:d=rr,rr=$s(i.stateNode.containerInfo),hn(o,i),dn(i),rr=d;break;case 12:hn(o,i),dn(i);break;case 31:hn(o,i),dn(i),d&4&&(d=i.updateQueue,d!==null&&(i.updateQueue=null,Us(i,d)));break;case 13:hn(o,i),dn(i),i.child.flags&8192&&i.memoizedState!==null!=(c!==null&&c.memoizedState!==null)&&(Hs=Ee()),d&4&&(d=i.updateQueue,d!==null&&(i.updateQueue=null,Us(i,d)));break;case 22:g=i.memoizedState!==null;var U=c!==null&&c.memoizedState!==null,Q=Gr,ut=Ae;if(Gr=Q||g,Ae=ut||U,hn(o,i),Ae=ut,Gr=Q,dn(i),d&8192)t:for(o=i.stateNode,o._visibility=g?o._visibility&-2:o._visibility|1,g&&(c===null||U||Gr||Ae||ai(i)),c=null,o=i;;){if(o.tag===5||o.tag===26){if(c===null){U=c=o;try{if(b=U.stateNode,g)C=b.style,typeof C.setProperty=="function"?C.setProperty("display","none","important"):C.display="none";else{D=U.stateNode;var ct=U.memoizedProps.style,Z=ct!=null&&ct.hasOwnProperty("display")?ct.display:null;D.style.display=Z==null||typeof Z=="boolean"?"":(""+Z).trim()}}catch(yt){ee(U,U.return,yt)}}}else if(o.tag===6){if(c===null){U=o;try{U.stateNode.nodeValue=g?"":U.memoizedProps}catch(yt){ee(U,U.return,yt)}}}else if(o.tag===18){if(c===null){U=o;try{var $=U.stateNode;g?o0($,!0):o0(U.stateNode,!1)}catch(yt){ee(U,U.return,yt)}}}else if((o.tag!==22&&o.tag!==23||o.memoizedState===null||o===i)&&o.child!==null){o.child.return=o,o=o.child;continue}if(o===i)break t;for(;o.sibling===null;){if(o.return===null||o.return===i)break t;c===o&&(c=null),o=o.return}c===o&&(c=null),o.sibling.return=o.return,o=o.sibling}d&4&&(d=i.updateQueue,d!==null&&(c=d.retryQueue,c!==null&&(d.retryQueue=null,Us(i,c))));break;case 19:hn(o,i),dn(i),d&4&&(d=i.updateQueue,d!==null&&(i.updateQueue=null,Us(i,d)));break;case 30:break;case 21:break;default:hn(o,i),dn(i)}}function dn(i){var o=i.flags;if(o&2){try{for(var c,d=i.return;d!==null;){if(sg(d)){c=d;break}d=d.return}if(c==null)throw Error(e(160));switch(c.tag){case 27:var g=c.stateNode,b=Hf(i);Ls(i,b,g);break;case 5:var C=c.stateNode;c.flags&32&&(Ti(C,""),c.flags&=-33);var D=Hf(i);Ls(i,D,C);break;case 3:case 4:var U=c.stateNode.containerInfo,Q=Hf(i);Vf(i,Q,U);break;default:throw Error(e(161))}}catch(ut){ee(i,i.return,ut)}i.flags&=-3}o&4096&&(i.flags&=-4097)}function gg(i){if(i.subtreeFlags&1024)for(i=i.child;i!==null;){var o=i;gg(o),o.tag===5&&o.flags&1024&&o.stateNode.reset(),i=i.sibling}}function qr(i,o){if(o.subtreeFlags&8772)for(o=o.child;o!==null;)fg(i,o.alternate,o),o=o.sibling}function ai(i){for(i=i.child;i!==null;){var o=i;switch(o.tag){case 0:case 11:case 14:case 15:ga(4,o,o.return),ai(o);break;case 1:pr(o,o.return);var c=o.stateNode;typeof c.componentWillUnmount=="function"&&og(o,o.return,c),ai(o);break;case 27:du(o.stateNode);case 26:case 5:pr(o,o.return),ai(o);break;case 22:o.memoizedState===null&&ai(o);break;case 30:ai(o);break;default:ai(o)}i=i.sibling}}function jr(i,o,c){for(c=c&&(o.subtreeFlags&8772)!==0,o=o.child;o!==null;){var d=o.alternate,g=i,b=o,C=b.flags;switch(b.tag){case 0:case 11:case 15:jr(g,b,c),ru(4,b);break;case 1:if(jr(g,b,c),d=b,g=d.stateNode,typeof g.componentDidMount=="function")try{g.componentDidMount()}catch(Q){ee(d,d.return,Q)}if(d=b,g=d.updateQueue,g!==null){var D=d.stateNode;try{var U=g.shared.hiddenCallbacks;if(U!==null)for(g.shared.hiddenCallbacks=null,g=0;g<U.length;g++)Kv(U[g],D)}catch(Q){ee(d,d.return,Q)}}c&&C&64&&ig(b),au(b,b.return);break;case 27:lg(b);case 26:case 5:jr(g,b,c),c&&d===null&&C&4&&ug(b),au(b,b.return);break;case 12:jr(g,b,c);break;case 31:jr(g,b,c),c&&C&4&&pg(g,b);break;case 13:jr(g,b,c),c&&C&4&&vg(g,b);break;case 22:b.memoizedState===null&&jr(g,b,c),au(b,b.return);break;case 30:break;default:jr(g,b,c)}o=o.sibling}}function Wf(i,o){var c=null;i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(c=i.memoizedState.cachePool.pool),i=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(i=o.memoizedState.cachePool.pool),i!==c&&(i!=null&&i.refCount++,c!=null&&Wo(c))}function qf(i,o){i=null,o.alternate!==null&&(i=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==i&&(o.refCount++,i!=null&&Wo(i))}function ar(i,o,c,d){if(o.subtreeFlags&10256)for(o=o.child;o!==null;)yg(i,o,c,d),o=o.sibling}function yg(i,o,c,d){var g=o.flags;switch(o.tag){case 0:case 11:case 15:ar(i,o,c,d),g&2048&&ru(9,o);break;case 1:ar(i,o,c,d);break;case 3:ar(i,o,c,d),g&2048&&(i=null,o.alternate!==null&&(i=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==i&&(o.refCount++,i!=null&&Wo(i)));break;case 12:if(g&2048){ar(i,o,c,d),i=o.stateNode;try{var b=o.memoizedProps,C=b.id,D=b.onPostCommit;typeof D=="function"&&D(C,o.alternate===null?"mount":"update",i.passiveEffectDuration,-0)}catch(U){ee(o,o.return,U)}}else ar(i,o,c,d);break;case 31:ar(i,o,c,d);break;case 13:ar(i,o,c,d);break;case 23:break;case 22:b=o.stateNode,C=o.alternate,o.memoizedState!==null?b._visibility&2?ar(i,o,c,d):iu(i,o):b._visibility&2?ar(i,o,c,d):(b._visibility|=2,Ki(i,o,c,d,(o.subtreeFlags&10256)!==0||!1)),g&2048&&Wf(C,o);break;case 24:ar(i,o,c,d),g&2048&&qf(o.alternate,o);break;default:ar(i,o,c,d)}}function Ki(i,o,c,d,g){for(g=g&&((o.subtreeFlags&10256)!==0||!1),o=o.child;o!==null;){var b=i,C=o,D=c,U=d,Q=C.flags;switch(C.tag){case 0:case 11:case 15:Ki(b,C,D,U,g),ru(8,C);break;case 23:break;case 22:var ut=C.stateNode;C.memoizedState!==null?ut._visibility&2?Ki(b,C,D,U,g):iu(b,C):(ut._visibility|=2,Ki(b,C,D,U,g)),g&&Q&2048&&Wf(C.alternate,C);break;case 24:Ki(b,C,D,U,g),g&&Q&2048&&qf(C.alternate,C);break;default:Ki(b,C,D,U,g)}o=o.sibling}}function iu(i,o){if(o.subtreeFlags&10256)for(o=o.child;o!==null;){var c=i,d=o,g=d.flags;switch(d.tag){case 22:iu(c,d),g&2048&&Wf(d.alternate,d);break;case 24:iu(c,d),g&2048&&qf(d.alternate,d);break;default:iu(c,d)}o=o.sibling}}var ou=8192;function Yi(i,o,c){if(i.subtreeFlags&ou)for(i=i.child;i!==null;)bg(i,o,c),i=i.sibling}function bg(i,o,c){switch(i.tag){case 26:Yi(i,o,c),i.flags&ou&&i.memoizedState!==null&&dw(c,rr,i.memoizedState,i.memoizedProps);break;case 5:Yi(i,o,c);break;case 3:case 4:var d=rr;rr=$s(i.stateNode.containerInfo),Yi(i,o,c),rr=d;break;case 22:i.memoizedState===null&&(d=i.alternate,d!==null&&d.memoizedState!==null?(d=ou,ou=16777216,Yi(i,o,c),ou=d):Yi(i,o,c));break;default:Yi(i,o,c)}}function xg(i){var o=i.alternate;if(o!==null&&(i=o.child,i!==null)){o.child=null;do o=i.sibling,i.sibling=null,i=o;while(i!==null)}}function uu(i){var o=i.deletions;if((i.flags&16)!==0){if(o!==null)for(var c=0;c<o.length;c++){var d=o[c];Le=d,_g(d,i)}xg(i)}if(i.subtreeFlags&10256)for(i=i.child;i!==null;)wg(i),i=i.sibling}function wg(i){switch(i.tag){case 0:case 11:case 15:uu(i),i.flags&2048&&ga(9,i,i.return);break;case 3:uu(i);break;case 12:uu(i);break;case 22:var o=i.stateNode;i.memoizedState!==null&&o._visibility&2&&(i.return===null||i.return.tag!==13)?(o._visibility&=-3,Ps(i)):uu(i);break;default:uu(i)}}function Ps(i){var o=i.deletions;if((i.flags&16)!==0){if(o!==null)for(var c=0;c<o.length;c++){var d=o[c];Le=d,_g(d,i)}xg(i)}for(i=i.child;i!==null;){switch(o=i,o.tag){case 0:case 11:case 15:ga(8,o,o.return),Ps(o);break;case 22:c=o.stateNode,c._visibility&2&&(c._visibility&=-3,Ps(o));break;default:Ps(o)}i=i.sibling}}function _g(i,o){for(;Le!==null;){var c=Le;switch(c.tag){case 0:case 11:case 15:ga(8,c,o);break;case 23:case 22:if(c.memoizedState!==null&&c.memoizedState.cachePool!==null){var d=c.memoizedState.cachePool.pool;d!=null&&d.refCount++}break;case 24:Wo(c.memoizedState.cache)}if(d=c.child,d!==null)d.return=c,Le=d;else t:for(c=i;Le!==null;){d=Le;var g=d.sibling,b=d.return;if(hg(d),d===c){Le=null;break t}if(g!==null){g.return=b,Le=g;break t}Le=b}}}var T2={getCacheForType:function(i){var o=je(Ce),c=o.data.get(i);return c===void 0&&(c=i(),o.data.set(i,c)),c},cacheSignal:function(){return je(Ce).controller.signal}},D2=typeof WeakMap=="function"?WeakMap:Map,Zt=0,se=null,Ut=null,Vt=0,te=0,Tn=null,ya=!1,Qi=!1,jf=!1,Xr=0,ye=0,ba=0,ii=0,Xf=0,Dn=0,Zi=0,su=null,pn=null,Kf=!1,Hs=0,Eg=0,Vs=1/0,Gs=null,xa=null,De=0,wa=null,Ji=null,Kr=0,Yf=0,Qf=null,Cg=null,lu=0,Zf=null;function Nn(){return(Zt&2)!==0&&Vt!==0?Vt&-Vt:L.T!==null?rh():Pp()}function Sg(){if(Dn===0)if((Vt&536870912)===0||Wt){var i=Zu;Zu<<=1,(Zu&3932160)===0&&(Zu=262144),Dn=i}else Dn=536870912;return i=Rn.current,i!==null&&(i.flags|=32),Dn}function vn(i,o,c){(i===se&&(te===2||te===9)||i.cancelPendingCommit!==null)&&($i(i,0),_a(i,Vt,Dn,!1)),No(i,c),((Zt&2)===0||i!==se)&&(i===se&&((Zt&2)===0&&(ii|=c),ye===4&&_a(i,Vt,Dn,!1)),vr(i))}function Rg(i,o,c){if((Zt&6)!==0)throw Error(e(327));var d=!c&&(o&127)===0&&(o&i.expiredLanes)===0||Do(i,o),g=d?O2(i,o):$f(i,o,!0),b=d;do{if(g===0){Qi&&!d&&_a(i,o,0,!1);break}else{if(c=i.current.alternate,b&&!N2(c)){g=$f(i,o,!1),b=!1;continue}if(g===2){if(b=o,i.errorRecoveryDisabledLanes&b)var C=0;else C=i.pendingLanes&-536870913,C=C!==0?C:C&536870912?536870912:0;if(C!==0){o=C;t:{var D=i;g=su;var U=D.current.memoizedState.isDehydrated;if(U&&($i(D,C).flags|=256),C=$f(D,C,!1),C!==2){if(jf&&!U){D.errorRecoveryDisabledLanes|=b,ii|=b,g=4;break t}b=pn,pn=g,b!==null&&(pn===null?pn=b:pn.push.apply(pn,b))}g=C}if(b=!1,g!==2)continue}}if(g===1){$i(i,0),_a(i,o,0,!0);break}t:{switch(d=i,b=g,b){case 0:case 1:throw Error(e(345));case 4:if((o&4194048)!==o)break;case 6:_a(d,o,Dn,!ya);break t;case 2:pn=null;break;case 3:case 5:break;default:throw Error(e(329))}if((o&62914560)===o&&(g=Hs+300-Ee(),10<g)){if(_a(d,o,Dn,!ya),$u(d,0,!0)!==0)break t;Kr=o,d.timeoutHandle=r0(Ag.bind(null,d,c,pn,Gs,Kf,o,Dn,ii,Zi,ya,b,"Throttled",-0,0),g);break t}Ag(d,c,pn,Gs,Kf,o,Dn,ii,Zi,ya,b,null,-0,0)}}break}while(!0);vr(i)}function Ag(i,o,c,d,g,b,C,D,U,Q,ut,ct,Z,$){if(i.timeoutHandle=-1,ct=o.subtreeFlags,ct&8192||(ct&16785408)===16785408){ct={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:kr},bg(o,b,ct);var yt=(b&62914560)===b?Hs-Ee():(b&4194048)===b?Eg-Ee():0;if(yt=pw(ct,yt),yt!==null){Kr=b,i.cancelPendingCommit=yt(Bg.bind(null,i,o,b,c,d,g,C,D,U,ut,ct,null,Z,$)),_a(i,b,C,!Q);return}}Bg(i,o,b,c,d,g,C,D,U)}function N2(i){for(var o=i;;){var c=o.tag;if((c===0||c===11||c===15)&&o.flags&16384&&(c=o.updateQueue,c!==null&&(c=c.stores,c!==null)))for(var d=0;d<c.length;d++){var g=c[d],b=g.getSnapshot;g=g.value;try{if(!Cn(b(),g))return!1}catch{return!1}}if(c=o.child,o.subtreeFlags&16384&&c!==null)c.return=o,o=c;else{if(o===i)break;for(;o.sibling===null;){if(o.return===null||o.return===i)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function _a(i,o,c,d){o&=~Xf,o&=~ii,i.suspendedLanes|=o,i.pingedLanes&=~o,d&&(i.warmLanes|=o),d=i.expirationTimes;for(var g=o;0<g;){var b=31-En(g),C=1<<b;d[b]=-1,g&=~C}c!==0&&zp(i,c,o)}function Ws(){return(Zt&6)===0?(cu(0),!1):!0}function Jf(){if(Ut!==null){if(te===0)var i=Ut.return;else i=Ut,zr=Qa=null,pf(i),Gi=null,jo=0,i=Ut;for(;i!==null;)ag(i.alternate,i),i=i.return;Ut=null}}function $i(i,o){var c=i.timeoutHandle;c!==-1&&(i.timeoutHandle=-1,Q2(c)),c=i.cancelPendingCommit,c!==null&&(i.cancelPendingCommit=null,c()),Kr=0,Jf(),se=i,Ut=c=Br(i.current,null),Vt=o,te=0,Tn=null,ya=!1,Qi=Do(i,o),jf=!1,Zi=Dn=Xf=ii=ba=ye=0,pn=su=null,Kf=!1,(o&8)!==0&&(o|=o&32);var d=i.entangledLanes;if(d!==0)for(i=i.entanglements,d&=o;0<d;){var g=31-En(d),b=1<<g;o|=i[g],d&=~b}return Xr=o,fs(),c}function Tg(i,o){It=null,L.H=tu,o===Vi||o===bs?(o=Wv(),te=3):o===ef?(o=Wv(),te=4):te=o===Nf?8:o!==null&&typeof o=="object"&&typeof o.then=="function"?6:1,Tn=o,Ut===null&&(ye=1,ks(i,Gn(o,i.current)))}function Dg(){var i=Rn.current;return i===null?!0:(Vt&4194048)===Vt?Xn===null:(Vt&62914560)===Vt||(Vt&536870912)!==0?i===Xn:!1}function Ng(){var i=L.H;return L.H=tu,i===null?tu:i}function Mg(){var i=L.A;return L.A=T2,i}function qs(){ye=4,ya||(Vt&4194048)!==Vt&&Rn.current!==null||(Qi=!0),(ba&134217727)===0&&(ii&134217727)===0||se===null||_a(se,Vt,Dn,!1)}function $f(i,o,c){var d=Zt;Zt|=2;var g=Ng(),b=Mg();(se!==i||Vt!==o)&&(Gs=null,$i(i,o)),o=!1;var C=ye;t:do try{if(te!==0&&Ut!==null){var D=Ut,U=Tn;switch(te){case 8:Jf(),C=6;break t;case 3:case 2:case 9:case 6:Rn.current===null&&(o=!0);var Q=te;if(te=0,Tn=null,to(i,D,U,Q),c&&Qi){C=0;break t}break;default:Q=te,te=0,Tn=null,to(i,D,U,Q)}}M2(),C=ye;break}catch(ut){Tg(i,ut)}while(!0);return o&&i.shellSuspendCounter++,zr=Qa=null,Zt=d,L.H=g,L.A=b,Ut===null&&(se=null,Vt=0,fs()),C}function M2(){for(;Ut!==null;)Og(Ut)}function O2(i,o){var c=Zt;Zt|=2;var d=Ng(),g=Mg();se!==i||Vt!==o?(Gs=null,Vs=Ee()+500,$i(i,o)):Qi=Do(i,o);t:do try{if(te!==0&&Ut!==null){o=Ut;var b=Tn;e:switch(te){case 1:te=0,Tn=null,to(i,o,b,1);break;case 2:case 9:if(Vv(b)){te=0,Tn=null,kg(o);break}o=function(){te!==2&&te!==9||se!==i||(te=7),vr(i)},b.then(o,o);break t;case 3:te=7;break t;case 4:te=5;break t;case 7:Vv(b)?(te=0,Tn=null,kg(o)):(te=0,Tn=null,to(i,o,b,7));break;case 5:var C=null;switch(Ut.tag){case 26:C=Ut.memoizedState;case 5:case 27:var D=Ut;if(C?y0(C):D.stateNode.complete){te=0,Tn=null;var U=D.sibling;if(U!==null)Ut=U;else{var Q=D.return;Q!==null?(Ut=Q,js(Q)):Ut=null}break e}}te=0,Tn=null,to(i,o,b,5);break;case 6:te=0,Tn=null,to(i,o,b,6);break;case 8:Jf(),ye=6;break t;default:throw Error(e(462))}}k2();break}catch(ut){Tg(i,ut)}while(!0);return zr=Qa=null,L.H=d,L.A=g,Zt=c,Ut!==null?0:(se=null,Vt=0,fs(),ye)}function k2(){for(;Ut!==null&&!fr();)Og(Ut)}function Og(i){var o=ng(i.alternate,i,Xr);i.memoizedProps=i.pendingProps,o===null?js(i):Ut=o}function kg(i){var o=i,c=o.alternate;switch(o.tag){case 15:case 0:o=Qm(c,o,o.pendingProps,o.type,void 0,Vt);break;case 11:o=Qm(c,o,o.pendingProps,o.type.render,o.ref,Vt);break;case 5:pf(o);default:ag(c,o),o=Ut=Mv(o,Xr),o=ng(c,o,Xr)}i.memoizedProps=i.pendingProps,o===null?js(i):Ut=o}function to(i,o,c,d){zr=Qa=null,pf(o),Gi=null,jo=0;var g=o.return;try{if(w2(i,g,o,c,Vt)){ye=1,ks(i,Gn(c,i.current)),Ut=null;return}}catch(b){if(g!==null)throw Ut=g,b;ye=1,ks(i,Gn(c,i.current)),Ut=null;return}o.flags&32768?(Wt||d===1?i=!0:Qi||(Vt&536870912)!==0?i=!1:(ya=i=!0,(d===2||d===9||d===3||d===6)&&(d=Rn.current,d!==null&&d.tag===13&&(d.flags|=16384))),Ig(o,i)):js(o)}function js(i){var o=i;do{if((o.flags&32768)!==0){Ig(o,ya);return}i=o.return;var c=C2(o.alternate,o,Xr);if(c!==null){Ut=c;return}if(o=o.sibling,o!==null){Ut=o;return}Ut=o=i}while(o!==null);ye===0&&(ye=5)}function Ig(i,o){do{var c=S2(i.alternate,i);if(c!==null){c.flags&=32767,Ut=c;return}if(c=i.return,c!==null&&(c.flags|=32768,c.subtreeFlags=0,c.deletions=null),!o&&(i=i.sibling,i!==null)){Ut=i;return}Ut=i=c}while(i!==null);ye=6,Ut=null}function Bg(i,o,c,d,g,b,C,D,U){i.cancelPendingCommit=null;do Xs();while(De!==0);if((Zt&6)!==0)throw Error(e(327));if(o!==null){if(o===i.current)throw Error(e(177));if(b=o.lanes|o.childLanes,b|=Pc,hx(i,c,b,C,D,U),i===se&&(Ut=se=null,Vt=0),Ji=o,wa=i,Kr=c,Yf=b,Qf=g,Cg=d,(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?(i.callbackNode=null,i.callbackPriority=0,z2(un,function(){return Pg(),null})):(i.callbackNode=null,i.callbackPriority=0),d=(o.flags&13878)!==0,(o.subtreeFlags&13878)!==0||d){d=L.T,L.T=null,g=q.p,q.p=2,C=Zt,Zt|=4;try{R2(i,o,c)}finally{Zt=C,q.p=g,L.T=d}}De=1,Fg(),zg(),Lg()}}function Fg(){if(De===1){De=0;var i=wa,o=Ji,c=(o.flags&13878)!==0;if((o.subtreeFlags&13878)!==0||c){c=L.T,L.T=null;var d=q.p;q.p=2;var g=Zt;Zt|=4;try{mg(o,i);var b=fh,C=_v(i.containerInfo),D=b.focusedElem,U=b.selectionRange;if(C!==D&&D&&D.ownerDocument&&wv(D.ownerDocument.documentElement,D)){if(U!==null&&Bc(D)){var Q=U.start,ut=U.end;if(ut===void 0&&(ut=Q),"selectionStart"in D)D.selectionStart=Q,D.selectionEnd=Math.min(ut,D.value.length);else{var ct=D.ownerDocument||document,Z=ct&&ct.defaultView||window;if(Z.getSelection){var $=Z.getSelection(),yt=D.textContent.length,Dt=Math.min(U.start,yt),ae=U.end===void 0?Dt:Math.min(U.end,yt);!$.extend&&Dt>ae&&(C=ae,ae=Dt,Dt=C);var j=xv(D,Dt),V=xv(D,ae);if(j&&V&&($.rangeCount!==1||$.anchorNode!==j.node||$.anchorOffset!==j.offset||$.focusNode!==V.node||$.focusOffset!==V.offset)){var Y=ct.createRange();Y.setStart(j.node,j.offset),$.removeAllRanges(),Dt>ae?($.addRange(Y),$.extend(V.node,V.offset)):(Y.setEnd(V.node,V.offset),$.addRange(Y))}}}}for(ct=[],$=D;$=$.parentNode;)$.nodeType===1&&ct.push({element:$,left:$.scrollLeft,top:$.scrollTop});for(typeof D.focus=="function"&&D.focus(),D=0;D<ct.length;D++){var lt=ct[D];lt.element.scrollLeft=lt.left,lt.element.scrollTop=lt.top}}il=!!ch,fh=ch=null}finally{Zt=g,q.p=d,L.T=c}}i.current=o,De=2}}function zg(){if(De===2){De=0;var i=wa,o=Ji,c=(o.flags&8772)!==0;if((o.subtreeFlags&8772)!==0||c){c=L.T,L.T=null;var d=q.p;q.p=2;var g=Zt;Zt|=4;try{fg(i,o.alternate,o)}finally{Zt=g,q.p=d,L.T=c}}De=3}}function Lg(){if(De===4||De===3){De=0,tr();var i=wa,o=Ji,c=Kr,d=Cg;(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?De=5:(De=0,Ji=wa=null,Ug(i,i.pendingLanes));var g=i.pendingLanes;if(g===0&&(xa=null),mc(c),o=o.stateNode,Ge&&typeof Ge.onCommitFiberRoot=="function")try{Ge.onCommitFiberRoot(Mr,o,void 0,(o.current.flags&128)===128)}catch{}if(d!==null){o=L.T,g=q.p,q.p=2,L.T=null;try{for(var b=i.onRecoverableError,C=0;C<d.length;C++){var D=d[C];b(D.value,{componentStack:D.stack})}}finally{L.T=o,q.p=g}}(Kr&3)!==0&&Xs(),vr(i),g=i.pendingLanes,(c&261930)!==0&&(g&42)!==0?i===Zf?lu++:(lu=0,Zf=i):lu=0,cu(0)}}function Ug(i,o){(i.pooledCacheLanes&=o)===0&&(o=i.pooledCache,o!=null&&(i.pooledCache=null,Wo(o)))}function Xs(){return Fg(),zg(),Lg(),Pg()}function Pg(){if(De!==5)return!1;var i=wa,o=Yf;Yf=0;var c=mc(Kr),d=L.T,g=q.p;try{q.p=32>c?32:c,L.T=null,c=Qf,Qf=null;var b=wa,C=Kr;if(De=0,Ji=wa=null,Kr=0,(Zt&6)!==0)throw Error(e(331));var D=Zt;if(Zt|=4,wg(b.current),yg(b,b.current,C,c),Zt=D,cu(0,!1),Ge&&typeof Ge.onPostCommitFiberRoot=="function")try{Ge.onPostCommitFiberRoot(Mr,b)}catch{}return!0}finally{q.p=g,L.T=d,Ug(i,o)}}function Hg(i,o,c){o=Gn(c,o),o=Df(i.stateNode,o,2),i=pa(i,o,2),i!==null&&(No(i,2),vr(i))}function ee(i,o,c){if(i.tag===3)Hg(i,i,c);else for(;o!==null;){if(o.tag===3){Hg(o,i,c);break}else if(o.tag===1){var d=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof d.componentDidCatch=="function"&&(xa===null||!xa.has(d))){i=Gn(c,i),c=Vm(2),d=pa(o,c,2),d!==null&&(Gm(c,d,o,i),No(d,2),vr(d));break}}o=o.return}}function th(i,o,c){var d=i.pingCache;if(d===null){d=i.pingCache=new D2;var g=new Set;d.set(o,g)}else g=d.get(o),g===void 0&&(g=new Set,d.set(o,g));g.has(c)||(jf=!0,g.add(c),i=I2.bind(null,i,o,c),o.then(i,i))}function I2(i,o,c){var d=i.pingCache;d!==null&&d.delete(o),i.pingedLanes|=i.suspendedLanes&c,i.warmLanes&=~c,se===i&&(Vt&c)===c&&(ye===4||ye===3&&(Vt&62914560)===Vt&&300>Ee()-Hs?(Zt&2)===0&&$i(i,0):Xf|=c,Zi===Vt&&(Zi=0)),vr(i)}function Vg(i,o){o===0&&(o=Fp()),i=Xa(i,o),i!==null&&(No(i,o),vr(i))}function B2(i){var o=i.memoizedState,c=0;o!==null&&(c=o.retryLane),Vg(i,c)}function F2(i,o){var c=0;switch(i.tag){case 31:case 13:var d=i.stateNode,g=i.memoizedState;g!==null&&(c=g.retryLane);break;case 19:d=i.stateNode;break;case 22:d=i.stateNode._retryCache;break;default:throw Error(e(314))}d!==null&&d.delete(o),Vg(i,c)}function z2(i,o){return cr(i,o)}var Ks=null,eo=null,eh=!1,Ys=!1,nh=!1,Ea=0;function vr(i){i!==eo&&i.next===null&&(eo===null?Ks=eo=i:eo=eo.next=i),Ys=!0,eh||(eh=!0,U2())}function cu(i,o){if(!nh&&Ys){nh=!0;do for(var c=!1,d=Ks;d!==null;){if(i!==0){var g=d.pendingLanes;if(g===0)var b=0;else{var C=d.suspendedLanes,D=d.pingedLanes;b=(1<<31-En(42|i)+1)-1,b&=g&~(C&~D),b=b&201326741?b&201326741|1:b?b|2:0}b!==0&&(c=!0,jg(d,b))}else b=Vt,b=$u(d,d===se?b:0,d.cancelPendingCommit!==null||d.timeoutHandle!==-1),(b&3)===0||Do(d,b)||(c=!0,jg(d,b));d=d.next}while(c);nh=!1}}function L2(){Gg()}function Gg(){Ys=eh=!1;var i=0;Ea!==0&&Y2()&&(i=Ea);for(var o=Ee(),c=null,d=Ks;d!==null;){var g=d.next,b=Wg(d,o);b===0?(d.next=null,c===null?Ks=g:c.next=g,g===null&&(eo=c)):(c=d,(i!==0||(b&3)!==0)&&(Ys=!0)),d=g}De!==0&&De!==5||cu(i),Ea!==0&&(Ea=0)}function Wg(i,o){for(var c=i.suspendedLanes,d=i.pingedLanes,g=i.expirationTimes,b=i.pendingLanes&-62914561;0<b;){var C=31-En(b),D=1<<C,U=g[C];U===-1?((D&c)===0||(D&d)!==0)&&(g[C]=fx(D,o)):U<=o&&(i.expiredLanes|=D),b&=~D}if(o=se,c=Vt,c=$u(i,i===o?c:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),d=i.callbackNode,c===0||i===o&&(te===2||te===9)||i.cancelPendingCommit!==null)return d!==null&&d!==null&&_n(d),i.callbackNode=null,i.callbackPriority=0;if((c&3)===0||Do(i,c)){if(o=c&-c,o===i.callbackPriority)return o;switch(d!==null&&_n(d),mc(c)){case 2:case 8:c=Nr;break;case 32:c=un;break;case 268435456:c=Yu;break;default:c=un}return d=qg.bind(null,i),c=cr(c,d),i.callbackPriority=o,i.callbackNode=c,o}return d!==null&&d!==null&&_n(d),i.callbackPriority=2,i.callbackNode=null,2}function qg(i,o){if(De!==0&&De!==5)return i.callbackNode=null,i.callbackPriority=0,null;var c=i.callbackNode;if(Xs()&&i.callbackNode!==c)return null;var d=Vt;return d=$u(i,i===se?d:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),d===0?null:(Rg(i,d,o),Wg(i,Ee()),i.callbackNode!=null&&i.callbackNode===c?qg.bind(null,i):null)}function jg(i,o){if(Xs())return null;Rg(i,o,!0)}function U2(){Z2(function(){(Zt&6)!==0?cr(wi,L2):Gg()})}function rh(){if(Ea===0){var i=Pi;i===0&&(i=Qu,Qu<<=1,(Qu&261888)===0&&(Qu=256)),Ea=i}return Ea}function Xg(i){return i==null||typeof i=="symbol"||typeof i=="boolean"?null:typeof i=="function"?i:rs(""+i)}function Kg(i,o){var c=o.ownerDocument.createElement("input");return c.name=o.name,c.value=o.value,i.id&&c.setAttribute("form",i.id),o.parentNode.insertBefore(c,o),i=new FormData(i),c.parentNode.removeChild(c),i}function P2(i,o,c,d,g){if(o==="submit"&&c&&c.stateNode===g){var b=Xg((g[ln]||null).action),C=d.submitter;C&&(o=(o=C[ln]||null)?Xg(o.formAction):C.getAttribute("formAction"),o!==null&&(b=o,C=null));var D=new us("action","action",null,d,g);i.push({event:D,listeners:[{instance:null,listener:function(){if(d.defaultPrevented){if(Ea!==0){var U=C?Kg(g,C):new FormData(g);Ef(c,{pending:!0,data:U,method:g.method,action:b},null,U)}}else typeof b=="function"&&(D.preventDefault(),U=C?Kg(g,C):new FormData(g),Ef(c,{pending:!0,data:U,method:g.method,action:b},b,U))},currentTarget:g}]})}}for(var ah=0;ah<Uc.length;ah++){var ih=Uc[ah],H2=ih.toLowerCase(),V2=ih[0].toUpperCase()+ih.slice(1);nr(H2,"on"+V2)}nr(Sv,"onAnimationEnd"),nr(Rv,"onAnimationIteration"),nr(Av,"onAnimationStart"),nr("dblclick","onDoubleClick"),nr("focusin","onFocus"),nr("focusout","onBlur"),nr(a2,"onTransitionRun"),nr(i2,"onTransitionStart"),nr(o2,"onTransitionCancel"),nr(Tv,"onTransitionEnd"),Ri("onMouseEnter",["mouseout","mouseover"]),Ri("onMouseLeave",["mouseout","mouseover"]),Ri("onPointerEnter",["pointerout","pointerover"]),Ri("onPointerLeave",["pointerout","pointerover"]),Ga("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Ga("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Ga("onBeforeInput",["compositionend","keypress","textInput","paste"]),Ga("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Ga("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Ga("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var fu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),G2=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(fu));function Yg(i,o){o=(o&4)!==0;for(var c=0;c<i.length;c++){var d=i[c],g=d.event;d=d.listeners;t:{var b=void 0;if(o)for(var C=d.length-1;0<=C;C--){var D=d[C],U=D.instance,Q=D.currentTarget;if(D=D.listener,U!==b&&g.isPropagationStopped())break t;b=D,g.currentTarget=Q;try{b(g)}catch(ut){cs(ut)}g.currentTarget=null,b=U}else for(C=0;C<d.length;C++){if(D=d[C],U=D.instance,Q=D.currentTarget,D=D.listener,U!==b&&g.isPropagationStopped())break t;b=D,g.currentTarget=Q;try{b(g)}catch(ut){cs(ut)}g.currentTarget=null,b=U}}}}function Pt(i,o){var c=o[gc];c===void 0&&(c=o[gc]=new Set);var d=i+"__bubble";c.has(d)||(Qg(o,i,2,!1),c.add(d))}function oh(i,o,c){var d=0;o&&(d|=4),Qg(c,i,d,o)}var Qs="_reactListening"+Math.random().toString(36).slice(2);function uh(i){if(!i[Qs]){i[Qs]=!0,Gp.forEach(function(c){c!=="selectionchange"&&(G2.has(c)||oh(c,!1,i),oh(c,!0,i))});var o=i.nodeType===9?i:i.ownerDocument;o===null||o[Qs]||(o[Qs]=!0,oh("selectionchange",!1,o))}}function Qg(i,o,c,d){switch(S0(o)){case 2:var g=gw;break;case 8:g=yw;break;default:g=_h}c=g.bind(null,o,c,i),g=void 0,!Rc||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(g=!0),d?g!==void 0?i.addEventListener(o,c,{capture:!0,passive:g}):i.addEventListener(o,c,!0):g!==void 0?i.addEventListener(o,c,{passive:g}):i.addEventListener(o,c,!1)}function sh(i,o,c,d,g){var b=d;if((o&1)===0&&(o&2)===0&&d!==null)t:for(;;){if(d===null)return;var C=d.tag;if(C===3||C===4){var D=d.stateNode.containerInfo;if(D===g)break;if(C===4)for(C=d.return;C!==null;){var U=C.tag;if((U===3||U===4)&&C.stateNode.containerInfo===g)return;C=C.return}for(;D!==null;){if(C=Ei(D),C===null)return;if(U=C.tag,U===5||U===6||U===26||U===27){d=b=C;continue t}D=D.parentNode}}d=d.return}ev(function(){var Q=b,ut=Cc(c),ct=[];t:{var Z=Dv.get(i);if(Z!==void 0){var $=us,yt=i;switch(i){case"keypress":if(is(c)===0)break t;case"keydown":case"keyup":$=Fx;break;case"focusin":yt="focus",$=Nc;break;case"focusout":yt="blur",$=Nc;break;case"beforeblur":case"afterblur":$=Nc;break;case"click":if(c.button===2)break t;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":$=av;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":$=Cx;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":$=Ux;break;case Sv:case Rv:case Av:$=Ax;break;case Tv:$=Hx;break;case"scroll":case"scrollend":$=_x;break;case"wheel":$=Gx;break;case"copy":case"cut":case"paste":$=Dx;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":$=ov;break;case"toggle":case"beforetoggle":$=qx}var Dt=(o&4)!==0,ae=!Dt&&(i==="scroll"||i==="scrollend"),j=Dt?Z!==null?Z+"Capture":null:Z;Dt=[];for(var V=Q,Y;V!==null;){var lt=V;if(Y=lt.stateNode,lt=lt.tag,lt!==5&&lt!==26&&lt!==27||Y===null||j===null||(lt=ko(V,j),lt!=null&&Dt.push(hu(V,lt,Y))),ae)break;V=V.return}0<Dt.length&&(Z=new $(Z,yt,null,c,ut),ct.push({event:Z,listeners:Dt}))}}if((o&7)===0){t:{if(Z=i==="mouseover"||i==="pointerover",$=i==="mouseout"||i==="pointerout",Z&&c!==Ec&&(yt=c.relatedTarget||c.fromElement)&&(Ei(yt)||yt[_i]))break t;if(($||Z)&&(Z=ut.window===ut?ut:(Z=ut.ownerDocument)?Z.defaultView||Z.parentWindow:window,$?(yt=c.relatedTarget||c.toElement,$=Q,yt=yt?Ei(yt):null,yt!==null&&(ae=u(yt),Dt=yt.tag,yt!==ae||Dt!==5&&Dt!==27&&Dt!==6)&&(yt=null)):($=null,yt=Q),$!==yt)){if(Dt=av,lt="onMouseLeave",j="onMouseEnter",V="mouse",(i==="pointerout"||i==="pointerover")&&(Dt=ov,lt="onPointerLeave",j="onPointerEnter",V="pointer"),ae=$==null?Z:Oo($),Y=yt==null?Z:Oo(yt),Z=new Dt(lt,V+"leave",$,c,ut),Z.target=ae,Z.relatedTarget=Y,lt=null,Ei(ut)===Q&&(Dt=new Dt(j,V+"enter",yt,c,ut),Dt.target=Y,Dt.relatedTarget=ae,lt=Dt),ae=lt,$&&yt)e:{for(Dt=W2,j=$,V=yt,Y=0,lt=j;lt;lt=Dt(lt))Y++;lt=0;for(var At=V;At;At=Dt(At))lt++;for(;0<Y-lt;)j=Dt(j),Y--;for(;0<lt-Y;)V=Dt(V),lt--;for(;Y--;){if(j===V||V!==null&&j===V.alternate){Dt=j;break e}j=Dt(j),V=Dt(V)}Dt=null}else Dt=null;$!==null&&Zg(ct,Z,$,Dt,!1),yt!==null&&ae!==null&&Zg(ct,ae,yt,Dt,!0)}}t:{if(Z=Q?Oo(Q):window,$=Z.nodeName&&Z.nodeName.toLowerCase(),$==="select"||$==="input"&&Z.type==="file")var Kt=pv;else if(hv(Z))if(vv)Kt=e2;else{Kt=$x;var wt=Jx}else $=Z.nodeName,!$||$.toLowerCase()!=="input"||Z.type!=="checkbox"&&Z.type!=="radio"?Q&&_c(Q.elementType)&&(Kt=pv):Kt=t2;if(Kt&&(Kt=Kt(i,Q))){dv(ct,Kt,c,ut);break t}wt&&wt(i,Z,Q),i==="focusout"&&Q&&Z.type==="number"&&Q.memoizedProps.value!=null&&wc(Z,"number",Z.value)}switch(wt=Q?Oo(Q):window,i){case"focusin":(hv(wt)||wt.contentEditable==="true")&&(Oi=wt,Fc=Q,Ho=null);break;case"focusout":Ho=Fc=Oi=null;break;case"mousedown":zc=!0;break;case"contextmenu":case"mouseup":case"dragend":zc=!1,Ev(ct,c,ut);break;case"selectionchange":if(r2)break;case"keydown":case"keyup":Ev(ct,c,ut)}var Bt;if(Oc)t:{switch(i){case"compositionstart":var Gt="onCompositionStart";break t;case"compositionend":Gt="onCompositionEnd";break t;case"compositionupdate":Gt="onCompositionUpdate";break t}Gt=void 0}else Mi?cv(i,c)&&(Gt="onCompositionEnd"):i==="keydown"&&c.keyCode===229&&(Gt="onCompositionStart");Gt&&(uv&&c.locale!=="ko"&&(Mi||Gt!=="onCompositionStart"?Gt==="onCompositionEnd"&&Mi&&(Bt=nv()):(ua=ut,Ac="value"in ua?ua.value:ua.textContent,Mi=!0)),wt=Zs(Q,Gt),0<wt.length&&(Gt=new iv(Gt,i,null,c,ut),ct.push({event:Gt,listeners:wt}),Bt?Gt.data=Bt:(Bt=fv(c),Bt!==null&&(Gt.data=Bt)))),(Bt=Xx?Kx(i,c):Yx(i,c))&&(Gt=Zs(Q,"onBeforeInput"),0<Gt.length&&(wt=new iv("onBeforeInput","beforeinput",null,c,ut),ct.push({event:wt,listeners:Gt}),wt.data=Bt)),P2(ct,i,Q,c,ut)}Yg(ct,o)})}function hu(i,o,c){return{instance:i,listener:o,currentTarget:c}}function Zs(i,o){for(var c=o+"Capture",d=[];i!==null;){var g=i,b=g.stateNode;if(g=g.tag,g!==5&&g!==26&&g!==27||b===null||(g=ko(i,c),g!=null&&d.unshift(hu(i,g,b)),g=ko(i,o),g!=null&&d.push(hu(i,g,b))),i.tag===3)return d;i=i.return}return[]}function W2(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5&&i.tag!==27);return i||null}function Zg(i,o,c,d,g){for(var b=o._reactName,C=[];c!==null&&c!==d;){var D=c,U=D.alternate,Q=D.stateNode;if(D=D.tag,U!==null&&U===d)break;D!==5&&D!==26&&D!==27||Q===null||(U=Q,g?(Q=ko(c,b),Q!=null&&C.unshift(hu(c,Q,U))):g||(Q=ko(c,b),Q!=null&&C.push(hu(c,Q,U)))),c=c.return}C.length!==0&&i.push({event:o,listeners:C})}var q2=/\r\n?/g,j2=/\u0000|\uFFFD/g;function Jg(i){return(typeof i=="string"?i:""+i).replace(q2,`
`).replace(j2,"")}function $g(i,o){return o=Jg(o),Jg(i)===o}function re(i,o,c,d,g,b){switch(c){case"children":typeof d=="string"?o==="body"||o==="textarea"&&d===""||Ti(i,d):(typeof d=="number"||typeof d=="bigint")&&o!=="body"&&Ti(i,""+d);break;case"className":es(i,"class",d);break;case"tabIndex":es(i,"tabindex",d);break;case"dir":case"role":case"viewBox":case"width":case"height":es(i,c,d);break;case"style":$p(i,d,b);break;case"data":if(o!=="object"){es(i,"data",d);break}case"src":case"href":if(d===""&&(o!=="a"||c!=="href")){i.removeAttribute(c);break}if(d==null||typeof d=="function"||typeof d=="symbol"||typeof d=="boolean"){i.removeAttribute(c);break}d=rs(""+d),i.setAttribute(c,d);break;case"action":case"formAction":if(typeof d=="function"){i.setAttribute(c,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof b=="function"&&(c==="formAction"?(o!=="input"&&re(i,o,"name",g.name,g,null),re(i,o,"formEncType",g.formEncType,g,null),re(i,o,"formMethod",g.formMethod,g,null),re(i,o,"formTarget",g.formTarget,g,null)):(re(i,o,"encType",g.encType,g,null),re(i,o,"method",g.method,g,null),re(i,o,"target",g.target,g,null)));if(d==null||typeof d=="symbol"||typeof d=="boolean"){i.removeAttribute(c);break}d=rs(""+d),i.setAttribute(c,d);break;case"onClick":d!=null&&(i.onclick=kr);break;case"onScroll":d!=null&&Pt("scroll",i);break;case"onScrollEnd":d!=null&&Pt("scrollend",i);break;case"dangerouslySetInnerHTML":if(d!=null){if(typeof d!="object"||!("__html"in d))throw Error(e(61));if(c=d.__html,c!=null){if(g.children!=null)throw Error(e(60));i.innerHTML=c}}break;case"multiple":i.multiple=d&&typeof d!="function"&&typeof d!="symbol";break;case"muted":i.muted=d&&typeof d!="function"&&typeof d!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(d==null||typeof d=="function"||typeof d=="boolean"||typeof d=="symbol"){i.removeAttribute("xlink:href");break}c=rs(""+d),i.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",c);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":d!=null&&typeof d!="function"&&typeof d!="symbol"?i.setAttribute(c,""+d):i.removeAttribute(c);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":d&&typeof d!="function"&&typeof d!="symbol"?i.setAttribute(c,""):i.removeAttribute(c);break;case"capture":case"download":d===!0?i.setAttribute(c,""):d!==!1&&d!=null&&typeof d!="function"&&typeof d!="symbol"?i.setAttribute(c,d):i.removeAttribute(c);break;case"cols":case"rows":case"size":case"span":d!=null&&typeof d!="function"&&typeof d!="symbol"&&!isNaN(d)&&1<=d?i.setAttribute(c,d):i.removeAttribute(c);break;case"rowSpan":case"start":d==null||typeof d=="function"||typeof d=="symbol"||isNaN(d)?i.removeAttribute(c):i.setAttribute(c,d);break;case"popover":Pt("beforetoggle",i),Pt("toggle",i),ts(i,"popover",d);break;case"xlinkActuate":Or(i,"http://www.w3.org/1999/xlink","xlink:actuate",d);break;case"xlinkArcrole":Or(i,"http://www.w3.org/1999/xlink","xlink:arcrole",d);break;case"xlinkRole":Or(i,"http://www.w3.org/1999/xlink","xlink:role",d);break;case"xlinkShow":Or(i,"http://www.w3.org/1999/xlink","xlink:show",d);break;case"xlinkTitle":Or(i,"http://www.w3.org/1999/xlink","xlink:title",d);break;case"xlinkType":Or(i,"http://www.w3.org/1999/xlink","xlink:type",d);break;case"xmlBase":Or(i,"http://www.w3.org/XML/1998/namespace","xml:base",d);break;case"xmlLang":Or(i,"http://www.w3.org/XML/1998/namespace","xml:lang",d);break;case"xmlSpace":Or(i,"http://www.w3.org/XML/1998/namespace","xml:space",d);break;case"is":ts(i,"is",d);break;case"innerText":case"textContent":break;default:(!(2<c.length)||c[0]!=="o"&&c[0]!=="O"||c[1]!=="n"&&c[1]!=="N")&&(c=xx.get(c)||c,ts(i,c,d))}}function lh(i,o,c,d,g,b){switch(c){case"style":$p(i,d,b);break;case"dangerouslySetInnerHTML":if(d!=null){if(typeof d!="object"||!("__html"in d))throw Error(e(61));if(c=d.__html,c!=null){if(g.children!=null)throw Error(e(60));i.innerHTML=c}}break;case"children":typeof d=="string"?Ti(i,d):(typeof d=="number"||typeof d=="bigint")&&Ti(i,""+d);break;case"onScroll":d!=null&&Pt("scroll",i);break;case"onScrollEnd":d!=null&&Pt("scrollend",i);break;case"onClick":d!=null&&(i.onclick=kr);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Wp.hasOwnProperty(c))t:{if(c[0]==="o"&&c[1]==="n"&&(g=c.endsWith("Capture"),o=c.slice(2,g?c.length-7:void 0),b=i[ln]||null,b=b!=null?b[c]:null,typeof b=="function"&&i.removeEventListener(o,b,g),typeof d=="function")){typeof b!="function"&&b!==null&&(c in i?i[c]=null:i.hasAttribute(c)&&i.removeAttribute(c)),i.addEventListener(o,d,g);break t}c in i?i[c]=d:d===!0?i.setAttribute(c,""):ts(i,c,d)}}}function Ke(i,o,c){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Pt("error",i),Pt("load",i);var d=!1,g=!1,b;for(b in c)if(c.hasOwnProperty(b)){var C=c[b];if(C!=null)switch(b){case"src":d=!0;break;case"srcSet":g=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(e(137,o));default:re(i,o,b,C,c,null)}}g&&re(i,o,"srcSet",c.srcSet,c,null),d&&re(i,o,"src",c.src,c,null);return;case"input":Pt("invalid",i);var D=b=C=g=null,U=null,Q=null;for(d in c)if(c.hasOwnProperty(d)){var ut=c[d];if(ut!=null)switch(d){case"name":g=ut;break;case"type":C=ut;break;case"checked":U=ut;break;case"defaultChecked":Q=ut;break;case"value":b=ut;break;case"defaultValue":D=ut;break;case"children":case"dangerouslySetInnerHTML":if(ut!=null)throw Error(e(137,o));break;default:re(i,o,d,ut,c,null)}}Yp(i,b,D,U,Q,C,g,!1);return;case"select":Pt("invalid",i),d=C=b=null;for(g in c)if(c.hasOwnProperty(g)&&(D=c[g],D!=null))switch(g){case"value":b=D;break;case"defaultValue":C=D;break;case"multiple":d=D;default:re(i,o,g,D,c,null)}o=b,c=C,i.multiple=!!d,o!=null?Ai(i,!!d,o,!1):c!=null&&Ai(i,!!d,c,!0);return;case"textarea":Pt("invalid",i),b=g=d=null;for(C in c)if(c.hasOwnProperty(C)&&(D=c[C],D!=null))switch(C){case"value":d=D;break;case"defaultValue":g=D;break;case"children":b=D;break;case"dangerouslySetInnerHTML":if(D!=null)throw Error(e(91));break;default:re(i,o,C,D,c,null)}Zp(i,d,g,b);return;case"option":for(U in c)c.hasOwnProperty(U)&&(d=c[U],d!=null)&&(U==="selected"?i.selected=d&&typeof d!="function"&&typeof d!="symbol":re(i,o,U,d,c,null));return;case"dialog":Pt("beforetoggle",i),Pt("toggle",i),Pt("cancel",i),Pt("close",i);break;case"iframe":case"object":Pt("load",i);break;case"video":case"audio":for(d=0;d<fu.length;d++)Pt(fu[d],i);break;case"image":Pt("error",i),Pt("load",i);break;case"details":Pt("toggle",i);break;case"embed":case"source":case"link":Pt("error",i),Pt("load",i);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Q in c)if(c.hasOwnProperty(Q)&&(d=c[Q],d!=null))switch(Q){case"children":case"dangerouslySetInnerHTML":throw Error(e(137,o));default:re(i,o,Q,d,c,null)}return;default:if(_c(o)){for(ut in c)c.hasOwnProperty(ut)&&(d=c[ut],d!==void 0&&lh(i,o,ut,d,c,void 0));return}}for(D in c)c.hasOwnProperty(D)&&(d=c[D],d!=null&&re(i,o,D,d,c,null))}function X2(i,o,c,d){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var g=null,b=null,C=null,D=null,U=null,Q=null,ut=null;for($ in c){var ct=c[$];if(c.hasOwnProperty($)&&ct!=null)switch($){case"checked":break;case"value":break;case"defaultValue":U=ct;default:d.hasOwnProperty($)||re(i,o,$,null,d,ct)}}for(var Z in d){var $=d[Z];if(ct=c[Z],d.hasOwnProperty(Z)&&($!=null||ct!=null))switch(Z){case"type":b=$;break;case"name":g=$;break;case"checked":Q=$;break;case"defaultChecked":ut=$;break;case"value":C=$;break;case"defaultValue":D=$;break;case"children":case"dangerouslySetInnerHTML":if($!=null)throw Error(e(137,o));break;default:$!==ct&&re(i,o,Z,$,d,ct)}}xc(i,C,D,U,Q,ut,b,g);return;case"select":$=C=D=Z=null;for(b in c)if(U=c[b],c.hasOwnProperty(b)&&U!=null)switch(b){case"value":break;case"multiple":$=U;default:d.hasOwnProperty(b)||re(i,o,b,null,d,U)}for(g in d)if(b=d[g],U=c[g],d.hasOwnProperty(g)&&(b!=null||U!=null))switch(g){case"value":Z=b;break;case"defaultValue":D=b;break;case"multiple":C=b;default:b!==U&&re(i,o,g,b,d,U)}o=D,c=C,d=$,Z!=null?Ai(i,!!c,Z,!1):!!d!=!!c&&(o!=null?Ai(i,!!c,o,!0):Ai(i,!!c,c?[]:"",!1));return;case"textarea":$=Z=null;for(D in c)if(g=c[D],c.hasOwnProperty(D)&&g!=null&&!d.hasOwnProperty(D))switch(D){case"value":break;case"children":break;default:re(i,o,D,null,d,g)}for(C in d)if(g=d[C],b=c[C],d.hasOwnProperty(C)&&(g!=null||b!=null))switch(C){case"value":Z=g;break;case"defaultValue":$=g;break;case"children":break;case"dangerouslySetInnerHTML":if(g!=null)throw Error(e(91));break;default:g!==b&&re(i,o,C,g,d,b)}Qp(i,Z,$);return;case"option":for(var yt in c)Z=c[yt],c.hasOwnProperty(yt)&&Z!=null&&!d.hasOwnProperty(yt)&&(yt==="selected"?i.selected=!1:re(i,o,yt,null,d,Z));for(U in d)Z=d[U],$=c[U],d.hasOwnProperty(U)&&Z!==$&&(Z!=null||$!=null)&&(U==="selected"?i.selected=Z&&typeof Z!="function"&&typeof Z!="symbol":re(i,o,U,Z,d,$));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Dt in c)Z=c[Dt],c.hasOwnProperty(Dt)&&Z!=null&&!d.hasOwnProperty(Dt)&&re(i,o,Dt,null,d,Z);for(Q in d)if(Z=d[Q],$=c[Q],d.hasOwnProperty(Q)&&Z!==$&&(Z!=null||$!=null))switch(Q){case"children":case"dangerouslySetInnerHTML":if(Z!=null)throw Error(e(137,o));break;default:re(i,o,Q,Z,d,$)}return;default:if(_c(o)){for(var ae in c)Z=c[ae],c.hasOwnProperty(ae)&&Z!==void 0&&!d.hasOwnProperty(ae)&&lh(i,o,ae,void 0,d,Z);for(ut in d)Z=d[ut],$=c[ut],!d.hasOwnProperty(ut)||Z===$||Z===void 0&&$===void 0||lh(i,o,ut,Z,d,$);return}}for(var j in c)Z=c[j],c.hasOwnProperty(j)&&Z!=null&&!d.hasOwnProperty(j)&&re(i,o,j,null,d,Z);for(ct in d)Z=d[ct],$=c[ct],!d.hasOwnProperty(ct)||Z===$||Z==null&&$==null||re(i,o,ct,Z,d,$)}function t0(i){switch(i){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function K2(){if(typeof performance.getEntriesByType=="function"){for(var i=0,o=0,c=performance.getEntriesByType("resource"),d=0;d<c.length;d++){var g=c[d],b=g.transferSize,C=g.initiatorType,D=g.duration;if(b&&D&&t0(C)){for(C=0,D=g.responseEnd,d+=1;d<c.length;d++){var U=c[d],Q=U.startTime;if(Q>D)break;var ut=U.transferSize,ct=U.initiatorType;ut&&t0(ct)&&(U=U.responseEnd,C+=ut*(U<D?1:(D-Q)/(U-Q)))}if(--d,o+=8*(b+C)/(g.duration/1e3),i++,10<i)break}}if(0<i)return o/i/1e6}return navigator.connection&&(i=navigator.connection.downlink,typeof i=="number")?i:5}var ch=null,fh=null;function Js(i){return i.nodeType===9?i:i.ownerDocument}function e0(i){switch(i){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function n0(i,o){if(i===0)switch(o){case"svg":return 1;case"math":return 2;default:return 0}return i===1&&o==="foreignObject"?0:i}function hh(i,o){return i==="textarea"||i==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.children=="bigint"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var dh=null;function Y2(){var i=window.event;return i&&i.type==="popstate"?i===dh?!1:(dh=i,!0):(dh=null,!1)}var r0=typeof setTimeout=="function"?setTimeout:void 0,Q2=typeof clearTimeout=="function"?clearTimeout:void 0,a0=typeof Promise=="function"?Promise:void 0,Z2=typeof queueMicrotask=="function"?queueMicrotask:typeof a0<"u"?function(i){return a0.resolve(null).then(i).catch(J2)}:r0;function J2(i){setTimeout(function(){throw i})}function Ca(i){return i==="head"}function i0(i,o){var c=o,d=0;do{var g=c.nextSibling;if(i.removeChild(c),g&&g.nodeType===8)if(c=g.data,c==="/$"||c==="/&"){if(d===0){i.removeChild(g),io(o);return}d--}else if(c==="$"||c==="$?"||c==="$~"||c==="$!"||c==="&")d++;else if(c==="html")du(i.ownerDocument.documentElement);else if(c==="head"){c=i.ownerDocument.head,du(c);for(var b=c.firstChild;b;){var C=b.nextSibling,D=b.nodeName;b[Mo]||D==="SCRIPT"||D==="STYLE"||D==="LINK"&&b.rel.toLowerCase()==="stylesheet"||c.removeChild(b),b=C}}else c==="body"&&du(i.ownerDocument.body);c=g}while(c);io(o)}function o0(i,o){var c=i;i=0;do{var d=c.nextSibling;if(c.nodeType===1?o?(c._stashedDisplay=c.style.display,c.style.display="none"):(c.style.display=c._stashedDisplay||"",c.getAttribute("style")===""&&c.removeAttribute("style")):c.nodeType===3&&(o?(c._stashedText=c.nodeValue,c.nodeValue=""):c.nodeValue=c._stashedText||""),d&&d.nodeType===8)if(c=d.data,c==="/$"){if(i===0)break;i--}else c!=="$"&&c!=="$?"&&c!=="$~"&&c!=="$!"||i++;c=d}while(c)}function ph(i){var o=i.firstChild;for(o&&o.nodeType===10&&(o=o.nextSibling);o;){var c=o;switch(o=o.nextSibling,c.nodeName){case"HTML":case"HEAD":case"BODY":ph(c),yc(c);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(c.rel.toLowerCase()==="stylesheet")continue}i.removeChild(c)}}function $2(i,o,c,d){for(;i.nodeType===1;){var g=c;if(i.nodeName.toLowerCase()!==o.toLowerCase()){if(!d&&(i.nodeName!=="INPUT"||i.type!=="hidden"))break}else if(d){if(!i[Mo])switch(o){case"meta":if(!i.hasAttribute("itemprop"))break;return i;case"link":if(b=i.getAttribute("rel"),b==="stylesheet"&&i.hasAttribute("data-precedence"))break;if(b!==g.rel||i.getAttribute("href")!==(g.href==null||g.href===""?null:g.href)||i.getAttribute("crossorigin")!==(g.crossOrigin==null?null:g.crossOrigin)||i.getAttribute("title")!==(g.title==null?null:g.title))break;return i;case"style":if(i.hasAttribute("data-precedence"))break;return i;case"script":if(b=i.getAttribute("src"),(b!==(g.src==null?null:g.src)||i.getAttribute("type")!==(g.type==null?null:g.type)||i.getAttribute("crossorigin")!==(g.crossOrigin==null?null:g.crossOrigin))&&b&&i.hasAttribute("async")&&!i.hasAttribute("itemprop"))break;return i;default:return i}}else if(o==="input"&&i.type==="hidden"){var b=g.name==null?null:""+g.name;if(g.type==="hidden"&&i.getAttribute("name")===b)return i}else return i;if(i=Kn(i.nextSibling),i===null)break}return null}function tw(i,o,c){if(o==="")return null;for(;i.nodeType!==3;)if((i.nodeType!==1||i.nodeName!=="INPUT"||i.type!=="hidden")&&!c||(i=Kn(i.nextSibling),i===null))return null;return i}function u0(i,o){for(;i.nodeType!==8;)if((i.nodeType!==1||i.nodeName!=="INPUT"||i.type!=="hidden")&&!o||(i=Kn(i.nextSibling),i===null))return null;return i}function vh(i){return i.data==="$?"||i.data==="$~"}function mh(i){return i.data==="$!"||i.data==="$?"&&i.ownerDocument.readyState!=="loading"}function ew(i,o){var c=i.ownerDocument;if(i.data==="$~")i._reactRetry=o;else if(i.data!=="$?"||c.readyState!=="loading")o();else{var d=function(){o(),c.removeEventListener("DOMContentLoaded",d)};c.addEventListener("DOMContentLoaded",d),i._reactRetry=d}}function Kn(i){for(;i!=null;i=i.nextSibling){var o=i.nodeType;if(o===1||o===3)break;if(o===8){if(o=i.data,o==="$"||o==="$!"||o==="$?"||o==="$~"||o==="&"||o==="F!"||o==="F")break;if(o==="/$"||o==="/&")return null}}return i}var gh=null;function s0(i){i=i.nextSibling;for(var o=0;i;){if(i.nodeType===8){var c=i.data;if(c==="/$"||c==="/&"){if(o===0)return Kn(i.nextSibling);o--}else c!=="$"&&c!=="$!"&&c!=="$?"&&c!=="$~"&&c!=="&"||o++}i=i.nextSibling}return null}function l0(i){i=i.previousSibling;for(var o=0;i;){if(i.nodeType===8){var c=i.data;if(c==="$"||c==="$!"||c==="$?"||c==="$~"||c==="&"){if(o===0)return i;o--}else c!=="/$"&&c!=="/&"||o++}i=i.previousSibling}return null}function c0(i,o,c){switch(o=Js(c),i){case"html":if(i=o.documentElement,!i)throw Error(e(452));return i;case"head":if(i=o.head,!i)throw Error(e(453));return i;case"body":if(i=o.body,!i)throw Error(e(454));return i;default:throw Error(e(451))}}function du(i){for(var o=i.attributes;o.length;)i.removeAttributeNode(o[0]);yc(i)}var Yn=new Map,f0=new Set;function $s(i){return typeof i.getRootNode=="function"?i.getRootNode():i.nodeType===9?i:i.ownerDocument}var Yr=q.d;q.d={f:nw,r:rw,D:aw,C:iw,L:ow,m:uw,X:lw,S:sw,M:cw};function nw(){var i=Yr.f(),o=Ws();return i||o}function rw(i){var o=Ci(i);o!==null&&o.tag===5&&o.type==="form"?Tm(o):Yr.r(i)}var no=typeof document>"u"?null:document;function h0(i,o,c){var d=no;if(d&&typeof o=="string"&&o){var g=Hn(o);g='link[rel="'+i+'"][href="'+g+'"]',typeof c=="string"&&(g+='[crossorigin="'+c+'"]'),f0.has(g)||(f0.add(g),i={rel:i,crossOrigin:c,href:o},d.querySelector(g)===null&&(o=d.createElement("link"),Ke(o,"link",i),ze(o),d.head.appendChild(o)))}}function aw(i){Yr.D(i),h0("dns-prefetch",i,null)}function iw(i,o){Yr.C(i,o),h0("preconnect",i,o)}function ow(i,o,c){Yr.L(i,o,c);var d=no;if(d&&i&&o){var g='link[rel="preload"][as="'+Hn(o)+'"]';o==="image"&&c&&c.imageSrcSet?(g+='[imagesrcset="'+Hn(c.imageSrcSet)+'"]',typeof c.imageSizes=="string"&&(g+='[imagesizes="'+Hn(c.imageSizes)+'"]')):g+='[href="'+Hn(i)+'"]';var b=g;switch(o){case"style":b=ro(i);break;case"script":b=ao(i)}Yn.has(b)||(i=v({rel:"preload",href:o==="image"&&c&&c.imageSrcSet?void 0:i,as:o},c),Yn.set(b,i),d.querySelector(g)!==null||o==="style"&&d.querySelector(pu(b))||o==="script"&&d.querySelector(vu(b))||(o=d.createElement("link"),Ke(o,"link",i),ze(o),d.head.appendChild(o)))}}function uw(i,o){Yr.m(i,o);var c=no;if(c&&i){var d=o&&typeof o.as=="string"?o.as:"script",g='link[rel="modulepreload"][as="'+Hn(d)+'"][href="'+Hn(i)+'"]',b=g;switch(d){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":b=ao(i)}if(!Yn.has(b)&&(i=v({rel:"modulepreload",href:i},o),Yn.set(b,i),c.querySelector(g)===null)){switch(d){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(c.querySelector(vu(b)))return}d=c.createElement("link"),Ke(d,"link",i),ze(d),c.head.appendChild(d)}}}function sw(i,o,c){Yr.S(i,o,c);var d=no;if(d&&i){var g=Si(d).hoistableStyles,b=ro(i);o=o||"default";var C=g.get(b);if(!C){var D={loading:0,preload:null};if(C=d.querySelector(pu(b)))D.loading=5;else{i=v({rel:"stylesheet",href:i,"data-precedence":o},c),(c=Yn.get(b))&&yh(i,c);var U=C=d.createElement("link");ze(U),Ke(U,"link",i),U._p=new Promise(function(Q,ut){U.onload=Q,U.onerror=ut}),U.addEventListener("load",function(){D.loading|=1}),U.addEventListener("error",function(){D.loading|=2}),D.loading|=4,tl(C,o,d)}C={type:"stylesheet",instance:C,count:1,state:D},g.set(b,C)}}}function lw(i,o){Yr.X(i,o);var c=no;if(c&&i){var d=Si(c).hoistableScripts,g=ao(i),b=d.get(g);b||(b=c.querySelector(vu(g)),b||(i=v({src:i,async:!0},o),(o=Yn.get(g))&&bh(i,o),b=c.createElement("script"),ze(b),Ke(b,"link",i),c.head.appendChild(b)),b={type:"script",instance:b,count:1,state:null},d.set(g,b))}}function cw(i,o){Yr.M(i,o);var c=no;if(c&&i){var d=Si(c).hoistableScripts,g=ao(i),b=d.get(g);b||(b=c.querySelector(vu(g)),b||(i=v({src:i,async:!0,type:"module"},o),(o=Yn.get(g))&&bh(i,o),b=c.createElement("script"),ze(b),Ke(b,"link",i),c.head.appendChild(b)),b={type:"script",instance:b,count:1,state:null},d.set(g,b))}}function d0(i,o,c,d){var g=(g=vt.current)?$s(g):null;if(!g)throw Error(e(446));switch(i){case"meta":case"title":return null;case"style":return typeof c.precedence=="string"&&typeof c.href=="string"?(o=ro(c.href),c=Si(g).hoistableStyles,d=c.get(o),d||(d={type:"style",instance:null,count:0,state:null},c.set(o,d)),d):{type:"void",instance:null,count:0,state:null};case"link":if(c.rel==="stylesheet"&&typeof c.href=="string"&&typeof c.precedence=="string"){i=ro(c.href);var b=Si(g).hoistableStyles,C=b.get(i);if(C||(g=g.ownerDocument||g,C={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},b.set(i,C),(b=g.querySelector(pu(i)))&&!b._p&&(C.instance=b,C.state.loading=5),Yn.has(i)||(c={rel:"preload",as:"style",href:c.href,crossOrigin:c.crossOrigin,integrity:c.integrity,media:c.media,hrefLang:c.hrefLang,referrerPolicy:c.referrerPolicy},Yn.set(i,c),b||fw(g,i,c,C.state))),o&&d===null)throw Error(e(528,""));return C}if(o&&d!==null)throw Error(e(529,""));return null;case"script":return o=c.async,c=c.src,typeof c=="string"&&o&&typeof o!="function"&&typeof o!="symbol"?(o=ao(c),c=Si(g).hoistableScripts,d=c.get(o),d||(d={type:"script",instance:null,count:0,state:null},c.set(o,d)),d):{type:"void",instance:null,count:0,state:null};default:throw Error(e(444,i))}}function ro(i){return'href="'+Hn(i)+'"'}function pu(i){return'link[rel="stylesheet"]['+i+"]"}function p0(i){return v({},i,{"data-precedence":i.precedence,precedence:null})}function fw(i,o,c,d){i.querySelector('link[rel="preload"][as="style"]['+o+"]")?d.loading=1:(o=i.createElement("link"),d.preload=o,o.addEventListener("load",function(){return d.loading|=1}),o.addEventListener("error",function(){return d.loading|=2}),Ke(o,"link",c),ze(o),i.head.appendChild(o))}function ao(i){return'[src="'+Hn(i)+'"]'}function vu(i){return"script[async]"+i}function v0(i,o,c){if(o.count++,o.instance===null)switch(o.type){case"style":var d=i.querySelector('style[data-href~="'+Hn(c.href)+'"]');if(d)return o.instance=d,ze(d),d;var g=v({},c,{"data-href":c.href,"data-precedence":c.precedence,href:null,precedence:null});return d=(i.ownerDocument||i).createElement("style"),ze(d),Ke(d,"style",g),tl(d,c.precedence,i),o.instance=d;case"stylesheet":g=ro(c.href);var b=i.querySelector(pu(g));if(b)return o.state.loading|=4,o.instance=b,ze(b),b;d=p0(c),(g=Yn.get(g))&&yh(d,g),b=(i.ownerDocument||i).createElement("link"),ze(b);var C=b;return C._p=new Promise(function(D,U){C.onload=D,C.onerror=U}),Ke(b,"link",d),o.state.loading|=4,tl(b,c.precedence,i),o.instance=b;case"script":return b=ao(c.src),(g=i.querySelector(vu(b)))?(o.instance=g,ze(g),g):(d=c,(g=Yn.get(b))&&(d=v({},c),bh(d,g)),i=i.ownerDocument||i,g=i.createElement("script"),ze(g),Ke(g,"link",d),i.head.appendChild(g),o.instance=g);case"void":return null;default:throw Error(e(443,o.type))}else o.type==="stylesheet"&&(o.state.loading&4)===0&&(d=o.instance,o.state.loading|=4,tl(d,c.precedence,i));return o.instance}function tl(i,o,c){for(var d=c.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),g=d.length?d[d.length-1]:null,b=g,C=0;C<d.length;C++){var D=d[C];if(D.dataset.precedence===o)b=D;else if(b!==g)break}b?b.parentNode.insertBefore(i,b.nextSibling):(o=c.nodeType===9?c.head:c,o.insertBefore(i,o.firstChild))}function yh(i,o){i.crossOrigin==null&&(i.crossOrigin=o.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=o.referrerPolicy),i.title==null&&(i.title=o.title)}function bh(i,o){i.crossOrigin==null&&(i.crossOrigin=o.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=o.referrerPolicy),i.integrity==null&&(i.integrity=o.integrity)}var el=null;function m0(i,o,c){if(el===null){var d=new Map,g=el=new Map;g.set(c,d)}else g=el,d=g.get(c),d||(d=new Map,g.set(c,d));if(d.has(i))return d;for(d.set(i,null),c=c.getElementsByTagName(i),g=0;g<c.length;g++){var b=c[g];if(!(b[Mo]||b[We]||i==="link"&&b.getAttribute("rel")==="stylesheet")&&b.namespaceURI!=="http://www.w3.org/2000/svg"){var C=b.getAttribute(o)||"";C=i+C;var D=d.get(C);D?D.push(b):d.set(C,[b])}}return d}function g0(i,o,c){i=i.ownerDocument||i,i.head.insertBefore(c,o==="title"?i.querySelector("head > title"):null)}function hw(i,o,c){if(c===1||o.itemProp!=null)return!1;switch(i){case"meta":case"title":return!0;case"style":if(typeof o.precedence!="string"||typeof o.href!="string"||o.href==="")break;return!0;case"link":if(typeof o.rel!="string"||typeof o.href!="string"||o.href===""||o.onLoad||o.onError)break;return o.rel==="stylesheet"?(i=o.disabled,typeof o.precedence=="string"&&i==null):!0;case"script":if(o.async&&typeof o.async!="function"&&typeof o.async!="symbol"&&!o.onLoad&&!o.onError&&o.src&&typeof o.src=="string")return!0}return!1}function y0(i){return!(i.type==="stylesheet"&&(i.state.loading&3)===0)}function dw(i,o,c,d){if(c.type==="stylesheet"&&(typeof d.media!="string"||matchMedia(d.media).matches!==!1)&&(c.state.loading&4)===0){if(c.instance===null){var g=ro(d.href),b=o.querySelector(pu(g));if(b){o=b._p,o!==null&&typeof o=="object"&&typeof o.then=="function"&&(i.count++,i=nl.bind(i),o.then(i,i)),c.state.loading|=4,c.instance=b,ze(b);return}b=o.ownerDocument||o,d=p0(d),(g=Yn.get(g))&&yh(d,g),b=b.createElement("link"),ze(b);var C=b;C._p=new Promise(function(D,U){C.onload=D,C.onerror=U}),Ke(b,"link",d),c.instance=b}i.stylesheets===null&&(i.stylesheets=new Map),i.stylesheets.set(c,o),(o=c.state.preload)&&(c.state.loading&3)===0&&(i.count++,c=nl.bind(i),o.addEventListener("load",c),o.addEventListener("error",c))}}var xh=0;function pw(i,o){return i.stylesheets&&i.count===0&&al(i,i.stylesheets),0<i.count||0<i.imgCount?function(c){var d=setTimeout(function(){if(i.stylesheets&&al(i,i.stylesheets),i.unsuspend){var b=i.unsuspend;i.unsuspend=null,b()}},6e4+o);0<i.imgBytes&&xh===0&&(xh=62500*K2());var g=setTimeout(function(){if(i.waitingForImages=!1,i.count===0&&(i.stylesheets&&al(i,i.stylesheets),i.unsuspend)){var b=i.unsuspend;i.unsuspend=null,b()}},(i.imgBytes>xh?50:800)+o);return i.unsuspend=c,function(){i.unsuspend=null,clearTimeout(d),clearTimeout(g)}}:null}function nl(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)al(this,this.stylesheets);else if(this.unsuspend){var i=this.unsuspend;this.unsuspend=null,i()}}}var rl=null;function al(i,o){i.stylesheets=null,i.unsuspend!==null&&(i.count++,rl=new Map,o.forEach(vw,i),rl=null,nl.call(i))}function vw(i,o){if(!(o.state.loading&4)){var c=rl.get(i);if(c)var d=c.get(null);else{c=new Map,rl.set(i,c);for(var g=i.querySelectorAll("link[data-precedence],style[data-precedence]"),b=0;b<g.length;b++){var C=g[b];(C.nodeName==="LINK"||C.getAttribute("media")!=="not all")&&(c.set(C.dataset.precedence,C),d=C)}d&&c.set(null,d)}g=o.instance,C=g.getAttribute("data-precedence"),b=c.get(C)||d,b===d&&c.set(null,g),c.set(C,g),this.count++,d=nl.bind(this),g.addEventListener("load",d),g.addEventListener("error",d),b?b.parentNode.insertBefore(g,b.nextSibling):(i=i.nodeType===9?i.head:i,i.insertBefore(g,i.firstChild)),o.state.loading|=4}}var mu={$$typeof:A,Provider:null,Consumer:null,_currentValue:K,_currentValue2:K,_threadCount:0};function mw(i,o,c,d,g,b,C,D,U){this.tag=1,this.containerInfo=i,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=pc(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=pc(0),this.hiddenUpdates=pc(null),this.identifierPrefix=d,this.onUncaughtError=g,this.onCaughtError=b,this.onRecoverableError=C,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=U,this.incompleteTransitions=new Map}function b0(i,o,c,d,g,b,C,D,U,Q,ut,ct){return i=new mw(i,o,c,C,U,Q,ut,ct,D),o=1,b===!0&&(o|=24),b=Sn(3,null,null,o),i.current=b,b.stateNode=i,o=Jc(),o.refCount++,i.pooledCache=o,o.refCount++,b.memoizedState={element:d,isDehydrated:c,cache:o},nf(b),i}function x0(i){return i?(i=Bi,i):Bi}function w0(i,o,c,d,g,b){g=x0(g),d.context===null?d.context=g:d.pendingContext=g,d=da(o),d.payload={element:c},b=b===void 0?null:b,b!==null&&(d.callback=b),c=pa(i,d,o),c!==null&&(vn(c,i,o),Ko(c,i,o))}function _0(i,o){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var c=i.retryLane;i.retryLane=c!==0&&c<o?c:o}}function wh(i,o){_0(i,o),(i=i.alternate)&&_0(i,o)}function E0(i){if(i.tag===13||i.tag===31){var o=Xa(i,67108864);o!==null&&vn(o,i,67108864),wh(i,67108864)}}function C0(i){if(i.tag===13||i.tag===31){var o=Nn();o=vc(o);var c=Xa(i,o);c!==null&&vn(c,i,o),wh(i,o)}}var il=!0;function gw(i,o,c,d){var g=L.T;L.T=null;var b=q.p;try{q.p=2,_h(i,o,c,d)}finally{q.p=b,L.T=g}}function yw(i,o,c,d){var g=L.T;L.T=null;var b=q.p;try{q.p=8,_h(i,o,c,d)}finally{q.p=b,L.T=g}}function _h(i,o,c,d){if(il){var g=Eh(d);if(g===null)sh(i,o,d,ol,c),R0(i,d);else if(xw(g,i,o,c,d))d.stopPropagation();else if(R0(i,d),o&4&&-1<bw.indexOf(i)){for(;g!==null;){var b=Ci(g);if(b!==null)switch(b.tag){case 3:if(b=b.stateNode,b.current.memoizedState.isDehydrated){var C=Va(b.pendingLanes);if(C!==0){var D=b;for(D.pendingLanes|=2,D.entangledLanes|=2;C;){var U=1<<31-En(C);D.entanglements[1]|=U,C&=~U}vr(b),(Zt&6)===0&&(Vs=Ee()+500,cu(0))}}break;case 31:case 13:D=Xa(b,2),D!==null&&vn(D,b,2),Ws(),wh(b,2)}if(b=Eh(d),b===null&&sh(i,o,d,ol,c),b===g)break;g=b}g!==null&&d.stopPropagation()}else sh(i,o,d,null,c)}}function Eh(i){return i=Cc(i),Ch(i)}var ol=null;function Ch(i){if(ol=null,i=Ei(i),i!==null){var o=u(i);if(o===null)i=null;else{var c=o.tag;if(c===13){if(i=s(o),i!==null)return i;i=null}else if(c===31){if(i=l(o),i!==null)return i;i=null}else if(c===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;i=null}else o!==i&&(i=null)}}return ol=i,null}function S0(i){switch(i){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(er()){case wi:return 2;case Nr:return 8;case un:case To:return 32;case Yu:return 268435456;default:return 32}default:return 32}}var Sh=!1,Sa=null,Ra=null,Aa=null,gu=new Map,yu=new Map,Ta=[],bw="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function R0(i,o){switch(i){case"focusin":case"focusout":Sa=null;break;case"dragenter":case"dragleave":Ra=null;break;case"mouseover":case"mouseout":Aa=null;break;case"pointerover":case"pointerout":gu.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":yu.delete(o.pointerId)}}function bu(i,o,c,d,g,b){return i===null||i.nativeEvent!==b?(i={blockedOn:o,domEventName:c,eventSystemFlags:d,nativeEvent:b,targetContainers:[g]},o!==null&&(o=Ci(o),o!==null&&E0(o)),i):(i.eventSystemFlags|=d,o=i.targetContainers,g!==null&&o.indexOf(g)===-1&&o.push(g),i)}function xw(i,o,c,d,g){switch(o){case"focusin":return Sa=bu(Sa,i,o,c,d,g),!0;case"dragenter":return Ra=bu(Ra,i,o,c,d,g),!0;case"mouseover":return Aa=bu(Aa,i,o,c,d,g),!0;case"pointerover":var b=g.pointerId;return gu.set(b,bu(gu.get(b)||null,i,o,c,d,g)),!0;case"gotpointercapture":return b=g.pointerId,yu.set(b,bu(yu.get(b)||null,i,o,c,d,g)),!0}return!1}function A0(i){var o=Ei(i.target);if(o!==null){var c=u(o);if(c!==null){if(o=c.tag,o===13){if(o=s(c),o!==null){i.blockedOn=o,Hp(i.priority,function(){C0(c)});return}}else if(o===31){if(o=l(c),o!==null){i.blockedOn=o,Hp(i.priority,function(){C0(c)});return}}else if(o===3&&c.stateNode.current.memoizedState.isDehydrated){i.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}i.blockedOn=null}function ul(i){if(i.blockedOn!==null)return!1;for(var o=i.targetContainers;0<o.length;){var c=Eh(i.nativeEvent);if(c===null){c=i.nativeEvent;var d=new c.constructor(c.type,c);Ec=d,c.target.dispatchEvent(d),Ec=null}else return o=Ci(c),o!==null&&E0(o),i.blockedOn=c,!1;o.shift()}return!0}function T0(i,o,c){ul(i)&&c.delete(o)}function ww(){Sh=!1,Sa!==null&&ul(Sa)&&(Sa=null),Ra!==null&&ul(Ra)&&(Ra=null),Aa!==null&&ul(Aa)&&(Aa=null),gu.forEach(T0),yu.forEach(T0)}function sl(i,o){i.blockedOn===o&&(i.blockedOn=null,Sh||(Sh=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,ww)))}var ll=null;function D0(i){ll!==i&&(ll=i,r.unstable_scheduleCallback(r.unstable_NormalPriority,function(){ll===i&&(ll=null);for(var o=0;o<i.length;o+=3){var c=i[o],d=i[o+1],g=i[o+2];if(typeof d!="function"){if(Ch(d||c)===null)continue;break}var b=Ci(c);b!==null&&(i.splice(o,3),o-=3,Ef(b,{pending:!0,data:g,method:c.method,action:d},d,g))}}))}function io(i){function o(U){return sl(U,i)}Sa!==null&&sl(Sa,i),Ra!==null&&sl(Ra,i),Aa!==null&&sl(Aa,i),gu.forEach(o),yu.forEach(o);for(var c=0;c<Ta.length;c++){var d=Ta[c];d.blockedOn===i&&(d.blockedOn=null)}for(;0<Ta.length&&(c=Ta[0],c.blockedOn===null);)A0(c),c.blockedOn===null&&Ta.shift();if(c=(i.ownerDocument||i).$$reactFormReplay,c!=null)for(d=0;d<c.length;d+=3){var g=c[d],b=c[d+1],C=g[ln]||null;if(typeof b=="function")C||D0(c);else if(C){var D=null;if(b&&b.hasAttribute("formAction")){if(g=b,C=b[ln]||null)D=C.formAction;else if(Ch(g)!==null)continue}else D=C.action;typeof D=="function"?c[d+1]=D:(c.splice(d,3),d-=3),D0(c)}}}function N0(){function i(b){b.canIntercept&&b.info==="react-transition"&&b.intercept({handler:function(){return new Promise(function(C){return g=C})},focusReset:"manual",scroll:"manual"})}function o(){g!==null&&(g(),g=null),d||setTimeout(c,20)}function c(){if(!d&&!navigation.transition){var b=navigation.currentEntry;b&&b.url!=null&&navigation.navigate(b.url,{state:b.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var d=!1,g=null;return navigation.addEventListener("navigate",i),navigation.addEventListener("navigatesuccess",o),navigation.addEventListener("navigateerror",o),setTimeout(c,100),function(){d=!0,navigation.removeEventListener("navigate",i),navigation.removeEventListener("navigatesuccess",o),navigation.removeEventListener("navigateerror",o),g!==null&&(g(),g=null)}}}function Rh(i){this._internalRoot=i}cl.prototype.render=Rh.prototype.render=function(i){var o=this._internalRoot;if(o===null)throw Error(e(409));var c=o.current,d=Nn();w0(c,d,i,o,null,null)},cl.prototype.unmount=Rh.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var o=i.containerInfo;w0(i.current,2,null,i,null,null),Ws(),o[_i]=null}};function cl(i){this._internalRoot=i}cl.prototype.unstable_scheduleHydration=function(i){if(i){var o=Pp();i={blockedOn:null,target:i,priority:o};for(var c=0;c<Ta.length&&o!==0&&o<Ta[c].priority;c++);Ta.splice(c,0,i),c===0&&A0(i)}};var M0=n.version;if(M0!=="19.2.3")throw Error(e(527,M0,"19.2.3"));q.findDOMNode=function(i){var o=i._reactInternals;if(o===void 0)throw typeof i.render=="function"?Error(e(188)):(i=Object.keys(i).join(","),Error(e(268,i)));return i=h(o),i=i!==null?p(i):null,i=i===null?null:i.stateNode,i};var _w={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:L,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var fl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!fl.isDisabled&&fl.supportsFiber)try{Mr=fl.inject(_w),Ge=fl}catch{}}return wu.createRoot=function(i,o){if(!a(i))throw Error(e(299));var c=!1,d="",g=Lm,b=Um,C=Pm;return o!=null&&(o.unstable_strictMode===!0&&(c=!0),o.identifierPrefix!==void 0&&(d=o.identifierPrefix),o.onUncaughtError!==void 0&&(g=o.onUncaughtError),o.onCaughtError!==void 0&&(b=o.onCaughtError),o.onRecoverableError!==void 0&&(C=o.onRecoverableError)),o=b0(i,1,!1,null,null,c,d,null,g,b,C,N0),i[_i]=o.current,uh(i),new Rh(o)},wu.hydrateRoot=function(i,o,c){if(!a(i))throw Error(e(299));var d=!1,g="",b=Lm,C=Um,D=Pm,U=null;return c!=null&&(c.unstable_strictMode===!0&&(d=!0),c.identifierPrefix!==void 0&&(g=c.identifierPrefix),c.onUncaughtError!==void 0&&(b=c.onUncaughtError),c.onCaughtError!==void 0&&(C=c.onCaughtError),c.onRecoverableError!==void 0&&(D=c.onRecoverableError),c.formState!==void 0&&(U=c.formState)),o=b0(i,1,!0,o,c??null,d,g,U,b,C,D,N0),o.context=x0(null),c=o.current,d=Nn(),d=vc(d),g=da(d),g.callback=null,pa(c,g,d),c=d,o.current.lanes=c,No(o,c),vr(o),i[_i]=o.current,uh(i),new cl(o)},wu.version="19.2.3",wu}var H0;function kw(){if(H0)return Dh.exports;H0=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(n){console.error(n)}}return r(),Dh.exports=Ow(),Dh.exports}var Iw=kw();function Bw(){return Me.jsx("header",{className:"text-center space-y-4",children:Me.jsx("h1",{className:"text-5xl md:text-6xl font-bold tracking-tight bg-clip-text text-transparent bg-linear-to-r from-white to-slate-400",children:"Face Detection"})})}const Fw=pi.forwardRef((r,n)=>Me.jsx("video",{playsInline:!0,muted:!0,ref:n,autoPlay:!0,className:"relative z-10 block max-w-full h-auto rounded-2xl touch-action-none"})),zw=pi.forwardRef((r,n)=>Me.jsx("canvas",{ref:n,className:"absolute top-0 left-0 z-20 touch-action-none"}));function Lw(){return Me.jsxs("div",{className:"fixed inset-0 z-0 pointer-events-none",children:[Me.jsx("div",{className:"absolute top-0 left-1/4 w-96 h-96 bg-brand-500/20 rounded-full blur-3xl animate-pulse-slow"}),Me.jsx("div",{className:"absolute bottom-0 right-1/4 w-96 h-96 bg-purple-500/20 rounded-full blur-3xl animate-pulse-slow",style:{animationDelay:"1.5s"}})]})}var Vy=function(r,n){return(Vy=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])})(r,n)};function sr(r,n){function t(){this.constructor=r}Vy(r,n),r.prototype=n===null?Object.create(n):(t.prototype=n.prototype,new t)}function bt(r,n,t,e){return new(t||(t=Promise))((function(a,u){function s(h){try{f(e.next(h))}catch(p){u(p)}}function l(h){try{f(e.throw(h))}catch(p){u(p)}}function f(h){h.done?a(h.value):new t((function(p){p(h.value)})).then(s,l)}f((e=e.apply(r,[])).next())}))}function xt(r,n){var t,e,a,u,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return u={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function l(f){return function(h){return(function(p){if(t)throw new TypeError("Generator is already executing.");for(;s;)try{if(t=1,e&&(a=2&p[0]?e.return:p[0]?e.throw||((a=e.return)&&a.call(e),0):e.next)&&!(a=a.call(e,p[1])).done)return a;switch(e=0,a&&(p=[2&p[0],a.value]),p[0]){case 0:case 1:a=p;break;case 4:return s.label++,{value:p[1],done:!1};case 5:s.label++,e=p[1],p=[0];continue;case 7:p=s.ops.pop(),s.trys.pop();continue;default:if(!(a=(a=s.trys).length>0&&a[a.length-1])&&(p[0]===6||p[0]===2)){s=0;continue}if(p[0]===3&&(!a||p[1]>a[0]&&p[1]<a[3])){s.label=p[1];break}if(p[0]===6&&s.label<a[1]){s.label=a[1],a=p;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(p);break}a[2]&&s.ops.pop(),s.trys.pop();continue}p=n.call(r,s)}catch(v){p=[6,v],e=0}finally{t=a=0}if(5&p[0])throw p[1];return{value:p[0]?p[1]:void 0,done:!0}})([f,h])}}}var Uw=(function(){function r(n){this.global=n,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return r.prototype.setPlatform=function(n,t){this.platform!=null&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+t+"."),this.platformName=n,this.platform=t},r.prototype.registerFlag=function(n,t,e){if(this.flagRegistry[n]={evaluationFn:t,setHook:e},this.urlFlags[n]!=null){var a=this.urlFlags[n];console.warn("Setting feature override from URL "+n+": "+a+"."),this.set(n,a)}},r.prototype.get=function(n){return n in this.flags?this.flags[n]:(this.flags[n]=this.evaluateFlag(n),this.flags[n])},r.prototype.getNumber=function(n){return this.get(n)},r.prototype.getBool=function(n){return this.get(n)},r.prototype.getFlags=function(){return this.flags},Object.defineProperty(r.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),r.prototype.set=function(n,t){if(this.flagRegistry[n]==null)throw new Error("Cannot set flag "+n+" as it has not been registered.");this.flags[n]=t,this.flagRegistry[n].setHook!=null&&this.flagRegistry[n].setHook(t)},r.prototype.evaluateFlag=function(n){if(this.flagRegistry[n]==null)throw new Error("Cannot evaluate flag '"+n+"': no evaluation function found.");return this.flagRegistry[n].evaluationFn()},r.prototype.setFlags=function(n){this.flags=Object.assign({},n)},r.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},r.prototype.populateURLFlags=function(){var n=this;if(this.global!==void 0&&this.global.location!==void 0&&this.global.location.search!==void 0){var t,e,a=(t=this.global.location.search,e={},t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(function(u){for(var s=[],l=1;l<arguments.length;l++)s[l-1]=arguments[l];return Pw(e,s[0],s[1]),s.join("=")})),e);"tfjsflags"in a&&a.tfjsflags.split(",").forEach((function(u){var s=u.split(":"),l=s[0],f=s[1];n.urlFlags[l]=(function(h,p){if((p=p.toLowerCase())==="true"||p==="false")return p==="true";if(""+ +p===p)return+p;throw new Error("Could not parse value flag value "+p+" for flag "+h+".")})(l,f)}))}},r})();function Pw(r,n,t){r[decodeURIComponent(n)]=decodeURIComponent(t||"")}function st(){return Gy}var Gy=null,Al=new Map,od=new Map;function Wy(r,n){var t=jy(r,n);return Al.get(t)}function Hw(r){return od.get(r)}function V0(r){for(var n=Al.entries(),t=[];;){var e=n.next(),a=e.done,u=e.value;if(a)break;var s=u[0],l=u[1];s.split("_")[0]===r&&t.push(l)}return t}function qy(r){var n=r.kernelName,t=r.backendName,e=jy(n,t);if(Al.has(e))throw new Error("The kernel '"+n+"' for backend '"+t+"' is already registered");Al.set(e,r)}function Vw(r){var n=r.kernelName;od.has(n)&&console.warn("Overriding the gradient for '"+n+"'"),od.set(n,r)}function jy(r,n){return n+"_"+r}function ud(r,n,t){return Math.max(r,Math.min(n,t))}function Xy(r){return r%2==0?r:r+1}function Gw(r){for(var n=0,t=0;t<r.length;t++)n+=r[t];return n}function k(r,n){if(!r)throw new Error(typeof n=="string"?n:n())}function $t(r,n,t){t===void 0&&(t=""),k(Pe(r,n),(function(){return t+" Shapes "+r+" and "+n+" must match"}))}function Ro(r){k(r!=null,(function(){return"The input to the tensor constructor must be a non-null value."}))}function _o(r,n,t){if(n===void 0&&(n=[]),t===void 0&&(t=!1),n==null&&(n=[]),Array.isArray(r)||_r(r)&&!t)for(var e=0;e<r.length;++e)_o(r[e],n,t);else n.push(r);return n}function _t(r){if(r.length===0)return 1;for(var n=r[0],t=1;t<r.length;t++)n*=r[t];return n}function Pe(r,n){if(r===n)return!0;if(r==null||n==null||r.length!==n.length)return!1;for(var t=0;t<r.length;t++)if(r[t]!==n[t])return!1;return!0}function _e(r){return r%1==0}function Ww(r){if(Math.tanh!=null)return Math.tanh(r);if(r===1/0)return 1;if(r===-1/0)return-1;var n=Math.exp(2*r);return(n-1)/(n+1)}function sd(r){var n=Math.ceil(Math.sqrt(r));return[n,Math.ceil(r/n)]}function vo(r,n){return n<=r.length?r:r+" ".repeat(n-r.length)}function G0(r,n,t){return n===void 0&&(n=function(e){return 0}),new Promise((function(e,a){var u=0,s=function(){if(r())e();else{u++;var l=n(u);t!=null&&u>=t?a():setTimeout(s,l)}};s()}))}function qw(r,n){for(var t=1,e=-1,a=0;a<r.length;++a)if(r[a]>=0)t*=r[a];else if(r[a]===-1){if(e!==-1)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+e+" and dim "+a);e=a}else if(r[a]<0)throw Error("Shapes can not be < 0. Found "+r[a]+" at dim "+a);if(e===-1){if(n>0&&n!==t)throw Error("Size("+n+") must match the product of shape "+r);return r}if(t===0)throw Error("Cannot infer the missing size in ["+r+"] when there are 0 elements");if(n%t!=0)throw Error("The implicit shape can't be a fractional number. Got "+n+" / "+t);var u=r.slice();return u[e]=n/t,u}function Fe(r,n){var t=n.length;return k((r=r==null?n.map((function(e,a){return a})):[].concat(r)).every((function(e){return e>=-t&&e<t})),(function(){return"All values in axis param must be in range [-"+t+", "+t+") but got axis "+r})),k(r.every((function(e){return _e(e)})),(function(){return"All values in axis param must be integers but got axis "+r})),r.map((function(e){return e<0?t+e:e}))}function li(r,n){for(var t=[],e=[],a=n!=null&&Array.isArray(n)&&n.length===0,u=n==null||a?null:Fe(n,r).sort(),s=0,l=0;l<r.length;++l){if(u!=null){if(u[s]===l&&r[l]!==1)throw new Error("Can't squeeze axis "+l+" since its dim '"+r[l]+"' is not 1");(u[s]==null||u[s]>l)&&r[l]===1&&(t.push(r[l]),e.push(l)),u[s]<=l&&s++}r[l]!==1&&(t.push(r[l]),e.push(l))}return{newShape:t,keptDims:e}}function Du(r,n){var t=null;if(r==null||r==="float32")t=new Float32Array(n);else if(r==="int32")t=new Int32Array(n);else{if(r!=="bool")throw new Error("Unknown data type "+r);t=new Uint8Array(n)}return t}function Tl(r,n){var t=null;if(r==null||r==="float32")t=new Float32Array(n);else if(r==="int32")t=new Int32Array(n);else if(r==="bool")t=new Uint8Array(n);else{if(r!=="string")throw new Error("Unknown data type "+r);t=new Array(n)}return t}function jw(r,n){for(var t=0;t<r.length;t++){var e=r[t];if(isNaN(e)||!isFinite(e))throw Error("A tensor of type "+n+" being uploaded contains "+e+".")}}function Xw(r){return r==="bool"||r==="complex64"||r==="float32"||r==="int32"||r==="string"}function Kw(r,n){return n!=="complex64"&&(n!=="float32"||r==="complex64")&&(n!=="int32"||r==="float32"||r==="complex64")&&(n!=="bool"||r!=="bool")}function _r(r){return r instanceof Float32Array||r instanceof Int32Array||r instanceof Uint8Array}function Ky(r){if(r==="float32"||r==="int32")return 4;if(r==="complex64")return 8;if(r==="bool")return 1;throw new Error("Unknown dtype "+r)}function Yw(r){if(r==null)return 0;var n=0;return r.forEach((function(t){return n+=t.length})),n}function Nd(r){return typeof r=="string"||r instanceof String}function Qw(r){return typeof r=="boolean"}function Zw(r){return typeof r=="number"}function Uu(r){return Array.isArray(r)?Uu(r[0]):r instanceof Float32Array?"float32":r instanceof Int32Array||r instanceof Uint8Array?"int32":Zw(r)?"float32":Nd(r)?"string":Qw(r)?"bool":"float32"}function ld(r){return!!(r&&r.constructor&&r.call&&r.apply)}function cd(r,n){for(var t=n;t<r;++t)if(r%t==0)return t;return r}function Er(r){var n=r.length;if(n<2)return[];var t=new Array(n-1);t[n-2]=r[n-1];for(var e=n-3;e>=0;--e)t[e]=t[e+1]*r[e+1];return t}function Yy(r,n,t){if(n==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(r)&&(r=_o(r)),t&&jw(r,n),(function(u,s){return u instanceof Float32Array&&s==="float32"||u instanceof Int32Array&&s==="int32"||u instanceof Uint8Array&&s==="bool"})(r,n))return r;if(n==null||n==="float32"||n==="complex64")return new Float32Array(r);if(n==="int32")return new Int32Array(r);if(n==="bool"){for(var e=new Uint8Array(r.length),a=0;a<e.length;++a)Math.round(r[a])!==0&&(e[a]=1);return e}throw new Error("Unknown data type "+n)}function W0(r,n){if(r.length===0)return n[0];var t=r.reduce((function(e,a){return e*a}));if(t===0)return[];if(t!==n.length)throw new Error("["+r+"] does not match the input size.");return(function e(a,u,s){var l=new Array;if(u.length===1)for(var f=u[0],h=0;h<f;h++)l[h]=s[a+h];else{f=u[0];var p=u.slice(1),v=p.reduce((function(m,y){return m*y}));for(h=0;h<f;h++)l[h]=e(a+h*v,p,s)}return l})(0,r,n)}function Qy(r,n){for(var t=Pu(r,n),e=0;e<t.length;e++)t[e]=1;return t}function Pu(r,n){if(n==null||n==="float32"||n==="complex64")return new Float32Array(r);if(n==="int32")return new Int32Array(r);if(n==="bool")return new Uint8Array(r);throw new Error("Unknown data type "+n)}function yr(){return st().platform.now()}function Zy(r){r.forEach((function(n){k(Number.isInteger(n)&&n>=0,(function(){return"Tensor must have a shape comprised of positive integers but got shape ["+r+"]."}))}))}function Jw(r,n){return n===void 0&&(n="utf-8"),n=n||"utf-8",st().platform.encode(r,n)}function Dl(r,n){return n===void 0&&(n="utf-8"),n=n||"utf-8",st().platform.decode(r,n)}function q0(r,n,t){if(n===0)return 0;if(n===1)return r[0];for(var e=r[r.length-1],a=0;a<r.length-1;++a)e+=t[a]*r[a];return e}function $w(r,n,t){if(n===0)return[];if(n===1)return[r];for(var e=new Array(n),a=0;a<e.length-1;++a)e[a]=Math.floor(r/t[a]),r-=e[a]*t[a];return e[e.length-1]=r,e}var t_=(function(){function r(n,t){this.backendTimer=n,this.logger=t,t==null&&(this.logger=new e_)}return r.prototype.profileKernel=function(n,t,e){var a,u=this,s=this.backendTimer.time((function(){a=e()}));return a.forEach((function(l){l.data().then((function(f){(function(h,p,v){if(p!=="float32")return!1;for(var m=0;m<h.length;m++){var y=h[m];if(isNaN(y)||!isFinite(y))return console.warn("Found "+y+" in the result of '"+v+"'"),!0}})(f,l.dtype,n),s.then((function(h){var p="";h.getExtraProfileInfo!=null&&(p=h.getExtraProfileInfo()),u.logger.logKernelProfile(n,l,f,h.kernelMs,t,p)}))}))})),a},r})(),e_=(function(){function r(){}return r.prototype.logKernelProfile=function(n,t,e,a,u,s){var l=typeof a=="number"?vo(a+"ms",9):a.error,f=vo(n,25),h=t.rank,p=t.size,v=vo(t.shape.toString(),14),m="";for(var y in u){var x=u[y].shape||t.shape,w=x.length;m+=y+": "+w+"D "+(w>0?x:"")+" "}console.log("%c"+f+"	%c"+l+"	%c"+h+"D "+v+"	%c"+p+"	%c"+m+"	%c"+s,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},r})(),j0=20,_u=3,kh=7;function n_(r,n,t,e){var a=Er(n),u=(function(h,p,v,m){var y=_t(p),x=m[m.length-1],w=new Array(x).fill(0),_=p.length,E=v==="complex64"?Cu(h):h;if(_>1)for(var R=0;R<y/x;R++)for(var A=R*x,S=0;S<x;S++)w[S]=Math.max(w[S],Eu(E[A+S],0,v).length);return w})(r,n,t,a),s=n.length,l=(function h(p,v,m,y,x,w){w===void 0&&(w=!0);var _=m==="complex64"?2:1,E=v[0],R=v.length;if(R===0)return m==="complex64"?[Eu(Cu(p)[0],0,m)]:m==="bool"?[Jy(p[0])]:[p[0].toString()];if(R===1){if(E>j0){var A=_u*_,S=Array.from(p.slice(0,A)),T=Array.from(p.slice((E-_u)*_,E*_));return m==="complex64"&&(S=Cu(S),T=Cu(T)),["["+S.map((function(nt,L){return Eu(nt,x[L],m)})).join(", ")+", ..., "+T.map((function(nt,L){return Eu(nt,x[E-_u+L],m)})).join(", ")+"]"]}return["["+(m==="complex64"?Cu(p):Array.from(p)).map((function(nt,L){return Eu(nt,x[L],m)})).join(", ")+"]"]}var N=v.slice(1),O=y.slice(1),B=y[0]*_,I=[];if(E>j0){for(var F=0;F<_u;F++){var G=(H=F*B)+B;I.push.apply(I,h(p.slice(H,G),N,m,O,x,!1))}for(I.push("..."),F=E-_u;F<E;F++)G=(H=F*B)+B,I.push.apply(I,h(p.slice(H,G),N,m,O,x,F===E-1))}else for(F=0;F<E;F++){var H;G=(H=F*B)+B,I.push.apply(I,h(p.slice(H,G),N,m,O,x,F===E-1))}var at=R===2?",":"";for(I[0]="["+I[0]+at,F=1;F<I.length-1;F++)I[F]=" "+I[F]+at;var et=`,
`;for(F=2;F<R;F++)et+=`
`;return I[I.length-1]=" "+I[I.length-1]+"]"+(w?"":et),I})(r,n,t,a,u),f=["Tensor"];return e&&(f.push("  dtype: "+t),f.push("  rank: "+s),f.push("  shape: ["+n+"]"),f.push("  values:")),f.push(l.map((function(h){return"    "+h})).join(`
`)),f.join(`
`)}function Eu(r,n,t){return vo(Array.isArray(r)?parseFloat(r[0].toFixed(kh))+" + "+parseFloat(r[1].toFixed(kh))+"j":Nd(r)?"'"+r+"'":t==="bool"?Jy(r):parseFloat(r.toFixed(kh)).toString(),n)}function Jy(r){return r===0?"false":"true"}function Cu(r){for(var n=[],t=0;t<r.length;t+=2)n.push([r[t],r[t+1]]);return n}var Nu=(function(){function r(n,t,e){var a=this;if(this.dtype=t,this.shape=n.slice(),this.size=_t(n),e!=null){var u=e.length;k(u===this.size,(function(){return"Length of values '"+u+"' does not match the size inferred by the shape '"+a.size+"'."}))}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=e||Tl(t,this.size),this.strides=Er(n)}return r.prototype.set=function(n){for(var t=this,e=[],a=1;a<arguments.length;a++)e[a-1]=arguments[a];e.length===0&&(e=[0]),k(e.length===this.rank,(function(){return"The number of provided coordinates ("+e.length+") must match the rank ("+t.rank+")"}));var u=this.locToIndex(e);this.values[u]=n},r.prototype.get=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];n.length===0&&(n=[0]);for(var e=0,a=0,u=n;a<u.length;a++){var s=u[a];if(s<0||s>=this.shape[e]){var l="Requested out of range element at "+n+".   Buffer shape="+this.shape;throw new Error(l)}e++}for(var f=n[n.length-1],h=0;h<n.length-1;++h)f+=this.strides[h]*n[h];return this.values[f]},r.prototype.locToIndex=function(n){if(this.rank===0)return 0;if(this.rank===1)return n[0];for(var t=n[n.length-1],e=0;e<n.length-1;++e)t+=this.strides[e]*n[e];return t},r.prototype.indexToLoc=function(n){if(this.rank===0)return[];if(this.rank===1)return[n];for(var t=new Array(this.shape.length),e=0;e<t.length-1;++e)t[e]=Math.floor(n/this.strides[e]),n-=t[e]*this.strides[e];return t[t.length-1]=n,t},Object.defineProperty(r.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),r.prototype.toTensor=function(){return br().makeTensor(this.values,this.shape,this.dtype)},r})(),br=null,tt=null,$y=null,pe=(function(){function r(n,t,e,a){this.kept=!1,this.isDisposedInternal=!1,this.shape=n.slice(),this.dtype=t||"float32",this.size=_t(n),this.strides=Er(n),this.dataId=e,this.id=a,this.rankType=this.rank<5?this.rank.toString():"higher"}return r.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},r.prototype.asScalar=function(){return this.throwIfDisposed(),k(this.size===1,(function(){return"The array must have only 1 element."})),this.reshape([])},r.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},r.prototype.as2D=function(n,t){return this.throwIfDisposed(),this.reshape([n,t])},r.prototype.as3D=function(n,t,e){return this.throwIfDisposed(),this.reshape([n,t,e])},r.prototype.as4D=function(n,t,e,a){return this.throwIfDisposed(),this.reshape([n,t,e,a])},r.prototype.as5D=function(n,t,e,a,u){return this.throwIfDisposed(),this.reshape([n,t,e,a,u])},r.prototype.asType=function(n){return this.throwIfDisposed(),tt.cast(this,n)},Object.defineProperty(r.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),r.prototype.buffer=function(){return bt(this,void 0,void 0,(function(){var n;return xt(this,(function(t){switch(t.label){case 0:return[4,this.data()];case 1:return n=t.sent(),[2,tt.buffer(this.shape,this.dtype,n)]}}))}))},r.prototype.bufferSync=function(){return tt.buffer(this.shape,this.dtype,this.dataSync())},r.prototype.array=function(){return bt(this,void 0,void 0,(function(){var n;return xt(this,(function(t){switch(t.label){case 0:return[4,this.data()];case 1:return n=t.sent(),[2,W0(this.shape,n)]}}))}))},r.prototype.arraySync=function(){return W0(this.shape,this.dataSync())},r.prototype.data=function(){return bt(this,void 0,void 0,(function(){var n,t;return xt(this,(function(e){switch(e.label){case 0:return this.throwIfDisposed(),n=br().read(this.dataId),this.dtype!=="string"?[3,2]:[4,n];case 1:t=e.sent();try{return[2,t.map((function(a){return Dl(a)}))]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}e.label=2;case 2:return[2,n]}}))}))},r.prototype.dataSync=function(){this.throwIfDisposed();var n=br().readSync(this.dataId);if(this.dtype==="string")try{return n.map((function(t){return Dl(t)}))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return n},r.prototype.bytes=function(){return bt(this,void 0,void 0,(function(){var n;return xt(this,(function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,br().read(this.dataId)];case 1:return n=t.sent(),this.dtype==="string"?[2,n]:[2,new Uint8Array(n.buffer)]}}))}))},r.prototype.dispose=function(){this.isDisposed||(br().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(r.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),r.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},r.prototype.toFloat=function(){return this.asType("float32")},r.prototype.toInt=function(){return this.asType("int32")},r.prototype.toBool=function(){return this.asType("bool")},r.prototype.print=function(n){return n===void 0&&(n=!1),tt.print(this,n)},r.prototype.reshape=function(n){return this.throwIfDisposed(),tt.reshape(this,n)},r.prototype.reshapeAs=function(n){return this.throwIfDisposed(),this.reshape(n.shape)},r.prototype.expandDims=function(n){return n===void 0&&(n=0),tt.expandDims(this,n)},r.prototype.cumsum=function(n,t,e){return n===void 0&&(n=0),t===void 0&&(t=!1),e===void 0&&(e=!1),tt.cumsum(this,n,t,e)},r.prototype.squeeze=function(n){return this.throwIfDisposed(),tt.squeeze(this,n)},r.prototype.clone=function(){return this.throwIfDisposed(),tt.clone(this)},r.prototype.oneHot=function(n,t,e){return this.throwIfDisposed(),tt.oneHot(this,n,t,e)},r.prototype.toString=function(n){return n===void 0&&(n=!1),n_(this.dataSync(),this.shape,this.dtype,n)},r.prototype.tile=function(n){return this.throwIfDisposed(),tt.tile(this,n)},r.prototype.gather=function(n,t){return t===void 0&&(t=0),this.throwIfDisposed(),tt.gather(this,n,t)},r.prototype.matMul=function(n,t,e){return t===void 0&&(t=!1),e===void 0&&(e=!1),this.throwIfDisposed(),tt.matMul(this,n,t,e)},r.prototype.dot=function(n){return this.throwIfDisposed(),tt.dot(this,n)},r.prototype.norm=function(n,t,e){return n===void 0&&(n="euclidean"),t===void 0&&(t=null),e===void 0&&(e=!1),this.throwIfDisposed(),tt.norm(this,n,t,e)},r.prototype.slice=function(n,t){return this.throwIfDisposed(),tt.slice(this,n,t)},r.prototype.reverse=function(n){return this.throwIfDisposed(),tt.reverse(this,n)},r.prototype.concat=function(n,t){return t===void 0&&(t=0),this.throwIfDisposed(),n instanceof r&&(n=[n]),tt.concat([this].concat(n),t)},r.prototype.split=function(n,t){return t===void 0&&(t=0),this.throwIfDisposed(),tt.split(this,n,t)},r.prototype.stack=function(n,t){return t===void 0&&(t=0),tt.stack([this,n],t)},r.prototype.unstack=function(n){return n===void 0&&(n=0),tt.unstack(this,n)},r.prototype.pad=function(n,t){return t===void 0&&(t=0),tt.pad(this,n,t)},r.prototype.batchNormalization=function(n,t,e,a,u){return e===void 0&&(e=.001),$y("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(n,t,u,a,e)},r.prototype.batchNorm=function(n,t,e,a,u){return u===void 0&&(u=.001),this.throwIfDisposed(),tt.batchNorm(this,n,t,e,a,u)},r.prototype.all=function(n,t){return n===void 0&&(n=null),t===void 0&&(t=!1),this.throwIfDisposed(),tt.all(this,n,t)},r.prototype.any=function(n,t){return n===void 0&&(n=null),t===void 0&&(t=!1),this.throwIfDisposed(),tt.any(this,n,t)},r.prototype.logSumExp=function(n,t){return n===void 0&&(n=null),t===void 0&&(t=!1),this.throwIfDisposed(),tt.logSumExp(this,n,t)},r.prototype.sum=function(n,t){return n===void 0&&(n=null),t===void 0&&(t=!1),this.throwIfDisposed(),tt.sum(this,n,t)},r.prototype.prod=function(n,t){return n===void 0&&(n=null),t===void 0&&(t=!1),this.throwIfDisposed(),tt.prod(this,n,t)},r.prototype.mean=function(n,t){return n===void 0&&(n=null),t===void 0&&(t=!1),this.throwIfDisposed(),tt.mean(this,n,t)},r.prototype.min=function(n,t){return n===void 0&&(n=null),t===void 0&&(t=!1),this.throwIfDisposed(),tt.min(this,n,t)},r.prototype.max=function(n,t){return n===void 0&&(n=null),t===void 0&&(t=!1),this.throwIfDisposed(),tt.max(this,n,t)},r.prototype.argMin=function(n){return n===void 0&&(n=null),this.throwIfDisposed(),tt.argMin(this,n)},r.prototype.argMax=function(n){return n===void 0&&(n=null),this.throwIfDisposed(),tt.argMax(this,n)},r.prototype.cast=function(n){return this.throwIfDisposed(),tt.cast(this,n)},r.prototype.add=function(n){return this.throwIfDisposed(),tt.add(this,n)},r.prototype.addStrict=function(n){return this.throwIfDisposed(),tt.addStrict(this,n)},r.prototype.atan2=function(n){return this.throwIfDisposed(),tt.atan2(this,n)},r.prototype.sub=function(n){return this.throwIfDisposed(),tt.sub(this,n)},r.prototype.subStrict=function(n){return this.throwIfDisposed(),tt.subStrict(this,n)},r.prototype.pow=function(n){return this.throwIfDisposed(),tt.pow(this,n)},r.prototype.powStrict=function(n){return this.throwIfDisposed(),tt.powStrict(this,n)},r.prototype.mul=function(n){return this.throwIfDisposed(),tt.mul(this,n)},r.prototype.mulStrict=function(n){return this.throwIfDisposed(),tt.mulStrict(this,n)},r.prototype.div=function(n){return this.throwIfDisposed(),tt.div(this,n)},r.prototype.divNoNan=function(n){return this.throwIfDisposed(),tt.divNoNan(this,n)},r.prototype.floorDiv=function(n){return this.throwIfDisposed(),tt.floorDiv(this,n)},r.prototype.divStrict=function(n){return this.throwIfDisposed(),tt.divStrict(this,n)},r.prototype.minimum=function(n){return this.throwIfDisposed(),tt.minimum(this,n)},r.prototype.minimumStrict=function(n){return this.throwIfDisposed(),tt.minimumStrict(this,n)},r.prototype.maximum=function(n){return this.throwIfDisposed(),tt.maximum(this,n)},r.prototype.maximumStrict=function(n){return this.throwIfDisposed(),tt.maximumStrict(this,n)},r.prototype.mod=function(n){return this.throwIfDisposed(),tt.mod(this,n)},r.prototype.modStrict=function(n){return this.throwIfDisposed(),tt.modStrict(this,n)},r.prototype.squaredDifferenceStrict=function(n){return this.throwIfDisposed(),tt.squaredDifferenceStrict(this,n)},r.prototype.transpose=function(n){return this.throwIfDisposed(),tt.transpose(this,n)},r.prototype.notEqual=function(n){return this.throwIfDisposed(),tt.notEqual(this,n)},r.prototype.notEqualStrict=function(n){return this.throwIfDisposed(),tt.notEqualStrict(this,n)},r.prototype.less=function(n){return this.throwIfDisposed(),tt.less(this,n)},r.prototype.lessStrict=function(n){return this.throwIfDisposed(),tt.lessStrict(this,n)},r.prototype.equal=function(n){return this.throwIfDisposed(),tt.equal(this,n)},r.prototype.equalStrict=function(n){return this.throwIfDisposed(),tt.equalStrict(this,n)},r.prototype.lessEqual=function(n){return this.throwIfDisposed(),tt.lessEqual(this,n)},r.prototype.lessEqualStrict=function(n){return this.throwIfDisposed(),tt.lessEqualStrict(this,n)},r.prototype.greater=function(n){return this.throwIfDisposed(),tt.greater(this,n)},r.prototype.greaterStrict=function(n){return this.throwIfDisposed(),tt.greaterStrict(this,n)},r.prototype.greaterEqual=function(n){return this.throwIfDisposed(),tt.greaterEqual(this,n)},r.prototype.greaterEqualStrict=function(n){return this.throwIfDisposed(),tt.greaterEqualStrict(this,n)},r.prototype.logicalAnd=function(n){return this.throwIfDisposed(),tt.logicalAnd(this,n)},r.prototype.logicalOr=function(n){return this.throwIfDisposed(),tt.logicalOr(this,n)},r.prototype.logicalNot=function(){return this.throwIfDisposed(),tt.logicalNot(this)},r.prototype.logicalXor=function(n){return this.throwIfDisposed(),tt.logicalXor(this,n)},r.prototype.where=function(n,t){return this.throwIfDisposed(),tt.where(n,this,t)},r.prototype.neg=function(){return this.throwIfDisposed(),tt.neg(this)},r.prototype.ceil=function(){return this.throwIfDisposed(),tt.ceil(this)},r.prototype.floor=function(){return this.throwIfDisposed(),tt.floor(this)},r.prototype.sign=function(){return this.throwIfDisposed(),tt.sign(this)},r.prototype.isNaN=function(){return this.throwIfDisposed(),tt.isNaN(this)},r.prototype.isInf=function(){return this.throwIfDisposed(),tt.isInf(this)},r.prototype.isFinite=function(){return this.throwIfDisposed(),tt.isFinite(this)},r.prototype.exp=function(){return this.throwIfDisposed(),tt.exp(this)},r.prototype.expm1=function(){return this.throwIfDisposed(),tt.expm1(this)},r.prototype.log=function(){return this.throwIfDisposed(),tt.log(this)},r.prototype.log1p=function(){return this.throwIfDisposed(),tt.log1p(this)},r.prototype.sqrt=function(){return this.throwIfDisposed(),tt.sqrt(this)},r.prototype.rsqrt=function(){return this.throwIfDisposed(),tt.rsqrt(this)},r.prototype.square=function(){return this.throwIfDisposed(),tt.square(this)},r.prototype.reciprocal=function(){return this.throwIfDisposed(),tt.reciprocal(this)},r.prototype.abs=function(){return this.throwIfDisposed(),tt.abs(this)},r.prototype.clipByValue=function(n,t){return this.throwIfDisposed(),tt.clipByValue(this,n,t)},r.prototype.relu=function(){return this.throwIfDisposed(),tt.relu(this)},r.prototype.relu6=function(){return this.throwIfDisposed(),tt.relu6(this)},r.prototype.elu=function(){return this.throwIfDisposed(),tt.elu(this)},r.prototype.selu=function(){return this.throwIfDisposed(),tt.selu(this)},r.prototype.leakyRelu=function(n){return n===void 0&&(n=.2),this.throwIfDisposed(),tt.leakyRelu(this,n)},r.prototype.prelu=function(n){return this.throwIfDisposed(),tt.prelu(this,n)},r.prototype.sigmoid=function(){return this.throwIfDisposed(),tt.sigmoid(this)},r.prototype.logSigmoid=function(){return this.throwIfDisposed(),tt.logSigmoid(this)},r.prototype.softplus=function(){return this.throwIfDisposed(),tt.softplus(this)},r.prototype.zerosLike=function(){return this.throwIfDisposed(),tt.zerosLike(this)},r.prototype.onesLike=function(){return this.throwIfDisposed(),tt.onesLike(this)},r.prototype.sin=function(){return this.throwIfDisposed(),tt.sin(this)},r.prototype.cos=function(){return this.throwIfDisposed(),tt.cos(this)},r.prototype.tan=function(){return this.throwIfDisposed(),tt.tan(this)},r.prototype.asin=function(){return this.throwIfDisposed(),tt.asin(this)},r.prototype.acos=function(){return this.throwIfDisposed(),tt.acos(this)},r.prototype.atan=function(){return this.throwIfDisposed(),tt.atan(this)},r.prototype.sinh=function(){return this.throwIfDisposed(),tt.sinh(this)},r.prototype.cosh=function(){return this.throwIfDisposed(),tt.cosh(this)},r.prototype.tanh=function(){return this.throwIfDisposed(),tt.tanh(this)},r.prototype.asinh=function(){return this.throwIfDisposed(),tt.asinh(this)},r.prototype.acosh=function(){return this.throwIfDisposed(),tt.acosh(this)},r.prototype.atanh=function(){return this.throwIfDisposed(),tt.atanh(this)},r.prototype.erf=function(){return this.throwIfDisposed(),tt.erf(this)},r.prototype.round=function(){return this.throwIfDisposed(),tt.round(this)},r.prototype.step=function(n){return n===void 0&&(n=0),this.throwIfDisposed(),tt.step(this,n)},r.prototype.softmax=function(n){return n===void 0&&(n=-1),this.throwIfDisposed(),tt.softmax(this,n)},r.prototype.logSoftmax=function(n){return n===void 0&&(n=-1),this.throwIfDisposed(),tt.logSoftmax(this,n)},r.prototype.resizeBilinear=function(n,t){return t===void 0&&(t=!1),this.throwIfDisposed(),tt.image.resizeBilinear(this,n,t)},r.prototype.resizeNearestNeighbor=function(n,t){return t===void 0&&(t=!1),this.throwIfDisposed(),tt.image.resizeNearestNeighbor(this,n,t)},r.prototype.conv1d=function(n,t,e,a,u,s){return a===void 0&&(a="NWC"),u===void 0&&(u=1),this.throwIfDisposed(),tt.conv1d(this,n,t,e,a,u,s)},r.prototype.conv2d=function(n,t,e,a,u,s){return a===void 0&&(a="NHWC"),u===void 0&&(u=[1,1]),this.throwIfDisposed(),tt.conv2d(this,n,t,e,a,u,s)},r.prototype.conv2dTranspose=function(n,t,e,a,u){return this.throwIfDisposed(),tt.conv2dTranspose(this,n,t,e,a,u)},r.prototype.depthwiseConv2D=function(n,t,e,a,u,s){return a===void 0&&(a="NHWC"),u===void 0&&(u=[1,1]),this.throwIfDisposed(),tt.depthwiseConv2d(this,n,t,e,a,u,s)},r.prototype.separableConv2d=function(n,t,e,a,u,s){return u===void 0&&(u=[1,1]),s===void 0&&(s="NHWC"),this.throwIfDisposed(),tt.separableConv2d(this,n,t,e,a,u,s)},r.prototype.avgPool=function(n,t,e,a){return this.throwIfDisposed(),tt.avgPool(this,n,t,e,a)},r.prototype.maxPool=function(n,t,e,a){return this.throwIfDisposed(),tt.maxPool(this,n,t,e,a)},r.prototype.localResponseNormalization=function(n,t,e,a){return n===void 0&&(n=5),t===void 0&&(t=1),e===void 0&&(e=1),a===void 0&&(a=.5),tt.localResponseNormalization(this,n,t,e,a)},r.prototype.pool=function(n,t,e,a,u){return this.throwIfDisposed(),tt.pool(this,n,t,e,a,u)},r.prototype.variable=function(n,t,e){return n===void 0&&(n=!0),this.throwIfDisposed(),br().makeVariable(this,n,t,e)},r.prototype.unsortedSegmentSum=function(n,t){return this.throwIfDisposed(),tt.unsortedSegmentSum(this,n,t)},r.prototype.batchToSpaceND=function(n,t){return this.throwIfDisposed(),tt.batchToSpaceND(this,n,t)},r.prototype.spaceToBatchND=function(n,t){return this.throwIfDisposed(),tt.spaceToBatchND(this,n,t)},r.prototype.topk=function(n,t){return n===void 0&&(n=1),t===void 0&&(t=!0),this.throwIfDisposed(),tt.topk(this,n,t)},r.prototype.stridedSlice=function(n,t,e,a,u,s,l,f){return a===void 0&&(a=0),u===void 0&&(u=0),s===void 0&&(s=0),l===void 0&&(l=0),f===void 0&&(f=0),this.throwIfDisposed(),tt.stridedSlice(this,n,t,e,a,u,s,l,f)},r.prototype.depthToSpace=function(n,t){return this.throwIfDisposed(),tt.depthToSpace(this,n,t)},r.prototype.fft=function(){return this.throwIfDisposed(),tt.spectral.fft(this)},r.prototype.ifft=function(){return this.throwIfDisposed(),tt.spectral.ifft(this)},r.prototype.rfft=function(){return this.throwIfDisposed(),tt.spectral.rfft(this)},r.prototype.irfft=function(){return this.throwIfDisposed(),tt.spectral.irfft(this)},r})();Object.defineProperty(pe,Symbol.hasInstance,{value:function(r){return!!r&&r.dataId!=null&&r.shape!=null&&r.dtype!=null}});var X0,fd,hd,dd,pd,Eo=(function(r){function n(t,e,a,u){var s=r.call(this,t.shape,t.dtype,t.dataId,u)||this;return s.trainable=e,s.name=a,s}return sr(n,r),n.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value ("+t.dtype+") and previous value ("+this.dtype+") must match");if(!Pe(t.shape,this.shape))throw new Error("shape of the new value ("+t.shape+") and previous value ("+this.shape+") must match");br().disposeTensor(this),this.dataId=t.dataId,br().incRef(this,null)},n.prototype.dispose=function(){br().disposeVariable(this),this.isDisposedInternal=!0},n})(pe);Object.defineProperty(Eo,Symbol.hasInstance,{value:function(r){return r instanceof pe&&r.assign!=null&&r.assign instanceof Function}}),(function(r){r.R0="R0",r.R1="R1",r.R2="R2",r.R3="R3",r.R4="R4",r.R5="R5",r.R6="R6"})(X0||(X0={})),(function(r){r.float32="float32",r.int32="int32",r.bool="int32",r.complex64="complex64"})(fd||(fd={})),(function(r){r.float32="float32",r.int32="int32",r.bool="bool",r.complex64="complex64"})(hd||(hd={})),(function(r){r.float32="float32",r.int32="float32",r.bool="float32",r.complex64="complex64"})(dd||(dd={})),(function(r){r.float32="complex64",r.int32="complex64",r.bool="complex64",r.complex64="complex64"})(pd||(pd={}));var r_={float32:dd,int32:fd,bool:hd,complex64:pd};function Qe(r,n){if(r==="string"||n==="string"){if(r==="string"&&n==="string")return"string";throw new Error("Can not upcast "+r+" with "+n)}return r_[r][n]}function Ih(r){return Qe(r,"int32")}function me(r,n){if(r.dtype===n.dtype)return[r,n];var t=Qe(r.dtype,n.dtype);return[r.cast(t),n.cast(t)]}function a_(r,n){k(r.dtype===n.dtype,(function(){return"The dtypes of the first("+r.dtype+") and second("+n.dtype+") input must match"}))}function t1(r){var n=[];return(function t(e,a,u){if(e!=null){if(e instanceof pe)return void a.push(e);if(s=e,!(!Array.isArray(s)&&typeof s!="object")){var s,l=e;for(var f in l){var h=l[f];u.has(h)||(u.add(h),t(h,a,u))}}}})(r,n,new Set),n}var Bh,K0=(function(){function r(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return r.prototype.dispose=function(){for(var n in this.registeredVariables)this.registeredVariables[n].dispose()},r})(),i_=(function(){function r(n){this.ENV=n,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new K0}return r.prototype.ready=function(){return bt(this,void 0,void 0,(function(){var n,t,e;return xt(this,(function(a){switch(a.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then((function(){}))];if(this.backendInstance!=null)return[2];n=this.getSortedBackends(),t=0,a.label=1;case 1:return t<n.length?(e=n[t],[4,this.initializeBackend(e).success]):[3,5];case 2:return a.sent()?[4,this.setBackend(e)]:[3,4];case 3:return a.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}}))}))},Object.defineProperty(r.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var n=this.initializeBackendsAndReturnBest(),t=n.name;if(n.asyncInit)throw new Error("The highest priority backend '"+t+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!0,configurable:!0}),r.prototype.backendNames=function(){return Object.keys(this.registryFactory)},r.prototype.findBackend=function(n){return!(n in this.registry)&&(!(n in this.registryFactory)||this.initializeBackend(n).asyncInit)?null:this.registry[n]},r.prototype.findBackendFactory=function(n){return n in this.registryFactory?this.registryFactory[n].factory:null},r.prototype.registerBackend=function(n,t,e){return e===void 0&&(e=1),n in this.registryFactory?(console.warn(n+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[n]={factory:t,priority:e},!0)},r.prototype.setBackend=function(n){return bt(this,void 0,void 0,(function(){var t,e,a;return xt(this,(function(u){switch(u.label){case 0:if(this.registryFactory[n]==null)throw new Error("Backend name '"+n+"' not found in registry");return this.backendName=n,this.registry[n]!=null?[3,4]:(this.backendInstance=null,t=this.initializeBackend(n),e=t.success,t.asyncInit?[4,e]:[3,2]);case 1:return a=u.sent(),[3,3];case 2:a=e,u.label=3;case 3:if(!a)return[2,!1];u.label=4;case 4:return this.backendInstance=this.registry[n],this.setupRegisteredKernels(),this.profiler=new t_(this.backendInstance),[2,!0]}}))}))},r.prototype.setupRegisteredKernels=function(){var n=this;V0(this.backendName).forEach((function(t){t.setupFunc!=null&&t.setupFunc(n.backendInstance)}))},r.prototype.disposeRegisteredKernels=function(n){var t=this;V0(n).forEach((function(e){e.disposeFunc!=null&&e.disposeFunc(t.registry[n])}))},r.prototype.initializeBackend=function(n){var t=this,e=this.registryFactory[n];if(e==null)throw new Error("Cannot initialize backend "+n+", no registration found.");try{var a=e.factory();if(Promise.resolve(a)===a){var u=++this.pendingBackendInitId,s=a.then((function(l){return!(u<t.pendingBackendInitId)&&(t.registry[n]=l,t.pendingBackendInit=null,!0)})).catch((function(l){return!(u<t.pendingBackendInitId)&&(t.pendingBackendInit=null,console.warn("Initialization of backend "+n+" failed"),console.warn(l.stack||l.message),!1)}));return this.pendingBackendInit=s,{success:s,asyncInit:!0}}return this.registry[n]=a,{success:!0,asyncInit:!1}}catch(l){return console.warn("Initialization of backend "+n+" failed"),console.warn(l.stack||l.message),{success:!1,asyncInit:!1}}},r.prototype.removeBackend=function(n){if(!(n in this.registryFactory))throw new Error(n+" backend not found in registry");this.backendName===n&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,n in this.registry&&(this.disposeRegisteredKernels(n),this.registry[n].dispose(),delete this.registry[n]),delete this.registryFactory[n],this.backendName===n&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},r.prototype.getSortedBackends=function(){var n=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((function(t,e){return n.registryFactory[e].priority-n.registryFactory[t].priority}))},r.prototype.initializeBackendsAndReturnBest=function(){for(var n=this.getSortedBackends(),t=0;t<n.length;t++){var e=n[t],a=this.initializeBackend(e),u=a.success,s=a.asyncInit;if(s||u)return{name:e,asyncInit:s}}throw new Error("Could not initialize any backends, all backend initializations failed.")},r.prototype.moveData=function(n,t){var e=this.state.tensorInfo.get(t),a=e.backend,u=this.readSync(t);a.disposeData(t),e.backend=n,n.move(t,u,e.shape,e.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},r.prototype.tidy=function(n,t){var e,a=this,u=null;if(t==null){if(typeof n!="function")throw new Error("Please provide a function to tidy()");t=n}else{if(typeof n!="string"&&!(n instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");u=n}return this.scopedRun((function(){return a.startScope(u)}),(function(){return a.endScope(e)}),(function(){return(e=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),e}))},r.prototype.scopedRun=function(n,t,e){n();try{var a=e();return t(),a}catch(u){throw t(),u}},r.prototype.nextTensorId=function(){return r.nextTensorId++},r.prototype.nextVariableId=function(){return r.nextVariableId++},r.prototype.clone=function(n){var t=this.makeTensorFromDataId(n.dataId,n.shape,n.dtype),e={x:n};return this.addTapeNode(this.state.activeScope.name,e,[t],(function(a){return{x:function(){return a.toFloat()}}}),[]),t},r.prototype.runKernel=function(n,t,e,a,u){return this.runKernelFunc(null,t,null,n,e,a,u)},r.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},r.prototype.checkKernelForMemLeak=function(n,t,e){var a=this.backend.numDataIds(),u=0;e.forEach((function(f){u+=f.dtype==="complex64"?3:1}));var s=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],l=a-t-u-s;if(l>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+l+" data ids) after running '"+n+"'")},r.prototype.runKernelFunc=function(n,t,e,a,u,s,l){var f,h=this;s===void 0&&(s=[]),l===void 0&&(l=[]);var p=[],v=this.isTapeOn();a==null&&(a=this.state.activeScope!=null?this.state.activeScope.name:"");var m,y=function(R){v&&(p=R.map((function(A){return h.keep(h.clone(A))})))},x=this.state.numBytes,w=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var _,E=Wy(a,this.backendName);return m=E!=null?function(){var R=h.backend.numDataIds();_=E.kernelFunc({inputs:t,attrs:u,backend:h.backend});var A=Array.isArray(_)?_:[_];h.shouldCheckForMemLeaks()&&h.checkKernelForMemLeak(a,R,A);var S=A.map((function(N){var O=N.dataId,B=N.shape,I=N.dtype;return h.makeTensorFromDataId(O,B,I)})),T=S.filter((function(N,O){return l[O]}));return y((s||[]).slice().concat(T)),S}:function(){var R=h.backend.numDataIds();_=h.tidy((function(){return n(h.backend,y)}));var A=Array.isArray(_)?_:[_];return h.shouldCheckForMemLeaks()&&h.checkKernelForMemLeak(a,R,A),A},this.scopedRun((function(){return h.state.kernelDepth++}),(function(){return h.state.kernelDepth--}),(function(){f=h.ENV.getBool("DEBUG")?h.profiler.profileKernel(a,t,(function(){return m()})):m()})),v&&this.addTapeNode(a,t,f,e,p),this.state.profiling&&this.state.activeProfile.kernels.push({name:a,bytesAdded:this.state.numBytes-x,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-w,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(t).map((function(R){return t[R].shape})),outputShapes:f.map((function(R){return R.shape}))}),Array.isArray(_)?f:f[0]},r.prototype.makeTensor=function(n,t,e,a){if(n==null)throw new Error("Values passed to engine.makeTensor() are null");e=e||"float32",a=a||this.backend;var u=n;e==="string"&&Nd(n[0])&&(u=n.map((function(p){return Jw(p)})));var s=a.write(u,t,e),l=new pe(t,e,s,this.nextTensorId());if(this.incRef(l,a),e==="string"){var f=this.state.tensorInfo.get(s),h=Yw(u);this.state.numBytes+=h-f.bytes,f.bytes=h}return l},r.prototype.makeTensorFromDataId=function(n,t,e,a){var u=new pe(t,e=e||"float32",n,this.nextTensorId());return this.incRef(u,a),u},r.prototype.makeVariable=function(n,t,e,a){t===void 0&&(t=!0),e=e||this.nextVariableId().toString(),a!=null&&a!==n.dtype&&(n=n.asType(a));var u=new Eo(n,t,e,this.nextTensorId());if(this.state.registeredVariables[u.name]!=null)throw new Error("Variable with name "+u.name+" was already registered");return this.state.registeredVariables[u.name]=u,this.incRef(u,this.backend),u},r.prototype.incRef=function(n,t){var e=this.state.tensorInfo.has(n.dataId)?this.state.tensorInfo.get(n.dataId).refCount:0;if(this.state.numTensors++,n.dtype==="string"&&this.state.numStringTensors++,e===0){this.state.numDataBuffers++;var a=0;n.dtype!=="complex64"&&n.dtype!=="string"&&(a=n.size*Ky(n.dtype)),this.state.tensorInfo.set(n.dataId,{backend:t||this.backend,dtype:n.dtype,shape:n.shape,bytes:a,refCount:0}),this.state.numBytes+=a}this.state.tensorInfo.get(n.dataId).refCount++,n instanceof Eo||this.track(n)},r.prototype.disposeTensor=function(n){if(this.state.tensorInfo.has(n.dataId)){this.state.numTensors--,n.dtype==="string"&&this.state.numStringTensors--;var t=this.state.tensorInfo.get(n.dataId);t.refCount<=1?(n.dtype!=="complex64"&&(this.state.numBytes-=t.bytes),this.state.numDataBuffers--,t.backend.disposeData(n.dataId),this.state.tensorInfo.delete(n.dataId)):this.state.tensorInfo.get(n.dataId).refCount--}},r.prototype.disposeVariables=function(){for(var n in this.state.registeredVariables){var t=this.state.registeredVariables[n];this.disposeVariable(t)}},r.prototype.disposeVariable=function(n){this.disposeTensor(n),this.state.registeredVariables[n.name]!=null&&delete this.state.registeredVariables[n.name]},r.prototype.memory=function(){var n=this.backend.memory();return n.numTensors=this.state.numTensors,n.numDataBuffers=this.state.numDataBuffers,n.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(n.unreliable=!0,n.reasons==null&&(n.reasons=[]),n.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),n},r.prototype.profile=function(n){return bt(this,void 0,void 0,(function(){var t,e;return xt(this,(function(a){return this.state.profiling=!0,t=this.state.numBytes,e=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=n(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map((function(u){return u.totalBytesSnapshot}))),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-e,[2,this.state.activeProfile]}))}))},r.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},r.prototype.addTapeNode=function(n,t,e,a,u){var s=this,l={id:this.state.nextTapeNodeId++,kernelName:n,inputs:t,outputs:e,saved:u},f=Hw(n);f!=null&&(a=f.gradFunc),a!=null&&(l.gradient=function(h){return h=h.map((function(p,v){if(p==null){var m=e[v],y=Pu(m.size,m.dtype);return s.makeTensor(y,m.shape,m.dtype)}return p})),a(h.length>1?h:h[0],u)}),this.state.activeTape.push(l)},r.prototype.keep=function(n){return n.kept=!0,n},r.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},r.prototype.endTape=function(){this.state.gradientDepth--},r.prototype.startScope=function(n){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};n&&(t.name=n),this.state.scopeStack.push(t),this.state.activeScope=t},r.prototype.endScope=function(n){for(var t=this,e=t1(n),a=new Set(e.map((function(f){return f.id}))),u=0;u<this.state.activeScope.track.length;u++){var s=this.state.activeScope.track[u];s.kept||a.has(s.id)||s.dispose()}var l=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],e.forEach((function(f){f.kept||f.scopeId!==l.id||t.track(f)}))},r.prototype.gradients=function(n,t,e,a){var u=this;if(a===void 0&&(a=!1),k(t.length>0,(function(){return"gradients() received an empty list of xs."})),e!=null&&e.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '"+e.dtype+"'");var s=this.scopedRun((function(){return u.startTape()}),(function(){return u.endTape()}),(function(){return u.tidy("forward",n)}));k(s instanceof pe,(function(){return"The result y returned by f() must be a tensor."}));var l=(function(f,h,p){for(var v={},m={},y=0;y<h.length;y++)v[h[y].id]=!0;for(y=0;y<f.length;y++){var x=(N=f[y]).inputs;for(var w in x){for(var _=x[w],E=!1,R=0;R<h.length;R++)if(v[_.id]){N.outputs.forEach((function(F){return v[F.id]=!0})),E=!0,m[N.id]=!0;break}if(E)break}}var A={};A[p.id]=!0;var S={};for(y=f.length-1;y>=0;y--)for(x=(N=f[y]).inputs,R=0;R<N.outputs.length;R++)if(A[N.outputs[R].id]){for(var w in x)A[x[w].id]=!0,S[N.id]=!0;break}var T=[];for(y=0;y<f.length;y++){var N;if(m[(N=f[y]).id]&&S[N.id]){var O={};for(var w in N.inputs){var B=N.inputs[w];v[B.id]&&(O[w]=B)}var I=Object.assign({},N);I.inputs=O,I.outputs=N.outputs,T.push(I)}}return T})(this.state.activeTape,t,s);if(!a&&l.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(function(){var f,h,p={};p[s.id]=e??(f=s.shape,h=Qy(_t(f),"float32"),W.makeTensor(h,f,"float32")),(function(m,y,x){for(var w=function(E){var R=y[E],A=[];if(R.outputs.forEach((function(O){var B=m[O.id];B!=null?A.push(B):A.push(null)})),R.gradient==null)throw new Error("Cannot compute gradient: gradient function not found for "+R.kernelName+".");var S=R.gradient(A),T=function(O){if(!(O in S))throw new Error("Cannot backprop through input "+O+". Available gradients found: "+Object.keys(S)+".");var B=x((function(){return S[O]()}));if(B.dtype!=="float32")throw new Error("Error in gradient for op "+R.kernelName+". The gradient of input "+O+" must have 'float32' dtype, but has '"+B.dtype+"'");var I=R.inputs[O];if(!Pe(B.shape,I.shape))throw new Error("Error in gradient for op "+R.kernelName+". The gradient of input '"+O+"' has shape '"+B.shape+"', which does not match the shape of the input '"+I.shape+"'");if(m[I.id]==null)m[I.id]=B;else{var F=m[I.id];m[I.id]=F.add(B),F.dispose()}};for(var N in R.inputs)T(N)},_=y.length-1;_>=0;_--)w(_)})(p,l,(function(m){return u.tidy(m)}));var v=t.map((function(m){return p[m.id]}));return u.state.gradientDepth===0&&(u.state.activeTape.forEach((function(m){for(var y=0,x=m.saved;y<x.length;y++)x[y].dispose()})),u.state.activeTape=null),{value:s,grads:v}}))},r.prototype.customGrad=function(n){var t=this;return k(ld(n),(function(){return"The f passed in customGrad(f) must be a function."})),function(){for(var e,a=[],u=0;u<arguments.length;u++)a[u]=arguments[u];k(a.every((function(l){return l instanceof pe})),(function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"}));var s={};return a.forEach((function(l,f){s[f]=l})),t.runKernelFunc((function(l,f){return k((e=n.apply(void 0,a.concat([f]))).value instanceof pe,(function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"})),k(ld(e.gradFunc),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."})),e.value}),s,(function(l,f){var h=e.gradFunc(l,f),p=Array.isArray(h)?h:[h];k(p.length===a.length,(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."})),k(p.every((function(m){return m instanceof pe})),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."}));var v={};return p.forEach((function(m,y){v[y]=function(){return m}})),v}))}},r.prototype.readSync=function(n){return this.state.tensorInfo.get(n).backend.readSync(n)},r.prototype.read=function(n){return this.state.tensorInfo.get(n).backend.read(n)},r.prototype.time=function(n){return bt(this,void 0,void 0,(function(){var t,e;return xt(this,(function(a){switch(a.label){case 0:return t=yr(),[4,this.backend.time(n)];case 1:return(e=a.sent()).wallMs=yr()-t,[2,e]}}))}))},r.prototype.track=function(n){return this.state.activeScope!=null&&(n.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(n)),n},Object.defineProperty(r.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),r.prototype.reset=function(){for(var n in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new K0,this.registry)this.disposeRegisteredKernels(n),this.registry[n].dispose(),delete this.registry[n];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},r.nextTensorId=0,r.nextVariableId=0,r})(),W=(function(){var r=(function(){if(Bh==null){var t=void 0;if(typeof window<"u")t=window;else if(typeof global<"u")t=global;else if(typeof process<"u")t=process;else{if(typeof self>"u")throw new Error("Could not find a global object");t=self}Bh=t}return Bh})();if(r._tfengine==null){var n=new Uw(r);r._tfengine=new i_(n)}return(function(t){Gy=t})(r._tfengine.ENV),br=function(){return r._tfengine},r._tfengine})();function e1(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var Qr=st();Qr.registerFlag("DEBUG",(function(){return!1}),(function(r){r&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),Qr.registerFlag("IS_BROWSER",(function(){return e1()})),Qr.registerFlag("IS_NODE",(function(){return typeof process<"u"&&process.versions!==void 0&&process.versions.node!==void 0})),Qr.registerFlag("IS_CHROME",(function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)})),Qr.registerFlag("PROD",(function(){return!1})),Qr.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(function(){return Qr.getBool("DEBUG")})),Qr.registerFlag("DEPRECATION_WARNINGS_ENABLED",(function(){return!0})),Qr.registerFlag("IS_TEST",(function(){return!1}));var Mu,kn,On,ui={},Fh={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function o_(r,n){ui[r]=n}function Ar(r){r in ui||(ui[r]=(function(t){if(t!==1&&t!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var e=(function(a){if(typeof OffscreenCanvas<"u"&&a===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")})(t);return e.addEventListener("webglcontextlost",(function(a){a.preventDefault(),delete ui[t]}),!1),t===1?e.getContext("webgl",Fh)||e.getContext("experimental-webgl",Fh):e.getContext("webgl2",Fh)})(r));var n=ui[r];return n.isContextLost()?(delete ui[r],Ar(r)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),ui[r])}function Yl(r,n){return[n,r]}function Ru(r){var n=_t(r);return sd(Math.ceil(n/4))}function Hu(r,n){return[Math.max(1,Math.ceil(n/2)),Math.max(1,Math.ceil(r/2))]}function Md(r,n){var t,e,a,u,s,l,f,h,p,v=r;return st().getNumber("WEBGL_VERSION")===2?(t=v.R32F,e=v.R16F,a=v.RGBA16F,u=v.RGBA32F,s=v.RED,l=4,f=1,h=v.HALF_FLOAT,p=v.FLOAT):(t=r.RGBA,e=r.RGBA,a=r.RGBA,u=v.RGBA,s=r.RGBA,l=4,f=4,h=n!=null?n.HALF_FLOAT_OES:null,p=r.FLOAT),{internalFormatFloat:t,internalFormatHalfFloat:e,internalFormatPackedHalfFloat:a,internalFormatPackedFloat:u,textureFormatFloat:s,downloadTextureFormat:r.RGBA,downloadUnpackNumChannels:l,defaultNumChannels:f,textureTypeHalfFloat:h,textureTypeFloat:p}}function Et(r,n,t){var e=t();return n&&(function(a){var u=a.getError();if(u!==a.NO_ERROR)throw new Error("WebGL Error: "+c_(a,u))})(r),e}(function(r){r[r.DENSE=0]="DENSE",r[r.SHARED_BATCH=1]="SHARED_BATCH"})(Mu||(Mu={})),(function(r){r[r.RENDER=0]="RENDER",r[r.UPLOAD=1]="UPLOAD",r[r.PIXELS=2]="PIXELS",r[r.DOWNLOAD=3]="DOWNLOAD"})(kn||(kn={})),(function(r){r[r.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",r[r.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",r[r.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",r[r.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",r[r.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(On||(On={}));var u_=596e-10,s_=65504;function l_(r){return!!(st().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||r===0||u_<Math.abs(r)&&Math.abs(r)<s_)}function c_(r,n){switch(n){case r.NO_ERROR:return"NO_ERROR";case r.INVALID_ENUM:return"INVALID_ENUM";case r.INVALID_VALUE:return"INVALID_VALUE";case r.INVALID_OPERATION:return"INVALID_OPERATION";case r.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case r.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case r.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+n}}function hl(r,n,t){return ta(r,n,(function(){return r.getExtension(t)}),'Extension "'+t+'" not supported on this browser.')}function f_(r,n,t){var e=ta(r,n,(function(){return r.createShader(r.VERTEX_SHADER)}),"Unable to create vertex WebGLShader.");if(Et(r,n,(function(){return r.shaderSource(e,t)})),Et(r,n,(function(){return r.compileShader(e)})),r.getShaderParameter(e,r.COMPILE_STATUS)===!1)throw console.log(r.getShaderInfoLog(e)),new Error("Failed to compile vertex shader.");return e}function h_(r,n,t){var e=ta(r,n,(function(){return r.createShader(r.FRAGMENT_SHADER)}),"Unable to create fragment WebGLShader.");if(Et(r,n,(function(){return r.shaderSource(e,t)})),Et(r,n,(function(){return r.compileShader(e)})),r.getShaderParameter(e,r.COMPILE_STATUS)===!1)throw(function(a,u){var s=d_.exec(u);if(s==null)return console.log("Couldn't parse line number in error: "+u),void console.log(a);for(var l=+s[1],f=a.split(`
`),h=f.length.toString().length+2,p=f.map((function(_,E){return vo((E+1).toString(),h)+_})),v=0,m=0;m<p.length;m++)v=Math.max(p[m].length,v);var y=p.slice(0,l-1),x=p.slice(l-1,l),w=p.slice(l);console.log(y.join(`
`)),console.log(u.split(`
`)[0]),console.log("%c "+vo(x[0],v),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(w.join(`
`))})(t,r.getShaderInfoLog(e)),new Error("Failed to compile fragment shader.");return e}var zh,Lh,d_=/ERROR: [0-9]+:([0-9]+):/g;function p_(r,n){return ta(r,n,(function(){return r.createProgram()}),"Unable to create WebGLProgram.")}function v_(r,n,t){if(Et(r,n,(function(){return r.linkProgram(t)})),r.getProgramParameter(t,r.LINK_STATUS)===!1)throw console.log(r.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}function Uh(r,n,t){if(Et(r,n,(function(){return r.validateProgram(t)})),r.getProgramParameter(t,r.VALIDATE_STATUS)===!1)throw console.log(r.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function m_(r,n,t){var e=ta(r,n,(function(){return r.createBuffer()}),"Unable to create WebGLBuffer");return Et(r,n,(function(){return r.bindBuffer(r.ARRAY_BUFFER,e)})),Et(r,n,(function(){return r.bufferData(r.ARRAY_BUFFER,t,r.STATIC_DRAW)})),e}function g_(r,n,t){var e=ta(r,n,(function(){return r.createBuffer()}),"Unable to create WebGLBuffer");return Et(r,n,(function(){return r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,e)})),Et(r,n,(function(){return r.bufferData(r.ELEMENT_ARRAY_BUFFER,t,r.STATIC_DRAW)})),e}function y_(r,n){return ta(r,n,(function(){return r.createTexture()}),"Unable to create WebGLTexture.")}function b_(r,n){var t=st().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(r<=0||n<=0){var e="["+r+"x"+n+"]";throw new Error("Requested texture size "+e+" is invalid.")}if(r>t||n>t)throw e="["+r+"x"+n+"]",new Error("Requested texture size "+e+" greater than WebGL maximum on this browser / GPU "+("["+t+"x"+t+"]")+".")}function x_(r,n){return ta(r,n,(function(){return r.createFramebuffer()}),"Unable to create WebGLFramebuffer.")}function Y0(r,n,t,e,a,u,s,l){var f=r.getAttribLocation(t,e);return f!==-1&&(Et(r,n,(function(){return r.bindBuffer(r.ARRAY_BUFFER,a)})),Et(r,n,(function(){return r.vertexAttribPointer(f,u,r.FLOAT,!1,s,l)})),Et(r,n,(function(){return r.enableVertexAttribArray(f)})),!0)}function w_(r,n,t,e){R_(r,e),Et(r,n,(function(){return r.activeTexture(r.TEXTURE0+e)})),Et(r,n,(function(){return r.bindTexture(r.TEXTURE_2D,t)}))}function __(r,n,t,e){return ta(r,n,(function(){return r.getUniformLocation(t,e)}),'uniform "'+e+'" not present in program.')}function E_(r,n,t){return r.getUniformLocation(n,t)}function C_(r,n,t,e,a,u){Et(r,n,(function(){return w_(r,n,e,u)})),Et(r,n,(function(){return r.uniform1i(a,u)}))}function Ph(r,n,t,e){Et(r,n,(function(){return r.bindFramebuffer(r.FRAMEBUFFER,e)})),Et(r,n,(function(){return r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,t,0)}))}function Q0(r,n,t){Et(r,n,(function(){return r.bindFramebuffer(r.FRAMEBUFFER,t)})),Et(r,n,(function(){return r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,null,0)}))}function dl(r){var n=r.checkFramebufferStatus(r.FRAMEBUFFER);if(n!==r.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+S_(r,n))}function S_(r,n){switch(n){case r.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case r.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case r.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case r.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+n}}function ta(r,n,t,e){var a=Et(r,n,(function(){return t()}));if(a==null)throw new Error(e);return a}function R_(r,n){var t=r.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,e=n+r.TEXTURE0;if(e<r.TEXTURE0||e>t)throw new Error("textureUnit must be in "+("[gl.TEXTURE0, gl.TEXTURE"+t+"]")+".")}function Nl(r,n){return n===void 0&&(n=2),_t(r.slice(0,r.length-n))}function Ml(r){if(r.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[r.length>1?r[r.length-2]:1,r[r.length-1]]}function Hh(r){var n=[1,1,1];return r.length===0||r.length===1&&r[0]===1||(n=[Nl(r)].concat(Ml(r))),n}function A_(r,n){var t;n===void 0&&(n=!1);var e=st().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n&&(e*=2,(r=r.map((function(h,p){return p>=r.length-2?Xy(r[p]):r[p]}))).length===1&&(r=[2,r[0]])),r.length!==2){var a=li(r);r=a.newShape}var u=_t(r);if(r.length<=1&&u<=e)return[1,u];if(r.length===2&&r[0]<=e&&r[1]<=e)return r;if(r.length===3&&r[0]*r[1]<=e&&r[2]<=e)return[r[0]*r[1],r[2]];if(r.length===3&&r[0]<=e&&r[1]*r[2]<=e)return[r[0],r[1]*r[2]];if(r.length===4&&r[0]*r[1]*r[2]<=e&&r[3]<=e)return[r[0]*r[1]*r[2],r[3]];if(r.length===4&&r[0]<=e&&r[1]*r[2]*r[3]<=e)return[r[0],r[1]*r[2]*r[3]];if(n){var s=Nl(r),l=2,f=2;return r.length&&(l=(t=Ml(r))[0],f=t[1]),sd(u=s*(l/2)*(f/2)).map((function(h){return 2*h}))}return sd(u)}function pl(r){return r%2==0}function vl(r,n){if(Pe(r=r.slice(-2),n=n.slice(-2))||!r.length||!n.length||r[0]===0||r[1]===0||n[0]===0||n[1]===0)return!0;if(r.length!==n.length){var t=r.slice(-1)[0],e=n.slice(-1)[0];if(t===e||pl(t)&&pl(e)&&(r[0]===1||n[0]===1))return!0}return r[1]===n[1]&&pl(r[0])&&pl(n[0])}function T_(r){if(zh==null){var n=Ar(r);zh=n.getParameter(n.MAX_TEXTURE_SIZE)}return zh}function D_(r){if(Lh==null){var n=Ar(r);Lh=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,Lh)}function N_(r){if(r===0)return 0;var n=Ar(r);return Jn(n,"EXT_disjoint_timer_query_webgl2")&&r===2?2:Jn(n,"EXT_disjoint_timer_query")?1:0}function Jn(r,n){return r.getExtension(n)!=null}function Z0(r){try{if(Ar(r)!=null)return!0}catch{return!1}return!1}function M_(r){if(r===0)return!1;var n=Ar(r);if(r===1){if(!Jn(n,"OES_texture_float"))return!1}else if(!Jn(n,"EXT_color_buffer_float"))return!1;return vd(n)}function O_(r){if(r===0)return!1;var n=Ar(r);if(r!==1){if(Jn(n,"EXT_color_buffer_float"))return vd(n);if(Jn(n,"EXT_color_buffer_half_float")){var t=n.getExtension("EXT_color_buffer_half_float");return(function(e,a){var u=Md(e,a),s=e.createTexture();e.bindTexture(e.TEXTURE_2D,s),e.texImage2D(e.TEXTURE_2D,0,u.internalFormatHalfFloat,1,1,0,u.textureFormatFloat,u.textureTypeHalfFloat,null);var l=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,l),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,s,0);var f=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(s),e.deleteFramebuffer(l),f})(n,t)}return!1}return!!Jn(n,"OES_texture_float")&&!!Jn(n,"WEBGL_color_buffer_float")&&vd(n)}function vd(r){var n=Md(r),t=r.createTexture();r.bindTexture(r.TEXTURE_2D,t),r.texImage2D(r.TEXTURE_2D,0,n.internalFormatFloat,1,1,0,n.textureFormatFloat,n.textureTypeFloat,null);var e=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,e),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,t,0);var a=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(t),r.deleteFramebuffer(e),a}function k_(r){return r===2&&Ar(r).fenceSync!=null}var Nt=st();function n1(r){st().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(r+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function mt(r,n){return W.tidy(r,n)}function yn(r){t1(r).forEach((function(n){return n.dispose()}))}function I_(r){return W.keep(r)}function Ol(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];st().getBool("IS_TEST")||console.warn.apply(console,r)}function Ua(r,n){var t=r;if(_r(r))return n==="string"?[]:[r.length];if(!Array.isArray(r))return[];for(var e=[];Array.isArray(t)||_r(t)&&n!=="string";)e.push(t.length),t=t[0];return Array.isArray(r)&&st().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&(function a(u,s,l){if(l=l||[],!Array.isArray(u)&&!_r(u))return void k(s.length===0,(function(){return"Element arr["+l.join("][")+"] is a primitive, but should be an array/TypedArray of "+s[0]+" elements"}));k(s.length>0,(function(){return"Element arr["+l.join("][")+"] should be a primitive, but is an array of "+u.length+" elements"})),k(u.length===s[0],(function(){return"Element arr["+l.join("][")+"] should have "+s[0]+" elements, but has "+u.length+" elements"}));for(var f=s.slice(1),h=0;h<u.length;++h)a(u[h],f,l.concat(h))})(r,e,[]),e}function J0(r,n,t,e){if(r!=null&&(r!=="numeric"&&r!==n||r==="numeric"&&n==="string"))throw new Error("Argument '"+t+"' passed to '"+e+"' must be "+r+" tensor, but got "+n+" tensor")}function M(r,n,t,e){if(e===void 0&&(e="numeric"),r instanceof pe)return J0(e,r.dtype,n,t),r;var a=Uu(r);if(a!=="string"&&["bool","int32","float32"].indexOf(e)>=0&&(a=e),J0(e,a,n,t),r==null||!_r(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string"){var u=r==null?"null":r.constructor.name;throw new Error("Argument '"+n+"' passed to '"+t+"' must be a Tensor or TensorLike, but got '"+u+"'")}var s=Ua(r,a);_r(r)||Array.isArray(r)||(r=[r]);var l=a!=="string"?Yy(r,a,st().getBool("DEBUG")):_o(r,[],!0);return W.makeTensor(l,s,a)}function kl(r,n,t,e){if(e===void 0&&(e="numeric"),!Array.isArray(r))throw new Error("Argument "+n+" passed to "+t+" must be a `Tensor[]` or `TensorLike[]`");return r.map((function(a,u){return M(a,n+"["+u+"]",t)}),e)}function r1(r,n){for(var t=0;t<r.length;++t)if(r[r.length-t-1]!==n-1-t)return!1;return!0}function B_(r,n,t){for(var e=r.length+n.length,a=[],u=0,s=0,l=0;l<e;l++)t.indexOf(l)===-1?a.push(r[u++]):a.push(n[s++]);return a}function $e(r,n){for(var t=[],e=r.length,a=0;a<e;a++)n.indexOf(a)===-1&&t.push(r[a]);return[t,n.map((function(u){return r[u]}))]}function bn(r,n){return B_(r,n.map((function(t){return 1})),n)}function Mn(r,n,t){k(r1(n,t),(function(){return r+" supports only inner-most axes for now. Got axes "+n+" and rank-"+t+" input."}))}function Tr(r,n){if(r1(r,n))return null;for(var t=[],e=0;e<n;++e)r.indexOf(e)===-1&&t.push(e);return r.forEach((function(a){return t.push(a)})),t}function Od(r){return r.map((function(n,t){return[t,n]})).sort((function(n,t){return n[1]-t[1]})).map((function(n){return n[0]}))}function Dr(r,n){for(var t=[],e=n-r;e<n;++e)t.push(e);return t}function F_(r,n){var t=r[0].length;r.forEach((function(a,u){k(a.length===t,(function(){return"Error in concat"+t+"D: rank of tensors["+u+"] must be the same as the rank of the rest ("+t+")"}))})),k(n>=0&&n<t,(function(){return"Error in concat"+t+"D: axis must be between 0 and "+(t-1)+"."}));var e=r[0];r.forEach((function(a,u){for(var s=0;s<t;s++)k(s===n||a[s]===e[s],(function(){return"Error in concat"+t+"D: Shape of tensors["+u+"] ("+a+") does not match the shape of the rest ("+e+") along the non-concatenated axis "+u+"."}))}))}function Co(r,n){for(var t=r[0].slice(),e=1;e<r.length;e++)t[n]+=r[e][n];return t}function P(r){var n=Object.keys(r);if(n.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+n.length+" keys.");var t=n[0],e=r[t];t.endsWith("_")&&(t=t.substring(0,t.length-1));var a=function(){for(var u=[],s=0;s<arguments.length;s++)u[s]=arguments[s];W.startScope(t);try{var l=e.apply(void 0,u);return l instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),W.endScope(l),l}catch(f){throw W.endScope(null),f}};return Object.defineProperty(a,"name",{value:t,configurable:!0}),a}Nt.registerFlag("HAS_WEBGL",(function(){return Nt.getNumber("WEBGL_VERSION")>0})),Nt.registerFlag("WEBGL_VERSION",(function(){return Z0(2)?2:Z0(1)?1:0})),Nt.registerFlag("WEBGL_BUFFER_SUPPORTED",(function(){return Nt.get("WEBGL_VERSION")===2})),Nt.registerFlag("WEBGL_CPU_FORWARD",(function(){return!0})),Nt.registerFlag("WEBGL_FORCE_F16_TEXTURES",(function(){return!1})),Nt.registerFlag("WEBGL_PACK",(function(){return Nt.getBool("HAS_WEBGL")})),Nt.registerFlag("WEBGL_PACK_NORMALIZATION",(function(){return Nt.getBool("WEBGL_PACK")})),Nt.registerFlag("WEBGL_PACK_CLIP",(function(){return Nt.getBool("WEBGL_PACK")})),Nt.registerFlag("WEBGL_PACK_DEPTHWISECONV",(function(){return!1})),Nt.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",(function(){return Nt.getBool("WEBGL_PACK")})),Nt.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",(function(){return Nt.getBool("WEBGL_PACK")})),Nt.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",(function(){return Nt.getBool("WEBGL_PACK")})),Nt.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",(function(){return Nt.getBool("WEBGL_PACK")})),Nt.registerFlag("WEBGL_PACK_REDUCE",(function(){return Nt.getBool("WEBGL_PACK")})),Nt.registerFlag("WEBGL_LAZILY_UNPACK",(function(){return Nt.getBool("WEBGL_PACK")})),Nt.registerFlag("WEBGL_CONV_IM2COL",(function(){return Nt.getBool("WEBGL_PACK")})),Nt.registerFlag("WEBGL_MAX_TEXTURE_SIZE",(function(){return T_(Nt.getNumber("WEBGL_VERSION"))})),Nt.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",(function(){return D_(Nt.getNumber("WEBGL_VERSION"))})),Nt.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",(function(){var r=Nt.getNumber("WEBGL_VERSION");return r===0?0:N_(r)})),Nt.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",(function(){return Nt.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(r=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(r)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(r.substr(0,4))));var r})),Nt.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",(function(){return M_(Nt.getNumber("WEBGL_VERSION"))})),Nt.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",(function(){return!Nt.getBool("WEBGL_FORCE_F16_TEXTURES")&&Nt.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")})),Nt.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",(function(){return O_(Nt.getNumber("WEBGL_VERSION"))})),Nt.registerFlag("WEBGL_FENCE_API_ENABLED",(function(){return k_(Nt.getNumber("WEBGL_VERSION"))})),Nt.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",(function(){return Nt.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0})),$y=n1;var Ye=P({complex_:function(r,n){var t=M(r,"real","complex"),e=M(n,"imag","complex");return $t(t.shape,e.shape,"real and imag shapes, "+t.shape+" and "+e.shape+", must match in call to tf.complex()."),W.runKernelFunc((function(a){return a.complex(t,e)}),{$real:t,$imag:e})}}),Zn=P({real_:function(r){var n=M(r,"input","real");return W.runKernelFunc((function(t){return t.real(n)}),{$input:n})}}),xr=P({imag_:function(r){var n=M(r,"input","imag");return W.runKernelFunc((function(t){return t.imag(n)}),{$input:n})}});function Ze(r,n,t){return Pa(r,n,Ua(r,t),t)}function Pa(r,n,t,e){if(e==null&&(e=Uu(r)),e==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!_r(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(n!=null){Zy(n);var a=_t(n),u=_t(t);k(a===u,(function(){return"Based on the provided shape, ["+n+"], the tensor should have "+a+" values but has "+u}));for(var s=0;s<t.length;++s){var l=t[s],f=s!==t.length-1||l!==_t(n.slice(s));k(t[s]===n[s]||!f,(function(){return"Error creating a new Tensor. Inferred shape ("+t+") does not match the provided shape ("+n+"). "}))}}return _r(r)||Array.isArray(r)||(r=[r]),n=n||t,r=e!=="string"?Yy(r,e,st().getBool("DEBUG")):_o(r,[],!0),W.makeTensor(r,n,e)}function pt(r,n){if((_r(r)&&n!=="string"||Array.isArray(r))&&n!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(n==="string"&&_r(r)&&!(r instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Pa(r,[],[],n)}function Te(r,n){Ro(r);var t=Ua(r,n);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Pa(r,null,t,n)}function Ba(r,n,t){if(Ro(r),n!=null&&n.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var e=Ua(r,t);if(e.length!==2&&e.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(e.length===1&&n==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Pa(r,n,e,t)}function kd(r,n,t){if(Ro(r),n!=null&&n.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var e=Ua(r,t);if(e.length!==3&&e.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(e.length===1&&n==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Pa(r,n,e,t)}function mn(r,n,t){if(Ro(r),n!=null&&n.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var e=Ua(r,t);if(e.length!==4&&e.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(e.length===1&&n==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Pa(r,n,e,t)}function z_(r,n,t){if(Ro(r),n!=null&&n.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var e=Ua(r,t);if(e.length!==5&&e.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(e.length===1&&n==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Pa(r,n,e,t)}function L_(r,n,t){if(Ro(r),n!=null&&n.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var e=Ua(r,t);if(e.length!==6&&e.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(e.length===1&&n==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return Pa(r,n=n||e,e,t)}function U_(r,n,t,e){return n===void 0&&(n=!0),W.makeVariable(r,n,t,e)}function Ao(r,n){if(n===void 0&&(n="float32"),n==="complex64"){var t=Ao(r,"float32"),e=he(r,"float32");return Ye(t,e)}var a=Qy(_t(r),n);return W.makeTensor(a,r,n)}function he(r,n){if(n===void 0&&(n="float32"),n==="complex64"){var t=he(r,"float32"),e=he(r,"float32");return Ye(t,e)}var a=Pu(_t(r),n);return W.makeTensor(a,r,n)}function Cr(r,n,t){return W.runKernelFunc((function(e){return e.fill(r,n,t)}),{})}function P_(r,n,t){if(t<=0)throw new Error("The number of values should be positive.");return W.runKernelFunc((function(e){return e.linspace(r,n,t)}),{})}function Il(r,n,t,e){if(t===void 0&&(t=1),e===void 0&&(e="float32"),t===0)throw new Error("Cannot have a step of zero");if(r===n||r<n&&t<0||n<r&&t>1)return he([0],e);var a=Pu(Math.abs(Math.ceil((n-r)/t)),e);n<r&&t===1&&(t=-1),a[0]=r;for(var u=1;u<a.length;u++)a[u]=a[u-1]+t;return Te(a,e)}var a1=P({onesLike_:function(r){var n=M(r,"x","onesLike");if(n.dtype==="complex64"){var t=a1(Zn(n)),e=jt(xr(n));return Ye(t,e)}return W.runKernelFunc((function(a){return a.onesLike(n)}),{$x:n},(function(a,u){return{$x:function(){return jt(a)}}}))}}),jt=P({zerosLike_:function(r){var n=M(r,"x","zerosLike");return W.runKernelFunc((function(t){return t.zerosLike(n)}),{$x:n},(function(t,e){return{$x:function(){return jt(t)}}}))}}),Oe=P({concat_:function(r,n){n===void 0&&(n=0),k(r.length>=1,(function(){return"Pass at least one tensor to concat"}));var t=kl(r,"tensors","concat");t[0].dtype==="complex64"&&t.forEach((function(l){if(l.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `+l.dtype+". ")})),n=Fe(n,t[0].shape)[0];var e=Co(t.map((function(l){return l.shape})),n);if(_t(e)===0)return Ze([],e);if((t=t.filter((function(l){return l.size>0}))).length===1)return t[0];var a=t.map((function(l){return l.shape}));F_(a,n);var u=t,s={axis:n};return W.runKernelFunc((function(l){return l.concat(t,n)}),u,(function(l){var f=a.map((function(h){return h[n]}));return Id(l,f,n).map((function(h){return function(){return h}}))}),"Concat",s)}}),H_=P({concat1d_:function(r){return Oe(r,0)}}),V_=P({concat2d_:function(r,n){return Oe(r,n)}}),G_=P({concat3d_:function(r,n){return Oe(r,n)}}),W_=P({concat4d_:function(r,n){return Oe(r,n)}}),Id=P({split_:function(r,n,t){t===void 0&&(t=0);var e,a=M(r,"x","split");return t=Fe(t,a.shape)[0],typeof n=="number"?(k(a.shape[t]%n==0,(function(){return"Number of splits must evenly divide the axis."})),e=new Array(n).fill(a.shape[t]/n)):(k(a.shape[t]===n.reduce((function(u,s){return u+s})),(function(){return"The sum of sizes must match the size of the axis dimension."})),e=n),W.runKernelFunc((function(u){return u.split(a,e,t)}),{$x:a},(function(u){return{$x:function(){return Oe(u,t)}}}))}});function mi(r,n){return r(n={exports:{}},n.exports),n.exports}var q_=mi((function(r){(function(n,t,e){function a(l){var f,h=this,p=(f=4022871197,function(v){v=v.toString();for(var m=0;m<v.length;m++){var y=.02519603282416938*(f+=v.charCodeAt(m));y-=f=y>>>0,f=(y*=f)>>>0,f+=4294967296*(y-=f)}return 23283064365386963e-26*(f>>>0)});h.next=function(){var v=2091639*h.s0+23283064365386963e-26*h.c;return h.s0=h.s1,h.s1=h.s2,h.s2=v-(h.c=0|v)},h.c=1,h.s0=p(" "),h.s1=p(" "),h.s2=p(" "),h.s0-=p(l),h.s0<0&&(h.s0+=1),h.s1-=p(l),h.s1<0&&(h.s1+=1),h.s2-=p(l),h.s2<0&&(h.s2+=1),p=null}function u(l,f){return f.c=l.c,f.s0=l.s0,f.s1=l.s1,f.s2=l.s2,f}function s(l,f){var h=new a(l),p=f&&f.state,v=h.next;return v.int32=function(){return 4294967296*h.next()|0},v.double=function(){return v()+11102230246251565e-32*(2097152*v()|0)},v.quick=v,p&&(typeof p=="object"&&u(p,h),v.state=function(){return u(h,{})}),v}t&&t.exports?t.exports=s:this.alea=s})(0,r)})),j_=mi((function(r){(function(n,t,e){function a(l){var f=this,h="";f.x=0,f.y=0,f.z=0,f.w=0,f.next=function(){var v=f.x^f.x<<11;return f.x=f.y,f.y=f.z,f.z=f.w,f.w^=f.w>>>19^v^v>>>8},l===(0|l)?f.x=l:h+=l;for(var p=0;p<h.length+64;p++)f.x^=0|h.charCodeAt(p),f.next()}function u(l,f){return f.x=l.x,f.y=l.y,f.z=l.z,f.w=l.w,f}function s(l,f){var h=new a(l),p=f&&f.state,v=function(){return(h.next()>>>0)/4294967296};return v.double=function(){do var m=((h.next()>>>11)+(h.next()>>>0)/4294967296)/2097152;while(m===0);return m},v.int32=h.next,v.quick=v,p&&(typeof p=="object"&&u(p,h),v.state=function(){return u(h,{})}),v}t&&t.exports?t.exports=s:this.xor128=s})(0,r)})),X_=mi((function(r){(function(n,t,e){function a(l){var f=this,h="";f.next=function(){var v=f.x^f.x>>>2;return f.x=f.y,f.y=f.z,f.z=f.w,f.w=f.v,(f.d=f.d+362437|0)+(f.v=f.v^f.v<<4^v^v<<1)|0},f.x=0,f.y=0,f.z=0,f.w=0,f.v=0,l===(0|l)?f.x=l:h+=l;for(var p=0;p<h.length+64;p++)f.x^=0|h.charCodeAt(p),p==h.length&&(f.d=f.x<<10^f.x>>>4),f.next()}function u(l,f){return f.x=l.x,f.y=l.y,f.z=l.z,f.w=l.w,f.v=l.v,f.d=l.d,f}function s(l,f){var h=new a(l),p=f&&f.state,v=function(){return(h.next()>>>0)/4294967296};return v.double=function(){do var m=((h.next()>>>11)+(h.next()>>>0)/4294967296)/2097152;while(m===0);return m},v.int32=h.next,v.quick=v,p&&(typeof p=="object"&&u(p,h),v.state=function(){return u(h,{})}),v}t&&t.exports?t.exports=s:this.xorwow=s})(0,r)})),K_=mi((function(r){(function(n,t,e){function a(l){var f=this;f.next=function(){var h,p,v=f.x,m=f.i;return h=v[m],p=(h^=h>>>7)^h<<24,p^=(h=v[m+1&7])^h>>>10,p^=(h=v[m+3&7])^h>>>3,p^=(h=v[m+4&7])^h<<7,h=v[m+7&7],p^=(h^=h<<13)^h<<9,v[m]=p,f.i=m+1&7,p},(function(h,p){var v,m=[];if(p===(0|p))m[0]=p;else for(p=""+p,v=0;v<p.length;++v)m[7&v]=m[7&v]<<15^p.charCodeAt(v)+m[v+1&7]<<13;for(;m.length<8;)m.push(0);for(v=0;v<8&&m[v]===0;++v);for(v==8?m[7]=-1:m[v],h.x=m,h.i=0,v=256;v>0;--v)h.next()})(f,l)}function u(l,f){return f.x=l.x.slice(),f.i=l.i,f}function s(l,f){l==null&&(l=+new Date);var h=new a(l),p=f&&f.state,v=function(){return(h.next()>>>0)/4294967296};return v.double=function(){do var m=((h.next()>>>11)+(h.next()>>>0)/4294967296)/2097152;while(m===0);return m},v.int32=h.next,v.quick=v,p&&(p.x&&u(p,h),v.state=function(){return u(h,{})}),v}t&&t.exports?t.exports=s:this.xorshift7=s})(0,r)})),Y_=mi((function(r){(function(n,t,e){function a(l){var f=this;f.next=function(){var h,p,v=f.w,m=f.X,y=f.i;return f.w=v=v+1640531527|0,p=m[y+34&127],h=m[y=y+1&127],p^=p<<13,h^=h<<17,p^=p>>>15,h^=h>>>12,p=m[y]=p^h,f.i=y,p+(v^v>>>16)|0},(function(h,p){var v,m,y,x,w,_=[],E=128;for(p===(0|p)?(m=p,p=null):(p+="\0",m=0,E=Math.max(E,p.length)),y=0,x=-32;x<E;++x)p&&(m^=p.charCodeAt((x+32)%p.length)),x===0&&(w=m),m^=m<<10,m^=m>>>15,m^=m<<4,m^=m>>>13,x>=0&&(w=w+1640531527|0,y=(v=_[127&x]^=m+w)==0?y+1:0);for(y>=128&&(_[127&(p&&p.length||0)]=-1),y=127,x=512;x>0;--x)m=_[y+34&127],v=_[y=y+1&127],m^=m<<13,v^=v<<17,m^=m>>>15,v^=v>>>12,_[y]=m^v;h.w=w,h.X=_,h.i=y})(f,l)}function u(l,f){return f.i=l.i,f.w=l.w,f.X=l.X.slice(),f}function s(l,f){l==null&&(l=+new Date);var h=new a(l),p=f&&f.state,v=function(){return(h.next()>>>0)/4294967296};return v.double=function(){do var m=((h.next()>>>11)+(h.next()>>>0)/4294967296)/2097152;while(m===0);return m},v.int32=h.next,v.quick=v,p&&(p.X&&u(p,h),v.state=function(){return u(h,{})}),v}t&&t.exports?t.exports=s:this.xor4096=s})(0,r)})),Q_=mi((function(r){(function(n,t,e){function a(l){var f=this,h="";f.next=function(){var v=f.b,m=f.c,y=f.d,x=f.a;return v=v<<25^v>>>7^m,m=m-y|0,y=y<<24^y>>>8^x,x=x-v|0,f.b=v=v<<20^v>>>12^m,f.c=m=m-y|0,f.d=y<<16^m>>>16^x,f.a=x-v|0},f.a=0,f.b=0,f.c=-1640531527,f.d=1367130551,l===Math.floor(l)?(f.a=l/4294967296|0,f.b=0|l):h+=l;for(var p=0;p<h.length+20;p++)f.b^=0|h.charCodeAt(p),f.next()}function u(l,f){return f.a=l.a,f.b=l.b,f.c=l.c,f.d=l.d,f}function s(l,f){var h=new a(l),p=f&&f.state,v=function(){return(h.next()>>>0)/4294967296};return v.double=function(){do var m=((h.next()>>>11)+(h.next()>>>0)/4294967296)/2097152;while(m===0);return m},v.int32=h.next,v.quick=v,p&&(typeof p=="object"&&u(p,h),v.state=function(){return u(h,{})}),v}t&&t.exports?t.exports=s:this.tychei=s})(0,r)})),si=mi((function(r){(function(n,t){var e,a=this,u=256,s=6,l="random",f=t.pow(u,s),h=t.pow(2,52),p=2*h,v=u-1;function m(E,R,A){var S=[],T=w((function B(I,F){var G,H=[],at=typeof I;if(F&&at=="object")for(G in I)try{H.push(B(I[G],F-1))}catch{}return H.length?H:at=="string"?I:I+"\0"})((R=R==1?{entropy:!0}:R||{}).entropy?[E,_(n)]:E??(function(){try{var B;return e&&(B=e.randomBytes)?B=B(u):(B=new Uint8Array(u),(a.crypto||a.msCrypto).getRandomValues(B)),_(B)}catch{var I=a.navigator,F=I&&I.plugins;return[+new Date,a,F,a.screen,_(n)]}})(),3),S),N=new y(S),O=function(){for(var B=N.g(s),I=f,F=0;B<h;)B=(B+F)*u,I*=u,F=N.g(1);for(;B>=p;)B/=2,I/=2,F>>>=1;return(B+F)/I};return O.int32=function(){return 0|N.g(4)},O.quick=function(){return N.g(4)/4294967296},O.double=O,w(_(N.S),n),(R.pass||A||function(B,I,F,G){return G&&(G.S&&x(G,N),B.state=function(){return x(N,{})}),F?(t[l]=B,I):B})(O,T,"global"in R?R.global:this==t,R.state)}function y(E){var R,A=E.length,S=this,T=0,N=S.i=S.j=0,O=S.S=[];for(A||(E=[A++]);T<u;)O[T]=T++;for(T=0;T<u;T++)O[T]=O[N=v&N+E[T%A]+(R=O[T])],O[N]=R;(S.g=function(B){for(var I,F=0,G=S.i,H=S.j,at=S.S;B--;)I=at[G=v&G+1],F=F*u+at[v&(at[G]=at[H=v&H+I])+(at[H]=I)];return S.i=G,S.j=H,F})(u)}function x(E,R){return R.i=E.i,R.j=E.j,R.S=E.S.slice(),R}function w(E,R){for(var A,S=E+"",T=0;T<S.length;)R[v&T]=v&(A^=19*R[v&T])+S.charCodeAt(T++);return _(R)}function _(E){return String.fromCharCode.apply(0,E)}if(t["seed"+l]=m,w(t.random(),n),r.exports){r.exports=m;try{e=require("crypto")}catch{}}})([],Math)}));si.alea=q_,si.xor128=j_,si.xorwow=X_,si.xorshift7=K_,si.xor4096=Y_,si.tychei=Q_;var Ql=si.alea,Bd=(function(){function r(n,t,e,a,u){this.mean=n,this.stdDev=t,this.dtype=e,this.nextVal=NaN,this.truncated=a,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var s=u||Math.random();this.random=Ql(s.toString())}return r.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var n=this.nextVal;return this.nextVal=NaN,n}for(var t,e,a=!1;!a;){var u=void 0,s=void 0,l=void 0;do l=(u=2*this.random()-1)*u+(s=2*this.random()-1)*s;while(l>=1||l===0);var f=Math.sqrt(-2*Math.log(l)/l);t=this.mean+this.stdDev*u*f,e=this.mean+this.stdDev*s*f,this.truncated&&!this.isValidTruncated(t)||(a=!0)}return this.truncated&&!this.isValidTruncated(e)||(this.nextVal=this.convertValue(e)),this.convertValue(t)},r.prototype.convertValue=function(n){return this.dtype==null||this.dtype==="float32"?n:Math.round(n)},r.prototype.isValidTruncated=function(n){return n<=this.upper&&n>=this.lower},r})(),Z_=(function(){function r(n,t,e,a){this.alpha=n,this.beta=1/t,this.dtype=e;var u=a||Math.random();this.randu=Ql(u.toString()),this.randn=new Bd(0,1,e,!1,this.randu()),this.d=n<1?n+2/3:n-1/3,this.c=1/Math.sqrt(9*this.d)}return r.prototype.nextValue=function(){for(var n,t,e,a,u,s;;){do a=this.randn.nextValue(),s=1+this.c*a;while(s<=0);if(s*=s*s,t=1-.331*(n=a*a)*n,e=.5*n+this.d*(1-s+Math.log(s)),(u=this.randu())<t||Math.log(u)<e)break}return s=1/this.beta*this.d*s,this.alpha<1&&(s*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(s)},r.prototype.convertValue=function(n){return this.dtype==="float32"?n:Math.round(n)},r})(),J_=(function(){function r(n,t,e,a){var u=this;if(n===void 0&&(n=0),t===void 0&&(t=1),this.canReturnFloat=function(){return u.dtype==null||u.dtype==="float32"},this.min=n,this.range=t-n,this.dtype=e,a==null&&(a=Math.random()),typeof a=="number"&&(a=a.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+n+" - "+t+" <= 1 and dtype is not float");this.random=Ql(a)}return r.prototype.convertValue=function(n){return this.canReturnFloat()?n:Math.round(n)},r.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},r})();function kt(r,n,t){return n===void 0&&(n="float32"),n=n||"float32",Zy(r),new Nu(r,n,t)}function $_(r,n){n===void 0&&(n=!1),console.log(r.toString(n))}var i1=P({batchToSpaceND_:function(r,n,t){var e=M(r,"x","batchToSpaceND"),a=n.reduce((function(u,s){return u*s}));return k(e.rank>=1+n.length,(function(){return"input rank is "+e.rank+" but should be > than blockShape.length "+n.length})),k(t.length===n.length,(function(){return"crops.length is "+t.length+" but should be equal to blockShape.length  "+n.length})),k(e.shape[0]%a==0,(function(){return"input tensor batch is "+e.shape[0]+" but is not divisible by the product of the elements of blockShape "+n.join(" * ")+" === "+a})),W.runKernelFunc((function(u){return u.batchToSpaceND(e,n,t)}),{$x:e},(function(u){return{$x:function(){return u.spaceToBatchND(n,t)}}}))}}),tE=P({broadcastTo_:function(r,n){var t=M(r,"broadcastTo","x"),e=t.shape;if(n.some((function(f){return!(f>0)||f%1!=0})))throw new Error("broadcastTo(): Invalid broadcast shape ["+n+"].");if(n.length<t.rank)throw new Error("broadcastTo(): shape.length="+n.length+" < input.rank="+t.rank+".");if(n.length>t.rank){for(var a=t.shape.slice();a.length<n.length;)a.unshift(1);t=t.reshape(a)}for(var u=Array.from(n),s=n.length-1;s>=0;s--)if(t.shape[s]===n[s])u[s]=1;else if(t.shape[s]!==1)throw new Error("broadcastTo(): ["+e+"] cannot be broadcast to ["+n+"].");var l=u.map((function(f,h){return f>1?h:-1})).filter((function(f){return f>=0}));return l.length===0?t.clone():W.runKernelFunc((function(f){return f.tile(t,u)}),{input:t},(function(f){return{input:function(){return f.sum(l,!0)}}}))}}),eE=P({cast_:function(r,n){var t=M(r,"x","cast");if(!Xw(n))throw new Error("Failed to cast to unknown dtype "+n);if(n==="string"&&t.dtype!=="string"||n!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");var e={dtype:n};return W.runKernelFunc((function(a){return a.cast(t,n)}),{x:t},(function(a){return{x:function(){return a.clone()}}}),"Cast",e)}}),nE=P({clone_:function(r){var n=M(r,"x","clone",null);return W.runKernelFunc((function(){return W.makeTensorFromDataId(n.dataId,n.shape,n.dtype)}),{$x:n},(function(t){return{$x:function(){return t.toFloat()}}}))}}),rE=P({cumsum_:function(r,n,t,e){n===void 0&&(n=0),t===void 0&&(t=!1),e===void 0&&(e=!1);var a=M(r,"x","cumsum"),u=Tr([n|=0],a.rank),s=a;u!=null&&(s=a.transpose(u));var l=Dr(1,a.rank)[0],f=W.runKernelFunc((function(h){return h.cumsum(s,l,t,e)}),{permutedX:s},(function(h){return{permutedX:function(){return h.cumsum(n,t,!e)}}}));return u!=null&&(f=f.transpose(u)),f}}),aE=P({depthToSpace_:function(r,n,t){t===void 0&&(t="NHWC");var e=M(r,"x","depthToSpace"),a=t==="NHWC"?e.shape[1]:e.shape[2],u=t==="NHWC"?e.shape[2]:e.shape[3],s=t==="NHWC"?e.shape[3]:e.shape[1];return k(a*n>=0,(function(){return`Negative dimension size caused by overflow when multiplying
      `+a+" and "+n+`  for depthToSpace with input shape
      `+e.shape})),k(u*n>=0,(function(){return`Negative dimension size caused by overflow when multiplying
      `+u+" and "+n+` for depthToSpace with input shape
          `+e.shape})),k(s%(n*n)==0,(function(){return"Dimension size must be evenly divisible by "+n*n+" but is "+s+" for depthToSpace with input shape "+e.shape})),W.runKernelFunc((function(l){return l.depthToSpace(e,n,t)}),{$x:e})}}),Qn=P({expandDims_:function(r,n){n===void 0&&(n=0);var t=M(r,"x","expandDims",null);k(n<=t.rank,(function(){return"Axis must be <= rank of the tensor"}));var e=t.shape.slice();return n<0&&(k(-(t.rank+1)<=n,(function(){return"Axis must be in the interval ["+-(t.rank+1)+", "+t.rank+"]"})),n=t.rank+n+1),e.splice(n,0,1),or(t,e)}}),o1=P({eye_:function(r,n,t,e){e===void 0&&(e="float32"),n==null&&(n=r);for(var a=kt([r,n],e),u=r<=n?r:n,s=0;s<u;++s)a.set(1,s,s);var l=a.toTensor().as2D(r,n);if(t==null)return l;if(t.length===1)return mo(Qn(l,0),[t[0],1,1]);if(t.length===2)return mo(Qn(Qn(l,0),0),[t[0],t[1],1,1]);if(t.length===3)return mo(Qn(Qn(Qn(l,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+t.length+"D.")}}),iE=P({multinomial_:function(r,n,t,e){e===void 0&&(e=!1);var a=M(r,"logits","multinomial"),u=a.size,s=a.rank;if(u<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+u+".");if(s>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+s);t=t||Math.random();var l=s===1?a.as2D(1,-1):a,f=W.runKernelFunc((function(h){return h.multinomial(l,e,n,t)}),{logits2D:l});return s===1?f.as1D():f}}),md=P({oneHot_:function(r,n,t,e){if(t===void 0&&(t=1),e===void 0&&(e=0),n<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+n);var a=M(r,"indices","oneHot","int32"),u=a.shape.concat([n]);return a=a.flatten(),W.runKernelFunc((function(s){return s.oneHot(a,n,t,e)}),{$indices:a},(function(s){return{$indices:function(){return he(a.shape,"float32")}}})).reshape(u)}}),gi=P({pad_:function(r,n,t){t===void 0&&(t=0);var e=M(r,"x","pad");if(e.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var a={paddings:n,constantValue:t};return W.runKernelFunc((function(u){return u.pad(e,n,t)}),{x:e},(function(u){var s=n.map((function(l){return l[0]}));return{x:function(){return u.slice(s,e.shape)}}}),"PadV2",a)}}),oE=P({pad1d_:function(r,n,t){return t===void 0&&(t=0),k(n.length===2,(function(){return"Invalid number of paddings. Must be length of 2."})),gi(r,[n],t)}}),uE=P({pad2d_:function(r,n,t){return t===void 0&&(t=0),k(n.length===2&&n[0].length===2&&n[1].length===2,(function(){return"Invalid number of paddings. Must be length of 2 each."})),gi(r,n,t)}}),sE=P({pad3d_:function(r,n,t){return t===void 0&&(t=0),k(n.length===3&&n[0].length===2&&n[1].length===2&&n[2].length===2,(function(){return"Invalid number of paddings. Must be length of 2 each."})),gi(r,n,t)}}),lE=P({pad4d_:function(r,n,t){return t===void 0&&(t=0),k(n.length===4&&n[0].length===2&&n[1].length===2&&n[2].length===2&&n[3].length===2,(function(){return"Invalid number of paddings. Must be length of 2 each."})),gi(r,n,t)}}),cE=P({rand_:function(r,n,t){var e=_t(r),a=null;if(t==null||t==="float32")a=new Float32Array(e);else if(t==="int32")a=new Int32Array(e);else{if(t!=="bool")throw new Error("Unknown data type "+t);a=new Uint8Array(e)}for(var u=0;u<e;u++)a[u]=n();return W.makeTensor(a,r,t)}}),fE=P({randomNormal_:function(r,n,t,e,a){if(n===void 0&&(n=0),t===void 0&&(t=1),e!=null&&e==="bool")throw new Error("Unsupported data type "+e);for(var u=new Bd(n,t,e,!1,a),s=kt(r,e),l=0;l<s.values.length;l++)s.values[l]=u.nextValue();return s.toTensor()}}),hE=P({randomGamma_:function(r,n,t,e,a){if(t===void 0&&(t=1),e===void 0&&(e="float32"),t==null&&(t=1),e==null&&(e="float32"),e!=="float32"&&e!=="int32")throw new Error("Unsupported data type "+e);for(var u=new Z_(n,t,e,a),s=kt(r,e),l=0;l<s.values.length;l++)s.values[l]=u.nextValue();return s.toTensor()}}),u1=P({randomUniform_:function(r,n,t,e,a){n===void 0&&(n=0),t===void 0&&(t=1),e===void 0&&(e="float32");for(var u=kt(r,e),s=new J_(n,t,null,a),l=0;l<u.values.length;l++)u.values[l]=s.nextValue();return u.toTensor()}}),or=P({reshape_:function(r,n){var t=M(r,"x","reshape",null);n=qw(n,t.size),k(t.size===_t(n),(function(){return"new shape and old shape must have the same number of elements."}));var e={shape:n};return W.runKernelFunc((function(a){return a.reshape(t,n)}),{x:t},(function(a){return{x:function(){return a.reshape(t.shape)}}}),"Reshape",e)}}),s1=P({spaceToBatchND_:function(r,n,t){var e=M(r,"x","spaceToBatchND");return k(e.rank>=1+n.length,(function(){return"input rank "+e.rank+" should be > than [blockShape] "+n.length})),k(t.length===n.length,(function(){return"paddings.shape[0] "+t.length+" must be equal to [blockShape] "+n.length})),k(e.shape.reduce((function(a,u,s){return s>0&&s<=n.length?a&&(u+t[s-1][0]+t[s-1][1])%n[s-1]==0:a}),!0),(function(){return"input spatial dimensions "+e.shape.slice(1)+" with paddings "+t.toString()+" must be divisible by blockShapes "+n.toString()})),W.runKernelFunc((function(a){return a.spaceToBatchND(e,n,t)}),{$x:e},(function(a){return{$x:function(){return a.batchToSpaceND(n,t)}}}))}}),l1=P({squeeze_:function(r,n){var t=M(r,"x","squeeze");return or(t,li(t.shape,n).newShape)}}),Fn=P({stack_:function(r,n){n===void 0&&(n=0);var t=kl(r,"tensors","stack");if(k(t.length>=1,(function(){return"Pass at least one tensor to tf.stack"})),t.length===1)return t[0].expandDims(n);var e=t[0].rank,a=t[0].shape,u=t[0].dtype;k(n<=e,(function(){return"Axis must be <= rank of the tensor"})),t.forEach((function(l){$t(a,l.shape,"All tensors passed to stack must have matching shapes")})),t.forEach((function(l){k(u===l.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var s=t.map((function(l){return l.expandDims(n)}));return Oe(s,n)}}),mo=P({tile_:function(r,n){var t=M(r,"x","tile",null);k(t.rank===n.length,(function(){return"Error in transpose: rank of input "+t.rank+" must match length of reps "+n+"."}));var e=[t],a={reps:n};return W.runKernelFunc((function(u,s){var l=u.tile(t,n);return s([t]),l}),{x:t},(function(u,s){var l=s[0];return{x:function(){var f=jt(l);if(l.rank===1)for(var h=0;h<n[0];++h)f=f.add(u.slice([h*l.shape[0]],[l.shape[0]]));else if(l.rank===2)for(h=0;h<n[0];++h)for(var p=0;p<n[1];++p)f=f.add(u.slice([h*l.shape[0],p*l.shape[1]],[l.shape[0],l.shape[1]]));else if(l.rank===3)for(h=0;h<n[0];++h)for(p=0;p<n[1];++p)for(var v=0;v<n[2];++v)f=f.add(u.slice([h*l.shape[0],p*l.shape[1],v*l.shape[2]],[l.shape[0],l.shape[1],l.shape[2]]));else{if(l.rank!==4)throw new Error("Gradient for tile operation is not implemented for rank-"+l.rank+" tensors yet.");for(h=0;h<n[0];++h)for(p=0;p<n[1];++p)for(v=0;v<n[2];++v)for(var m=0;m<n[3];++m)f=f.add(u.slice([h*l.shape[0],p*l.shape[1],v*l.shape[2],m*l.shape[3]],[l.shape[0],l.shape[1],l.shape[2],l.shape[3]]))}return f}}}),"Tile",a,e)}}),dE=P({truncatedNormal_:function(r,n,t,e,a){if(n===void 0&&(n=0),t===void 0&&(t=1),e!=null&&e==="bool")throw new Error("Unsupported data type "+e);for(var u=new Bd(n,t,e,!0,a),s=kt(r,e),l=0;l<s.values.length;l++)s.values[l]=u.nextValue();return s.toTensor()}}),ke=P({unstack_:function(r,n){n===void 0&&(n=0),n=n||0;var t=M(r,"x","unstack");k(n>=-t.shape.length&&n<t.shape.length,(function(){return"Axis = "+n+" is not in [-"+t.shape.length+", "+t.shape.length+")"})),n<0&&(n+=t.shape.length);var e={axis:n};return W.runKernelFunc((function(a){return a.unstack(t,n)}),{x:t},(function(a){return{x:function(){return Fn(a,n)}}}),"Unpack",e)}}),pE=function(r,n){return bt(this,void 0,void 0,(function(){var t,e,a,u,s,l,f,h,p,v;return xt(this,(function(m){switch(m.label){case 0:return t=M(r,"x","setdiff1d"),e=M(n,"y","setdiff1d"),k(t.dtype===e.dtype,(function(){return"x and y should have the same dtype, but got x ("+t.dtype+") and y ("+e.dtype+")."})),k(t.rank===1,(function(){return"x should be 1D tensor, but got x ("+t.shape+")."})),k(e.rank===1,(function(){return"y should be 1D tensor, but got y ("+e.shape+")."})),[4,t.data()];case 1:return a=m.sent(),[4,e.data()];case 2:for(u=m.sent(),s=new Set(u),l=0,p=0;p<a.length;p++)s.has(a[p])||l++;for(f=new Nu([l],t.dtype),h=new Nu([l],"int32"),p=0,v=0;p<a.length;p++)s.has(a[p])||(f.values[v]=a[p],h.values[v]=p,v++);return[2,[f.toTensor(),h.toTensor()]]}}))}))};function Bl(r,n,t,e){e===void 0&&(e=!0);var a=[];if(e)(a=a.concat(n.slice(0))).push(r[0]/t),a=a.concat(r.slice(1));else{a=a.concat(r[0]);for(var u=n.length,s=0;s<u;++s)a=a.concat([r[s+1]/n[s],n[s]]);a=a.concat(r.slice(u+1))}return a}function Fl(r,n,t){t===void 0&&(t=!0);var e=[];if(t){e.push(n);for(var a=n+1;a<r;++a)a<=2*n?(e.push(a),e.push(a-(n+1))):e.push(a)}else{var u=[],s=[];for(a=1;a<r;++a)a>=2*n+1||a%2==1?s.push(a):u.push(a);e.push.apply(e,u),e.push(0),e.push.apply(e,s)}return e}function zl(r,n,t,e){e===void 0&&(e=!0);var a=[];e?a.push(r[0]/t):a.push(r[0]*t);for(var u=1;u<r.length;++u)u<=n.length?e?a.push(n[u-1]*r[u]):a.push(r[u]/n[u-1]):a.push(r[u]);return a}function c1(r,n){for(var t=[0],e=0;e<n;++e)t.push(r[e][0]);return t}function f1(r,n,t){for(var e=r.slice(0,1),a=0;a<t;++a)e.push(r[a+1]-n[a][0]-n[a][1]);return e}function h1(r,n){if(r.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+r.rank+".");if(n.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+n.rank+".");if(n.dtype!=="int32")throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+n.dtype+".");if(n.shape[n.rank-1]>r.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+n.shape[n.rank-1]+" vs. "+r.rank);if(r.size===0)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+r.shape+".");for(var t=n.shape,e=t[t.length-1],a=1,u=0;u<t.length-1;++u)a*=t[u];var s=r.shape,l=t.slice();l.pop();var f=1;for(u=e;u<r.rank;++u)f*=s[u],l.push(s[u]);var h=Er(r.shape).map((function(p){return p/f})).concat([1]).slice(0,e);return[l,a,f,h]}var d1=30;function Vh(r){return r<=d1?r:cd(r,Math.floor(Math.sqrt(r)))}function vE(r,n,t){var e=n.rank>1?n.shape[n.rank-1]:1,a=n.rank>1?n.rank-1:1,u="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+t.shape+", indices.shape: "+n.shape+", shape: "+r+", sliceDim: "+e+", and batchDim: "+a+".";if(t.rank<a)throw new Error(u+" update.rank < "+a+". ");if(r.length<e+(t.rank-a))throw new Error(u+" Output shape length < "+(e+(t.rank-a)));if(t.rank!==a+r.length-e)throw new Error(u+" update.rank != "+(a+r.length-e));for(var s=0;s<a;++s)if(t.shape[s]!==n.shape[s])throw new Error(u+" updates.shape["+s+"] ("+t.shape[s]+") != indices.shape["+s+"] ("+n.shape[s]+").");for(s=0;s<t.rank-a;++s)if(t.shape[s+a]!==r[s+e])throw new Error(u+" updates.shape["+(s+a)+"] ("+t.shape[s+a]+") != shape["+(s+a)+"] ("+r[s+a]+")")}function mE(r,n,t){if(n.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+n.rank+".");if(r.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+r.rank+".");if(n.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: "+n.dtype);if(t.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+t);if(t.length===0){if(n.size===0)throw new Error("Indices specified for empty output. indices shape: "+n.shape);if(r.size===0)throw new Error("Updates specified for empty output. updates shape: "+r.shape)}vE(t,n,r)}function Ll(r,n,t){for(var e=n.shape.length,a=e>1?n.shape[e-1]:1,u=t.length,s=1,l=a;l<u;++l)s*=t[l];var f=a<1?1:a;return{sliceRank:a,numUpdates:_t(n.shape)/f,sliceSize:s,strides:Er(t.slice(0,a)).concat([1]),outputSize:_t(t)}}function gE(r,n,t){k(r.rank===n.length,(function(){return"Error in slice"+r.rank+"D: Length of begin "+n+" must match the rank of the array ("+r.rank+")."})),k(r.rank===t.length,(function(){return"Error in slice"+r.rank+"D: Length of size "+t+" must match the rank of the array ("+r.rank+")."}));for(var e=function(u){k(n[u]+t[u]<=r.shape[u],(function(){return"Error in slice"+r.rank+"D: begin["+u+"] + size["+u+"] ("+(n[u]+t[u])+") would overflow input.shape["+u+"] ("+r.shape[u]+")"}))},a=0;a<r.rank;++a)e(a)}function $0(r){for(var n=[],t=0;r>0;)1&r&&n.push(t),r/=2,t++;return n}function Fd(r,n,t){for(var e=[],a=0;a<r.length;a++)e[a]=Math.ceil((n[a]-r[a])/t[a]);return e}function yE(r,n,t,e,a){var u=n[a],s=t[a]||1;(r&1<<a||u==null)&&(u=s>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var l=e[a];return u<0&&(u+=l),u=ud(0,u,l-1)}function bE(r,n,t,e,a){var u=n[a],s=t[a]||1;(r&1<<a||u==null)&&(u=s>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var l=e[a];return u<0&&(u+=l),u=s>0?ud(0,u,l):ud(-1,u,l-1)}function p1(r,n,t){for(var e=t.length,a=0;a<t.length;a++)if(t[a]>1){e=a;break}for(a=e+1;a<t.length;a++)if(n[a]>0||t[a]!==r[a])return!1;return!0}function v1(r,n){for(var t=r.length>0?r[r.length-1]:1,e=0;e<r.length-1;e++)t+=r[e]*n[e];return t}function xE(r,n){k(ld(r),(function(){return"The f passed in variableGrads(f) must be a function"})),k(n==null||Array.isArray(n)&&n.every((function(p){return p instanceof Eo})),(function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"}));var t=n!=null;if(!t)for(var e in n=[],W.registeredVariables)n.push(W.registeredVariables[e]);var a=t?n.filter((function(p){return!p.trainable})):null,u=n.length;k((n=n.filter((function(p){return p.trainable}))).length>0,(function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+u+" variables is trainable."}));var s=W.gradients(r,n,null,!0),l=s.value,f=s.grads;k(f.some((function(p){return p!=null})),(function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."})),k(l.rank===0,(function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+l.rank+" tensor"}));var h={};return n.forEach((function(p,v){f[v]!=null&&(h[p.name]=f[v])})),a?.forEach((function(p){return h[p.name]=null})),{value:l,grads:h}}function Zl(r){return W.customGrad(r)}var ea=P({softmax_:function(r,n){n===void 0&&(n=-1);var t=M(r,"logits","softmax","float32");if(n===-1&&(n=t.rank-1),n!==t.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+t.rank+" and dim was "+n);return W.runKernelFunc((function(e,a){var u=e.softmax(t,n);return a([u]),u}),{logits:t},(function(e,a){var u=a[0],s=e.mul(u);return{logits:function(){return s.sub(s.sum([n],!0).mul(u))}}}),"Softmax",{dim:n},[],[!0])}}),wE=P({logSoftmax_:function(r,n){n===void 0&&(n=-1);var t=M(r,"logits","logSoftmax");if(n===-1&&(n=t.rank-1),n!==t.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+t.rank+" and axis was "+n);return Zl((function(e,a){var u=e.max(n,!0),s=e.sub(u),l=s.toFloat().sub(s.exp().sum(n,!0).log());return a([l]),{value:l,gradFunc:function(f,h){var p=h[0].exp();return f.sub(f.sum(n,!0).mul(p))}}}))(t)}}),m1=(function(){function r(n,t){this.backend=n,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}return r.prototype.get=function(n){return this.data.has(n)||this.dataMover.moveData(this.backend,n),this.data.get(n)},r.prototype.set=function(n,t){this.dataIdsCount++,this.data.set(n,t)},r.prototype.has=function(n){return this.data.has(n)},r.prototype.delete=function(n){return this.dataIdsCount--,this.data.delete(n)},r.prototype.numDataIds=function(){return this.dataIdsCount},r})(),g1=(function(){function r(){}return r.prototype.time=function(n){return J("time")},r.prototype.read=function(n){return J("read")},r.prototype.readSync=function(n){return J("readSync")},r.prototype.numDataIds=function(){return J("numDataIds")},r.prototype.disposeData=function(n){return J("disposeData")},r.prototype.write=function(n,t,e){return J("write")},r.prototype.move=function(n,t,e,a){return J("move")},r.prototype.memory=function(){return J("memory")},r.prototype.floatPrecision=function(){return J("floatPrecision")},r.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},r.prototype.batchMatMul=function(n,t,e,a){return J("batchMatMul")},r.prototype.fusedBatchMatMul=function(n){return n.a,n.b,n.transposeA,n.transposeB,n.bias,n.activation,n.preluActivationWeights,J("fusedBatchMatMul")},r.prototype.slice=function(n,t,e){return J("slice")},r.prototype.stridedSlice=function(n,t,e,a){return J("stridedSlice")},r.prototype.unstack=function(n,t){return J("unstack")},r.prototype.reverse=function(n,t){return J("reverse")},r.prototype.concat=function(n,t){return J("concat")},r.prototype.neg=function(n){return J("neg")},r.prototype.add=function(n,t){return J("add")},r.prototype.addN=function(n){return J("addN")},r.prototype.subtract=function(n,t){return J("subtract")},r.prototype.multiply=function(n,t){return J("multiply")},r.prototype.realDivide=function(n,t){return J("realDivide")},r.prototype.floorDiv=function(n,t){return J("floorDiv")},r.prototype.sum=function(n,t){return J("sum")},r.prototype.prod=function(n,t){return J("prod")},r.prototype.unsortedSegmentSum=function(n,t,e){return J("unsortedSegmentSum")},r.prototype.argMin=function(n,t){return J("argMin")},r.prototype.argMax=function(n,t){return J("argMax")},r.prototype.equal=function(n,t){return J("equal")},r.prototype.notEqual=function(n,t){return J("notEqual")},r.prototype.less=function(n,t){return J("less")},r.prototype.lessEqual=function(n,t){return J("lessEqual")},r.prototype.greater=function(n,t){return J("greater")},r.prototype.greaterEqual=function(n,t){return J("greaterEqual")},r.prototype.logicalNot=function(n){return J("logicalNot")},r.prototype.logicalAnd=function(n,t){return J("logicalAnd")},r.prototype.logicalOr=function(n,t){return J("logicalOr")},r.prototype.where=function(n){return J("where")},r.prototype.select=function(n,t,e){return J("select")},r.prototype.topk=function(n,t,e){return J("topk")},r.prototype.min=function(n,t){return J("min")},r.prototype.minimum=function(n,t){return J("minimum")},r.prototype.mod=function(n,t){return J("mod")},r.prototype.max=function(n,t){return J("max")},r.prototype.maximum=function(n,t){return J("maximum")},r.prototype.all=function(n,t){return J("all")},r.prototype.any=function(n,t){return J("any")},r.prototype.squaredDifference=function(n,t){return J("squaredDifference")},r.prototype.ceil=function(n){return J("ceil")},r.prototype.floor=function(n){return J("floor")},r.prototype.round=function(n){return J("round")},r.prototype.sign=function(n){return J("sign")},r.prototype.isNaN=function(n){return J("isNaN")},r.prototype.isInf=function(n){return J("isInf")},r.prototype.isFinite=function(n){return J("isFinite")},r.prototype.pow=function(n,t){return J("pow")},r.prototype.exp=function(n){return J("exp")},r.prototype.expm1=function(n){return J("expm1")},r.prototype.softmax=function(n,t){return J("softmax")},r.prototype.log=function(n){return J("log")},r.prototype.log1p=function(n){return J("log1p")},r.prototype.sqrt=function(n){return J("sqrt")},r.prototype.rsqrt=function(n){return J("rsqrt")},r.prototype.square=function(n){return J("square")},r.prototype.reciprocal=function(n){return J("reciprocal")},r.prototype.relu=function(n){return J("relu")},r.prototype.relu6=function(n){return J("relu6")},r.prototype.prelu=function(n,t){return J("prelu")},r.prototype.elu=function(n){return J("elu")},r.prototype.eluDer=function(n,t){return J("eluDer")},r.prototype.selu=function(n){return J("selu")},r.prototype.int=function(n){return J("int")},r.prototype.clip=function(n,t,e){return J("clip")},r.prototype.abs=function(n){return J("abs")},r.prototype.complexAbs=function(n){return J("complexAbs")},r.prototype.sigmoid=function(n){return J("sigmoid")},r.prototype.softplus=function(n){return J("softplus")},r.prototype.sin=function(n){return J("sin")},r.prototype.cos=function(n){return J("cos")},r.prototype.tan=function(n){return J("tan")},r.prototype.asin=function(n){return J("asin")},r.prototype.acos=function(n){return J("acos")},r.prototype.atan=function(n){return J("atan")},r.prototype.atan2=function(n,t){return J("atan2")},r.prototype.sinh=function(n){return J("sinh")},r.prototype.cosh=function(n){return J("cosh")},r.prototype.tanh=function(n){return J("tanh")},r.prototype.asinh=function(n){return J("asinh")},r.prototype.acosh=function(n){return J("acosh")},r.prototype.atanh=function(n){return J("atanh")},r.prototype.erf=function(n){return J("erf")},r.prototype.step=function(n,t){return J("step")},r.prototype.fusedConv2d=function(n){return n.input,n.filter,n.convInfo,n.bias,n.activation,n.preluActivationWeights,J("fusedConv2d")},r.prototype.conv2d=function(n,t,e){return J("conv2d")},r.prototype.conv2dDerInput=function(n,t,e){return J("conv2dDerInput")},r.prototype.conv2dDerFilter=function(n,t,e){return J("conv2dDerFilter")},r.prototype.fusedDepthwiseConv2D=function(n){return n.input,n.filter,n.convInfo,n.bias,n.activation,n.preluActivationWeights,J("fusedDepthwiseConv2D")},r.prototype.depthwiseConv2D=function(n,t,e){return J("depthwiseConv2D")},r.prototype.depthwiseConv2DDerInput=function(n,t,e){return J("depthwiseConv2DDerInput")},r.prototype.depthwiseConv2DDerFilter=function(n,t,e){return J("depthwiseConv2DDerFilter")},r.prototype.conv3d=function(n,t,e){return J("conv3d")},r.prototype.conv3dDerInput=function(n,t,e){return J("conv3dDerInput")},r.prototype.conv3dDerFilter=function(n,t,e){return J("conv3dDerFilter")},r.prototype.maxPool=function(n,t){return J("maxPool")},r.prototype.maxPoolBackprop=function(n,t,e,a){return J("maxPoolBackprop")},r.prototype.avgPool=function(n,t){return J("avgPool")},r.prototype.avgPoolBackprop=function(n,t,e){return J("avgPoolBackprop")},r.prototype.avgPool3d=function(n,t){return J("avgPool3d")},r.prototype.avgPool3dBackprop=function(n,t,e){return J("avgPool3dBackprop")},r.prototype.maxPool3d=function(n,t){return J("maxPool3d")},r.prototype.maxPool3dBackprop=function(n,t,e,a){return J("maxPool3dBackprop")},r.prototype.reshape=function(n,t){return J("reshape")},r.prototype.cast=function(n,t){return J("cast")},r.prototype.tile=function(n,t){return J("tile")},r.prototype.pad=function(n,t,e){return J("pad")},r.prototype.transpose=function(n,t){return J("transpose")},r.prototype.gather=function(n,t,e){return J("gather")},r.prototype.gatherND=function(n,t){return J("gatherND")},r.prototype.scatterND=function(n,t,e){return J("scatterND")},r.prototype.batchToSpaceND=function(n,t,e){return J("batchToSpaceND")},r.prototype.spaceToBatchND=function(n,t,e){return J("spaceToBatchND")},r.prototype.resizeBilinear=function(n,t,e,a){return J("resizeBilinear")},r.prototype.resizeBilinearBackprop=function(n,t,e){return J("resizeBilinearBackprop")},r.prototype.resizeNearestNeighbor=function(n,t,e,a){return J("resizeNearestNeighbor")},r.prototype.resizeNearestNeighborBackprop=function(n,t,e){return J("resizeNearestNeighborBackprop")},r.prototype.batchNormalization=function(n,t,e,a,u,s){return J("batchNormalization")},r.prototype.localResponseNormalization4D=function(n,t,e,a,u){return J("localResponseNormalization4D")},r.prototype.LRNGrad=function(n,t,e,a,u,s,l){return J("LRNGrad")},r.prototype.multinomial=function(n,t,e,a){return J("multinomial")},r.prototype.oneHot=function(n,t,e,a){return J("oneHot")},r.prototype.cumsum=function(n,t,e,a){return J("cumsum")},r.prototype.nonMaxSuppression=function(n,t,e,a,u){return J("nonMaxSuppression")},r.prototype.fft=function(n){return J("fft")},r.prototype.ifft=function(n){return J("ifft")},r.prototype.complex=function(n,t){return J("complex")},r.prototype.real=function(n){return J("real")},r.prototype.imag=function(n){return J("imag")},r.prototype.cropAndResize=function(n,t,e,a,u,s){return J("cropAndResize")},r.prototype.depthToSpace=function(n,t,e){return J("depthToSpace")},r.prototype.split=function(n,t,e){return J("split")},r.prototype.sparseToDense=function(n,t,e,a){return J("sparseToDense")},r.prototype.diag=function(n){return J("diag")},r.prototype.fill=function(n,t,e){return J("fill")},r.prototype.onesLike=function(n){return J("onesLike")},r.prototype.zerosLike=function(n){return J("zerosLike")},r.prototype.linspace=function(n,t,e){return J("linspace")},r.prototype.dispose=function(){return J("dispose")},r})();function J(r){throw new Error("'"+r+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function Oa(r,n){for(var t=r.length,e=[],a=0;a<t;a++){var u=t-1-a,s=r[u]||1;(n[n.length-1-a]||1)>1&&s===1&&e.unshift(u)}return e}function Ie(r,n){for(var t=[],e=0;e<n.length;e++){var a=r[r.length-e-1],u=n.length-e-1,s=n[u];(a==null||a===1&&s>1)&&t.unshift(u)}return t}function Ht(r,n){for(var t=[],e=Math.max(r.length,n.length),a=0;a<e;a++){var u=r[r.length-a-1];u==null&&(u=1);var s=n[n.length-a-1];if(s==null&&(s=1),u===1)t.unshift(s);else if(s===1)t.unshift(u);else{if(u!==s)throw Error("Operands could not be broadcast together with shapes "+r+" and "+n+".");t.unshift(u)}}return t}function Ou(r,n,t,e,a,u,s){s===void 0&&(s="channelsLast");var l,f=Hl(n),h=f[0],p=f[1];if(s==="channelsLast")l=[h,p,r[3],r[3]];else{if(s!=="channelsFirst")throw new Error("Unknown dataFormat "+s);l=[h,p,r[1],r[1]]}return yi(r,l,t,e,a,u,!1,s)}function Ul(r,n,t,e,a,u,s){s===void 0&&(s="NDHWC");var l,f,h=gd(n),p=h[0],v=h[1],m=h[2];if(s==="NDHWC")f="channelsLast",l=[p,v,m,r[4],r[4]];else{if(s!=="NCDHW")throw new Error("Unknown dataFormat "+s);f="channelsFirst",l=[p,v,m,r[1],r[1]]}return Pl(r,l,t,e,a,!1,f,u)}function yi(r,n,t,e,a,u,s,l){s===void 0&&(s=!1),l===void 0&&(l="channelsLast");var f=[-1,-1,-1,-1],h=f[0],p=f[1],v=f[2],m=f[3];if(l==="channelsLast")h=r[0],p=r[1],v=r[2],m=r[3];else{if(l!=="channelsFirst")throw new Error("Unknown dataFormat "+l);h=r[0],m=r[1],p=r[2],v=r[3]}var y,x=n[0],w=n[1],_=n[3],E=Hl(t),R=E[0],A=E[1],S=Hl(e),T=S[0],N=S[1],O=go(x,T),B=go(w,N),I=(function(et,nt,L,q,K,rt,ot,z){var X,it,ht;if(typeof et=="number"){X={top:et,bottom:et,left:et,right:et,type:et===0?"VALID":"NUMBER"};var dt=(function(zt,Xt,qt,Jt,oe){Jt==null&&(Jt=y1(zt,Xt,qt));var ue=zt[0],Ln=zt[1],wn=Au((ue-Xt+2*Jt)/qt+1,oe);k(_e(wn),(function(){return"The output # of rows ("+wn+") must be an integer. Change the stride and/or zero pad parameters"}));var Ve=Au((Ln-Xt+2*Jt)/qt+1,oe);return k(_e(Ve),(function(){return"The output # of columns ("+Ve+") must be an integer. Change the stride and/or zero pad parameters"})),[wn,Ve]})([nt,L],rt,q,et,z);it=dt[0],ht=dt[1]}else if(et==="same"){it=Math.ceil(nt/q),ht=Math.ceil(L/K);var vt=Math.max(0,(it-1)*q+rt-nt),gt=Math.max(0,(ht-1)*K+ot-L),Tt=Math.floor(vt/2),Rt=vt-Tt,ie=Math.floor(gt/2);X={top:Tt,bottom:Rt,left:ie,right:gt-ie,type:"SAME"}}else{if(et!=="valid")throw Error("Unknown padding parameter: "+et);X={top:0,bottom:0,left:0,right:0,type:"VALID"},it=Math.ceil((nt-rt+1)/q),ht=Math.ceil((L-ot+1)/K)}return{padInfo:X,outHeight:it,outWidth:ht}})(a,p,v,R,A,O,B,u),F=I.padInfo,G=I.outHeight,H=I.outWidth,at=s?_*m:_;return l==="channelsFirst"?y=[h,at,G,H]:l==="channelsLast"&&(y=[h,G,H,at]),{batchSize:h,dataFormat:l,inHeight:p,inWidth:v,inChannels:m,outHeight:G,outWidth:H,outChannels:at,padInfo:F,strideHeight:R,strideWidth:A,filterHeight:x,filterWidth:w,effectiveFilterHeight:O,effectiveFilterWidth:B,dilationHeight:T,dilationWidth:N,inShape:r,outShape:y,filterShape:n}}function Pl(r,n,t,e,a,u,s,l){u===void 0&&(u=!1),s===void 0&&(s="channelsLast");var f=[-1,-1,-1,-1,-1],h=f[0],p=f[1],v=f[2],m=f[3],y=f[4];if(s==="channelsLast")h=r[0],p=r[1],v=r[2],m=r[3],y=r[4];else{if(s!=="channelsFirst")throw new Error("Unknown dataFormat "+s);h=r[0],y=r[1],p=r[2],v=r[3],m=r[4]}var x,w=n[0],_=n[1],E=n[2],R=n[4],A=gd(t),S=A[0],T=A[1],N=A[2],O=gd(e),B=O[0],I=O[1],F=O[2],G=go(w,B),H=go(_,I),at=go(E,F),et=(function(ot,z,X,it,ht,dt,vt,gt,Tt,Rt,ie){var zt,Xt,qt,Jt;if(typeof ot=="number"){zt={top:ot,bottom:ot,left:ot,right:ot,front:ot,back:ot,type:ot===0?"VALID":"NUMBER"};var oe=(function(Ee,er,wi,Nr,un,To){un==null&&(un=y1(Ee,er,Nr));var Yu=Ee[0],hc=Ee[1],dc=Ee[2],Mr=Au((Yu-er+2*un)/Nr+1,To);k(_e(Mr),(function(){return"The output # of depths ("+Mr+") must be an integer. Change the stride and/or zero pad parameters"}));var Ge=Au((hc-er+2*un)/Nr+1,To);k(_e(Ge),(function(){return"The output # of rows ("+Ge+") must be an integer. Change the stride and/or zero pad parameters"}));var Un=Au((dc-er+2*un)/Nr+1,To);return k(_e(Un),(function(){return"The output # of columns ("+Un+") must be an integer. Change the stride and/or zero pad parameters"})),[Mr,Ge,Un,wi]})([z,X,it,1],gt,1,ht,ot,ie);Xt=oe[0],qt=oe[1],Jt=oe[2]}else if(ot==="same"){Xt=Math.ceil(z/ht),qt=Math.ceil(X/dt),Jt=Math.ceil(it/vt);var ue=(Xt-1)*ht+gt-z,Ln=(qt-1)*dt+Tt-X,wn=(Jt-1)*vt+Rt-it,Ve=Math.floor(ue/2),cr=ue-Ve,_n=Math.floor(Ln/2),fr=Ln-_n,tr=Math.floor(wn/2);zt={top:_n,bottom:fr,left:tr,right:wn-tr,front:Ve,back:cr,type:"SAME"}}else{if(ot!=="valid")throw Error("Unknown padding parameter: "+ot);zt={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},Xt=Math.ceil((z-gt+1)/ht),qt=Math.ceil((X-Tt+1)/dt),Jt=Math.ceil((it-Rt+1)/vt)}return{padInfo:zt,outDepth:Xt,outHeight:qt,outWidth:Jt}})(a,p,v,m,S,T,N,G,H,at,l),nt=et.padInfo,L=et.outDepth,q=et.outHeight,K=et.outWidth,rt=u?R*y:R;return s==="channelsFirst"?x=[h,rt,L,q,K]:s==="channelsLast"&&(x=[h,L,q,K,rt]),{batchSize:h,dataFormat:s,inDepth:p,inHeight:v,inWidth:m,inChannels:y,outDepth:L,outHeight:q,outWidth:K,outChannels:rt,padInfo:nt,strideDepth:S,strideHeight:T,strideWidth:N,filterDepth:w,filterHeight:_,filterWidth:E,effectiveFilterDepth:G,effectiveFilterHeight:H,effectiveFilterWidth:at,dilationDepth:B,dilationHeight:I,dilationWidth:F,inShape:r,outShape:x,filterShape:n}}function y1(r,n,t,e){e===void 0&&(e=1);var a=go(n,e);return Math.floor((r[0]*(t-1)-t+a)/2)}function Hl(r){return typeof r=="number"?[r,r,r]:r.length===2?[r[0],r[1],1]:r}function gd(r){return typeof r=="number"?[r,r,r]:r}function go(r,n){return n<=1?r:r+(r-1)*(n-1)}function Au(r,n){if(!n)return r;switch(n){case"round":return Math.round(r);case"ceil":return Math.ceil(r);case"floor":return Math.floor(r);default:throw new Error("Unknown roundingMode "+n)}}function So(r){var n=Hl(r),t=n[0],e=n[1],a=n[2];return t===1&&e===1&&a===1}function xn(r,n){return So(r)||So(n)}function zd(r){if(r==="NHWC")return"channelsLast";if(r==="NCHW")return"channelsFirst";throw new Error("Unknown dataFormat "+r)}function b1(r,n,t){if(n==="complex64"){if(r.dtype==="complex64")return r.clone();var e=he(r.shape),a=r.toFloat(),u=t.complex(a,e);return e.dispose(),a.dispose(),u}if(!Kw(r.dtype,n))return W.makeTensorFromDataId(r.dataId,r.shape,n);if(r.dtype==="complex64"){var s=t.real(r);return u=s.cast(n),s.dispose(),u}if(n==="int32")return t.int(r);if(n==="bool"){var l=pt(0,r.dtype);return u=t.notEqual(r,l),l.dispose(),u}throw new Error("Error in Cast: failed to cast "+r.dtype+" to "+n)}function yd(r,n){return W.makeTensorFromDataId(r.dataId,n,r.dtype)}function x1(r,n,t){var e=(n-r)/(t-1),a=Pu(t,"float32");a[0]=r;for(var u=1;u<a.length;u++)a[u]=a[u-1]+e;return Te(a,"float32")}function bd(r,n){if(r.length!==n.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+r.length+", imag: "+n.length+".");for(var t=new Float32Array(2*r.length),e=0;e<t.length;e+=2)t[e]=r[e/2],t[e+1]=n[e/2];return t}function ty(r,n){return{real:r[2*n],imag:r[2*n+1]}}function _E(r,n,t,e){r[2*e]=n,r[2*e+1]=t}function EE(r,n,t){var e=(t?2:-2)*Math.PI*(r/n);return{real:Math.cos(e),imag:Math.sin(e)}}function CE(r,n,t){var e=(function(u,s,l){return(function(f,h,p){for(var v=0,m=f.length,y=0,x=!1;v<m;){var w=p(h,f[y=v+(m-v>>>1)]);w>0?v=y+1:(m=y,x=!w)}return x?v:-v-1})(u,s,l||SE)})(r,n,t),a=e<0?-(e+1):e;r.splice(a,0,n)}function SE(r,n){return r>n?1:r<n?-1:0}function Ld(r,n,t,e,a){return w1(r,n,t,e,a,0).selectedIndices}function Ud(r,n,t,e,a,u){var s=w1(r,n,t,e,a,u);return s.numValidOutputs.dispose(),{selectedIndices:s.selectedIndices,selectedScores:s.selectedScores}}function w1(r,n,t,e,a,u,s,l){l===void 0&&(l=!1);for(var f=Array.from(n).map((function(S,T){return{score:S,boxIndex:T,suppressBeginIndex:0}})).filter((function(S){return S.score>a})).sort(ey),h=u>0?-.5/u:0,p=[],v=[];p.length<t&&f.length>0;){var m=f.pop(),y=m.score,x=m.boxIndex,w=m.suppressBeginIndex;if(y<a)break;for(var _=!1,E=p.length-1;E>=w;--E){var R=RE(r,x,p[E]);if(R>=e){_=!0;break}if(m.score=m.score*AE(e,h,R),m.score<=a)break}m.suppressBeginIndex=p.length,_||(m.score===y?(p.push(x),v.push(m.score)):m.score>a&&CE(f,m,ey))}var A=p.length;return l&&(p.fill(0,A),v.fill(0,A)),{selectedIndices:Te(p,"int32"),selectedScores:Te(v,"float32"),numValidOutputs:pt(A,"int32")}}function RE(r,n,t){var e=r.subarray(4*n,4*n+4),a=r.subarray(4*t,4*t+4),u=Math.min(e[0],e[2]),s=Math.min(e[1],e[3]),l=Math.max(e[0],e[2]),f=Math.max(e[1],e[3]),h=Math.min(a[0],a[2]),p=Math.min(a[1],a[3]),v=Math.max(a[0],a[2]),m=Math.max(a[1],a[3]),y=(l-u)*(f-s),x=(v-h)*(m-p);if(y<=0||x<=0)return 0;var w=Math.max(u,h),_=Math.max(s,p),E=Math.min(l,v),R=Math.min(f,m),A=Math.max(E-w,0)*Math.max(R-_,0);return A/(y+x-A)}function AE(r,n,t){var e=Math.exp(n*t*t);return t<=r?e:0}function ey(r,n){return r.score-n.score||r.score===n.score&&n.boxIndex-r.boxIndex}function _1(r,n,t){var e=new Array(r.rank).fill(0),a=r.shape.slice();return n.map((function(u){a[t]=u;var s=r.slice(e,a);return e[t]+=u,s}))}function E1(r,n){for(var t=new Array(r.rank),e=0;e<t.length;e++)t[e]=r.shape[e]*n[e];var a=kt(t,r.dtype);for(e=0;e<a.values.length;++e){for(var u=a.indexToLoc(e),s=new Array(r.rank),l=0;l<s.length;l++)s[l]=u[l]%r.shape[l];var f=r.locToIndex(s);a.values[e]=r.values[f]}return a.toTensor()}function C1(r,n,t,e,a){for(var u=n[n.length-1],s=[r.length/u,u],l=s[0],f=s[1],h=Du(t,l*e),p=Du("int32",l*e),v=0;v<l;v++){for(var m=v*f,y=r.subarray(m,m+f),x=[],w=0;w<y.length;w++)x.push({value:y[w],index:w});x.sort((function(S,T){return T.value-S.value}));var _=v*e,E=h.subarray(_,_+e),R=p.subarray(_,_+e);for(w=0;w<e;w++)E[w]=x[w].value,R[w]=x[w].index}var A=n.slice();return A[A.length-1]=e,[Ze(h,A,t),Ze(p,A,"int32")]}function Pd(r,n){for(var t=[],e=0;e<n.length;e++)n[e]&&t.push(e);var a=kt(r,"int32"),u=kt([t.length,r.length],"int32");for(e=0;e<t.length;e++){var s=a.indexToLoc(t[e]),l=e*r.length;u.values.set(s,l)}return u.toTensor()}var TE=function(r,n){this.outputShape=[],this.outputShape=r,this.variableNames=n.map((function(a,u){return"T"+u}));var t=[];this.variableNames.forEach((function(a){t.push("float v"+a+" = get"+a+"AtOutCoords();")}));var e=this.variableNames.map((function(a){return"v"+a})).join(" + ");this.userCode=`
      void main() {
        `+t.join(`
        `)+`

        float result = `+e+`;
        setOutput(result);
      }
    `},DE=function(r,n){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r,this.variableNames=n.map((function(a,u){return"T"+u}));var t=[];this.variableNames.forEach((function(a){t.push("vec4 v"+a+" = get"+a+"AtOutCoords();")}));var e=this.variableNames.map((function(a){return"v"+a})).join(" + ");this.userCode=`
      void main() {
        `+t.join(`
        `)+`

        vec4 result = `+e+`;
        setOutput(result);
      }
    `},NE=function(r,n,t){this.variableNames=["A"];var e=r.windowSize,a=r.batchSize,u=r.inSize,s=Math.ceil(u/e);t||this.variableNames.push("bestIndicesA"),this.outputShape=[a,s];var l=n==="max"?">":"<",f=t?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+e+`;

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < `+e+`; i++) {
          int inIdx = `+f+`;
          float candidate = getA(batch, inIdx);
          if (candidate `+l+` bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `};function S1(r,n){return["x","y","z","w","u","v"].slice(0,n).map((function(t){return r+"."+t}))}function gn(r,n){return n===1?[r]:S1(r,n)}function en(){var r,n,t,e,a,u,s,l,f,h;return st().getNumber("WEBGL_VERSION")===2?(r="#version 300 es",n="in",t="out",e="in",a="texture",u="outputColor",s="out vec4 outputColor;",l=`
      bool isnan_custom(float val) {
        return (val > 0.0 || val < 0.0) ? false : val != 0.0;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `,f="",h=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(r="",n="attribute",t="varying",e="varying",a="texture2D",u="gl_FragColor",s="",l=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,f=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,h=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:r,attribute:n,varyingVs:t,varyingFs:e,texture2D:a,output:u,defineOutput:s,defineSpecialNaN:l,defineSpecialInf:f,defineRound:h}}function ci(r,n,t){t===void 0&&(t="index");var e=Er(n);return e.map((function(a,u){return"int "+r[u]+" = "+t+" / "+a+"; "+(u===e.length-1?"int "+r[u+1]+" = "+t+" - "+r[u]+" * "+a:"index -= "+r[u]+" * "+a)+";"})).join("")}function Hd(r){var n=Er(r).map((function(t){return t.toString()}));return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * `+n[0]+" + coords.y * "+n[1]+` + coords.z;
  }
`}var R1=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;function ME(r,n,t,e){var a=[];r.forEach((function(y){var x=_t(y.shapeInfo.logicalShape);y.shapeInfo.isUniform?a.push("uniform float "+y.name+(x>1?"["+x+"]":"")+";"):(a.push("uniform sampler2D "+y.name+";"),a.push("uniform int offset"+y.name+";"))}));var u,s,l=a.join(`
`),f=r.map((function(y){return(function(x,w,_){_===void 0&&(_=!1);var E="";E+=_?A1(x):co(x);var R=x.shapeInfo.logicalShape,A=w.logicalShape;return R.length<=A.length&&(E+=_?(function(S,T){var N,O=S.name,B=O.charAt(0).toUpperCase()+O.slice(1),I="get"+B+"AtOutCoords",F=S.shapeInfo.logicalShape.length,G=T.logicalShape.length,H=Oa(S.shapeInfo.logicalShape,T.logicalShape),at=le(G),et=G-F,nt=["x","y","z","w","u","v"];N=F===0?"":G<2&&H.length>=1?"coords = 0;":H.map((function(X){return"coords."+nt[X+et]+" = 0;"})).join(`
`);var L="";L=G<2&&F>0?"coords":S.shapeInfo.logicalShape.map((function(X,it){return"coords."+nt[it+et]})).join(", ");var q="return outputValue;",K=_t(S.shapeInfo.logicalShape)===1,rt=_t(T.logicalShape)===1;if(F!==1||K||rt){if(K&&!rt)q=G===1?`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:`
        return vec4(outputValue.x);
      `;else if(H.length){var ot=F-2,z=F-1;H.indexOf(ot)>-1&&H.indexOf(z)>-1?q="return vec4(outputValue.x);":H.indexOf(ot)>-1?q="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":H.indexOf(z)>-1&&(q="return vec4(outputValue.xx, outputValue.zz);")}}else q=`
      return vec4(outputValue.xy, outputValue.xy);
    `;return`
    vec4 `+I+`() {
      `+at+` coords = getOutputCoords();
      `+N+`
      vec4 outputValue = get`+B+"("+L+`);
      `+q+`
    }
  `})(x,w):(function(S,T){var N=S.name,O=N.charAt(0).toUpperCase()+N.slice(1),B="get"+O+"AtOutCoords",I=T.texShape,F=S.shapeInfo.texShape,G=S.shapeInfo.logicalShape.length,H=T.logicalShape.length;if(!S.shapeInfo.isUniform&&G===H&&S.shapeInfo.flatOffset==null&&Pe(F,I))return`
      float `+B+`() {
        return sampleTexture(`+N+`, resultUV);
      }
    `;var at,et=le(H),nt=Oa(S.shapeInfo.logicalShape,T.logicalShape),L=H-G,q=["x","y","z","w","u","v"];at=G===0?"":H<2&&nt.length>=1?"coords = 0;":nt.map((function(rt){return"coords."+q[rt+L]+" = 0;"})).join(`
`);var K="";return K=H<2&&G>0?"coords":S.shapeInfo.logicalShape.map((function(rt,ot){return"coords."+q[ot+L]})).join(", "),`
    float `+B+`() {
      `+et+` coords = getOutputCoords();
      `+at+`
      return get`+O+"("+K+`);
    }
  `})(x,w)),E})(y,n,e)})).join(`
`),h=n.texShape,p=en(),v=(function(y){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return `+y.texture2D+`(textureSampler, uv).r;
    }
  `})(p),m=(function(y){return y.version+`
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    `+y.varyingFs+` vec2 resultUV;
    `+y.defineOutput+`
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    `+y.defineSpecialNaN+`
    `+y.defineSpecialInf+`
    `+y.defineRound+`

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    `+OE+`
    `+kE+`
    `+IE+`
  `})(p);return n.isPacked?(u=(function(y,x){switch(y.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return(function(S,T){var N=[Math.ceil(T[0]/2),Math.ceil(T[1]/2)];return N[0]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * `+N[1]+`.0);
      }
    `:N[1]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * `+N[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+N[0]+", "+N[1]+`));
      return 2 * (resTexRC.x * `+N[1]+` + resTexRC.y);
    }
  `})(0,x);case 2:return(function(S,T){var N=[Math.ceil(T[0]/2),Math.ceil(T[1]/2)];if(Pe(S,T))return`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(`+N[0]+", "+N[1]+`));
      }
    `;var O=Math.ceil(S[1]/2);return`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+N[0]+", "+N[1]+`));

      int index = resTexRC.x * `+N[1]+` + resTexRC.y;
      int r = 2 * (index / `+O+`);
      int c = imod(index, `+O+`) * 2;

      return ivec2(r, c);
    }
  `})(y,x);case 3:return w=y,_=x,E=[Math.ceil(_[0]/2),Math.ceil(_[1]/2)],R=Math.ceil(w[2]/2),A=R*Math.ceil(w[1]/2),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+E[0]+", "+E[1]+`));
      int index = resTexRC.x * `+E[1]+` + resTexRC.y;

      int b = index / `+A+`;
      index -= b * `+A+`;

      int r = 2 * (index / `+R+`);
      int c = imod(index, `+R+`) * 2;

      return ivec3(b, r, c);
    }
  `;default:return(function(S,T){for(var N=[Math.ceil(T[0]/2),Math.ceil(T[1]/2)],O=Math.ceil(S[S.length-1]/2),B=O*Math.ceil(S[S.length-2]/2),I=B,F="",G="b, r, c",H=2;H<S.length-1;H++)I*=S[S.length-H-1],F=`
      int b`+H+" = index / "+I+`;
      index -= b`+H+" * "+I+`;
    `+F,G="b"+H+", "+G;return`
    ivec`+S.length+` getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+N[0]+", "+N[1]+`));
      int index = resTexRC.x * `+N[1]+` + resTexRC.y;

      `+F+`

      int b = index / `+B+`;
      index -= b * `+B+`;

      int r = 2 * (index / `+O+`);
      int c = imod(index, `+O+`) * 2;

      return ivec`+S.length+"("+G+`);
    }
  `})(y,x)}var w,_,E,R,A})(n.logicalShape,h),s=(function(y){return`
    void setOutput(vec4 val) {
      `+y.output+` = val;
    }
  `})(p)):(u=(function(y,x){switch(y.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return(function(E,R){return R[0]===1?`
      int getOutputCoords() {
        return int(resultUV.x * `+R[1]+`.0);
      }
    `:R[1]===1?`
      int getOutputCoords() {
        return int(resultUV.y * `+R[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+R[0]+", "+R[1]+`));
      return resTexRC.x * `+R[1]+` + resTexRC.y;
    }
  `})(0,x);case 2:return(function(E,R){return Pe(E,R)?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(`+R[0]+", "+R[1]+`));
      }
    `:E[1]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+R[0]+", "+R[1]+`));
        int index = resTexRC.x * `+R[1]+` + resTexRC.y;
        return ivec2(index, 0);
      }
    `:E[0]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+R[0]+", "+R[1]+`));
        int index = resTexRC.x * `+R[1]+` + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+R[0]+", "+R[1]+`));
      int index = resTexRC.x * `+R[1]+` + resTexRC.y;
      int r = index / `+E[1]+`;
      int c = index - r * `+E[1]+`;
      return ivec2(r, c);
    }
  `})(y,x);case 3:return w=x,_=ci(["r","c","d"],y),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+w[0]+", "+w[1]+`));
      int index = resTexRC.x * `+w[1]+` + resTexRC.y;
      `+_+`
      return ivec3(r, c, d);
    }
  `;case 4:return(function(E,R){var A=ci(["r","c","d","d2"],E);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+R[0]+", "+R[1]+`));
      int index = resTexRC.x * `+R[1]+` + resTexRC.y;
      `+A+`
      return ivec4(r, c, d, d2);
    }
  `})(y,x);case 5:return(function(E,R){var A=ci(["r","c","d","d2","d3"],E);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(`+R[0]+`,
                             `+R[1]+`));

      int index = resTexRC.x * `+R[1]+` + resTexRC.y;

      `+A+`

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `})(y,x);case 6:return(function(E,R){var A=ci(["r","c","d","d2","d3","d4"],E);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+R[0]+", "+R[1]+`));
      int index = resTexRC.x * `+R[1]+` + resTexRC.y;

      `+A+`

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `})(y,x);default:throw new Error(y.length+"-D output sampling is not yet supported")}var w,_})(n.logicalShape,h),s=(function(y){return`
    void setOutput(float val) {
      `+y.output+` = vec4(val, 0, 0, 0);
    }
  `})(p)),e&&(m+=BE),[m,v,s,l,u,f,t].join(`
`)}function co(r){var n=r.shapeInfo.logicalShape;switch(n.length){case 0:return(function(t){var e=t.name,a="get"+e.charAt(0).toUpperCase()+e.slice(1);if(t.shapeInfo.isUniform)return"float "+a+"() {return "+e+";}";var u=t.shapeInfo.texShape,s=u[0],l=u[1];if(s===1&&l===1)return`
      float `+a+`() {
        return sampleTexture(`+e+`, halfCR);
      }
    `;var f=t.shapeInfo.texShape,h=f[0],p=f[1],v=oi(e);return`
    float `+a+`() {
      vec2 uv = uvFromFlat(`+h+", "+p+", "+v+`);
      return sampleTexture(`+e+`, uv);
    }
  `})(r);case 1:return(function(t){var e=t.name,a="get"+e.charAt(0).toUpperCase()+e.slice(1);if(t.shapeInfo.isUniform)return`
      float `+a+`(int index) {
        `+oo(t)+`
      }
    `;var u=t.shapeInfo.texShape,s=u[0],l=u[1];if(l===1&&s===1)return`
      float `+a+`(int index) {
        return sampleTexture(`+e+`, halfCR);
      }
    `;var f=oi(e);return l===1?`
      float `+a+`(int index) {
        vec2 uv = vec2(0.5, (float(index + `+f+") + 0.5) / "+s+`.0);
        return sampleTexture(`+e+`, uv);
      }
    `:s===1?`
      float `+a+`(int index) {
        vec2 uv = vec2((float(index + `+f+") + 0.5) / "+l+`.0, 0.5);
        return sampleTexture(`+e+`, uv);
      }
    `:`
    float `+a+`(int index) {
      vec2 uv = uvFromFlat(`+s+", "+l+", index + "+f+`);
      return sampleTexture(`+e+`, uv);
    }
  `})(r);case 2:return(function(t){var e=t.shapeInfo.logicalShape,a=t.name,u="get"+a.charAt(0).toUpperCase()+a.slice(1),s=t.shapeInfo.texShape;if(s!=null&&Pe(e,s)){var l=s[0],f=s[1];return`
    float `+u+`(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(`+f+".0, "+l+`.0);
      return sampleTexture(`+a+`, uv);
    }
  `}var h=li(e),p=h.newShape,v=h.keptDims,m=p;if(m.length<e.length){var y=fo(t,m);return`
      `+co(y)+`
      float `+u+`(int row, int col) {
        return `+u+"("+ho(["row","col"],v)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+u+`(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(`+e[1]+`, 1)));
        `+oo(t)+`
      }
    `;var x=s[0],w=s[1],_=oi(a);return w===1?`
    float `+u+`(int row, int col) {
      float index = dot(vec3(row, col, `+_+"), vec3("+e[1]+`, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / `+x+`.0);
      return sampleTexture(`+a+`, uv);
    }
  `:x===1?`
    float `+u+`(int row, int col) {
      float index = dot(vec3(row, col, `+_+"), vec3("+e[1]+`, 1, 1));
      vec2 uv = vec2((index + 0.5) / `+w+`.0, 0.5);
      return sampleTexture(`+a+`, uv);
    }
  `:`
  float `+u+`(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * `+e[1]+" + col + "+_+`;
    vec2 uv = uvFromFlat(`+x+", "+w+`, index);
    return sampleTexture(`+a+`, uv);
  }
`})(r);case 3:return(function(t){var e=t.shapeInfo.logicalShape,a=t.name,u="get"+a.charAt(0).toUpperCase()+a.slice(1),s=e[1]*e[2],l=e[2],f=li(e),h=f.newShape,p=f.keptDims,v=h;if(v.length<e.length){var m=fo(t,v);return`
        `+co(m)+`
        float `+u+`(int row, int col, int depth) {
          return `+u+"("+ho(["row","col","depth"],p)+`);
        }
      `}if(t.shapeInfo.isUniform)return`
      float `+u+`(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(`+s+", "+l+`, 1)));
        `+oo(t)+`
      }
    `;var y=t.shapeInfo.texShape,x=y[0],w=y[1],_=t.shapeInfo.flatOffset;if(w===s&&_==null)return`
        float `+u+`(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(`+l+`, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(`+w+".0, "+x+`.0);
          return sampleTexture(`+a+`, uv);
        }
      `;if(w===l&&_==null)return`
    float `+u+`(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(`+e[1]+`, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+w+".0, "+x+`.0);
      return sampleTexture(`+a+`, uv);
    }
  `;var E=oi(a);return`
      float `+u+`(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `+s+" + col * "+l+" + depth + "+E+`;
        vec2 uv = uvFromFlat(`+x+", "+w+`, index);
        return sampleTexture(`+a+`, uv);
      }
  `})(r);case 4:return(function(t){var e=t.shapeInfo.logicalShape,a=t.name,u="get"+a.charAt(0).toUpperCase()+a.slice(1),s=e[3],l=e[2]*s,f=e[1]*l,h=li(e),p=h.newShape,v=h.keptDims;if(p.length<e.length){var m=fo(t,p);return`
      `+co(m)+`
      float `+u+`(int row, int col, int depth, int depth2) {
        return `+u+"("+ho(["row","col","depth","depth2"],v)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+u+`(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(`+f+", "+l+", "+s+`, 1)));
        `+oo(t)+`
      }
    `;var y=t.shapeInfo.flatOffset,x=t.shapeInfo.texShape,w=x[0],_=x[1];if(_===f&&y==null)return`
      float `+u+`(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(`+l+", "+s+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+_+".0, "+w+`.0);
        return sampleTexture(`+a+`, uv);
      }
    `;if(_===s&&y==null)return`
      float `+u+`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`+e[1]*e[2]+", "+e[2]+`, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+_+".0, "+w+`.0);
        return sampleTexture(`+a+`, uv);
      }
    `;var E=oi(a);return`
    float `+u+`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+f+" + col * "+l+` +
          depth * `+s+` + depth2;
      vec2 uv = uvFromFlat(`+w+", "+_+", index + "+E+`);
      return sampleTexture(`+a+`, uv);
    }
  `})(r);case 5:return(function(t){var e=t.shapeInfo.logicalShape,a=t.name,u="get"+a.charAt(0).toUpperCase()+a.slice(1),s=e[4],l=e[3]*s,f=e[2]*l,h=e[1]*f,p=li(e),v=p.newShape,m=p.keptDims;if(v.length<e.length){var y=fo(t,v);return`
      `+co(y)+`
      float `+u+`(int row, int col, int depth, int depth2, int depth3) {
        return `+u+"("+ho(["row","col","depth","depth2","depth3"],m)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+u+`(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(`+h+", "+f+", "+l+", "+s+`)) +
          depth3;
        `+oo(t)+`
      }
    `;var x=t.shapeInfo.flatOffset,w=t.shapeInfo.texShape,_=w[0],E=w[1];if(E===h&&x==null)return`
      float `+u+`(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(`+f+", "+l+", "+s+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+E+".0, "+_+`.0);
        return sampleTexture(`+a+`, uv);
      }
    `;if(E===s&&x==null)return`
      float `+u+`(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(`+e[1]*e[2]*e[3]+`,
               `+e[2]*e[3]+", "+e[3]+`, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+E+".0, "+_+`.0);
        return sampleTexture(`+a+`, uv);
      }
    `;var R=oi(a);return`
    float `+u+`(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+h+" + col * "+f+" + depth * "+l+` +
          depth2 * `+s+" + depth3 + "+R+`;
      vec2 uv = uvFromFlat(`+_+", "+E+`, index);
      return sampleTexture(`+a+`, uv);
    }
  `})(r);case 6:return(function(t){var e=t.shapeInfo.logicalShape,a=t.name,u="get"+a.charAt(0).toUpperCase()+a.slice(1),s=li(e),l=s.newShape,f=s.keptDims;if(l.length<e.length){var h=fo(t,l);return`
      `+co(h)+`
      float `+u+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return `+u+"("+ho(["row","col","depth","depth2","depth3","depth4"],f)+`);
      }
    `}var p=e[5],v=e[4]*p,m=e[3]*v,y=e[2]*m,x=e[1]*y;if(t.shapeInfo.isUniform)return`
      float `+u+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(`+x+", "+y+", "+m+", "+v+`)) +
          dot(
            vec2(depth3, depth4),
            vec2(`+p+`, 1)));
        `+oo(t)+`
      }
    `;var w=t.shapeInfo.flatOffset,_=t.shapeInfo.texShape,E=_[0],R=_[1];if(R===x&&w==null)return`
      float `+u+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(`+y+", "+m+", "+v+", "+p+`)) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+R+".0, "+E+`.0);
        return sampleTexture(`+a+`, uv);
      }
    `;if(R===p&&w==null)return`
      float `+u+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(`+e[1]*e[2]*e[3]*e[4]+`,
               `+e[2]*e[3]*e[4]+`,
               `+e[3]*e[4]+`,
               `+e[4]+`)) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+R+".0, "+E+`.0);
        return sampleTexture(`+a+`, uv);
      }
    `;var A=oi(a);return`
    float `+u+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+x+" + col * "+y+" + depth * "+m+` +
          depth2 * `+v+" + depth3 * "+p+" + depth4 + "+A+`;
      vec2 uv = uvFromFlat(`+E+", "+R+`, index);
      return sampleTexture(`+a+`, uv);
    }
  `})(r);default:throw new Error(n.length+"-D input sampling is not yet supported")}}function A1(r){var n,t,e;switch(r.shapeInfo.logicalShape.length){case 0:return n=r.name,t="get"+n.charAt(0).toUpperCase()+n.slice(1),e=en(),`
    vec4 `+t+`() {
      return `+e.texture2D+"("+n+`, halfCR);
    }
  `;case 1:return(function(a){var u=a.name,s="get"+u.charAt(0).toUpperCase()+u.slice(1),l=a.shapeInfo.texShape,f=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)],h=en();return`
    vec4 `+s+`(int index) {
      vec2 uv = packedUVfrom1D(
        `+f[0]+", "+f[1]+`, index);
      return `+h.texture2D+"("+u+`, uv);
    }
  `})(r);case 2:return(function(a){var u=a.shapeInfo.logicalShape,s=a.name,l="get"+s.charAt(0).toUpperCase()+s.slice(1),f=a.shapeInfo.texShape,h=f[0],p=f[1],v=en();if(f!=null&&Pe(u,f))return`
      vec4 `+l+`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`+p+".0, "+h+`.0);

        return `+v.texture2D+"("+s+`, uv);
      }
    `;var m=[Math.ceil(f[0]/2),Math.ceil(f[1]/2)],y=Math.ceil(u[1]/2);return`
    vec4 `+l+`(int row, int col) {
      vec2 uv = packedUVfrom2D(`+y+", "+m[0]+", "+m[1]+`, row, col);
      return `+v.texture2D+"("+s+`, uv);
    }
  `})(r);case 3:return(function(a){var u=a.shapeInfo.logicalShape,s=a.name,l="get"+s.charAt(0).toUpperCase()+s.slice(1),f=a.shapeInfo.texShape,h=[Math.ceil(f[0]/2),Math.ceil(f[1]/2)];if(u[0]===1){var p=u.slice(1),v=fo(a,p);return`
        `+A1(v)+`
        vec4 `+l+`(int b, int row, int col) {
          return `+l+"("+ho(["b","row","col"],[1,2])+`);
        }
      `}var m=h[0],y=h[1],x=Math.ceil(u[2]/2),w=x*Math.ceil(u[1]/2),_=en();return`
    vec4 `+l+`(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        `+m+", "+y+", "+w+", "+x+`, b, row, col);
      return `+_.texture2D+"("+s+`, uv);
    }
  `})(r);default:return(function(a){for(var u=a.shapeInfo.logicalShape,s=u.length,l=a.name,f="get"+l.charAt(0).toUpperCase()+l.slice(1),h=a.shapeInfo.texShape,p=[Math.ceil(h[0]/2),Math.ceil(h[1]/2)],v=p[0],m=p[1],y=Math.ceil(u[s-1]/2),x=y*Math.ceil(u[s-2]/2),w="int b, int row, int col",_="b * "+x+" + (row / 2) * "+y+" + (col / 2)",E=2;E<s-1;E++)w="int b"+E+", "+w,x*=u[s-E-1],_="b"+E+" * "+x+" + "+_;var R=en();return`
    vec4 `+f+"("+w+`) {
      int index = `+_+`;
      int texR = index / `+m+`;
      int texC = index - texR * `+m+`;
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+m+", "+v+`);
      return `+R.texture2D+"("+l+`, uv);
    }
  `})(r)}}var OE=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,kE=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,IE=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,BE=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function oi(r){return"offset"+r}function oo(r){var n=r.name,t=_t(r.shapeInfo.logicalShape);return t<2?"return "+n+";":`
    for (int i = 0; i < `+t+`; i++) {
      if (i == index) {
        return `+n+`[i];
      }
    }
  `}function le(r){if(r<=1)return"int";if(r===2)return"ivec2";if(r===3)return"ivec3";if(r===4)return"ivec4";if(r===5)return"ivec5";if(r===6)return"ivec6";throw Error("GPU for rank "+r+" is not yet supported")}function fo(r,n){var t=JSON.parse(JSON.stringify(r));return t.shapeInfo.logicalShape=n,t}function ho(r,n){return n.map((function(t){return r[t]})).join(", ")}var FE=function(r,n,t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,k(r.length>2,(function(){return"Packed arg"+(t.charAt(0).toUpperCase()+t.slice(1))+" supports only inputs with rank above 2."}));var a=r[r.length-1],u=Math.ceil(a/n);this.outputShape=r.slice(0,-1),u>1&&this.outputShape.push(u),e||this.variableNames.push("bestIndicesA");var s,l,f=this.outputShape,h=f.length,p=le(h),v=gn("coords",h);if(u===1){var m=le(l=h+1);s=`
        `+m+" sourceLocR = "+m+"("+v.join()+`, 0);
        ++`+v[h-1]+`;
        `+m+" sourceLocG = "+m+"("+v.join()+`, 0);
        ++`+v[h-2]+`;
        `+m+" sourceLocA = "+m+"("+v.join()+`, 0);
        --`+v[h-1]+`;
        `+m+" sourceLocB = "+m+"("+v.join()+`, 0);
        --`+v[h-2]+";"}else l=h,s=`
        `+p+` sourceLocR = coords;
        ++`+v[h-1]+`;
        `+p+` sourceLocG = coords;
        ++`+v[h-2]+`;
        `+p+` sourceLocA = coords;
        --`+v[h-1]+`;
        `+p+` sourceLocB = coords;
        --`+v[h-2]+";";var y=["x","y","z","w","u","v"].slice(0,l),x="."+y[l-1],w=y.map((function(B){return"int "+B})),_=gn("sourceLocR",l-1).concat("inIdx.r"),E=gn("sourceLocG",l-1).concat("inIdx.g"),R=gn("sourceLocB",l-1).concat("inIdx.b"),A=gn("sourceLocA",l-1).concat("inIdx.a"),S=t==="max"?"greaterThan":"lessThan",T=e?"":`
          inIdx = round(vec4(getBestIndicesAChannel(`+_.join()+`),
                             getBestIndicesAChannel(`+E.join()+`),
                             getBestIndicesAChannel(`+R.join()+`),
                             getBestIndicesAChannel(`+A.join()+")));",N=`vec4(
            getAChannel(`+_.join()+`),
            hasNextCol ? getAChannel(`+E.join()+`) : 0.,
            hasNextRow ? getAChannel(`+R.join()+`) : 0.,
            hasNextRow && hasNextCol ? getAChannel(`+A.join()+") : 0.)",O=e?"":`
      float getBestIndicesAChannel(`+w.join()+`) {
        return getChannel(getBestIndicesA(`+y.join()+`),
                                          vec2(`+y.slice(-2).join()+`));
      }`;this.userCode=`
      float getAChannel(`+w.join()+`) {
        return getChannel(getA(`+y.join()+`),
                               vec2(`+y.slice(-2).join()+`));
      }
      `+O+`
      void main() {
        `+p+` coords = getOutputCoords();
        bool hasNextCol = `+v[h-1]+" < "+(f[h-1]-1)+`;
        bool hasNextRow = `+v[h-2]+" < "+(f[h-2]-1)+`;
        `+s+`
        ivec4 srcIdx = ivec4(sourceLocR`+x+", sourceLocG"+x+`,
          sourceLocB`+x+", sourceLocA"+x+") * "+n+`;
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = `+N+`;

        for (int i = 0; i < `+n+`; i++) {
          inIdx = srcIdx;
          `+T+`
          vec4 candidate = `+N+`;
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(`+S+`(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `},zE=function(r){this.variableNames=["dy"],this.outputShape=r.inShape;var n=r.filterHeight,t=r.filterWidth,e=r.strideHeight,a=r.strideWidth,u=r.dilationHeight,s=r.dilationWidth,l=r.effectiveFilterHeight,f=r.effectiveFilterWidth,h=l-1-r.padInfo.top,p=f-1-r.padInfo.left,v=1/(n*t);this.userCode=`
      const ivec2 pads = ivec2(`+h+", "+p+`);
      const float avgMultiplier = float(`+v+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+l+`;
            wR += `+u+`) {
          float dyR = float(dyRCorner + wR) / `+e+`.0;

          if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+f+`;
            wC+= `+s+`) {
            float dyC = float(dyCCorner + wC) / `+a+`.0;

            if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `},LE=function(r){this.variableNames=["dy"],this.outputShape=r.inShape;var n=r.filterDepth,t=r.filterHeight,e=r.filterWidth,a=r.strideDepth,u=r.strideHeight,s=r.strideWidth,l=r.dilationDepth,f=r.dilationHeight,h=r.dilationWidth,p=r.effectiveFilterDepth,v=r.effectiveFilterHeight,m=r.effectiveFilterWidth,y=p-1-r.padInfo.front,x=v-1-r.padInfo.top,w=m-1-r.padInfo.left,_=1/(n*t*e);this.userCode=`
      const ivec3 pads = ivec3(`+y+", "+x+", "+w+`);
      const float avgMultiplier = float(`+_+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+p+`;
            wD += `+l+`) {
          float dyD = float(dyDCorner + wD) / `+a+`.0;

          if (dyD < 0.0 || dyD >= `+r.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+v+`;
              wR += `+f+`) {
            float dyR = float(dyRCorner + wR) / `+u+`.0;

            if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+m+`;
                wC += `+h+`) {
              float dyC = float(dyCCorner + wC) / `+s+`.0;

              if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `},UE=function(r,n,t,e,a,u){this.outputShape=[],this.variableNames=["x","mean","variance"],Ht(r,n),Ht(r,t);var s="0.0";e!=null&&(Ht(r,e),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var l="1.0";a!=null&&(Ht(r,a),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=r,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = `+s+`;
        float scale = `+l+`;
        float inv = scale * inversesqrt(variance + float(`+u+`));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `},PE=function(r,n,t,e,a,u){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Ht(r,n),Ht(r,t);var s="vec4(0.0)";e!=null&&(Ht(r,e),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var l="vec4(1.0)";a!=null&&(Ht(r,a),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=r,this.userCode=`
      void main() {
        vec4 offset = `+s+`;
        vec4 scale = `+l+`;

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(`+u+`));

        setOutput((x - mean) * inv + offset);
      }
    `},HE="return areal * breal - aimag * bimag;",VE="return areal * bimag + aimag * breal;",ny=function(r,n,t){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Ht(n,t),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        `+r+`
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `},Gh="return a + b;",Wh="return a - b;",ry="return a * b;",T1="return (a < 0.) ? b * a : a;",be=function(r,n,t){this.variableNames=["A","B"],this.outputShape=Ht(n,t),this.userCode=`
      float binaryOperation(float a, float b) {
        `+r+`
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `},D1=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`,Zr=function(r,n,t,e){e===void 0&&(e=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Ht(n,t);var a=this.outputShape.length,u="";if(e)if(a===0||_t(this.outputShape)===1)u=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(u=`
          `+le(a)+` coords = getOutputCoords();
        `,a===1)u+=`
            result.y = (coords + 1) >= `+this.outputShape[0]+` ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{var s=gn("coords",a);u+=`
            bool nextRowOutOfBounds =
              (`+s[a-2]+" + 1) >= "+this.outputShape[a-2]+`;
            bool nextColOutOfBounds =
              (`+s[a-1]+" + 1) >= "+this.outputShape[a-1]+`;
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        `+r+`
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        `+u+`

        setOutput(result);
      }
    `},GE=(function(){function r(n){this.variableNames=["A"],this.outputShape=n,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}return r.prototype.getCustomSetupFunc=function(n,t){var e=this;return function(a,u){e.minLoc==null&&(e.minLoc=a.getUniformLocationNoThrow(u,"minVal"),e.maxLoc=a.getUniformLocationNoThrow(u,"maxVal")),a.gl.uniform1f(e.minLoc,n),a.gl.uniform1f(e.maxLoc,t)}},r})(),WE=(function(){function r(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}return r.prototype.getCustomSetupFunc=function(n,t){var e=this;return function(a,u){e.minLoc==null&&(e.minLoc=a.getUniformLocationNoThrow(u,"minVal"),e.maxLoc=a.getUniformLocationNoThrow(u,"maxVal")),a.gl.uniform1f(e.minLoc,n),a.gl.uniform1f(e.maxLoc,t)}},r})(),qE=function(r){this.variableNames=["real","imag"],this.outputShape=r,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `},jE=function(r){this.outputShape=[],this.outputShape=Co(r,1),this.variableNames=r.map((function(l,f){return"T"+f}));var n=new Array(r.length-1);n[0]=r[0][1];for(var t=1;t<n.length;t++)n[t]=n[t-1]+r[t][1];var e=["if (yC < "+n[0]+") setOutput(getT0(yR, yC));"];for(t=1;t<n.length;t++){var a=n[t-1];e.push("else if (yC < "+n[t]+") setOutput(getT"+t+"(yR, yC-"+a+"));")}var u=n.length,s=n[n.length-1];e.push("else setOutput(getT"+u+"(yR, yC-"+s+"));"),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        `+e.join(`
        `)+`
      }
    `},XE=function(r,n){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Co(r,n);var t=this.outputShape,e=t.length,a=le(e),u=gn("coords",e),s=["x","y","z","w","u","v"].slice(0,e);this.variableNames=r.map((function(_,E){return"T"+E}));var l=new Array(r.length-1);l[0]=r[0][n];for(var f=1;f<l.length;f++)l[f]=l[f-1]+r[f][n];var h=s[n],p=s.slice(-2),v=s.join(),m="if ("+h+" < "+l[0]+`) {
        return getChannel(
            getT0(`+v+"), vec2("+p.join()+`));
        }`;for(f=1;f<l.length;f++){var y=l[f-1];m+=`
        if (`+h+" < "+l[f]+"  && "+h+" >= "+l[f-1]+`) {
          return getChannel(
            getT`+f+"("+ml(s,h,y)+`),
            vec2(`+ml(p,h,y)+`));
        }`}var x=l.length,w=l[l.length-1];m+=`
        return getChannel(
          getT`+x+"("+ml(s,h,w)+`),
          vec2(`+ml(p,h,w)+"));",this.userCode=`
      float getValue(`+s.map((function(_){return"int "+_}))+`) {
        `+m+`
      }

      void main() {
        `+a+` coords = getOutputCoords();
        vec4 result = vec4(getValue(`+u+`), 0., 0., 0.);

        `+u[e-1]+" = "+u[e-1]+` + 1;
        if (`+u[e-1]+" < "+t[e-1]+`) {
          result.g = getValue(`+u+`);
        }

        `+u[e-2]+" = "+u[e-2]+` + 1;
        if (`+u[e-2]+" < "+t[e-2]+`) {
          result.a = getValue(`+u+`);
        }

        `+u[e-1]+" = "+u[e-1]+` - 1;
        if (`+u[e-2]+" < "+t[e-2]+` &&
            `+u[e-1]+" < "+t[e-1]+`) {
          result.b = getValue(`+u+`);
        }
        setOutput(result);
      }
    `};function ml(r,n,t){var e=r.indexOf(n);return r.map((function(a,u){return u===e?a+" - "+t:a})).join()}var KE=function(r){this.variableNames=["x","dy"],this.outputShape=r.filterShape;var n=r.strideHeight,t=r.strideWidth,e=r.padInfo.top,a=r.padInfo.left,u=r.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < `+r.batchSize+`; b++) {
          for (int yR = 0; yR < `+r.outHeight+`; yR++) {
            int xR = wR + yR * `+n+" - "+e+`;

            if (xR < 0 || xR >= `+r.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+r.outWidth+`; yC++) {
              int xC = wC + yC * `+t+" - "+a+`;

              if (xC < 0 || xC >= `+r.inWidth+`) {
                continue;
              }

              if (`+u+`) {
                float dyValue = getDy(b, yR, yC, d2);
                float xValue = getX(b, xR, xC, d1);
                dotProd += (xValue * dyValue);
              } else {
                float dyValue = getDy(b, d2, yR, yC);
                float xValue = getX(b, d1, xR, xC);
                dotProd += (xValue * dyValue);
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},YE=function(r){this.variableNames=["dy","W"],this.outputShape=r.inShape;var n=r.filterHeight,t=r.filterWidth,e=r.strideHeight,a=r.strideWidth,u=r.dataFormat==="channelsLast",s=n-1-r.padInfo.top,l=t-1-r.padInfo.left,f=u?1:2,h=u?2:3,p=u?3:1;this.userCode=`
      const ivec2 pads = ivec2(`+s+", "+l+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[`+p+`];

        ivec2 dyCorner = ivec2(coords[`+f+"], coords["+h+`]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+n+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+e+`.0;

          if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+n+` - 1 - wR;

          for (int wC = 0; wC < `+t+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+a+`.0;

            if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+t+` - 1 - wC;

            for (int d2 = 0; d2 < `+r.outChannels+`; d2++) {

              if (`+u+`) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},QE=function(r){this.variableNames=["x","dy"],this.outputShape=r.filterShape;var n=r.strideDepth,t=r.strideHeight,e=r.strideWidth,a=r.padInfo.front,u=r.padInfo.top,s=r.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < `+r.batchSize+`; b++) {
          for (int yF = 0; yF < `+r.outDepth+`; yF++) {
            int xF = wF + yF * `+n+" - "+a+`;

            if (xF < 0 || xF >= `+r.inDepth+`) {
              continue;
            }

            for (int yR = 0; yR < `+r.outHeight+`; yR++) {
              int xR = wR + yR * `+t+" - "+u+`;

              if (xR < 0 || xR >= `+r.inHeight+`) {
                continue;
              }

              for (int yC = 0; yC < `+r.outWidth+`; yC++) {
                int xC = wC + yC * `+e+" - "+s+`;

                if (xC < 0 || xC >= `+r.inWidth+`) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},ZE=function(r){this.variableNames=["dy","W"],this.outputShape=r.inShape;var n=r.filterDepth,t=r.filterHeight,e=r.filterWidth,a=r.strideDepth,u=r.strideHeight,s=r.strideWidth,l=n-1-r.padInfo.front,f=t-1-r.padInfo.top,h=e-1-r.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(`+l+", "+f+", "+h+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < `+n+`; wF++) {
          float dyF = float(dyFCorner + wF) / `+a+`.0;

          if (dyF < 0.0 || dyF >= `+r.outDepth+`.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = `+n+` - 1 - wF;

          for (int wR = 0; wR < `+t+`; wR++) {
            float dyR = float(dyRCorner + wR) / `+u+`.0;

            if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = `+t+` - 1 - wR;

            for (int wC = 0; wC < `+e+`; wC++) {
              float dyC = float(dyCCorner + wC) / `+s+`.0;

              if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = `+e+` - 1 - wC;

              for (int d2 = 0; d2 < `+r.outChannels+`; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},JE=function(r){this.variableNames=["x","dy"],this.outputShape=r.filterShape;var n=r.strideHeight,t=r.strideWidth,e=r.padInfo.top,a=r.padInfo.left,u=r.outChannels/r.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * `+u+` + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < `+r.batchSize+`; b++) {
          for (int yR = 0; yR < `+r.outHeight+`; yR++) {
            int xR = wR + yR * `+n+" - "+e+`;

            if (xR < 0 || xR >= `+r.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+r.outWidth+`; yC++) {
              int xC = wC + yC * `+t+" - "+a+`;

              if (xC < 0 || xC >= `+r.inWidth+`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `},$E=function(r){this.variableNames=["dy","W"],this.outputShape=r.inShape;var n=r.filterHeight,t=r.filterWidth,e=r.strideHeight,a=r.strideWidth,u=n-1-r.padInfo.top,s=t-1-r.padInfo.left,l=r.outChannels/r.inChannels;this.userCode=`
      const ivec2 pads = ivec2(`+u+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < `+n+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+e+`.0;

          if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+n+` - 1 - wR;

          for (int wC = 0; wC < `+t+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+a+`.0;

            if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+t+` - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < `+l+`; dm++) {
              int d2 = d1 * `+l+` + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `},ay=function(r,n,t,e){n===void 0&&(n=!1),t===void 0&&(t=null),e===void 0&&(e=!1),this.variableNames=["x","W"],this.outputShape=r.outShape;var a=r.padInfo.top,u=r.padInfo.left,s=r.strideHeight,l=r.strideWidth,f=r.dilationHeight,h=r.dilationWidth,p=r.filterHeight,v=r.filterWidth,m=4*Math.floor(r.inChannels/4),y=r.inChannels%4,x=r.dataFormat==="channelsLast",w=x?1:2,_=x?2:3,E=x?3:1,R="",A="";t&&(R=e?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+t+`
        }`:`
          float activation(float x) {
            `+t+`
          }
        `,A="result = activation(result);");var S=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),e&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+R+`

      const ivec2 strides = ivec2(`+s+", "+l+`);
      const ivec2 pads = ivec2(`+a+", "+u+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[`+E+`];

        ivec2 xRCCorner =
            ivec2(coords[`+w+"], coords["+_+`]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+p+`; wR++) {
          int xR = xRCorner + wR * `+f+`;

          if (xR < 0 || xR >= `+r.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+v+`; wC++) {
            int xC = xCCorner + wC * `+h+`;

            if (xC < 0 || xC >= `+r.inWidth+`) {
              continue;
            }

            for (int d1 = 0; d1 < `+m+`; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (`+x+`) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (`+(y===1)+`) {

              if (`+x+`) {
                dotProd +=
                    getX(batch, xR, xC, `+m+`) *
                    getW(wR, wC, `+m+`, d2);
              } else {
                dotProd +=
                    getX(batch, `+m+`, xR, xC) *
                    getW(wR, wC, `+m+`, d2);
              }

            } else if (`+(y===2)+`) {
              vec2 wValues = vec2(
                getW(wR, wC, `+m+`, d2),
                getW(wR, wC, `+m+` + 1, d2)
              );

              if (`+x+`) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, `+m+`),
                  getX(batch, xR, xC, `+m+` + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, `+m+`, xR, xC),
                  getX(batch, `+m+` + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (`+(y===3)+`) {
              vec3 wValues = vec3(
                getW(wR, wC, `+m+`, d2),
                getW(wR, wC, `+m+` + 1, d2),
                getW(wR, wC, `+m+` + 2, d2)
              );

              if (`+x+`) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, `+m+`),
                  getX(batch, xR, xC, `+m+` + 1),
                  getX(batch, xR, xC, `+m+` + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, `+m+`, xR, xC),
                  getX(batch, `+m+` + 1, xR, xC),
                  getX(batch, `+m+` + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        `+S+`
        `+A+`
        setOutput(result);
      }
    `},tC=function(r){this.variableNames=["x","W"],this.outputShape=r.outShape;var n=r.padInfo.front,t=r.padInfo.top,e=r.padInfo.left,a=r.strideDepth,u=r.strideHeight,s=r.strideWidth,l=r.dilationDepth,f=r.dilationHeight,h=r.dilationWidth,p=r.filterDepth,v=r.filterHeight,m=r.filterWidth,y=4*Math.floor(r.inChannels/4),x=r.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(`+a+", "+u+", "+s+`);
      const ivec3 pads = ivec3(`+n+", "+t+", "+e+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < `+p+`; wF++) {
          int xF = xFCorner + wF * `+l+`;

          if (xF < 0 || xF >= `+r.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+v+`; wR++) {
            int xR = xRCorner + wR * `+f+`;

            if (xR < 0 || xR >= `+r.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+m+`; wC++) {
              int xC = xCCorner + wC * `+h+`;

              if (xC < 0 || xC >= `+r.inWidth+`) {
                continue;
              }

              for (int d1 = 0; d1 < `+y+`; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (`+(x===1)+`) {
                dotProd +=
                  getX(batch, xF, xR, xC, `+y+`) *
                  getW(wF, wR, wC, `+y+`, d2);
              } else if (`+(x===2)+`) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, `+y+`),
                  getX(batch, xF, xR, xC, `+y+` + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, `+y+`, d2),
                  getW(wF, wR, wC, `+y+` + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (`+(x===3)+`) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, `+y+`),
                  getX(batch, xF, xR, xC, `+y+` + 1),
                  getX(batch, xF, xR, xC, `+y+` + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, `+y+`, d2),
                  getW(wF, wR, wC, `+y+` + 1, d2),
                  getW(wF, wR, wC, `+y+` + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},iy=function(r,n,t,e){n===void 0&&(n=!1),t===void 0&&(t=null),e===void 0&&(e=!1),this.variableNames=["x","W"],this.outputShape=r.outShape;var a=r.inHeight,u=r.inWidth,s=r.padInfo.top,l=r.padInfo.left,f=r.strideHeight,h=r.strideWidth,p=r.dilationHeight,v=r.dilationWidth,m=r.filterHeight,y=r.filterWidth,x=r.outChannels/r.inChannels,w="",_="";t&&(w=e?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+t+`
        }`:`
          float activation(float x) {
            `+t+`
          }
        `,_="result = activation(result);");var E=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),e&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+w+`

      const ivec2 strides = ivec2(`+f+", "+h+`);
      const ivec2 pads = ivec2(`+s+", "+l+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `+x+`;
        int q = d2 - d1 * `+x+`;

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < `+m+`; wR++) {
          int xR = xRCorner + wR * `+p+`;

          if (xR < 0 || xR >= `+a+`) {
            continue;
          }

          for (int wC = 0; wC < `+y+`; wC++) {
            int xC = xCCorner + wC * `+v+`;

            if (xC < 0 || xC >= `+u+`) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        `+E+`
        `+_+`
        setOutput(result);
      }
    `},oy=function(r,n,t,e){n===void 0&&(n=!1),t===void 0&&(t=null),e===void 0&&(e=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r.outShape;for(var a=r.inHeight,u=r.inWidth,s=r.padInfo.top,l=r.padInfo.left,f=r.strideHeight,h=r.strideWidth,p=r.dilationHeight,v=r.dilationWidth,m=r.filterHeight,y=r.filterWidth,x=y,w="int xR; int xC; int xCOffset;",_=0;_<m;_++)for(var E=0;E<y;E++)w+=`
          vec4 xTexelR`+_+"C"+2*E+` = vec4(0.);
          vec4 wR`+_+"C"+E+` = vec4(0.);
          vec4 xR`+_+"C"+E+" = vec4(0.);";for(_=0;_<m;_++)for(var R=0;R<x;R++){if(w+=`
          xR = xRCorner + `+_*p+`;
          xC = xCCorner + `+(E=2*R)*v+`;
        `,h===1){if(E<y&&(w+=l%2==1?`
                xCOffset = xC + 1;
                if(xR >= 0 && xR < `+a+" && xCOffset >= 0 && xCOffset < "+u+`) {
                  xTexelR`+_+"C"+E+` = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+u+`) {
                    xTexelR`+_+"C"+E+`.zw = vec2(0.);
                  }
                } else {
                  xTexelR`+_+"C"+E+` = vec4(0.);
                }

                xCOffset = xC + 1 - 2;
                if(xR >= 0 && xR < `+a+" && xCOffset >= 0 && xCOffset < "+u+`) {
                  vec4 previous = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+u+`) {
                    previous.zw = vec2(0.);
                  }

                  xR`+_+"C"+E+" = vec4(previous.zw, xTexelR"+_+"C"+E+`.xy);
                } else {
                  xR`+_+"C"+E+" = vec4(0, 0, xTexelR"+_+"C"+E+`.xy);
                }
              `:`
                if(xR >= 0 && xR < `+a+" && xC >= 0 && xC < "+u+`) {
                  xTexelR`+_+"C"+E+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+_+"C"+E+` = vec4(0.);
                }

                xR`+_+"C"+E+" = xTexelR"+_+"C"+E+`;
              `,E+1<y)){var A=l%2==0?Xy(v):v;v%2==0&&l%2==1||v%2!=0&&l%2!=1?(w+=`
                  xCOffset = xC + `+l%2+" + "+A+`;

                  if(xR >= 0 && xR < `+a+` &&
                    xCOffset >= 0 && xCOffset < `+u+`) {
                    xTexelR`+_+"C"+(E+2)+` = getX(batch, xR, xCOffset, d1);
                  }
                `,v>1&&(w+=`
                    xCOffset -= 2;
                    if(xR >= 0 && xR < `+a+` &&
                      xCOffset >= 0 && xCOffset < `+u+`) {
                      xTexelR`+_+"C"+E+` = getX(batch, xR, xCOffset, d1);
                    } else {
                      xTexelR`+_+"C"+E+` = vec4(0.);
                    }
                  `),w+=`
                  xR`+_+"C"+(E+1)+` = vec4(
                    xTexelR`+_+"C"+E+".zw, xTexelR"+_+"C"+(E+2)+`.xy);
                `):w+=`
                  xCOffset = xC + `+A+`;

                  if(xR >= 0 && xR < `+a+` &&
                    xCOffset >= 0 && xCOffset < `+u+`) {
                    xTexelR`+_+"C"+(E+2)+` = getX(batch, xR, xCOffset, d1);
                  }

                  xR`+_+"C"+(E+1)+" = xTexelR"+_+"C"+(E+2)+`;
                `}}else E<y&&(w+=`
              if(xR >= 0 && xR < `+a+`) {
            `,l%2==1?(w+=`
                xCOffset = xC + 1 - `+h+`;
                if(xCOffset >= 0 && xCOffset < `+u+`) {
                  xTexelR`+_+"C"+E+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+_+"C"+E+` = vec4(0.);
                }

                if(xC + 1 >= 0 && xC + 1 < `+u+`) {
                  xTexelR`+_+"C"+(E+2)+` = getX(batch, xR, xC + 1, d1);
                } else {
                  xTexelR`+_+"C"+(E+2)+` = vec4(0.);
                }

                xR`+_+"C"+E+` = vec4(
                  xTexelR`+_+"C"+E+".zw, xTexelR"+_+"C"+(E+2)+`.zw);
              `,E+1<y&&(w+=`
                  vec4 final = vec4(0.);
                  xCOffset = xC + 1 + `+h+`;
                  if(xCOffset >= 0 && xCOffset < `+u+`) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xR`+_+"C"+(E+1)+" = vec4(xTexelR"+_+"C"+(E+2)+`.xy, final.xy);
                `)):(w+=`
                if(xC >= 0 && xC < `+u+`) {
                  xTexelR`+_+"C"+E+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+_+"C"+E+` = vec4(0.);
                }

                xCOffset = xC + `+h+`;
                if(xCOffset >= 0 && xCOffset < `+u+`) {
                  xTexelR`+_+"C"+(E+2)+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+_+"C"+(E+2)+` = vec4(0.);
                }

                xR`+_+"C"+E+` = vec4(
                  xTexelR`+_+"C"+E+".xy, xTexelR"+_+"C"+(E+2)+`.xy);
              `,E+1<y&&(w+=`
                  xR`+_+"C"+(E+1)+` = vec4(
                    xTexelR`+_+"C"+E+".zw, xTexelR"+_+"C"+(E+2)+`.zw);
                `)),w+="}");E<y&&(w+=`
            vec4 wTexelR`+_+"C"+E+" = getW("+_+", "+E+`, d1, q);
            wR`+_+"C"+E+" = vec4(wTexelR"+_+"C"+E+".xz, wTexelR"+_+"C"+E+`.xz);
          `,E+1<y&&(w+=`
              vec4 wTexelR`+_+"C"+(E+1)+" = getW("+_+", "+(E+1)+`, d1, q);
              wR`+_+"C"+(E+1)+` =
                vec4(wTexelR`+_+"C"+(E+1)+".xz, wTexelR"+_+"C"+(E+1)+".xz);"))}for(_=0;_<m;_++)for(E=0;E<y;E++)w+="dotProd += xR"+_+"C"+E+" * wR"+_+"C"+E+";";var S="",T="";t&&(S=e?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+t+`
        }`:`vec4 activation(vec4 x) {
          `+t+`
        }`,T="result = activation(result);");var N=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),e&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+S+`

      const ivec2 strides = ivec2(`+f+", "+h+`);
      const ivec2 pads = ivec2(`+s+", "+l+`);

      void main() {

        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2;
        int q = 0;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        vec4 dotProd = vec4(0.);

        `+w+`

        vec4 result = dotProd;
        `+N+`
        `+T+`
        setOutput(result);
      }
    `},eC=function(r,n,t,e,a){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var u=r[0],s=r[1],l=r[2],f=r[3],h=n[0],p=t[0],v=t[1];this.outputShape=[h,p,v,f];var m=e==="bilinear"?1:0,y=[s-1+".0",l-1+".0"],x=y[0],w=y[1],_=p>1?[""+(s-1)/(p-1),"(y2-y1) * height_ratio","y1*"+x+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+x],E=_[0],R=_[1],A=_[2],S=v>1?[""+(l-1)/(v-1),"(x2-x1) * width_ratio","x1*"+w+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+w],T=S[0],N=S[1],O=S[2];this.userCode=`
      const float height_ratio = float(`+E+`);
      const float width_ratio = float(`+T+`);
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= `+u+`) {
          return;
        }

        float height_scale = `+R+`;
        float width_scale = `+N+`;

        float in_y = `+A+`;
        if( in_y < 0.0 || in_y > `+x+` ) {
          setOutput(float(`+a+`));
          return;
        }
        float in_x = `+O+`;
        if( in_x < 0.0 || in_x > `+w+` ) {
          setOutput(float(`+a+`));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(`+m+` == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `},nC=function(r,n,t){this.variableNames=["x"],this.outputShape=r;var e=r.length,a=r[r.length-1],u=t?"<":">";this.userCode=`
      int getIndex(int i) {
        `+(t?"return "+a+" -i - 1;":"return i;")+`
      }

      void main() {
        `+le(e)+` coords = getOutputCoords();
        int end = `+uy(e,"coords")+`;
        float val = 0.0;
        for (int i = `+a+` - 1; i >= 0; i -= 1) {
          int idx = getIndex(i);
          if (idx `+u+` end) {
            continue;
          }
          if (idx == end && `+n+`) {
            continue;
          }
          `+uy(e,"coords")+` = idx;
          val += getX(`+(function(s,l){if(s===1)return""+l;if(s===2)return l+".x, "+l+".y";if(s===3)return l+".x, "+l+".y, "+l+".z";if(s===4)return l+".x, "+l+".y, "+l+".z, "+l+".w";throw Error("Cumulative sum for rank "+s+" is not yet supported")})(e,"coords")+`);
        }
        setOutput(val);
      }
    `};function uy(r,n){if(r===1)return""+n;if(r===2)return n+".y";if(r===3)return n+".z";if(r===4)return n+".w";throw Error("Cumulative sum for rank "+r+" is not yet supported")}var rC=function(r){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Mu.DENSE;var n=Ru(r),t=en();this.outputShape=r,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+ci(["r","c","d"],r)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+n[0]+", "+n[1]+`));
        int index = 4 * (resTexRC.x * `+n[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        `+t.output+` = result;
      }
    `},aC=function(r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Mu.DENSE;var n=Ru(r),t=en();this.outputShape=r,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+ci(["r","c","d"],r)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+n[0]+", "+n[1]+`));
        int index = 4 * (resTexRC.x * `+n[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        `+t.output+` = result;
      }
    `},iC=(function(){function r(n,t,e){this.variableNames=["x"],this.outputShape=[],this.outputShape=n,this.blockSize=t,this.dataFormat=e,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = `+this.getHeightCoordString()+`;
      int w = `+this.getWidthCoordString()+`;
      int d = `+this.getDepthCoordString()+`;

      int in_h = h / `+t+`;
      int offset_h = imod(h, `+t+`);
      int in_w = w / `+t+`;
      int offset_w = imod(w, `+t+`);
      int offset_d = (offset_h * `+t+` + offset_w) *
        `+this.getOutputDepthSize()+`;
      int in_d = d + offset_d;

      float result = `+this.getInputSamplingString()+`;
      setOutput(result);
    }
  `}return r.prototype.getHeightCoordString=function(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"},r.prototype.getWidthCoordString=function(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"},r.prototype.getDepthCoordString=function(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"},r.prototype.getOutputDepthSize=function(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]},r.prototype.getInputSamplingString=function(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},r})(),oC=function(r){this.variableNames=["X"],this.outputShape=[r,r],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `},uC=function(r){this.variableNames=["A"],this.outTexUsage=kn.DOWNLOAD;var n=en();this.outputShape=r,this.userCode=`
      `+R1+`

      void main() {
        float x = getAAtOutCoords();
        `+n.output+` = encode_float(x);
      }
    `},sC=function(r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=kn.DOWNLOAD;var n=en();this.outputShape=r,this.userCode=`
      `+R1+`

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        `+n.output+` = encode_float(x);
      }
    `},lC=function(r,n,t){t===void 0&&(t=!1),this.variableNames=["A"];var e=en(),a=n[0],u=n[1];this.outputShape=r;var s="result";t&&(s="floor(result * 255. + 0.5)"),this.userCode=`
      `+Hd(r)+`

      void main() {
        ivec3 coords = getOutputCoords();

        int flatIndex = getFlatIndex(coords);
        int offset = imod(flatIndex, 4);

        flatIndex = idiv(flatIndex, 4, 1.);
        
        int r = flatIndex / `+u+`;
        int c = imod(flatIndex, `+u+`);
        vec2 uv = (vec2(c, r) + halfCR) / vec2(`+u+".0, "+a+`.0);
        vec4 values = `+e.texture2D+`(A, uv);

        float result;

        if(offset == 0) {
          result = values[0];
        } else if(offset == 1) {
          result = values[1];
        } else if(offset == 2) {
          result = values[2];
        } else {
          result = values[3];
        }

        `+e.output+" = vec4("+s+`, 0., 0., 0.);
      }
    `},cC=function(r,n,t){t===void 0&&(t=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var e=en(),a=n[0],u=n[1];this.outputShape=r;var s="",l="result";t&&(l="floor(result * 255. + 0.5)");for(var f=0;f<=1;f++)for(var h=0;h<=1;h++){var p=2*f+h;s+=`
          localCoords = coords;
          if(localCoords[2] + `+h+" < "+r[2]+`) {
            localCoords[2] += `+h+`;
            if(localCoords[1] + `+f+" < "+r[1]+`) {
              localCoords[1] += `+f+`;

              flatIndex = getFlatIndex(localCoords);
              offset = imod(flatIndex, 4);

              flatIndex = idiv(flatIndex, 4, 1.);

              r = flatIndex / `+u+`;
              c = imod(flatIndex, `+u+`);
              uv = (vec2(c, r) + halfCR) / vec2(`+u+".0, "+a+`.0);
              values = `+e.texture2D+`(A, uv);

              if(offset == 0) {
                result[`+p+`] = values[0];
              } else if(offset == 1) {
                result[`+p+`] = values[1];
              } else if(offset == 2) {
                result[`+p+`] = values[2];
              } else {
                result[`+p+`] = values[3];
              }
            }
          }
        `}this.userCode=`
      `+Hd(r)+`

      void main() {
        ivec3 coords = getOutputCoords();

        vec4 result = vec4(0.);
        int flatIndex, r, c, offset;
        ivec3 localCoords;
        vec2 uv;
        vec4 values;

        `+s+`

        `+e.output+" = "+l+`;
      }
    `},fC="return real * expR - imag * expI;",hC="return real * expI + imag * expR;",sy=function(r,n,t){this.variableNames=["real","imag"];var e=n[1];this.outputShape=n;var a=t?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,u=t?e+".0":"1.0";this.userCode=`
      const float exponentMultiplier = `+a+`;

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        `+r+`
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(`+e+`);
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < `+e+`; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / `+u+`;
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `},dC=(function(){function r(n,t){this.outputShape=[],this.variableNames=["x"],this.outputShape=n,this.userCode=`
      uniform float value;
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}return r.prototype.getCustomSetupFunc=function(n){var t=this;return function(e,a){t.valueLoc==null&&(t.valueLoc=e.getUniformLocationNoThrow(a,"value")),e.gl.uniform1f(t.valueLoc,n)}},r})(),pC=function(r,n,t){this.variableNames=["A","indices"];var e=r.slice();e[t]=n,this.outputShape=e,this.rank=e.length;var a=le(this.rank),u=(function(s,l){var f=s.length;if(f>4)throw Error("Gather for rank "+f+" is not yet supported");if(f===1)return"int(getIndices(resRC))";for(var h=["resRC.x","resRC.y","resRC.z","resRC.w"],p=[],v=0;v<s.length;v++)v===l?p.push("int(getIndices("+h[v]+"))"):p.push(""+h[v]);return p.join()})(r,t);this.userCode=`
      void main() {
        `+a+` resRC = getOutputCoords();
        setOutput(getA(`+u+`));
      }
    `},vC=function(r,n,t){this.sliceDim=r,this.strides=n,this.variableNames=["x","indices"],this.outputShape=t;var e=le(n.length),a=le(t.length),u=this.sliceDim>1?"strides[j]":"strides";this.userCode=`
        `+e+" strides = "+e+"("+this.strides+`);
         void main() {
          `+a+` coords = getOutputCoords();
          int flattenIndex = 0;
          for (int j = 0; j < `+this.sliceDim+`; j++) {
            int index = round(getIndices(coords[0], j));
            flattenIndex += index * `+u+`;
          }
          setOutput(getX(flattenIndex, coords[1]));
        }
      `};function mC(r,n){var t=en();return f_(r,n,t.version+`
    precision highp float;
    `+t.attribute+` vec3 clipSpacePos;
    `+t.attribute+` vec2 uv;
    `+t.varyingVs+` vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`)}function gC(r,n){return m_(r,n,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function yC(r,n){return g_(r,n,new Uint16Array([0,1,2,2,1,3]))}function Vu(r,n,t,e,a,u,s){b_(t,e);var l=y_(r,n),f=r.TEXTURE_2D;return Et(r,n,(function(){return r.bindTexture(f,l)})),Et(r,n,(function(){return r.texParameteri(f,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE)})),Et(r,n,(function(){return r.texParameteri(f,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE)})),Et(r,n,(function(){return r.texParameteri(f,r.TEXTURE_MIN_FILTER,r.NEAREST)})),Et(r,n,(function(){return r.texParameteri(f,r.TEXTURE_MAG_FILTER,r.NEAREST)})),Et(r,n,(function(){return r.texImage2D(f,0,a,t,e,0,u,s,null)})),Et(r,n,(function(){return r.bindTexture(r.TEXTURE_2D,null)})),l}function bC(r,n,t,e,a){var u=Yl(t,e);return Vu(r,n,u[0],u[1],a.internalFormatFloat,a.textureFormatFloat,r.FLOAT)}function xC(r,n,t,e,a){var u=Yl(t,e);return Vu(r,n,u[0],u[1],a.internalFormatHalfFloat,a.textureFormatFloat,a.textureTypeHalfFloat)}function wC(r,n,t,e,a){var u=Yl(t,e);return Vu(r,n,u[0],u[1],r.RGBA,r.RGBA,r.UNSIGNED_BYTE)}function _C(r,n,t,e,a){var u=Hu(t,e);return Vu(r,n,u[0],u[1],a.internalFormatPackedFloat,r.RGBA,r.FLOAT)}function EC(r,n,t,e,a){var u=Hu(t,e);return Vu(r,n,u[0],u[1],a.internalFormatPackedHalfFloat,r.RGBA,a.textureTypeHalfFloat)}function CC(r,n,t,e){return Et(r,n,(function(){return r.bindBuffer(r.ARRAY_BUFFER,e)})),Y0(r,n,t,"clipSpacePos",e,3,20,0)&&Y0(r,n,t,"uv",e,2,20,12)}function SC(r,n,t,e,a,u,s){var l,f,h;Et(r,n,(function(){return r.bindTexture(r.TEXTURE_2D,t)})),u instanceof Uint8Array?(l=new Uint8Array(e*a*4),f=r.UNSIGNED_BYTE,h=r.RGBA):(l=new Float32Array(e*a*4),f=r.FLOAT,h=s.internalFormatPackedFloat),l.set(u),Et(r,n,(function(){return r.texImage2D(r.TEXTURE_2D,0,h,e,a,0,r.RGBA,f,l)})),Et(r,n,(function(){return r.bindTexture(r.TEXTURE_2D,null)}))}function RC(r,n,t,e){Et(r,n,(function(){return r.bindTexture(r.TEXTURE_2D,t)})),e.data instanceof Uint8Array?Et(r,n,(function(){return r.texImage2D(r.TEXTURE_2D,0,r.RGBA,e.width,e.height,0,r.RGBA,r.UNSIGNED_BYTE,e.data)})):Et(r,n,(function(){return r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,e)})),Et(r,n,(function(){return r.bindTexture(r.TEXTURE_2D,null)}))}function AC(r,n,t,e,a){var u=r.createBuffer();Et(r,n,(function(){return r.bindBuffer(r.PIXEL_PACK_BUFFER,u)}));var s=16*t*e;return Et(r,n,(function(){return r.bufferData(r.PIXEL_PACK_BUFFER,s,r.STREAM_READ)})),Et(r,n,(function(){return r.readPixels(0,0,e,t,r.RGBA,r.FLOAT,0)})),Et(r,n,(function(){return r.bindBuffer(r.PIXEL_PACK_BUFFER,null)})),u}function TC(r,n,t){var e=r,a=new Float32Array(t);return e.bindBuffer(e.PIXEL_PACK_BUFFER,n),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,a),e.bindBuffer(e.PIXEL_PACK_BUFFER,null),a}function DC(r,n,t,e,a){var u=Yl(t,e),s=u[0],l=u[1],f=new Uint8Array(t*e*4);return Et(r,n,(function(){return r.readPixels(0,0,s,l,a.downloadTextureFormat,r.UNSIGNED_BYTE,f)})),new Float32Array(f.buffer)}function NC(r,n,t,e,a,u,s,l){var f=r,h=new Float32Array((function(p,v){var m=Hu(p,v);return m[0]*m[1]*4})(u,s));return f.bindBuffer(f.PIXEL_PACK_BUFFER,n),f.getBufferSubData(f.PIXEL_PACK_BUFFER,0,h),f.bindBuffer(f.PIXEL_PACK_BUFFER,null),h}function MC(r,n,t,e){var a=new Float32Array(t*e*4);return Et(r,n,(function(){return r.readPixels(0,0,e,t,r.RGBA,r.FLOAT,a)})),a}var OC=(function(){function r(n){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var t=st().getNumber("WEBGL_VERSION");n!=null?(this.gl=n,o_(t,n)):this.gl=Ar(t);var e="WEBGL_color_buffer_float";if(st().getNumber("WEBGL_VERSION")===1){if(this.textureFloatExtension=hl(this.gl,this.debug,"OES_texture_float"),Jn(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=hl(this.gl,this.debug,"OES_texture_half_float");else if(st().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(e),Jn(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=hl(this.gl,this.debug,"EXT_color_buffer_half_float");else if(st().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(e="EXT_color_buffer_float",Jn(this.gl,e))this.colorBufferFloatExtension=this.gl.getExtension(e);else{if(!Jn(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=gC(this.gl,this.debug),this.indexBuffer=yC(this.gl,this.debug),this.framebuffer=x_(this.gl,this.debug),this.textureConfig=Md(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(r.prototype,"debug",{get:function(){return st().getBool("DEBUG")},enumerable:!0,configurable:!0}),r.prototype.dispose=function(){var n=this;if(!this.disposed){this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;Et(t,this.debug,(function(){return t.finish()})),Et(t,this.debug,(function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)})),Et(t,this.debug,(function(){return t.deleteFramebuffer(n.framebuffer)})),Et(t,this.debug,(function(){return t.bindBuffer(t.ARRAY_BUFFER,null)})),Et(t,this.debug,(function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)})),Et(t,this.debug,(function(){return t.deleteBuffer(n.indexBuffer)})),this.disposed=!0}},r.prototype.createFloat32MatrixTexture=function(n,t){return this.throwIfDisposed(),bC(this.gl,this.debug,n,t,this.textureConfig)},r.prototype.createFloat16MatrixTexture=function(n,t){return this.throwIfDisposed(),xC(this.gl,this.debug,n,t,this.textureConfig)},r.prototype.createUnsignedBytesMatrixTexture=function(n,t){return this.throwIfDisposed(),wC(this.gl,this.debug,n,t,this.textureConfig)},r.prototype.uploadPixelDataToTexture=function(n,t){this.throwIfDisposed(),RC(this.gl,this.debug,n,t)},r.prototype.uploadDenseMatrixToTexture=function(n,t,e,a){this.throwIfDisposed(),SC(this.gl,this.debug,n,t,e,a,this.textureConfig)},r.prototype.createFloat16PackedMatrixTexture=function(n,t){return this.throwIfDisposed(),EC(this.gl,this.debug,n,t,this.textureConfig)},r.prototype.createPackedMatrixTexture=function(n,t){return this.throwIfDisposed(),_C(this.gl,this.debug,n,t,this.textureConfig)},r.prototype.deleteMatrixTexture=function(n){var t=this;this.throwIfDisposed(),this.outputTexture===n&&(Q0(this.gl,this.debug,this.framebuffer),this.outputTexture=null),Et(this.gl,this.debug,(function(){return t.gl.deleteTexture(n)}))},r.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(n,t,e){var a=this;return this.downloadMatrixDriver(n,(function(){return DC(a.gl,a.debug,t,e,a.textureConfig)}))},r.prototype.downloadPackedMatrixFromBuffer=function(n,t,e,a,u,s){return NC(this.gl,n,0,0,0,u,s,this.textureConfig)},r.prototype.downloadFloat32MatrixFromBuffer=function(n,t){return TC(this.gl,n,t)},r.prototype.createBufferFromTexture=function(n,t,e){this.bindTextureToFrameBuffer(n);var a=AC(this.gl,this.debug,t,e,this.textureConfig);return this.unbindTextureToFrameBuffer(),a},r.prototype.createAndWaitForFence=function(){var n=this.createFence(this.gl);return this.pollFence(n)},r.prototype.createFence=function(n){var t,e,a=this;if(st().getBool("WEBGL_FENCE_API_ENABLED")){var u=n,s=u.fenceSync(u.SYNC_GPU_COMMANDS_COMPLETE,0);n.flush(),e=function(){var l=u.clientWaitSync(s,0,0);return l===u.ALREADY_SIGNALED||l===u.CONDITION_SATISFIED},t=s}else st().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),e=function(){return a.isQueryAvailable(t,st().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):e=function(){return!0};return{query:t,isFencePassed:e}},r.prototype.downloadMatrixFromPackedTexture=function(n,t,e){var a=this;return this.downloadMatrixDriver(n,(function(){return MC(a.gl,a.debug,t,e)}))},r.prototype.createProgram=function(n){this.throwIfDisposed();var t=this.gl,e=h_(t,this.debug,n),a=mC(t,this.debug),u=p_(t,this.debug);return Et(t,this.debug,(function(){return t.attachShader(u,a)})),Et(t,this.debug,(function(){return t.attachShader(u,e)})),v_(t,this.debug,u),this.debug&&Uh(t,this.debug,u),this.vertexAttrsAreBound||(this.setProgram(u),this.vertexAttrsAreBound=CC(t,this.debug,this.program,this.vertexBuffer)),u},r.prototype.deleteProgram=function(n){var t=this;this.throwIfDisposed(),n===this.program&&(this.program=null),n!=null&&Et(this.gl,this.debug,(function(){return t.gl.deleteProgram(n)}))},r.prototype.setProgram=function(n){var t=this;this.throwIfDisposed(),this.program=n,this.program!=null&&this.debug&&Uh(this.gl,this.debug,this.program),Et(this.gl,this.debug,(function(){return t.gl.useProgram(n)}))},r.prototype.getUniformLocation=function(n,t,e){return e===void 0&&(e=!0),this.throwIfDisposed(),e?__(this.gl,this.debug,n,t):E_(this.gl,n,t)},r.prototype.getAttributeLocation=function(n,t){var e=this;return this.throwIfDisposed(),Et(this.gl,this.debug,(function(){return e.gl.getAttribLocation(n,t)}))},r.prototype.getUniformLocationNoThrow=function(n,t){return this.throwIfDisposed(),this.gl.getUniformLocation(n,t)},r.prototype.setInputMatrixTexture=function(n,t,e){this.throwIfDisposed(),this.throwIfNoProgram(),C_(this.gl,this.debug,this.program,n,t,e)},r.prototype.setOutputMatrixTexture=function(n,t,e){this.setOutputMatrixTextureDriver(n,e,t)},r.prototype.setOutputPackedMatrixTexture=function(n,t,e){this.throwIfDisposed();var a=Hu(t,e),u=a[0],s=a[1];this.setOutputMatrixTextureDriver(n,u,s)},r.prototype.setOutputMatrixWriteRegion=function(n,t,e,a){this.setOutputMatrixWriteRegionDriver(e,n,a,t)},r.prototype.setOutputPackedMatrixWriteRegion=function(n,t,e,a){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},r.prototype.debugValidate=function(){this.program!=null&&Uh(this.gl,this.debug,this.program),dl(this.gl)},r.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var n=this.gl;this.debug&&this.debugValidate(),Et(n,this.debug,(function(){return n.drawElements(n.TRIANGLES,6,n.UNSIGNED_SHORT,0)}))},r.prototype.blockUntilAllProgramsCompleted=function(){var n=this;this.throwIfDisposed(),Et(this.gl,this.debug,(function(){return n.gl.finish()}))},r.prototype.getQueryTimerExtension=function(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=hl(this.gl,this.debug,st().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},r.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},r.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},r.prototype.beginQuery=function(){if(st().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var n=this.gl,t=this.getQueryTimerExtensionWebGL2(),e=n.createQuery();return n.beginQuery(t.TIME_ELAPSED_EXT,e),e}var a=this.getQueryTimerExtensionWebGL1(),u=a.createQueryEXT();return a.beginQueryEXT(a.TIME_ELAPSED_EXT,u),u},r.prototype.endQuery=function(){if(st().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")!==2){var n=this.getQueryTimerExtensionWebGL1();n.endQueryEXT(n.TIME_ELAPSED_EXT)}else{var t=this.gl,e=this.getQueryTimerExtensionWebGL2();t.endQuery(e.TIME_ELAPSED_EXT)}},r.prototype.waitForQueryAndGetTime=function(n){return bt(this,void 0,void 0,(function(){var t=this;return xt(this,(function(e){switch(e.label){case 0:return[4,G0((function(){return t.disposed||t.isQueryAvailable(n,st().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}))];case 1:return e.sent(),[2,this.getQueryTime(n,st().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}}))}))},r.prototype.getQueryTime=function(n,t){if(t===0)return null;if(t===2){var e=this.gl;return e.getQueryParameter(n,e.QUERY_RESULT)/1e6}var a=this.getQueryTimerExtensionWebGL1();return a.getQueryObjectEXT(n,a.QUERY_RESULT_EXT)/1e6},r.prototype.isQueryAvailable=function(n,t){if(t===0)return!0;if(t===2){var e=this.gl,a=this.getQueryTimerExtensionWebGL2(),u=e.getQueryParameter(n,e.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(a.GPU_DISJOINT_EXT)),u&&!this.disjoint}return u=(a=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(n,a.QUERY_RESULT_AVAILABLE_EXT),this.disjoint==null&&(this.disjoint=this.gl.getParameter(a.GPU_DISJOINT_EXT)),u&&!this.disjoint},r.prototype.pollFence=function(n){var t=this;return new Promise((function(e){t.addItemToPoll((function(){return n.isFencePassed()}),(function(){return e()}))}))},r.prototype.pollItems=function(){for(var n=(function(e){for(var a=0;a<e.length&&e[a]();++a);return a-1})(this.itemsToPoll.map((function(e){return e.isDoneFn}))),t=0;t<=n;++t)(0,this.itemsToPoll[t].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(n+1)},r.prototype.addItemToPoll=function(n,t){var e=this;this.itemsToPoll.push({isDoneFn:n,resolveFn:t}),this.itemsToPoll.length>1||G0((function(){return e.pollItems(),e.itemsToPoll.length===0}))},r.prototype.bindTextureToFrameBuffer=function(n){this.throwIfDisposed(),Ph(this.gl,this.debug,n,this.framebuffer),this.debug&&dl(this.gl)},r.prototype.unbindTextureToFrameBuffer=function(){this.outputTexture!=null?(Ph(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&dl(this.gl)):Q0(this.gl,this.debug,this.framebuffer)},r.prototype.downloadMatrixDriver=function(n,t){this.bindTextureToFrameBuffer(n);var e=t();return this.unbindTextureToFrameBuffer(),e},r.prototype.setOutputMatrixTextureDriver=function(n,t,e){this.throwIfDisposed();var a=this.gl;Ph(a,this.debug,n,this.framebuffer),this.debug&&dl(a),this.outputTexture=n,Et(a,this.debug,(function(){return a.viewport(0,0,t,e)})),Et(a,this.debug,(function(){return a.scissor(0,0,t,e)}))},r.prototype.setOutputMatrixWriteRegionDriver=function(n,t,e,a){var u=this;this.throwIfDisposed(),Et(this.gl,this.debug,(function(){return u.gl.scissor(n,t,e,a)}))},r.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},r.prototype.throwIfNoProgram=function(){if(this.program==null)throw new Error("No GPU program is currently set.")},r})();function ly(r,n){if(r.length!==n.length)throw Error("Binary was compiled with "+r.length+" inputs, but was executed with "+n.length+" inputs");r.forEach((function(t,e){var a=t.logicalShape,u=n[e],s=u.shape;if(!Pe(a,s))throw Error("Binary was compiled with different shapes than the current args. Shapes "+a+" and "+s+" must match");if(!t.isUniform||!u.isUniform){var l=t.texShape,f=u.isUniform?null:u.texData.texShape;if(!Pe(l,f))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+l+" and "+f+" must match")}}))}var kC=function(r,n,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r;for(var e=t.filterWidth,a=t.inChannels,u=t.strideWidth,s=t.strideHeight,l=t.padInfo,f=t.outWidth,h=t.dilationWidth,p=t.dilationHeight,v=t.dataFormat,m=l.left,y=l.top,x=a*e,w=en(),_=v==="channelsLast",E=_?0:1,R=_?1:2,A="",S=0;S<=1;S++)for(var T=0;T<=1;T++)A+=`
          blockIndex = rc.y + `+T+`;
          pos = rc.x + `+S+`;

          if(blockIndex < `+r[1]+" && pos < "+r[0]+`) {
            offsetY = int(blockIndex / (`+f+")) * "+s+" - "+y+`;
            d0 = offsetY + `+p+" * (pos / "+x+`);

            if(d0 < `+n[E]+` && d0 >= 0) {

              offsetX = int(mod(float(blockIndex), `+f+".) * "+u+". - "+m+`.);
              d1 = offsetX + `+h+" * (int(mod(float(pos), "+x+".) / "+a+`.));

              if(d1 < `+n[R]+` && d1 >= 0) {

                ch = int(mod(float(pos), `+a+`.));

                if (`+_+`) {
                  innerDims = vec2(d1, ch);
                  result[`+(2*S+T)+`] = getChannel(
                    getA(d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[`+(2*S+T)+`] = getChannel(
                    getA(ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec2 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        `+A+`

        `+w.output+` = result;
      }
    `},IC=function(r,n,t,e,a){this.variableNames=["x"],this.outputShape=[];var u,s=n,l=r[3]-1;this.outputShape=r;var f="float("+t+") + float("+e+") * sum";u=a===.5?"inversesqrt("+f+")":a===1?"1.0/("+f+")":"exp(log("+f+") * float(-"+a+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -`+s+"; j <= "+s+`; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  `+l+`) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * `+u+`;
        setOutput(val);
      }
    `},BC=function(r,n,t,e,a){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=r,this.depth=r[3],this.depthRadius=n,this.bias=t,this.alpha=e,this.beta=a,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < `+this.depth+`; ++d) {
          int depthBegin = int(max(0.0, float(d - `+n+`)));
          int depthEnd = int(min(float(`+this.depth+`),
              float(d + `+n+` + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = `+this.depth+`;

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(`+e+") * norm + float("+t+`);

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(`+e+`)
                * float(`+a+`)
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * `+a+`);
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `},FC=function(r,n,t,e,a){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var u,s=n,l=r[3]-1;this.outputShape=r;var f="float("+t+") + float("+e+") * sum";u=a===.5?"inversesqrt("+f+")":a===1?"1.0/("+f+")":"exp(log("+f+") * float(-"+a+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < `+this.outputShape[3]+`;
        bool hasNextRow = c < `+this.outputShape[2]+`;

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - `+s+`;
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - `+s+"; j <= "+s+`; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(`+l+`));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * `+u+`;
        setOutput(result);
      }
    `},zC=function(r){this.variableNames=["dy","maxPos"],this.outputShape=r.inShape;var n=r.strideHeight,t=r.strideWidth,e=r.dilationHeight,a=r.effectiveFilterHeight,u=r.effectiveFilterWidth,s=a-1-r.padInfo.top,l=u-1-r.padInfo.left,f=a*u-1;this.userCode=`
      const ivec2 pads = ivec2(`+s+", "+l+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+a+`;
          wR += `+e+`) {
          float dyR = float(dyRCorner + wR) / `+n+`.0;

          if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+u+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+t+`.0;

            if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = `+f+` - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * `+u+` + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `},LC=function(r){this.variableNames=["dy","maxPos"],this.outputShape=r.inShape;var n=r.strideDepth,t=r.strideHeight,e=r.strideWidth,a=r.dilationDepth,u=r.dilationHeight,s=r.dilationWidth,l=r.effectiveFilterDepth,f=r.effectiveFilterHeight,h=r.effectiveFilterWidth,p=l-1-r.padInfo.front,v=f-1-r.padInfo.top,m=h-1-r.padInfo.left,y=l*f*h-1;this.userCode=`
      const ivec3 pads = ivec3(`+p+", "+v+", "+m+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+l+`;
           wD += `+a+`) {
          float dyD = float(dyDCorner + wD) / `+n+`.0;

          if (dyD < 0.0 || dyD >= `+r.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+f+`;
              wR += `+u+`) {
            float dyR = float(dyRCorner + wR) / `+t+`.0;

            if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+h+`;
                wC += `+s+`) {
              float dyC = float(dyCCorner + wC) / `+e+`.0;

              if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = `+y+` -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * `+f+" * "+h+` +
                  wR * `+h+` + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `},qh=function(r,n,t,e,a,u,s){t===void 0&&(t=!1),e===void 0&&(e=!1),a===void 0&&(a=!1),u===void 0&&(u=null),s===void 0&&(s=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;var l=t?r[1]:r[2],f=Math.ceil(l/2),h=t?"i * 2, rc.y":"rc.y, i * 2",p=e?"rc.z, i * 2":"i * 2, rc.z",v=t?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],m=e?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],y="",x="";u&&(y=s?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+u+`
        }`:`vec4 activation(vec4 x) {
          `+u+`
        }`,x="result = activation(result);");var w=a?"result += getBiasAtOutCoords();":"";a&&this.variableNames.push("bias"),s&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+y+`

      const float sharedDimension = `+f+`.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < `+f+`; i++) {
          vec4 a = getMatrixA(rc.x, `+h+`);
          vec4 b = getMatrixB(rc.x, `+p+`);

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (`+v[0]+" * "+m[0]+`);
          result += (`+v[1]+" * "+m[1]+`);
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        `+w+`

        `+x+`

        setOutput(result);
      }
    `},UC=(function(){function r(n,t,e){this.variableNames=["probs"],this.outputShape=[n,e],this.userCode=`
      uniform float seed;

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < `+(t-1)+`; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(`+(t-1)+`));
      }
    `}return r.prototype.getCustomSetupFunc=function(n){var t=this;return function(e,a){t.seedLoc==null&&(t.seedLoc=e.getUniformLocation(a,"seed")),e.gl.uniform1f(t.seedLoc,n)}},r})(),PC=function(r,n,t,e){this.variableNames=["indices"],this.outputShape=[r,n],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(`+e+"), float("+t+`),
                      float(index == coords.y)));
      }
    `},HC=function(r){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=r;var n=r.length;if(n===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{var t=gn("rc",n),e=le(n),a=(function(l,f,h){if(l===1)return"rc > "+f[0];for(var p="",v=l-2;v<l;v++)p+=h[v]+" >= "+f[v],v<l-1&&(p+="||");return p})(n,r,t),u=(function(l,f,h,p){if(l===1)return"";var v=p.slice(-2);return`
    int r = `+v[0]+`;
    int c = `+v[1]+`;
    int rp1 = r + 1;
    int cp1 = c + 1;

    bool cEdge = cp1 >= `+f+`;
    bool rEdge = rp1 >= `+h+`;
  `})(n,r[r.length-1],r[r.length-2],t),s=(function(l,f){var h=l.length,p=(function(v,m){for(var y=[],x=0;x<=1;x++)for(var w=0;w<=1;w++){for(var _=(x===0?"r":"rp1")+", "+(w===0?"c":"cp1"),E=2;E<v;E++)_=m[m.length-1-E]+","+_;y.push(_)}return y})(h,f);return h===1?`getA(rc),
            rc + 1 >= `+l[0]+` ? 0. : getA(rc + 1),
            0, 0`:"getA("+p[0]+`),
          cEdge ? 0. : getA(`+p[1]+`),
          rEdge ? 0. : getA(`+p[2]+`),
          rEdge || cEdge ? 0. : getA(`+p[3]+")"})(r,t);this.userCode=`
        void main() {
          `+e+` rc = getOutputCoords();

          if(`+a+`) {
            setOutput(vec4(0));
          } else {
            `+u+`

            setOutput(vec4(`+s+`));
          }
        }
      `}},VC=function(r,n,t){this.variableNames=["x"],this.outputShape=n.map((function(f,h){return f[0]+r[h]+f[1]}));var e=r.length,a=le(e),u=n.map((function(f){return f[0]})).join(","),s=n.map((function(f,h){return f[0]+r[h]})).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,e);this.userCode=e!==1?`
      `+a+" start = "+a+"("+u+`);
      `+a+" end = "+a+"("+s+`);

      void main() {
        `+a+` outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(float(`+t+`));
        } else {
          `+a+` coords = outC - start;
          setOutput(getX(`+l+`));
        }
      }
    `:`
        int start = `+u+`;
        int end = `+s+`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(float(`+t+`));
          } else {
            setOutput(getX(outC - start));
          }
        }
      `},GC=function(r,n,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.map((function(_,E){return _[0]+r[E]+_[1]}));for(var e=r.length,a=le(e),u=n.map((function(_){return _[0]})).join(","),s=n.map((function(_,E){return _[0]+r[E]})).join(","),l=gn("rc",e),f=gn("source",e),h=l[e-1]+" < "+this.outputShape[e-1],p=e===1?"source":"vec2("+f.slice(-2).join()+")",v=[a+" rc = outputLoc;",l[e-1]+` += 1;
       if(`+h+`) {
      `,e===1?"":`}
       rc = outputLoc;
       `+l[e-2]+` += 1;
       if(`+l[e-2]+" < "+this.outputShape[e-2]+") {",e===1?"":"  "+l[e-1]+` += 1;
         if(`+h+") {"],m=e===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",y="",x=0,w=e===1?2:4;x<w;x++)y+=`
        `+v[x]+`
        if (`+m+`) {
          result[`+x+"] = float("+t+`);
        } else {
          `+a+` source = rc - start;
          result[`+x+"] = getChannel(getX("+f.join()+"), "+p+`);
        }
      `;y+=e===1?"} ":"}}",this.userCode=`
      const `+a+" start = "+a+"("+u+`);
      const `+a+" end = "+a+"("+s+`);

      void main() {
        `+a+` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `+y+`
        setOutput(result);
      }
    `},jh=function(r,n,t){if(this.variableNames=["x"],n==="avg"&&t)throw new Error("Cannot compute positions for average pool.");var e=r.filterWidth,a=r.strideHeight,u=r.strideWidth,s=r.dilationHeight,l=r.dilationWidth,f=r.effectiveFilterHeight,h=r.effectiveFilterWidth,p=r.padInfo.top,v=r.padInfo.left;this.outputShape=r.outShape;var m=n==="avg",y="0.0";if(m||(y="-1.0 / 1e-20"),t)this.userCode=`
        const ivec2 strides = ivec2(`+a+", "+u+`);
        const ivec2 pads = ivec2(`+p+", "+v+`);

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < `+f+`;
              wR += `+s+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+r.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+h+`;
                wC += `+l+`) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= `+r.inWidth+`) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value >= currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = wR * `+h+` + wC;
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var x=n+"("+n+"("+n+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";n==="avg"&&(x="avgValue / count");var w=4*Math.floor(e/4),_=e%4,E=`
      if (`+m+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(`+a+", "+u+`);
      const ivec2 pads = ivec2(`+p+", "+v+`);
      const float initializationValue = `+y+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= `+r.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+y+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < `+f+`;
            wR += `+s+`) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= `+r.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+w+`; wC += 4) {
            int xC = xCCorner + wC * `+l+`;

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+l+`, d),
              getValue(batch, xR, xC + 2 * `+l+`, d),
              getValue(batch, xR, xC + 3 * `+l+`, d)
            );

            `+E+`
          }

          int xC = xCCorner + `+w+`;
          if (`+(_===1)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            `+E+`
          } else if (`+(_===2)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+l+`, d),
              initializationValue,
              initializationValue
            );

            `+E+`
          } else if (`+(_===3)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+l+`, d),
              getValue(batch, xR, xC + 2 * `+l+`, d),
              initializationValue
            );

            `+E+`
          }
        }
        setOutput(`+x+`);
      }
    `}},Xh=function(r,n,t){if(this.variableNames=["x"],n==="avg"&&t)throw new Error("Cannot compute positions for average pool.");var e=r.filterWidth,a=r.strideDepth,u=r.strideHeight,s=r.strideWidth,l=r.dilationDepth,f=r.dilationHeight,h=r.dilationWidth,p=r.effectiveFilterDepth,v=r.effectiveFilterHeight,m=r.effectiveFilterWidth,y=r.padInfo.front,x=r.padInfo.top,w=r.padInfo.left;this.outputShape=r.outShape;var _=n==="avg",E="0.0";if(_||(E="-1.0 / 1e-20"),t)this.userCode=`
        const ivec3 strides =
            ivec3(`+a+", "+u+", "+s+`);
        const ivec3 pads = ivec3(`+y+", "+x+", "+w+`);

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < `+p+`;
              wD += `+l+`) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= `+r.inDepth+`) {
              continue;
            }

            for (int wR = 0; wR < `+v+`;
                wR += `+f+`) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= `+r.inHeight+`) {
                continue;
              }

              for (int wC = 0; wC < `+m+`;
                  wC += `+h+`) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= `+r.inWidth+`) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value >= currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition =
                      wD * `+v+" * "+m+` +
                      wR * `+m+` + wC;;
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var R=n+"("+n+"("+n+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";n==="avg"&&(R="avgValue / count");var A=4*Math.floor(e/4),S=e%4,T=`
      if (`+_+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(`+a+", "+u+", "+s+`);
      const ivec3 pads = ivec3(`+y+", "+x+", "+w+`);
      const float initializationValue = `+E+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= `+r.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+E+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < `+p+`;
            wD += `+l+`) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= `+r.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+v+`;
            wR += `+f+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+r.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+A+`; wC += 4) {
              int xC = xCCorner + wC * `+h+`;

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+h+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+h+`, ch),
                getValue(batch, xD, xR, xC + 3 * `+h+`, ch)
              );

              `+T+`
            }

            int xC = xCCorner + `+A+`;
            if (`+(S===1)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              `+T+`
            } else if (`+(S===2)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+h+`, ch),
                initializationValue,
                initializationValue
              );

              `+T+`
            } else if (`+(S===3)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+h+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+h+`, ch),
                initializationValue
              );

              `+T+`
            }
          }
          setOutput(`+R+`);
        }
      }
    `}},WC=function(r,n){this.variableNames=["x"];var t=r.windowSize,e=r.batchSize,a=r.inSize,u=Math.ceil(a/t);this.outputShape=[e,u];var s="0.0",l="";n==="prod"?s="1.0":n==="min"?(s="1.0 / 1e-20",l="min"):n==="max"&&(s="-1.0 / 1e-20",l="max");var f=n+"("+n+"("+n+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";n==="sum"?f="sumValue":n==="prod"?f="prodValue":n==="all"?f="allValue":n==="any"&&(f="anyValue");var h=4*Math.floor(t/4),p=t%4,v=`
      if (`+(n==="sum")+`) {
        sumValue += dot(values, ones);
      } else if (`+(n==="prod")+`) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = `+l+`(values, minMaxValue);
      }
    `,m="vec4";n==="all"?(s="1.0",v=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,m="bvec4"):n==="any"&&(s="0.0",v=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,m="bvec4");var y="";a%t>0&&(y=`
        if (inIdx < 0 || inIdx >= `+a+`) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = `+s+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `+y+`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+t+`;

        vec4 minMaxValue = vec4(`+s+`);
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < `+h+`; i += 4) {
          int inIdx = inOffset + i;
          `+m+" values = "+m+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `+v+`
        }

        int inIdx = inOffset + `+h+`;
        if (`+(p===1)+`) {
          `+m+" values = "+m+`(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          `+v+`
        } else if (`+(p===2)+`) {
          `+m+" values = "+m+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          `+v+`
        } else if (`+(p===3)+`) {
          `+m+" values = "+m+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          `+v+`
        }
        setOutput(`+f+`);
      }
    `},qC=function(r,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r;for(var t="",e=0;e<4;e++){var a="thisRC = rc;";e%2==1&&(a+="thisRC.z += 1;"),e>1&&(a+="thisRC.y += 1;"),t+=`
        `+a+`
        `+(e>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+`
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[`+e+`] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        `+(e>0?"}":"")+`
      `}this.userCode=`
      
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      `+ci(["r","c","d"],n)+`
      return ivec3(r, c, d);
    }
  
      `+Hd(r)+`

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = `+r[1]+`;
        int cols = `+r[2]+`;

        `+t+`

        setOutput(result);
      }
    `},jC=function(r,n,t){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n.shape;var e=n.shape,a=e[1],u=e[2],s=r.shape,l=s[1],f=s[2],h=[t&&l>1?a-1:a,t&&f>1?u-1:u],p=[t&&l>1?l-1:l,t&&f>1?f-1:f],v=h[0]/p[0],m=h[1]/p[1],y=1/v,x=1/m,w=2*Math.ceil(y)+2,_=2*Math.ceil(x)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+v+`);
        const float widthScale = float(`+m+`);

        const float invHeightScale = float(`+y+`);
        const float invWidthScale = float(`+x+`);

        const int winHeight = int(`+w+`);
        const int winWidth = int(`+_+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+l+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+f+`) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), `+(a-1)+`.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), `+(u-1)+`.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},XC=function(r,n,t,e){this.variableNames=["A"],this.outputShape=[];var a=r[0],u=r[1],s=r[2],l=r[3];this.outputShape=[a,n,t,l];var f=[e&&n>1?u-1:u,e&&t>1?s-1:s],h=[e&&n>1?n-1:n,e&&t>1?t-1:t];this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+f[0]/h[0]+`,
          `+f[1]/h[1]+`);
      const vec2 inputShapeRC = vec2(`+u+".0, "+s+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `},KC=function(r,n,t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var a=r[0],u=r[1],s=r[2],l=r[3];this.outputShape=[a,n,t,l];var f=[e&&n>1?u-1:u,e&&t>1?s-1:s],h=[e&&n>1?n-1:n,e&&t>1?t-1:t];this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `+f[0]/h[0]+`,
          `+f[1]/h[1]+`,
          `+f[1]/h[1]+`);
      const vec3 inputShapeRC = vec3(`+u+".0, "+s+`.0,
                                     `+s+`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `+(l-1)+`;
        bool hasNextRow = coords.z < `+(t-1)+`;

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `},YC=function(r,n,t){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n.shape;var e=n.shape,a=e[1],u=e[2],s=r.shape,l=s[1],f=s[2],h=[t&&l>1?a-1:a,t&&f>1?u-1:u],p=[t&&l>1?l-1:l,t&&f>1?f-1:f],v=h[0]/p[0],m=h[1]/p[1],y=1/v,x=1/m,w=2*Math.ceil(y)+2,_=2*Math.ceil(x)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+v+`);
        const float widthScale = float(`+m+`);

        const float invHeightScale = float(`+y+`);
        const float invWidthScale = float(`+x+`);

        const int winHeight = int(`+w+`);
        const int winWidth = int(`+_+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+l+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+f+`) {
              continue;
            }

            float sourceFracRow =
              float(`+h[0]+`) *
                (float(dyR) / float(`+p[0]+`));

            float sourceFracCol =
                float(`+h[1]+`) *
                  (float(dyC) / float(`+p[1]+`));

            int sourceNearestRow = int(min(
                float(int(`+a+`) - 1),
                `+t+` ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(`+u+`) - 1),
                `+t+` ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},QC=function(r,n,t,e){this.variableNames=["A"],this.outputShape=[];var a=r[0],u=r[1],s=r[2],l=r[3];this.outputShape=[a,n,t,l];var f=[e&&n>1?u-1:u,e&&t>1?s-1:s],h=[e&&n>1?n-1:n,e&&t>1?t-1:t],p=e?"0.5":"0.0";this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+f[0]/h[0]+`,
          `+f[1]/h[1]+`);
      const vec2 inputShapeRC = vec2(`+u+".0, "+s+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `+p+`)));

        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `},ZC=function(r,n){this.variableNames=["x"];var t=r.length;if(t>4)throw new Error("WebGL backend: Reverse of rank-"+t+" tensor is not yet supported");if(this.outputShape=r,t!==1){var e=r.map((function(u,s){return(function(l){return n.indexOf(l)!==-1&&r[l]!==1?r[l]+" - coords["+l+"] - 1":"coords["+l+"]"})(s)})).join(","),a=le(t);this.userCode=`
      void main() {
        `+a+` coords = getOutputCoords();
        setOutput(getX(`+e+`));
      }
    `}else this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(`+r[0]+` - coord - 1));
        }
      `},JC=function(r,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var t=r.length;if(t>4)throw new Error("WebGL backend: Reverse of rank-"+t+" tensor is not yet supported");this.outputShape=r;var e=gn("rc",t),a=e[t-1]+" + 1 < "+this.outputShape[t-1],u=e[t-2]+" + 1 < "+this.outputShape[t-2],s=le(t);function l(f){var h=r.map((function(p,v){return(function(m,y){return n.indexOf(m)!==-1&&r[m]!==1?r[m]+" - "+y[m]+" - 1":""+y[m]})(v,f)}));return"getChannel(getX("+h.join(",")+"), vec2("+h.slice(-2).join(",")+"))"}this.userCode=t===1?`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(`+r[0]+` - rc - 1),
            `+r[0]+` - rc - 1);
          if(`+a+`){
              result.g = getChannel(getX(`+r[0]+` - (rc  + 1) - 1),
                `+r[0]+` - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:`
        void main() {
          `+s+` rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = `+(function(f){return l(f)})(e.slice())+`;
          if(`+a+`){
            result.g = `+(function(f){return f[t-1]="("+f[t-1]+" + 1)",l(f)})(e.slice())+`;
          }
          if(`+u+`) {
            result.b = `+(function(f){return f[t-2]="("+f[t-2]+" + 1)",l(f)})(e.slice())+`;
            if(`+a+`) {
              result.a = `+(function(f){return f[t-1]="("+f[t-1]+" + 1)",f[t-2]="("+f[t-2]+" + 1)",l(f)})(e.slice())+`;
            }
          }
          setOutput(result);
        }
    `},cy=function(r,n,t,e,a,u,s){this.variableNames=["updates","indices","defaultValue"],this.outputShape=u;var l=le(a.length),f=le(u.length),h="";t===1?h="i":t===2&&(h="i, j");var p="getIndices("+h+")",v="";e===1?v="i":e===2&&(v="i, coords[1]");var m="getUpdates("+v+")",y=n>1?"strides[j]":"strides";this.userCode=`
        `+l+" strides = "+l+"("+a+`);

        void main() {
          `+f+` coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < `+r+`; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < `+n+`; j++) {
              int index = round(`+p+`);
              flattenedIndex += index * `+y+`;
            }
            if (flattenedIndex == coords[0]) {
              sum += `+m+`;
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `},$C=function(r,n){this.variableNames=["x","segmentIds"];var t=r.windowSize,e=r.batchSize,a=r.inSize,u=r.numSegments,s=u*Math.ceil(a/t);this.outputShape=[e,s];var l=4*Math.floor(t/4),f=t%4,h=`
        sumValue += dot(values, segFilter);
    `,p="";a%t>0&&(p=`
        if (inIdx < 0 || inIdx >= `+a+`) {
          return initializationValue;
        }
      `);var v="";a%t>0&&(v=`
        if (inIdx < 0 || inIdx >= `+a+`) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = 0.0;

      float getValue(int batch, int inIdx) {
        `+p+`
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        `+v+`
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          `+u+")) * float("+t+`));
        int currentSeg = int(mod(float(outIdx), float(`+u+`)));

        float sumValue = 0.0;

        for (int i = 0; i < `+l+`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          `+h+`
        }

        int inIdx = inOffset + `+l+`;
        if (`+(f===1)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          `+h+`
        } else if (`+(f===2)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          `+h+`
        } else if (`+(f===3)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          `+h+`
        }
        setOutput(sumValue);
      }
    `},tS=function(r,n,t){var e,a;if(this.variableNames=["c","a","b"],this.outputShape=n,t>4)throw Error("Where for rank "+t+" is not yet supported");if(t===1)a="resRC",e="resRC";else{for(var u=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[],l=[],f=0;f<n.length;f++)l.push(""+u[f]),f<r&&s.push(""+u[f]);e=s.join(),a=l.join()}var h=le(t);this.userCode=`
      void main() {
        `+h+` resRC = getOutputCoords();
        float cVal = getC(`+e+`);
        if (cVal >= 1.0) {
          setOutput(getA(`+a+`));
        } else {
          setOutput(getB(`+a+`));
        }
      }
    `},eS=(function(){function r(n){this.variableNames=["source"],this.outputShape=n,this.rank=n.length;var t,e=le(this.rank),a="uniform int start["+this.rank+"];",u=(function(s){if(s===1)return"sourceLoc";if(s<=6)return Kh.slice(0,s).map((function(l){return"sourceLoc."+l})).join(",");throw Error("Slicing for rank "+s+" is not yet supported")})(this.rank);t=`
        `+e+` sourceLoc;
        `+e+` coords = getOutputCoords();
        `+n.map((function(s,l){return"sourceLoc."+Kh[l]+" = start["+l+"] + coords."+Kh[l]+";"})).join(`
`)+`
      `,this.userCode=`
      `+a+`
      void main() {
        `+t+`
        setOutput(getSource(`+u+`));
      }
    `}return r.prototype.getCustomSetupFunc=function(n){var t=this;if(n.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+n.length+")");return function(e,a){t.startLoc==null&&(t.startLoc=e.getUniformLocationNoThrow(a,"start"),t.startLoc==null)||e.gl.uniform1iv(t.startLoc,n)}},r})(),Kh=["x","y","z","w","u","v"],nS=(function(){function r(n){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.rank=n.length;var t=le(this.rank),e=gn("coords",this.rank),a=gn("sourceLoc",this.rank),u=this.rank===1?"sourceLoc":"vec2("+a.slice(-2).join()+")",s="getChannel(getSource("+a.join()+"), "+u+")",l=`
      result.x = `+s+`;
      if (++`+e[this.rank-1]+" < "+n[this.rank-1]+`) {
        ++`+a[this.rank-1]+`;
        result.y = `+s+`;
        --`+a[this.rank-1]+`;
      }
    `,f=this.rank===1?"":`
      --`+e[this.rank-1]+`;
      if (++`+e[this.rank-2]+" < "+n[this.rank-2]+`) {
        ++`+a[this.rank-2]+`;
        result.z = `+s+`;
        if (++`+e[this.rank-1]+" < "+n[this.rank-1]+`) {
          ++`+a[this.rank-1]+`;
          result.w = `+s+`;
        }
      }
    `,h=this.rank<=4?`sourceLoc = coords +
            `+t+"("+n.map((function(p,v){return"start["+v+"]"})).join()+");":n.map((function(p,v){return a[v]+" = "+e[v]+" + start["+v+"];"})).join(`
`);this.userCode=`
      uniform int start[`+this.rank+`];
      void main() {
        `+t+` coords = getOutputCoords();
        `+t+` sourceLoc;
        `+h+`
        vec4 result = vec4(0.);
        `+l+`
        `+f+`
        setOutput(result);
      }
    `}return r.prototype.getCustomSetupFunc=function(n){var t=this;if(n.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+n.length+")");return function(e,a){t.startLoc==null&&(t.startLoc=e.getUniformLocationNoThrow(a,"start"),t.startLoc==null)||e.gl.uniform1iv(t.startLoc,n)}},r})(),rS=function(r,n,t){this.variableNames=["x"],this.outputShape=t;var e=t.length,a=le(t.length),u=le(t.length),s="";if(e===1)s="coords * strides + begin";else{var l=0;s=t.map((function(f,h){return l++,t.length===1?"coords * strides["+h+"] + begin["+h+"]":"coords["+(l-1)+"] * strides["+h+"] + begin["+h+"]"})).join(",")}this.userCode=`
      `+a+" begin = "+a+"("+r+`);
      `+a+" strides = "+a+"("+n+`);

      void main() {
        `+u+` coords = getOutputCoords();
        setOutput(getX(`+s+`));
      }
    `},aS=(function(){function r(n){this.gpgpu=n,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return r.prototype.acquireTexture=function(n,t,e){var a,u=fy(t,e),s=hy(n,u,e);if(s in this.freeTextures||(this.freeTextures[s]=[]),s in this.usedTextures||(this.usedTextures[s]=[]),this.freeTextures[s].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var l=this.freeTextures[s].shift();return this.usedTextures[s].push(l),l}return this.numUsedTextures++,this.log(),u===On.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(n[0],n[1]):u===On.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(n[0],n[1]):u===On.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(n[0],n[1]):u===On.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(n[0],n[1]):u===On.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(n[0],n[1])),this.usedTextures[s].push(a),a},r.prototype.releaseTexture=function(n,t,e,a){if(this.freeTextures!=null){var u=hy(t,fy(e,a),a);u in this.freeTextures||(this.freeTextures[u]=[]),this.freeTextures[u].push(n),this.numFreeTextures++,this.numUsedTextures--;var s=this.usedTextures[u],l=s.indexOf(n);if(l<0)throw new Error("Cannot release a texture that was never provided by this texture manager");s.splice(l,1),this.log()}},r.prototype.log=function(){if(this.logEnabled){var n=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+n+")")}},r.prototype.getNumUsedTextures=function(){return this.numUsedTextures},r.prototype.getNumFreeTextures=function(){return this.numFreeTextures},r.prototype.dispose=function(){var n=this;if(this.freeTextures!=null){for(var t in this.freeTextures)this.freeTextures[t].forEach((function(e){n.gpgpu.deleteMatrixTexture(e)}));for(var t in this.usedTextures)this.usedTextures[t].forEach((function(a){n.gpgpu.deleteMatrixTexture(a)}));this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},r})();function fy(r,n){if(r===kn.UPLOAD)return On.PACKED_2X2_FLOAT32;if(r===kn.RENDER||r==null)return(function(t){return st().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?t?On.PACKED_2X2_FLOAT32:On.UNPACKED_FLOAT32:t?On.PACKED_2X2_FLOAT16:On.UNPACKED_FLOAT16})(n);if(r===kn.DOWNLOAD||r===kn.PIXELS)return On.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+r)}function hy(r,n,t){return r[0]+"_"+r[1]+"_"+n+"_"+t}var iS=function(r,n){this.variableNames=["A"];for(var t=new Array(r.length),e=0;e<t.length;e++)t[e]=r[e]*n[e];this.outputShape=t,this.rank=t.length;var a=le(this.rank),u=(function(s){var l=s.length;if(l>5)throw Error("Tile for rank "+l+" is not yet supported");if(l===1)return"imod(resRC, "+s[0]+")";for(var f=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],h=[],p=0;p<s.length;p++)h.push("imod("+f[p]+", "+s[p]+")");return h.join()})(r);this.userCode=`
      void main() {
        `+a+` resRC = getOutputCoords();
        setOutput(getA(`+u+`));
      }
    `},oS=function(r,n){this.variableNames=["A"];for(var t=new Array(r.length),e=0;e<t.length;e++)t[e]=r[n[e]];this.outputShape=t,this.rank=t.length;var a=le(this.rank),u=(function(s){var l=s.length;if(l>6)throw Error("Transpose for rank "+l+" is not yet supported");for(var f=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],h=new Array(l),p=0;p<s.length;p++)h[s[p]]=f[p];return h.join()})(n);this.userCode=`
    void main() {
      `+a+` resRC = getOutputCoords();
      setOutput(getA(`+u+`));
    }
    `},uS=function(r,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var t=new Array(r.length),e=0;e<t.length;e++)t[e]=r[n[e]];if(this.outputShape=t,this.rank=t.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var a=le(this.rank),u=S1("rc",this.rank),s=new Array(this.rank);for(e=0;e<n.length;e++)s[n[e]]=u[e];var l="vec2("+s.slice(-2).join()+")",f="++"+u[this.rank-1]+" < "+t[this.rank-1],h="getChannel(getA("+s.join()+"), "+l+")";this.userCode=`
    void main() {
      `+a+` rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = `+h+`;
      if(`+f+`) {
        result[1] = `+h+`;
      }
      --`+u[this.rank-1]+`;
      if(++`+u[this.rank-2]+" < "+t[this.rank-2]+`) {
        result[2] = `+h+`;
        if(`+f+`) {
          result[3] = `+h+`;
        }
      }
      setOutput(result);
    }
    `},Vd=1.7580993408473768,Gd=1.0507009873554805,Ft=function(r,n){this.variableNames=["A"],this.outputShape=r,this.userCode=`
      float unaryOperation(float x) {
        `+n+`
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `},lr="if (isnan(x)) return x;",sS="return x;",dy="return abs(x);",N1=lr+`
  return (x < 0.0) ? 0.0 : x;
`,M1=lr+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,O1="return (x >= 0.0) ? x : (exp(x) - 1.0);",lS=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = `+Vd+`;
  float scale = `+Gd+`;
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,py="return -x;",vy="return ceil(x);",my="return floor(x);",gy="return exp(x);",yy="return exp(x) - 1.0;",cS=lr+`
  return sin(x);
`,fS=lr+`
  return cos(x);
`,hS=lr+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,dS=lr+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,pS=lr+`
  return atan(x);
`,vS=lr+"return log(x + sqrt(x * x + 1.0));",mS=lr+`
  if (x < 1.0) return NAN;
  return log(x + sqrt(x * x - 1.0));`,gS=lr+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
  return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,gl="return x;",yS="return x;",k1=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,I1=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,B1=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,Su=function(r,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r,this.userCode=`
      vec4 unaryOperation(vec4 x) {
        `+n+`
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `},bS=function(r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=r;var n=r.length,t=gn("rc",n),e=le(n),a=(function(l,f){if(l===1)return"rc";for(var h="",p=0;p<l;p++)h+=f[p],p<l-1&&(h+=",");return h})(n,t),u=t.slice(-2),s=n<=1?"rc":"vec2("+u.join(",")+")";this.userCode=`
      void main() {
        `+e+` rc = getOutputCoords();
        vec4 packedInput = getA(`+a+`);

        setOutput(getChannel(packedInput, `+s+`));
      }
    `},yl={};function bl(r,n){if(n===void 0&&(n=!1),r==="linear")return n?yS:sS;if(r==="relu")return n?k1:N1;if(r==="elu")return n?B1:O1;if(r==="relu6")return n?I1:M1;if(r==="prelu")return n?D1:T1;throw new Error("Activation "+r+" has not been implemented for the WebGL backend.")}var xS=600,wS=(function(r){function n(t){var e,a=r.call(this)||this;if(a.pendingRead=new WeakMap,a.pendingDisposal=new WeakSet,a.dataRefCount=new WeakMap,a.numBytesInGPU=0,a.uploadWaitMs=0,a.downloadWaitMs=0,a.warnedAboutMemory=!1,a.pendingDeletes=0,a.disposed=!1,!st().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(t==null){var u=Ar(st().getNumber("WEBGL_VERSION"));a.binaryCache=((e=st().getNumber("WEBGL_VERSION"))in yl||(yl[e]={}),yl[e]),a.gpgpu=new OC(u),a.canvas=u.canvas,a.gpgpuCreatedLocally=!0}else a.gpgpu=t,a.binaryCache={},a.gpgpuCreatedLocally=!1,a.canvas=t.gl.canvas;return a.textureManager=new aS(a.gpgpu),a.numMBBeforeWarning=st().global.screen==null?1024:st().global.screen.height*st().global.screen.width*window.devicePixelRatio*xS/1024/1024,a.texData=new m1(a,W),a}return sr(n,r),n.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},n.prototype.write=function(t,e,a){if(st().getBool("DEBUG")&&this.checkNumericalProblems(t),a==="complex64"&&t!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var u={};return this.texData.set(u,{shape:e,dtype:a,values:t,usage:kn.UPLOAD}),u},n.prototype.move=function(t,e,a,u){if(st().getBool("DEBUG")&&this.checkNumericalProblems(e),u==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(t,{shape:a,dtype:u,values:e,usage:kn.UPLOAD})},n.prototype.readSync=function(t){var e=this.texData.get(t),a=e.values,u=e.dtype,s=e.complexTensors,l=e.slice,f=e.shape,h=e.isPacked;if(l!=null){var p=void 0;p=h?new Su(f,gl):new Ft(f,gl);var v=this.runWebGLProgram(p,[{dataId:t,shape:f,dtype:u}],u),m=this.readSync(v.dataId);return this.disposeData(v.dataId),m}if(a!=null)return this.convertAndCacheOnCPU(t);if(u==="string")return a;var y,x,w=this.activeTimers!=null;return w&&(y=yr()),u==="complex64"?x=bd(s.real.dataSync(),s.imag.dataSync()):x=this.getValuesFromTexture(t),w&&(this.downloadWaitMs+=yr()-y),this.convertAndCacheOnCPU(t,x)},n.prototype.read=function(t){return bt(this,void 0,void 0,(function(){var e,a,u,s,l,f,h,p,v,m,y,x,w,_,E,R,A,S,T,N,O,B;return xt(this,(function(I){switch(I.label){case 0:if(this.pendingRead.has(t))return e=this.pendingRead.get(t),[2,new Promise((function(F){return e.push(F)}))];if(a=this.texData.get(t),u=a.values,s=a.shape,l=a.slice,f=a.dtype,h=a.complexTensors,p=a.isPacked,l!=null)return v=void 0,v=p?new Su(s,gl):new Ft(s,gl),m=this.runWebGLProgram(v,[{dataId:t,shape:s,dtype:f}],f),y=this.read(m.dataId),this.disposeData(m.dataId),[2,y];if(u!=null)return[2,this.convertAndCacheOnCPU(t)];if(!st().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&st().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return x=null,f!=="complex64"&&st().get("WEBGL_BUFFER_SUPPORTED")&&(w=this.decode(t),_=this.texData.get(w.dataId),x=(B=this.gpgpu).createBufferFromTexture.apply(B,[_.texture].concat(Ru(s)))),this.pendingRead.set(t,[]),f==="complex64"?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:I.sent(),I.label=2;case 2:return f!=="complex64"?[3,4]:[4,Promise.all([h.real.data(),h.imag.data()])];case 3:return R=I.sent(),A=R[0],S=R[1],E=bd(A,S),[3,5];case 4:x==null?E=this.getValuesFromTexture(t):(T=_t(s),E=this.gpgpu.downloadFloat32MatrixFromBuffer(x,T)),I.label=5;case 5:return w!=null&&this.disposeData(w.dataId),N=this.convertAndCacheOnCPU(t,E),O=this.pendingRead.get(t),this.pendingRead.delete(t),O.forEach((function(F){return F(N)})),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t),this.pendingDeletes--),[2,N]}}))}))},n.prototype.checkNumericalProblems=function(t){if(t!=null)for(var e=0;e<t.length;e++){var a=t[e];if(!l_(a))throw st().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value "+a+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"):Error("The value "+a+" cannot be represented on this device.")}},n.prototype.getValuesFromTexture=function(t){var e,a=this.texData.get(t),u=a.shape,s=a.dtype,l=a.isPacked,f=_t(u);if(st().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var h=this.decode(t),p=this.texData.get(h.dataId),v=(e=this.gpgpu).downloadMatrixFromPackedTexture.apply(e,[p.texture].concat(Ru(u))).subarray(0,f);return this.disposeData(h.dataId),v}var m=st().getBool("WEBGL_PACK")&&l===!0,y=m?Hh(u):u,x=m?new sC(y):new uC(y),w=this.runWebGLProgram(x,[{shape:y,dtype:s,dataId:t}],"float32"),_=this.texData.get(w.dataId),E=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(_.texture,_.texShape[0],_.texShape[1]).subarray(0,f);return this.disposeData(w.dataId),E},n.prototype.time=function(t){return bt(this,void 0,void 0,(function(){var e,a,u,s,l,f,h;return xt(this,(function(p){switch(p.label){case 0:return e=this.activeTimers,a=[],u=!1,this.programTimersStack==null?(this.programTimersStack=a,u=!0):this.activeTimers.push(a),this.activeTimers=a,t(),s=_o(this.activeTimers.map((function(v){return v.query}))).filter((function(v){return v!=null})),l=_o(this.activeTimers.map((function(v){return v.name}))).filter((function(v){return v!=null})),this.activeTimers=e,u&&(this.programTimersStack=null),f={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},st().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(s)]:[3,2];case 1:return h=p.sent(),f.kernelMs=Gw(h),f.getExtraProfileInfo=function(){return h.map((function(v,m){return{name:l[m],ms:v}})).map((function(v){return v.name+": "+v.ms})).join(", ")},[3,3];case 2:f.kernelMs={error:"WebGL query timers are not supported in this environment."},p.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,f]}}))}))},n.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},n.prototype.startTimer=function(){return st().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:yr(),endMs:null}},n.prototype.endTimer=function(t){return st().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),t):(t.endMs=yr(),t)},n.prototype.getQueryTime=function(t){return bt(this,void 0,void 0,(function(){var e;return xt(this,(function(a){return st().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(t)]:[2,(e=t).endMs-e.startMs]}))}))},n.prototype.disposeData=function(t){if(!this.pendingDisposal.has(t)){if(this.pendingRead.has(t))return this.pendingDisposal.add(t),void this.pendingDeletes++;if(this.texData.has(t)){this.releaseGPUData(t);var e=this.texData.get(t).complexTensors;e!=null&&(e.real.dispose(),e.imag.dispose()),this.texData.delete(t)}}},n.prototype.releaseGPUData=function(t){var e=this.texData.get(t),a=e.texture,u=e.dtype,s=e.texShape,l=e.usage,f=e.isPacked,h=e.slice,p=h&&h.origDataId||t,v=this.dataRefCount.get(p);v>1?this.dataRefCount.set(p,v-1):(this.dataRefCount.delete(p),a!=null&&(this.numBytesInGPU-=this.computeBytes(s,u),this.textureManager.releaseTexture(a,s,l,f)));var m=this.texData.get(t);m.texture=null,m.texShape=null,m.isPacked=!1,m.slice=null},n.prototype.getTexture=function(t){return this.uploadToGPU(t),this.texData.get(t).texture},n.prototype.getDataInfo=function(t){return this.texData.get(t)},n.prototype.getCPUBackend=function(){return st().getBool("WEBGL_CPU_FORWARD")?(this.cpuBackend==null&&(this.cpuBackend=W.findBackend("cpu")),this.cpuBackend):null},n.prototype.shouldExecuteOnCPU=function(t,e){var a=this;return e===void 0&&(e=128),this.getCPUBackend()!=null&&t.every((function(u){return a.texData.get(u.dataId).texture==null&&u.size<e}))},n.prototype.getGPGPUContext=function(){return this.gpgpu},n.prototype.complex=function(t,e){var a=this.makeOutput(t.shape,"complex64");return this.texData.get(a.dataId).complexTensors={real:W.keep(t.clone()),imag:W.keep(e.clone())},a},n.prototype.real=function(t){return this.texData.get(t.dataId).complexTensors.real.clone()},n.prototype.imag=function(t){return this.texData.get(t.dataId).complexTensors.imag.clone()},n.prototype.slice=function(t,e,a){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.slice(t,e,a);if(_t(a)===0)return Ze([],a,t.dtype);var u=this.texData.get(t.dataId).isPacked,s=p1(t.shape,e,a);if(u||!s){var l=st().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new nS(a):new eS(a),f=l.getCustomSetupFunc(e);return this.compileAndRun(l,[t],null,f)}return this.uploadToGPU(t.dataId),this.shallowSlice(t,e,a)},n.prototype.shallowSlice=function(t,e,a){var u=this.texData.get(t.dataId),s=this.makeOutput(a,t.dtype),l=this.texData.get(s.dataId);Object.assign(l,u),l.shape=a,l.dtype=t.dtype;var f=v1(e,t.strides);u.slice&&(f+=u.slice.flatOffset),l.slice={flatOffset:f,origDataId:u.slice&&u.slice.origDataId||t.dataId};var h=this.dataRefCount.get(l.slice.origDataId)||1;return this.dataRefCount.set(l.slice.origDataId,h+1),s},n.prototype.stridedSlice=function(t,e,a,u){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.stridedSlice(t,e,a,u);var s=Fd(e,a,u);if(s.some((function(f){return f===0})))return Ze([],s);var l=new rS(e,u,s);return this.compileAndRun(l,[t])},n.prototype.reverse=function(t,e){var a=st().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new JC(t.shape,e):new ZC(t.shape,e);return this.compileAndRun(a,[t])},n.prototype.concat=function(t,e){if(t[0].dtype==="complex64"){var a=t.map((function(y){return Zn(y)})),u=t.map((function(y){return xr(y)}));return Ye(this.concat(a,e),this.concat(u,e))}if(this.shouldExecuteOnCPU(t))return this.cpuBackend.concat(t,e);if(t.length===1)return t[0];if(t.length>st().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var s=Math.floor(t.length/2),l=this.concat(t.slice(0,s),e),f=this.concat(t.slice(s),e);return this.concat([l,f],e)}if(st().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&t[0].rank>1){var h=new XE(t.map((function(y){return y.shape})),e);return this.compileAndRun(h,t)}var p=Co(t.map((function(y){return y.shape})),e),v=t.map((function(y){return y.as2D(-1,_t(y.shape.slice(e)))})),m=new jE(v.map((function(y){return y.shape})));return this.compileAndRun(m,v).reshape(p)},n.prototype.neg=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.neg(t);if(st().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,py,t.dtype);var e=new Ft(t.shape,py);return this.compileAndRun(e,[t])},n.prototype.batchMatMul=function(t,e,a,u){var s=a?t.shape[2]:t.shape[1],l=u?e.shape[1]:e.shape[2],f=a?t.shape[1]:t.shape[2],h=t.shape[0];if((s===1||l===1)&&f>1e3){a&&(t=t.transpose([0,2,1])),u&&(e=e.transpose([0,2,1]));var p=l===1?t:t.as3D(h,f,1),v=l===1?2:1,m=l===1?e.as3D(h,1,f):e;return this.multiply(p,m).sum(v,!0)}var y=Qe(t.dtype,e.dtype),x=new qh(t.shape,[h,s,l],a,u);return this.compileAndRun(x,[t,e],y)},n.prototype.fusedBatchMatMul=function(t){var e=t.a,a=t.b,u=t.transposeA,s=t.transposeB,l=t.bias,f=t.activation,h=t.preluActivationWeights,p=u?e.shape[2]:e.shape[1],v=s?a.shape[1]:a.shape[2],m=e.shape[0],y=Qe(e.dtype,a.dtype),x=l!=null,w=h!=null,_=f?bl(f,!0):null,E=new qh(e.shape,[m,p,v],u,s,x,_,w),R=[e,a];return l&&R.push(l),h&&R.push(h),this.compileAndRun(E,R,y)},n.prototype.multiply=function(t,e){if(t.dtype==="complex64"){var a=this.texData.get(t.dataId),u=this.texData.get(e.dataId),s=new ny(HE,t.shape,e.shape),l=new ny(VE,t.shape,e.shape),f=[this.makeComplexComponentTensorInfo(t,a.complexTensors.real),this.makeComplexComponentTensorInfo(t,a.complexTensors.imag),this.makeComplexComponentTensorInfo(e,u.complexTensors.real),this.makeComplexComponentTensorInfo(e,u.complexTensors.imag)],h=this.compileAndRun(s,f),p=this.compileAndRun(l,f),v=this.complex(h,p);return h.dispose(),p.dispose(),v}if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.multiply(t,e);if(st().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,ry,t.dtype);var m=new be(ry,t.shape,e.shape);return this.compileAndRun(m,[t,e],t.dtype)},n.prototype.batchNormalization=function(t,e,a,u,s,l){var f=[t,e,a],h=null;l!=null&&(h=l.shape,f.push(l));var p=null;if(s!=null&&(p=s.shape,f.push(s)),st().getBool("WEBGL_PACK_NORMALIZATION")){var v=new PE(t.shape,e.shape,a.shape,h,p,u);return this.compileAndRun(v,f)}var m=new UE(t.shape,e.shape,a.shape,h,p,u);return this.compileAndRun(m,f)},n.prototype.localResponseNormalization4D=function(t,e,a,u,s){var l=st().getBool("WEBGL_PACK_NORMALIZATION")?new FC(t.shape,e,a,u,s):new IC(t.shape,e,a,u,s);return this.compileAndRun(l,[t])},n.prototype.LRNGrad=function(t,e,a,u,s,l,f){var h=new BC(e.shape,u,s,l,f);return this.compileAndRun(h,[e,a,t])},n.prototype.tile=function(t,e){if(t.dtype==="string"){var a=this.readSync(t.dataId).map((function(s){return Dl(s)}));return E1(kt(t.shape,t.dtype,a),e)}var u=new iS(t.shape,e);return this.compileAndRun(u,[t])},n.prototype.pad=function(t,e,a){var u=st().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new GC(t.shape,e,a):new VC(t.shape,e,a);return this.compileAndRun(u,[t])},n.prototype.transpose=function(t,e){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.transpose(t,e);var a=st().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new uS(t.shape,e):new oS(t.shape,e);return this.compileAndRun(a,[t])},n.prototype.gather=function(t,e,a){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.gather(t,e,a);var u=new pC(t.shape,e.size,a);return this.compileAndRun(u,[t,e])},n.prototype.batchToSpaceND=function(t,e,a){k(t.rank<=4,(function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"}));var u=e.reduce((function(v,m){return v*m})),s=Bl(t.shape,e,u),l=Fl(s.length,e.length),f=zl(t.shape,e,u),h=c1(a,e.length),p=f1(f,a,e.length);return t.reshape(s).transpose(l).reshape(f).slice(h,p)},n.prototype.spaceToBatchND=function(t,e,a){k(t.rank<=4,(function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"}));var u=e.reduce((function(m,y){return m*y})),s=[[0,0]];s.push.apply(s,a);for(var l=1+e.length;l<t.shape.length;++l)s.push([0,0]);var f=t.pad(s),h=Bl(f.shape,e,u,!1),p=Fl(h.length,e.length,!1),v=zl(f.shape,e,u,!1);return f.reshape(h).transpose(p).reshape(v)},n.prototype.reduce=function(t,e,a){var u=t.shape[0],s=t.shape[1],l=Vh(s),f=new WC({windowSize:l,inSize:s,batchSize:u},e),h=this.compileAndRun(f,[t],a);return h.shape[1]===1?h:this.reduce(h,e,a)},n.prototype.argReduce=function(t,e,a){a===void 0&&(a=null);var u=t.shape[0],s=t.shape[1];a!=null&&(u=a.shape[0],s=a.shape[1]);var l=Vh(s),f=new NE({windowSize:l,inSize:s,batchSize:u},e,a==null),h=[t];a!=null&&h.push(a);var p=this.compileAndRun(f,h,"int32");return p.shape[1]===1?p:this.argReduce(t,e,p)},n.prototype.argReducePacked=function(t,e,a){a===void 0&&(a=null);var u=a!=null?a.shape:t.shape,s=Vh(u[u.length-1]),l=new FE(u,s,e,a==null),f=a==null?[t]:[t,a],h=this.compileAndRun(l,f,"int32");return h.rank===t.rank?this.argReducePacked(t,e,h):h},n.prototype.sum=function(t,e){Mn("sum",e,t.rank);var a=$e(t.shape,e),u=a[0],s=_t(a[1]),l=t.as2D(-1,s),f=Ih(t.dtype);return this.reduce(l,"sum",f).reshape(u)},n.prototype.prod=function(t,e){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.prod(t,e);var a=$e(t.shape,e),u=a[0],s=_t(a[1]),l=t.as2D(-1,s),f=Ih(t.dtype);return this.reduce(l,"prod",f).reshape(u)},n.prototype.unsortedSegmentSum=function(t,e,a){var u=0,s=Tr([u],t.rank),l=t;s!=null&&(l=t.transpose(s),u=Dr(1,t.rank)[0]);var f=(function(y,x,w){for(var _=[],E=y.length,R=0;R<E;R++)R!==x?_.push(y[R]):_.push(w);return _})(l.shape,u,a),h=_t([l.shape[u]]),p=l.as2D(-1,h),v=Ih(t.dtype),m=this.segOpCompute(p,"unsortedSegmentSum",e,v,a).reshape(f);return s!=null&&(m=m.transpose(Od(s))),m},n.prototype.segOpCompute=function(t,e,a,u,s){var l=t.shape[0],f=t.shape[1],h=(function(m,y){var x,w=!1;for(m<=d1?(x=m,w=!0):x=cd(m,Math.floor(Math.sqrt(m)));!w;)x>y||x===m?w=!0:x=cd(m,x+1);return x})(f,s),p=new $C({windowSize:h,inSize:f,batchSize:l,numSegments:s}),v=this.compileAndRun(p,[t,a],u);return v.shape[1]===s?v:(a=Il(0,s).tile([f/h]),this.segOpCompute(v,e,a,u,s))},n.prototype.argMinMaxReduce=function(t,e,a){var u=[e];if(Mn("arg"+a.charAt(0).toUpperCase()+a.slice(1),u,t.rank),!st().getBool("WEBGL_PACK_REDUCE")||t.rank<=2){var s=$e(t.shape,u),l=s[0],f=_t(s[1]),h=t.as2D(-1,f);return this.argReduce(h,a).reshape(l)}return this.argReducePacked(t,a)},n.prototype.argMin=function(t,e){return this.argMinMaxReduce(t,e,"min")},n.prototype.argMax=function(t,e){return this.argMinMaxReduce(t,e,"max")},n.prototype.cumsum=function(t,e,a,u){if(e!==t.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(t.rank-1)+" but got axis="+e);var s=new nC(t.shape,a,u);return this.compileAndRun(s,[t])},n.prototype.equal=function(t,e){if(st().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,`
  return vec4(equal(a, b));
`,"bool");var a=new be("return float(a == b);",t.shape,e.shape);return this.compileAndRun(a,[t,e],"bool")},n.prototype.notEqual=function(t,e){if(st().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,`
  return vec4(notEqual(a, b));
`,"bool");var a=new be("return float(a != b);",t.shape,e.shape);return this.compileAndRun(a,[t,e],"bool")},n.prototype.less=function(t,e){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.less(t,e);if(st().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,`
  return vec4(lessThan(a, b));
`,"bool");var a=new be("return float(a < b);",t.shape,e.shape);return this.compileAndRun(a,[t,e],"bool")},n.prototype.lessEqual=function(t,e){if(st().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,`
  return vec4(lessThanEqual(a, b));
`,"bool");var a=new be("return float(a <= b);",t.shape,e.shape);return this.compileAndRun(a,[t,e],"bool")},n.prototype.greater=function(t,e){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.greater(t,e);if(st().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,`
  return vec4(greaterThan(a, b));
`,"bool");var a=new be("return float(a > b);",t.shape,e.shape);return this.compileAndRun(a,[t,e],"bool")},n.prototype.greaterEqual=function(t,e){if(st().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,`
  return vec4(greaterThanEqual(a, b));
`,"bool");var a=new be("return float(a >= b);",t.shape,e.shape);return this.compileAndRun(a,[t,e],"bool")},n.prototype.logicalNot=function(t){var e=new Ft(t.shape,"return float(!(x >= 1.0));");return this.compileAndRun(e,[t])},n.prototype.logicalAnd=function(t,e){if(st().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,"bool");var a=new be("return float(a >= 1.0 && b >= 1.0);",t.shape,e.shape);return this.compileAndRun(a,[t,e],"bool")},n.prototype.logicalOr=function(t,e){if(st().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,"bool");var a=new be("return float(a >= 1.0 || b >= 1.0);",t.shape,e.shape);return this.compileAndRun(a,[t,e],"bool")},n.prototype.select=function(t,e,a){var u=new tS(t.rank,e.shape,e.rank);return this.compileAndRun(u,[t,e,a],Qe(e.dtype,a.dtype))},n.prototype.where=function(t){Ol("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var e=t.dataSync();return Pd(t.shape,e)},n.prototype.topk=function(t,e,a){return C1(t.dataSync(),t.shape,t.dtype,e)},n.prototype.min=function(t,e){Mn("min",e,t.rank);var a=$e(t.shape,e),u=a[0],s=_t(a[1]),l=t.as2D(-1,s);return this.reduce(l,"min",l.dtype).reshape(u)},n.prototype.minimum=function(t,e){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.minimum(t,e);var a=st().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Zr(`
  vec4 result = vec4(min(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,e.shape):new be(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return min(a, b);
`,t.shape,e.shape);return this.compileAndRun(a,[t,e])},n.prototype.mod=function(t,e){var a=st().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Zr(`
  vec4 result = mod(a, b);
  vec4 isNaN = vec4(equal(b, vec4(0.0)));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,e.shape):new be(`if (b == 0.0) return NAN;
  return mod(a, b);`,t.shape,e.shape);return this.compileAndRun(a,[t,e])},n.prototype.max=function(t,e){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.max(t,e);Mn("max",e,t.rank);var a=$e(t.shape,e),u=a[0],s=_t(a[1]),l=t.as2D(-1,s);return this.reduce(l,"max",l.dtype).reshape(u)},n.prototype.maximum=function(t,e){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.maximum(t,e);var a=st().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Zr(`
  vec4 result = vec4(max(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,e.shape):new be(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return max(a, b);
`,t.shape,e.shape);return this.compileAndRun(a,[t,e])},n.prototype.all=function(t,e){Mn("all",e,t.rank);var a=$e(t.shape,e),u=a[0],s=_t(a[1]),l=t.as2D(-1,s);return this.reduce(l,"all",l.dtype).reshape(u)},n.prototype.any=function(t,e){Mn("any",e,t.rank);var a=$e(t.shape,e),u=a[0],s=_t(a[1]),l=t.as2D(-1,s);return this.reduce(l,"any",l.dtype).reshape(u)},n.prototype.realDivide=function(t,e){if(st().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,"float32",!0);var a=new be(`
if (a == b) {
  return 1.0;
};
return a / b;`,t.shape,e.shape);return this.compileAndRun(a,[t,e],"float32")},n.prototype.floorDiv=function(t,e){if(st().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,"int32");var a=new be(`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,t.shape,e.shape);return this.compileAndRun(a,[t,e],"int32")},n.prototype.add=function(t,e){if(t.dtype==="complex64"&&e.dtype==="complex64")return this.complexSeparableBinaryOp(t,e,Gh);if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.add(t,e);var a=Qe(t.dtype,e.dtype);if(st().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,Gh,a);var u=new be(Gh,t.shape,e.shape);return this.compileAndRun(u,[t,e],a)},n.prototype.packedUnaryOp=function(t,e,a){var u=new Su(t.shape,e);return this.compileAndRun(u,[t],a)},n.prototype.packedBinaryOp=function(t,e,a,u,s){s===void 0&&(s=!1);var l=new Zr(a,t.shape,e.shape,s);return this.compileAndRun(l,[t,e],u)},n.prototype.complexSeparableBinaryOp=function(t,e,a){var u=this,s=this.texData.get(t.dataId),l=this.texData.get(e.dataId),f=[[s.complexTensors.real,l.complexTensors.real],[s.complexTensors.imag,l.complexTensors.imag]].map((function(m){var y=m[0],x=m[1],w=u.makeComplexComponentTensorInfo(t,y),_=u.makeComplexComponentTensorInfo(e,x),E=new be(a,t.shape,e.shape);return u.compileAndRun(E,[w,_],Qe(y.dtype,x.dtype))})),h=f[0],p=f[1],v=this.complex(h,p);return h.dispose(),p.dispose(),v},n.prototype.makeComplexComponentTensorInfo=function(t,e){return{dataId:e.dataId,dtype:e.dtype,shape:t.shape}},n.prototype.addN=function(t){if(t.length===1)return t[0];if(t.length>st().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var e=Math.floor(t.length/2),a=this.addN(t.slice(0,e)),u=this.addN(t.slice(e));return this.addN([a,u])}var s=t.map((function(h){return h.dtype})).reduce((function(h,p){return Qe(h,p)})),l=t.map((function(h){return h.shape})),f=st().getBool("WEBGL_PACK")?new DE(t[0].shape,l):new TE(t[0].shape,l);return this.compileAndRun(f,t,s)},n.prototype.subtract=function(t,e){if(t.dtype==="complex64"&&e.dtype==="complex64")return this.complexSeparableBinaryOp(t,e,Wh);if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.subtract(t,e);var a=Qe(t.dtype,e.dtype);if(st().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,Wh,t.dtype);var u=new be(Wh,t.shape,e.shape);return this.compileAndRun(u,[t,e],a)},n.prototype.pow=function(t,e){var a=st().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Zr(`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,e.shape):new be(`
if(a < 0.0 && floor(b) < b){
  return NAN;
}
if (b == 0.0) {
  return 1.0;
}
return (round(mod(b, 2.0)) != 1) ?
    pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,t.shape,e.shape),u=Qe(t.dtype,e.dtype);return this.compileAndRun(a,[t,e],u)},n.prototype.ceil=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.ceil(t);if(st().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,vy,t.dtype);var e=new Ft(t.shape,vy);return this.compileAndRun(e,[t])},n.prototype.floor=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.floor(t);if(st().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,my,t.dtype);var e=new Ft(t.shape,my);return this.compileAndRun(e,[t])},n.prototype.sign=function(t){var e=new Ft(t.shape,`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`);return this.compileAndRun(e,[t])},n.prototype.isNaN=function(t){var e=new Ft(t.shape,"return float(isnan(x));");return this.compileAndRun(e,[t],"bool")},n.prototype.isInf=function(t){var e=new Ft(t.shape,"return float(isinf(x));");return this.compileAndRun(e,[t],"bool")},n.prototype.isFinite=function(t){var e=new Ft(t.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(e,[t],"bool")},n.prototype.round=function(t){var e=new Ft(t.shape,`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`);return this.compileAndRun(e,[t])},n.prototype.exp=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.exp(t);if(st().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,gy,t.dtype);var e=new Ft(t.shape,gy);return this.compileAndRun(e,[t])},n.prototype.expm1=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.expm1(t);if(st().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,yy,t.dtype);var e=new Ft(t.shape,yy);return this.compileAndRun(e,[t])},n.prototype.softmax=function(t,e){var a=Fe([e],t.shape),u=this.max(t,a),s=bn(u.shape,a),l=this.subtract(t,u.reshape(s)),f=this.exp(l),h=this.sum(f,a).reshape(s);return this.realDivide(f,h)},n.prototype.log=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.log(t);if(st().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,`
  vec4 result = log(x);
  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));
  result.r = isNaN.r == 1.0 ? NAN : result.r;
  result.g = isNaN.g == 1.0 ? NAN : result.g;
  result.b = isNaN.b == 1.0 ? NAN : result.b;
  result.a = isNaN.a == 1.0 ? NAN : result.a;

  return result;
`,t.dtype);var e=new Ft(t.shape,`if (x < 0.0) return NAN;
  return log(x);`);return this.compileAndRun(e,[t])},n.prototype.log1p=function(t){var e=new Ft(t.shape,"return log(1.0 + x);");return this.compileAndRun(e,[t])},n.prototype.sqrt=function(t){var e=new Ft(t.shape,"return sqrt(x);");return this.compileAndRun(e,[t])},n.prototype.rsqrt=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.rsqrt(t);var e=new Ft(t.shape,"return inversesqrt(x);");return this.compileAndRun(e,[t])},n.prototype.reciprocal=function(t){var e=new Ft(t.shape,"return 1.0 / x;");return this.compileAndRun(e,[t])},n.prototype.relu=function(t){var e;return e=st().getBool("WEBGL_PACK")?new Su(t.shape,k1):new Ft(t.shape,N1),this.compileAndRun(e,[t])},n.prototype.relu6=function(t){var e;return e=st().getBool("WEBGL_PACK")?new Su(t.shape,I1):new Ft(t.shape,M1),this.compileAndRun(e,[t])},n.prototype.prelu=function(t,e){var a=st().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Zr(D1,t.shape,e.shape):new be(T1,t.shape,e.shape);return this.compileAndRun(a,[t,e])},n.prototype.elu=function(t){if(st().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,B1,t.dtype);var e=new Ft(t.shape,O1);return this.compileAndRun(e,[t])},n.prototype.eluDer=function(t,e){var a=st().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Zr(`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,t.shape,e.shape):new be("return (b >= 1.0) ? a : a * (b + 1.0);",t.shape,e.shape);return this.compileAndRun(a,[t,e])},n.prototype.selu=function(t){var e=new Ft(t.shape,lS);return this.compileAndRun(e,[t])},n.prototype.int=function(t){var e=new Ft(t.shape,"return float(int(x));");return this.compileAndRun(e,[t],"int32")},n.prototype.clip=function(t,e,a){var u,s=(u=st().getBool("WEBGL_PACK_CLIP")?new WE(t.shape):new GE(t.shape)).getCustomSetupFunc(e,a);return this.compileAndRun(u,[t],null,s)},n.prototype.abs=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.abs(t);if(st().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,dy,t.dtype);var e=new Ft(t.shape,dy);return this.compileAndRun(e,[t])},n.prototype.complexAbs=function(t){var e=this.texData.get(t.dataId),a=new qE(t.shape),u=[this.makeComplexComponentTensorInfo(t,e.complexTensors.real),this.makeComplexComponentTensorInfo(t,e.complexTensors.imag)];return this.compileAndRun(a,u)},n.prototype.sigmoid=function(t){var e=new Ft(t.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(e,[t])},n.prototype.softplus=function(t){var e=new Ft(t.shape,`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`);return this.compileAndRun(e,[t])},n.prototype.sin=function(t){var e=new Ft(t.shape,cS);return this.compileAndRun(e,[t])},n.prototype.cos=function(t){var e=new Ft(t.shape,fS);return this.compileAndRun(e,[t])},n.prototype.tan=function(t){var e=new Ft(t.shape,"return tan(x);");return this.compileAndRun(e,[t])},n.prototype.asin=function(t){var e=new Ft(t.shape,hS);return this.compileAndRun(e,[t])},n.prototype.acos=function(t){var e=new Ft(t.shape,dS);return this.compileAndRun(e,[t])},n.prototype.atan=function(t){var e=new Ft(t.shape,pS);return this.compileAndRun(e,[t])},n.prototype.atan2=function(t,e){var a=st().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Zr(`
  vec4 result = atan(a, b);
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,e.shape):new be(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return atan(a, b);
`,t.shape,e.shape);return this.compileAndRun(a,[t,e])},n.prototype.sinh=function(t){var e=new Ft(t.shape,`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`);return this.compileAndRun(e,[t])},n.prototype.cosh=function(t){var e=new Ft(t.shape,`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`);return this.compileAndRun(e,[t])},n.prototype.tanh=function(t){var e=new Ft(t.shape,`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`);return this.compileAndRun(e,[t])},n.prototype.asinh=function(t){var e=new Ft(t.shape,vS);return this.compileAndRun(e,[t])},n.prototype.acosh=function(t){var e=new Ft(t.shape,mS);return this.compileAndRun(e,[t])},n.prototype.atanh=function(t){var e=new Ft(t.shape,gS);return this.compileAndRun(e,[t])},n.prototype.erf=function(t){var e=new Ft(t.shape,`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = 0.3275911;
  float a1 = 0.254829592;
  float a2 = -0.284496736;
  float a3 = 1.421413741;
  float a4 = -1.453152027;
  float a5 = 1.061405429;

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`);return this.compileAndRun(e,[t])},n.prototype.step=function(t,e){var a=new Ft(t.shape,(function(u){return u===void 0&&(u=0),lr+`
    return x > 0.0 ? 1.0 : float(`+u+`);
  `})(e));return this.compileAndRun(a,[t])},n.prototype.conv2dByMatMul=function(t,e,a,u,s,l){var f=t.shape,h=this.texData.get(t.dataId),p=a.inChannels,v=f[0]*f[1]*f[2],m=a.outChannels,y=a.dataFormat==="channelsLast",x=(v===1||m===1)&&p>1e3,w=f[2]%2!=0&&!!h.isPacked;if(x||!st().getBool("WEBGL_LAZILY_UNPACK")||!st().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!w){var _=y?f[0]*f[1]*f[2]:f[0]*f[2]*f[3],E=this.reshape(t,[1,_,a.inChannels]),R=this.reshape(e,[1,a.inChannels,a.outChannels]);return this.reshape(this.fusedBatchMatMul({a:E,b:R,transposeA:!1,transposeB:!1,bias:u,activation:s,preluActivationWeights:l}),a.outShape)}var A=y?f[0]*f[1]*(f[2]+1):f[0]*f[2]*(f[3]+1),S={dataId:t.dataId,shape:[1,A,a.inChannels],dtype:t.dtype},T=h.shape;h.shape=h.shape.slice(),h.shape[h.shape.length-2]++,k(vl(h.shape,S.shape),(function(){return"packed reshape "+h.shape+" to "+S.shape+" isn't free"}));var N=this.reshape(e,[1,a.inChannels,a.outChannels]),O=this.fusedBatchMatMul({a:S,b:N,transposeA:!1,transposeB:!1,bias:u,activation:s,preluActivationWeights:l}),B=this.texData.get(O.dataId);return k(B.isPacked,(function(){return"batchMatMul result is expected to be packed"})),h.shape=T,B.shape=a.outShape,W.makeTensorFromDataId(O.dataId,a.outShape,O.dtype)},n.prototype.conv2dWithIm2Row=function(t,e,a,u,s,l){var f=a.filterWidth,h=a.filterHeight,p=a.inChannels,v=a.outWidth,m=a.outHeight,y=a.dataFormat==="channelsLast",x=f*h*p,w=m*v,_=[x,w],E=t.squeeze([0]),R=e.reshape([1,x,-1]),A=new kC(_,E.shape,a),S=this.compileAndRun(A,[E]).reshape([1,_[0],_[1]]),T=u!=null,N=l!=null,O=s?bl(s,!0):null,B=new qh(S.shape,[1,w,a.outChannels],!0,!1,T,O,N),I=[S,R];u&&I.push(u),N&&I.push(l);var F=this.compileAndRun(B,I);return y?F.reshape([1,m,v,a.outChannels]):F.reshape([1,a.outChannels,m,v])},n.prototype.fusedConv2d=function(t){var e=t.input,a=t.filter,u=t.convInfo,s=t.bias,l=t.activation,f=t.preluActivationWeights;if(u.filterHeight===1&&u.filterWidth===1&&u.dilationHeight===1&&u.dilationWidth===1&&u.strideHeight===1&&u.strideWidth===1&&(u.padInfo.type==="SAME"||u.padInfo.type==="VALID"))return this.conv2dByMatMul(e,a,u,s,l,f);if(st().getBool("WEBGL_CONV_IM2COL")&&e.shape[0]===1)return this.conv2dWithIm2Row(e,a,u,s,l,f);var h=s!=null,p=f!=null,v=l?bl(l,!1):null,m=new ay(u,h,v,p),y=[e,a];return s&&y.push(s),f&&y.push(f),this.compileAndRun(m,y)},n.prototype.conv2d=function(t,e,a){if(a.filterHeight===1&&a.filterWidth===1&&a.dilationHeight===1&&a.dilationWidth===1&&a.strideHeight===1&&a.strideWidth===1&&(a.padInfo.type==="SAME"||a.padInfo.type==="VALID"))return this.conv2dByMatMul(t,e,a);if(st().getBool("WEBGL_CONV_IM2COL")&&t.shape[0]===1)return this.conv2dWithIm2Row(t,e,a);var u=new ay(a);return this.compileAndRun(u,[t,e])},n.prototype.conv2dDerInput=function(t,e,a){var u=new YE(a);return this.compileAndRun(u,[t,e])},n.prototype.conv2dDerFilter=function(t,e,a){var u=new KE(a);return this.compileAndRun(u,[t,e])},n.prototype.fusedDepthwiseConv2D=function(t){var e,a=t.input,u=t.filter,s=t.convInfo,l=t.bias,f=t.activation,h=t.preluActivationWeights,p=st().getBool("WEBGL_PACK_DEPTHWISECONV")&&s.strideWidth<=2&&s.outChannels/s.inChannels==1,v=f?bl(f,p):null,m=[a,u],y=l!=null,x=h!=null;return y&&m.push(l),x&&m.push(h),p?(e=new oy(s,y,v,x),this.compileAndRun(e,m)):(e=new iy(s,y,v,x),this.compileAndRun(e,m))},n.prototype.depthwiseConv2D=function(t,e,a){var u;return st().getBool("WEBGL_PACK_DEPTHWISECONV")&&a.strideWidth<=2&&a.outChannels/a.inChannels==1?(u=new oy(a),this.compileAndRun(u,[t,e])):(u=new iy(a),this.compileAndRun(u,[t,e]))},n.prototype.depthwiseConv2DDerInput=function(t,e,a){var u=new $E(a);return this.compileAndRun(u,[t,e])},n.prototype.depthwiseConv2DDerFilter=function(t,e,a){var u=new JE(a);return this.compileAndRun(u,[t,e])},n.prototype.conv3d=function(t,e,a){var u=new tC(a);return this.compileAndRun(u,[t,e])},n.prototype.conv3dDerInput=function(t,e,a){var u=new ZE(a);return this.compileAndRun(u,[t,e])},n.prototype.conv3dDerFilter=function(t,e,a){var u=new QE(a);return this.compileAndRun(u,[t,e])},n.prototype.maxPool=function(t,e){var a=new jh(e,"max",!1);return this.compileAndRun(a,[t])},n.prototype.avgPool=function(t,e){var a=new jh(e,"avg",!1);return this.compileAndRun(a,[t],"float32")},n.prototype.maxPoolBackprop=function(t,e,a,u){var s=new jh(u,"max",!0),l=this.compileAndRun(s,[e]),f=new zC(u),h=this.compileAndRun(f,[t,l],e.dtype);return l.dispose(),h},n.prototype.avgPoolBackprop=function(t,e,a){var u=new zE(a);return this.compileAndRun(u,[t],e.dtype)},n.prototype.cast=function(t,e){return b1(t,e,this)},n.prototype.unstack=function(t,e){for(var a=t.shape[e],u=new Array(t.rank-1),s=0,l=0;l<t.rank;l++)l!==e&&(u[s++]=t.shape[l]);var f=new Array(t.rank).fill(0),h=t.shape.slice();h[e]=1;var p=new Array(a);for(l=0;l<p.length;l++)f[e]=l,p[l]=this.slice(t,f,h).reshape(u);return p},n.prototype.avgPool3d=function(t,e){var a=new Xh(e,"avg",!1);return this.compileAndRun(a,[t],"float32")},n.prototype.avgPool3dBackprop=function(t,e,a){var u=new LE(a);return this.compileAndRun(u,[t],e.dtype)},n.prototype.maxPool3d=function(t,e){var a=new Xh(e,"max",!1);return this.compileAndRun(a,[t],"float32")},n.prototype.maxPool3dBackprop=function(t,e,a,u){var s=new Xh(u,"max",!0),l=this.compileAndRun(s,[e]),f=new LC(u),h=this.compileAndRun(f,[t,l],e.dtype);return l.dispose(),h},n.prototype.reshape=function(t,e){var a=this.texData.get(t.dataId);if(a.isPacked&&!vl(t.shape,e)&&(a.texture===null||!vl(a.shape,e))){var u=this.packedReshape(t,e);return W.makeTensorFromDataId(u.dataId,u.shape,u.dtype)}return yd(t,e)},n.prototype.resizeBilinear=function(t,e,a,u){var s=st().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new KC(t.shape,e,a,u):new XC(t.shape,e,a,u);return this.compileAndRun(s,[t],"float32")},n.prototype.resizeBilinearBackprop=function(t,e,a){var u=new jC(t,e,a);return this.compileAndRun(u,[t])},n.prototype.resizeNearestNeighbor=function(t,e,a,u){var s=new QC(t.shape,e,a,u);return this.compileAndRun(s,[t])},n.prototype.resizeNearestNeighborBackprop=function(t,e,a){var u=new YC(t,e,a);return this.compileAndRun(u,[t])},n.prototype.multinomial=function(t,e,a,u){var s=e?t:ea(t),l=s.shape[0],f=s.shape[1],h=new UC(l,f,a),p=h.getCustomSetupFunc(u);return this.compileAndRun(h,[s],"int32",p)},n.prototype.oneHot=function(t,e,a,u){var s=new PC(t.size,e,a,u);return this.compileAndRun(s,[t])},n.prototype.diag=function(t){var e=new oC(t.size);return this.compileAndRun(e,[t])},n.prototype.nonMaxSuppression=function(t,e,a,u,s){return Ol("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),Ld(t.dataSync(),e.dataSync(),a,u,s)},n.prototype.cropAndResize=function(t,e,a,u,s,l){var f=new eC(t.shape,e.shape,u,s,l);return this.compileAndRun(f,[t,e,a],"float32")},n.prototype.depthToSpace=function(t,e,a){k(e>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: "+e}));var u=t.shape[0],s=a==="NHWC"?t.shape[1]:t.shape[2],l=a==="NHWC"?t.shape[2]:t.shape[3],f=a==="NHWC"?t.shape[3]:t.shape[1],h=s*e,p=l*e,v=f/(e*e),m=new iC(a==="NHWC"?[u,h,p,v]:[u,v,h,p],e,a);return this.compileAndRun(m,[t])},n.prototype.split=function(t,e,a){return _1(t,e,a)},n.prototype.scatterND=function(t,e,a){var u=Ll(0,t,a),s=u.sliceRank,l=u.numUpdates,f=u.sliceSize,h=u.strides,p=u.outputSize,v=[p/f,f],m=t.reshape([l,s]),y=e.reshape([l,f]);if(p===0)return yd(Ze([]),a);var x=pt(0),w=new cy(l,s,m.rank,y.rank,h,v);return this.compileAndRun(w,[y,m,x]).reshape(a)},n.prototype.sparseToDense=function(t,e,a,u){var s=Ll(0,t,a),l=s.sliceRank,f=s.numUpdates,h=s.strides,p=s.outputSize,v=new cy(f,l,t.rank,e.rank,h,[p,1]);return this.compileAndRun(v,[e,t,u]).reshape(a)},n.prototype.fft=function(t){return this.fftImpl(t,!1)},n.prototype.ifft=function(t){return this.fftImpl(t,!0)},n.prototype.fftImpl=function(t,e){var a=this.texData.get(t.dataId),u=new sy(fC,t.shape,e),s=new sy(hC,t.shape,e),l=[this.makeComplexComponentTensorInfo(t,a.complexTensors.real),this.makeComplexComponentTensorInfo(t,a.complexTensors.imag)],f=this.compileAndRun(u,l),h=this.compileAndRun(s,l),p=this.complex(f,h).as2D(t.shape[0],t.shape[1]);return f.dispose(),h.dispose(),p},n.prototype.gatherND=function(t,e){var a=e.shape,u=a[a.length-1],s=h1(t,e),l=s[0],f=s[1],h=s[2],p=s[3],v=e.reshape([f,u]),m=t.reshape([t.size/h,h]),y=new vC(u,p,[f,h]);return this.compileAndRun(y,[m,v]).reshape(l)},n.prototype.fill=function(t,e,a){if((a=a||Uu(e))==="string"){var u=Tl(a,_t(t));return u.fill(e),W.makeTensor(u,t,a,this)}var s=new dC(t,e),l=s.getCustomSetupFunc(e);return this.compileAndRun(s,[],a,l)},n.prototype.onesLike=function(t){if(t.dtype==="string")throw new Error("onesLike is not supported under string dtype");return this.fill(t.shape,1,t.dtype)},n.prototype.zerosLike=function(t){return this.fill(t.shape,t.dtype==="string"?"":0,t.dtype)},n.prototype.linspace=function(t,e,a){return x1(t,e,a)},n.prototype.makeTensorInfo=function(t,e){var a=this.write(null,t,e);return this.texData.get(a).usage=null,{dataId:a,shape:t,dtype:e}},n.prototype.makeOutput=function(t,e){var a=this.makeTensorInfo(t,e).dataId;return W.makeTensorFromDataId(a,t,e,this)},n.prototype.unpackTensor=function(t){var e=new bS(t.shape);return this.runWebGLProgram(e,[t],t.dtype)},n.prototype.packTensor=function(t){var e=new HC(t.shape);return this.runWebGLProgram(e,[t],t.dtype,null,!0)},n.prototype.packedReshape=function(t,e){var a=[Nl(t.shape)].concat(Ml(t.shape)),u={dtype:t.dtype,shape:a,dataId:t.dataId},s=[Nl(e)].concat(Ml(e)),l=new qC(s,a),f=this.runWebGLProgram(l,[u],t.dtype,null,!0);return{dataId:f.dataId,shape:e,dtype:f.dtype}},n.prototype.decode=function(t){var e,a=this.texData.get(t),u=a.isPacked,s=a.shape,l=a.dtype,f=Hh(s);return e=u?new aC(f):new rC(f),{dtype:l,shape:s,dataId:this.runWebGLProgram(e,[{shape:f,dtype:l,dataId:t}],l,null,!0).dataId}},n.prototype.runWebGLProgram=function(t,e,a,u,s){var l=this;s===void 0&&(s=!1);var f=this.makeTensorInfo(t.outputShape,a),h=this.texData.get(f.dataId);if(t.packedOutput&&(h.isPacked=!0),t.outPackingScheme===Mu.DENSE){var p=Ru(t.outputShape);h.texShape=p.map((function(A){return 2*A}))}if(t.outTexUsage!=null&&(h.usage=t.outTexUsage),_t(f.shape)===0)return h.values=Du(f.dtype,0),f;var v=[],m=e.map((function(A){if(A.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var S=l.texData.get(A.dataId);if(S.texture==null){if(!t.packedInputs&&_t(A.shape)<=st().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:A.shape,texData:null,isUniform:!0,uniformValues:S.values};t.packedInputs&&(S.isPacked=!0,S.shape=A.shape)}else if(!!S.isPacked!=!!t.packedInputs)A=S.isPacked?l.unpackTensor(A):l.packTensor(A),v.push(A),S=l.texData.get(A.dataId);else if(S.isPacked&&!vl(S.shape,A.shape)){var T=A,N=A.shape;A.shape=S.shape,A=l.packedReshape(A,N),v.push(A),S=l.texData.get(A.dataId),T.shape=N}return l.uploadToGPU(A.dataId),{shape:A.shape,texData:S,isUniform:!1}}));this.uploadToGPU(f.dataId);var y,x={shape:f.shape,texData:h,isUniform:!1},w=(function(A,S,T){var N="";S.concat(T).forEach((function(I){var F=I.texData!=null&&I.texData.slice!=null&&I.texData.slice.flatOffset>0,G=I.isUniform?"uniform":I.texData.texShape;N+=I.shape+"_"+G+"_"+F}));var O=A.userCode,B=A.constructor.name;return B+="_"+N+"_"+O})(t,m,x),_=this.getAndSaveBinary(w,(function(){return(function(A,S,T,N){var O=S.userCode,B=T.map((function(K,rt){var ot={logicalShape:K.shape,texShape:K.isUniform?null:K.texData.texShape,isUniform:K.isUniform,isPacked:!K.isUniform&&K.texData.isPacked,flatOffset:null};return K.texData!=null&&K.texData.slice!=null&&K.texData.slice.flatOffset>0&&(ot.flatOffset=K.texData.slice.flatOffset),{name:S.variableNames[rt],shapeInfo:ot}})),I=B.map((function(K){return K.shapeInfo})),F={logicalShape:N.shape,texShape:N.texData.texShape,isUniform:!1,isPacked:N.texData.isPacked,flatOffset:null},G=ME(B,F,O,S.packedInputs),H=A.createProgram(G),at=null,et=A.getUniformLocation(H,"NAN",!1);st().getNumber("WEBGL_VERSION")===1&&(at=A.getUniformLocation(H,"INFINITY",!1));for(var nt={},L=0;L<S.variableNames.length;L++){var q=S.variableNames[L];nt[q]=A.getUniformLocation(H,q,!1),nt["offset"+q]=A.getUniformLocation(H,"offset"+q,!1)}return{program:S,source:G,webGLProgram:H,uniformLocations:nt,inShapeInfos:I,outShapeInfo:F,infLoc:at,nanLoc:et}})(l.gpgpu,t,m,x)})),E=this.activeTimers!=null;if(E&&(y=this.startTimer()),(function(A,S,T,N,O){ly(S.inShapeInfos,T),ly([S.outShapeInfo],[N]);var B=N.texData.texture,I=N.texData.texShape;N.texData.isPacked?A.setOutputPackedMatrixTexture(B,I[0],I[1]):A.setOutputMatrixTexture(B,I[0],I[1]),A.setProgram(S.webGLProgram),st().getNumber("WEBGL_VERSION")===1&&S.infLoc!==null&&A.gl.uniform1f(S.infLoc,1/0),S.nanLoc!==null&&A.gl.uniform1f(S.nanLoc,NaN),T.forEach((function(F,G){var H=S.program.variableNames[G],at=S.uniformLocations[H],et=S.uniformLocations["offset"+H];if(at!=null)if(F.isUniform)if(_t(F.shape)<2)A.gl.uniform1f(at,F.uniformValues[0]);else{var nt=F.uniformValues;nt instanceof Float32Array||(nt=new Float32Array(nt)),A.gl.uniform1fv(at,nt)}else F.texData.slice!=null&&et!=null&&A.gl.uniform1i(et,F.texData.slice.flatOffset),A.setInputMatrixTexture(F.texData.texture,at,G)})),O?.(A,S.webGLProgram),A.executeProgram()})(this.gpgpu,_,m,x,u),v.forEach((function(A){return l.disposeData(A.dataId)})),E&&(y=this.endTimer(y),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(y)})),!st().getBool("WEBGL_LAZILY_UNPACK")&&h.isPacked&&s===!1){var R=this.unpackTensor(f);return this.disposeData(f.dataId),R}return f},n.prototype.compileAndRun=function(t,e,a,u,s){s===void 0&&(s=!1),a=a||e[0].dtype;var l=this.runWebGLProgram(t,e,a,u,s);return W.makeTensorFromDataId(l.dataId,l.shape,l.dtype)},n.prototype.getAndSaveBinary=function(t,e){return t in this.binaryCache||(this.binaryCache[t]=e()),this.binaryCache[t]},n.prototype.getTextureManager=function(){return this.textureManager},n.prototype.dispose=function(){var t=this;this.disposed||(st().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach((function(e){t.gpgpu.deleteProgram(t.binaryCache[e].webGLProgram),delete t.binaryCache[e]})),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},n.prototype.floatPrecision=function(){var t=this;return this.floatPrecisionValue==null&&(this.floatPrecisionValue=mt((function(){if(!st().get("WEBGL_RENDER_FLOAT32_ENABLED")){var e=st().getBool("DEBUG");st().set("DEBUG",!1);var a=t.abs(pt(1e-8)).dataSync()[0];if(st().set("DEBUG",e),a>0)return 32}return 16}))),this.floatPrecisionValue},n.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},n.prototype.uploadToGPU=function(t){var e,a=this.texData.get(t),u=a.shape,s=a.dtype,l=a.values,f=a.texture,h=a.usage,p=a.isPacked;if(f==null){var v,m=this.activeTimers!=null;m&&(v=yr());var y=a.texShape;if(y==null&&(y=A_(u,p),a.texShape=y),l!=null){var x=Hh(u),w=void 0,_=y[1],E=y[0],R=l instanceof Uint8Array;p?(_=(e=Hu(y[0],y[1]))[0],E=e[1],w=new cC(x,[E,_],R)):w=new lC(x,[E,_],R);var A=this.makeTensorInfo([E,_],s);this.texData.get(A.dataId).usage=R?kn.PIXELS:kn.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(A.dataId),_,E,l);var S=this.runWebGLProgram(w,[A],s,null,!0),T=this.texData.get(S.dataId);a.texture=T.texture,a.texShape=T.texShape,a.isPacked=T.isPacked,a.usage=T.usage,this.disposeData(A.dataId),this.texData.delete(S.dataId),a.values=null,m&&(this.uploadWaitMs+=yr()-v)}else{var N=this.acquireTexture(y,h,s,p);a.texture=N}}},n.prototype.convertAndCacheOnCPU=function(t,e){var a=this.texData.get(t),u=a.dtype;return this.releaseGPUData(t),e!=null&&(a.values=(function(s,l){if(l==="float32"||l==="complex64")return s;if(l==="int32"||l==="bool"){for(var f=l==="int32"?new Int32Array(s.length):new Uint8Array(s.length),h=0;h<f.length;++h)f[h]=Math.round(s[h]);return f}throw new Error("Unknown dtype "+l)})(e,u)),a.values},n.prototype.acquireTexture=function(t,e,a,u){if(this.numBytesInGPU+=this.computeBytes(t,a),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var s=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+s+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(t,e,u)},n.prototype.computeBytes=function(t,e){return t[0]*t[1]*Ky(e)},n})(g1);e1()&&W.registerBackend("webgl",(function(){return new wS}),2);var _S=P({square_:function(r){var n=M(r,"x","square"),t=[n];return W.runKernelFunc((function(e,a){return a([n]),e.square(n)}),{x:n},null,"Square",{},t,[])}}),ku="SquaredDifference",F1=P({squaredDifference_:function(r,n){var t,e=M(r,"a","squaredDifference"),a=M(n,"b","squaredDifference");t=me(e,a),e=t[0],a=t[1],Ht(e.shape,a.shape);var u={a:e,b:a},s=[e,a];return W.runKernelFunc((function(l,f){var h=l.squaredDifference(e,a);return f([e,a]),h}),u,(function(l,f){var h=f[0],p=f[1],v=pt(2);return{a:function(){return l.mul(h.sub(p).mul(v))},b:function(){return l.mul(p.sub(h).mul(v))}}}),ku,{},s,[])}}),ES=P({abs_:function(r){var n=M(r,"x","abs");return n.dtype==="complex64"?W.runKernelFunc((function(t){return t.complexAbs(n)}),{$x:n}):W.runKernelFunc((function(t,e){var a=t.abs(n);return e([n]),a}),{x:n},(function(t,e){var a=e[0];return{x:function(){return t.mul(a.toFloat().step(-1))}}}),"Abs")}}),CS=P({acos_:function(r){var n=M(r,"x","acos");return W.runKernelFunc((function(t,e){var a=t.acos(n);return e([n]),a}),{$x:n},(function(t,e){var a=e[0];return{$x:function(){return t.divStrict(pt(1).sub(a.toFloat().square()).sqrt()).neg()}}}))}}),SS=P({acosh_:function(r){var n=M(r,"x","acosh");return W.runKernelFunc((function(t,e){var a=t.acosh(n);return e([n]),a}),{$x:n},(function(t,e){var a=e[0];return{$x:function(){return t.divStrict(a.toFloat().square().sub(1).sqrt())}}}))}}),RS=P({asin_:function(r){var n=M(r,"x","asin");return W.runKernelFunc((function(t,e){var a=t.asin(n);return e([n]),a}),{$x:n},(function(t,e){var a=e[0];return{$x:function(){return t.divStrict(pt(1).sub(a.toFloat().square()).sqrt())}}}))}}),AS=P({asinh_:function(r){var n=M(r,"x","asinh");return W.runKernelFunc((function(t,e){var a=t.asinh(n);return e([n]),a}),{$x:n},(function(t,e){var a=e[0];return{$x:function(){return t.divStrict(pt(1).add(a.toFloat().square()).sqrt())}}}))}}),TS=P({atan_:function(r){var n=M(r,"x","atan");return W.runKernelFunc((function(t,e){var a=t.atan(n);return e([n]),a}),{$x:n},(function(t,e){var a=e[0];return{$x:function(){return t.div(a.toFloat().square().add(1))}}}))}}),DS=P({atanh_:function(r){var n=M(r,"x","atanh");return W.runKernelFunc((function(t,e){var a=t.atanh(n);return e([n]),a}),{$x:n},(function(t,e){var a=e[0];return{$x:function(){return t.div(pt(1).sub(a.toFloat().square()))}}}))}}),NS=P({ceil_:function(r){var n=M(r,"x","ceil");return W.runKernelFunc((function(t){return t.ceil(n)}),{$x:n},(function(t){return{$x:function(){return jt(t)}}}))}}),Wd=P({clipByValue_:function(r,n,t){var e=M(r,"x","clipByValue");k(n<=t,(function(){return"Error in clip: min ("+n+") must be less than or equal to max ("+t+")."}));var a=[e],u={min:n,max:t};return W.runKernelFunc((function(s,l){var f=s.clip(e,n,t);return l([e]),f}),{x:e},(function(s,l){var f=l[0];return{x:function(){return s.where(f.greaterEqual(n).logicalAnd(f.lessEqual(t)),jt(s))}}}),"ClipByValue",u,a)}}),MS=P({cos_:function(r){var n=M(r,"x","cos"),t=[n];return W.runKernelFunc((function(e,a){var u=e.cos(n);return a([n]),u}),{x:n},(function(e,a){var u=a[0];return{x:function(){return u.toFloat().sin().neg().mul(e)}}}),"Cos",{},t)}}),OS=P({cosh_:function(r){var n=M(r,"x","cosh");return W.runKernelFunc((function(t,e){var a=t.cosh(n);return e([n]),a}),{$x:n},(function(t,e){var a=e[0];return{$x:function(){return a.toFloat().sinh().mulStrict(t)}}}))}}),kS=P({erf_:function(r){var n=M(r,"x","erf");return k(n.dtype==="int32"||n.dtype==="float32",(function(){return"Input dtype must be `int32` or `float32`."})),n.dtype==="int32"&&(n=n.toFloat()),W.runKernelFunc((function(t,e){var a=t.erf(n);return e([n]),a}),{$x:n},(function(t,e){var a=e[0];return{$x:function(){return t.mul(a.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}}))}}),xd=P({exp_:function(r){var n=M(r,"x","exp");return W.runKernelFunc((function(t,e){var a=t.exp(n);return e([a]),a}),{x:n},(function(t,e){return{x:function(){return t.mulStrict(e[0])}}}),"Exp",{},[],[!0])}}),IS=P({expm1_:function(r){var n=M(r,"x","expm1");return W.runKernelFunc((function(t,e){var a=t.expm1(n);return e([n]),a}),{$x:n},(function(t,e){var a=e[0];return{$x:function(){return t.mul(a.exp())}}}))}}),BS=P({floor_:function(r){var n=M(r,"x","floor");return W.runKernelFunc((function(t){return t.floor(n)}),{$x:n},(function(t){return{$x:function(){return jt(t)}}}))}}),FS=P({log_:function(r){var n=M(r,"x","log"),t=[n];return W.runKernelFunc((function(e,a){var u=e.log(n);return a([n]),u}),{x:n},(function(e,a){var u=a[0];return{x:function(){return e.div(u.toFloat())}}}),"Log",{},t)}}),zS=P({log1p_:function(r){var n=M(r,"x","log1p");return W.runKernelFunc((function(t,e){var a=t.log1p(n);return e([n]),a}),{$x:n},(function(t,e){var a=e[0];return{$x:function(){return t.div(a.add(1))}}}))}}),LS=P({logSigmoid_:function(r){var n=M(r,"x","logSigmoid");return W.runKernelFunc((function(t,e){var a=t.softplus(n.neg()).neg();return e([n]),a}),{$x:n},(function(t,e){var a=e[0];return{$x:function(){return t.mul(a.neg().sigmoid())}}}))}}),Vl=P({neg_:function(r){var n=M(r,"x","neg"),t=[n];return W.runKernelFunc((function(e){return e.neg(n)}),{x:n},(function(e){return{x:function(){return e.neg()}}}),"Neg",{},t)}}),US=P({reciprocal_:function(r){var n=M(r,"x","reciprocal");return W.runKernelFunc((function(t,e){var a=t.reciprocal(n);return e([n]),a}),{$x:n},(function(t,e){var a=e[0];return{$x:function(){return t.div(a.square().neg())}}}))}}),PS=P({round_:function(r){var n=M(r,"x","round");return W.runKernelFunc((function(t){return t.round(n)}),{$x:n},(function(t){return{$x:function(){return jt(t)}}}))}}),z1=P({rsqrt_:function(r){var n=M(r,"x","rsqrt"),t=[n];return W.runKernelFunc((function(e,a){var u=e.rsqrt(n);return a([n]),u}),{x:n},(function(e,a){var u=a[0];return{x:function(){return e.div(u.pow(1.5).mul(2)).neg()}}}),"Rsqrt",{},t)}}),L1=P({sigmoid_:function(r){var n=M(r,"x","sigmoid");return W.runKernelFunc((function(t,e){var a=t.sigmoid(n);return e([a]),a}),{x:n},(function(t,e){var a=e[0];return{x:function(){return t.mul(a.mul(pt(1).sub(a)))}}}),"Sigmoid")}}),HS=P({sign_:function(r){var n=M(r,"x","sign");return W.runKernelFunc((function(t){return t.sign(n)}),{$x:n},(function(t){return{$x:function(){return jt(t)}}}))}}),VS=P({isNaN_:function(r){var n=M(r,"x","isNaN");return W.runKernelFunc((function(t){return t.isNaN(n)}),{$x:n},(function(t){return{$x:function(){return jt(t)}}}))}}),GS=P({isInf_:function(r){var n=M(r,"x","isInf");return W.runKernelFunc((function(t){return t.isInf(n)}),{$x:n},(function(t){return{$x:function(){return jt(t)}}}))}}),WS=P({isFinite_:function(r){var n=M(r,"x","isFinite");return W.runKernelFunc((function(t){return t.isFinite(n)}),{$x:n},(function(t){return{$x:function(){return jt(t)}}}))}}),qS=P({sin_:function(r){var n=M(r,"x","sin"),t=[n];return W.runKernelFunc((function(e,a){var u=e.sin(n);return a([n]),u}),{x:n},(function(e,a){var u=a[0];return{x:function(){return u.toFloat().cos().mul(e)}}}),"Sin",{},t)}}),jS=P({sinh_:function(r){var n=M(r,"x","sinh");return W.runKernelFunc((function(t,e){var a=t.sinh(n);return e([n]),a}),{$x:n},(function(t,e){var a=e[0];return{$x:function(){return a.toFloat().cosh().mulStrict(t)}}}))}}),XS=P({softplus_:function(r){var n=M(r,"x","softplus");return W.runKernelFunc((function(t,e){var a=t.softplus(n);return e([n]),a}),{$x:n},(function(t,e){var a=e[0];return{$x:function(){return t.mul(a.sigmoid())}}}))}}),KS=P({sqrt_:function(r){var n=M(r,"x","sqrt");return W.runKernelFunc((function(t,e){var a=t.sqrt(n);return e([n]),a}),{$x:n},(function(t,e){var a=e[0];return{$x:function(){return t.div(a.toFloat().sqrt().mul(2))}}}))}}),YS=P({step_:function(r,n){n===void 0&&(n=0);var t=M(r,"x","step");return W.runKernelFunc((function(e){return e.step(t,n)}),{$x:t},(function(e){return{$x:function(){return jt(e)}}}))}}),QS=P({tan_:function(r){var n=M(r,"x","tan");return W.runKernelFunc((function(t,e){var a=t.tan(n);return e([n]),a}),{$x:n},(function(t,e){var a=e[0];return{$x:function(){return t.div(a.cos().square())}}}))}}),ZS=P({tanh_:function(r){var n=M(r,"x","tanh");return W.runKernelFunc((function(t,e){var a=t.tanh(n);return e([a]),a}),{x:n},(function(t,e){var a=e[0];return{x:function(){return pt(1).sub(a.square()).mulStrict(t)}}}),"Tanh",{},null,[!0])}});function U1(r,n,t,e,a,u){var s,l,f=M(r,"x","batchNorm"),h=M(n,"mean","batchNorm"),p=M(t,"variance","batchNorm");return a!=null&&(s=M(a,"scale","batchNorm")),e!=null&&(l=M(e,"offset","batchNorm")),k(f.rank===2,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+f.rank+"."})),k(h.rank===2||h.rank===1,(function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+h.rank+"."})),k(p.rank===2||p.rank===1,(function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+p.rank+"."})),s!=null&&k(s.rank===2||s.rank===1,(function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+s.rank+"."})),l!=null&&k(l.rank===2||l.rank===1,(function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+l.rank+"."})),Gu(f,h,p,l,s,u)}function P1(r,n,t,e,a,u){var s,l,f=M(r,"x","batchNorm"),h=M(n,"mean","batchNorm"),p=M(t,"variance","batchNorm");return a!=null&&(s=M(a,"scale","batchNorm")),e!=null&&(l=M(e,"offset","batchNorm")),k(f.rank===3,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+f.rank+"."})),k(h.rank===3||h.rank===1,(function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+h.rank+"."})),k(p.rank===3||p.rank===1,(function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+p.rank+"."})),s!=null&&k(s.rank===3||s.rank===1,(function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+s.rank+"."})),l!=null&&k(l.rank===3||l.rank===1,(function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+l.rank+"."})),Gu(f,h,p,l,s,u)}function H1(r,n,t,e,a,u){var s,l,f=M(r,"x","batchNorm"),h=M(n,"mean","batchNorm"),p=M(t,"variance","batchNorm");return a!=null&&(s=M(a,"scale","batchNorm")),e!=null&&(l=M(e,"offset","batchNorm")),k(f.rank===4,(function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+f.rank+"."})),k(h.rank===4||h.rank===1,(function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+h.rank+"."})),k(p.rank===4||p.rank===1,(function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+p.rank+"."})),s!=null&&k(s.rank===4||s.rank===1,(function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+s.rank+"."})),l!=null&&k(l.rank===4||l.rank===1,(function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+l.rank+"."})),Gu(f,h,p,l,s,u)}function Gu(r,n,t,e,a,u){u==null&&(u=.001);var s,l,f,h=M(r,"x","batchNorm"),p=M(n,"mean","batchNorm"),v=M(t,"variance","batchNorm");a!=null&&(s=M(a,"scale","batchNorm")),e!=null&&(l=M(e,"offset","batchNorm")),k(p.rank===v.rank,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),k(l==null||p.rank===l.rank,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),k(s==null||p.rank===s.rank,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."})),f=h.rank===0||h.rank===1?h.as4D(1,1,1,h.size):h.rank===2?h.as4D(1,1,h.shape[0],h.shape[1]):h.rank===3?h.as4D(1,h.shape[0],h.shape[1],h.shape[2]):h;var m=[h,p,v,s];return W.runKernelFunc((function(y,x){var w=y.batchNormalization(f,xl(p),xl(v),u,xl(s),xl(l));return x([h,p,v,s]),w}),{x:h,mean:p,variance:v,scale:s,offset:l},(function(y,x){var w=x,_=w[0],E=w[1],R=w[2],A=w[3],S=A??pt(1),T=Ie(E.shape,f.shape),N=[];if(E.rank===1){for(var O=0;O<f.shape.length-1;++O)N.push(f.shape[O]);N.push(1)}var B=_.sub(E),I=y.mul(S),F=z1(R.add(pt(u))),G=F.mul(F).mul(F).mul(pt(-.5));return{x:function(){return E.rank===1?y.mul(mo(F.as4D(1,1,1,E.shape[0]),N)).mul(S).reshape(_.shape):y.mul(F).mul(S).reshape(_.shape)},mean:function(){var H=F.mul(pt(-1)).mul(I);return E.rank===1&&(H=H.sum(T)),H.reshape(E.shape)},variance:function(){var H=G.mul(B).mul(I);return E.rank===1&&(H=H.sum(T)),H.reshape(E.shape)},scale:function(){var H=B.mul(F),at=y.mul(H);return E.rank===1&&(at=at.sum(T)),at.reshape(E.shape)},offset:function(){var H=y;return E.rank===1&&(H=H.sum(T)),H.reshape(E.shape)}}}),"BatchNormalization",{varianceEpsilon:u},m).reshape(h.shape)}function xl(r){return r==null?null:r.rank===0?r.as1D():r.rank===1?r:r.rank===2?r.as4D(1,1,r.shape[0],r.shape[1]):r.rank===3?r.as4D(1,r.shape[0],r.shape[1],r.shape[2]):r}function Jl(){n1("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var JS=P({batchNormalization2d_:function(r,n,t,e,a,u){return e===void 0&&(e=.001),Jl(),U1(r,n,t,u,a,e)}}),$S=P({batchNormalization3d_:function(r,n,t,e,a,u){return e===void 0&&(e=.001),Jl(),P1(r,n,t,u,a,e)}}),tR=P({batchNormalization4d_:function(r,n,t,e,a,u){return e===void 0&&(e=.001),Jl(),H1(r,n,t,u,a,e)}}),eR=P({batchNormalization_:function(r,n,t,e,a,u){return e===void 0&&(e=.001),Jl(),Gu(r,n,t,u,a,e)}}),V1=P({batchNorm_:Gu}),nR=P({batchNorm2d_:U1}),rR=P({batchNorm3d_:P1}),aR=P({batchNorm4d_:H1}),$l=P({logicalAnd_:function(r,n){var t=M(r,"a","logicalAnd","bool"),e=M(n,"b","logicalAnd","bool");return Ht(t.shape,e.shape),W.runKernelFunc((function(a){return a.logicalAnd(t,e)}),{a:t,b:e},null,"LogicalAnd")}}),iR=P({logicalNot_:function(r){var n=M(r,"x","logicalNot","bool");return W.runKernelFunc((function(t){return t.logicalNot(n)}),{$x:n})}}),G1=P({logicalOr_:function(r,n){var t=M(r,"a","logicalOr","bool"),e=M(n,"b","logicalOr","bool");return Ht(t.shape,e.shape),W.runKernelFunc((function(a){return a.logicalOr(t,e)}),{$a:t,$b:e})}}),oR=P({logicalXor_:function(r,n){var t=M(r,"a","logicalXor","bool"),e=M(n,"b","logicalXor","bool");return Ht(t.shape,e.shape),G1(r,n).logicalAnd($l(r,n).logicalNot())}}),vi=P({where_:function(r,n,t){var e=M(n,"a","where"),a=M(t,"b","where"),u=M(r,"condition","where","bool");return $t(e.shape,a.shape,"Error in where: "),u.rank===1?k(u.shape[0]===e.shape[0],(function(){return"The first dimension of `a` must match the size of `condition`."})):$t(u.shape,a.shape,"Error in where: "),W.runKernelFunc((function(s,l){var f=s.select(u,e,a);return l([u]),f}),{$condition:u,$a:e,$b:a},(function(s,l){var f=l[0];return{$condition:function(){return jt(f).toFloat()},$a:function(){return s.mul(f.cast(s.dtype))},$b:function(){return s.mul(f.logicalNot().cast(s.dtype))}}}))}}),W1=function(r){return bt(this,void 0,void 0,(function(){var n,t,e;return xt(this,(function(a){switch(a.label){case 0:return[4,(n=M(r,"condition","whereAsync","bool")).data()];case 1:return t=a.sent(),e=Pd(n.shape,t),r!==n&&n.dispose(),[2,e]}}))}))},Lt=P({add_:function(r,n){var t,e=M(r,"a","add"),a=M(n,"b","add");t=me(e,a),e=t[0],a=t[1];var u=Ht(e.shape,a.shape);return W.runKernelFunc((function(s){return s.add(e,a)}),{a:e,b:a},(function(s){return{a:function(){var l=s,f=Ie(e.shape,u);return f.length>0&&(l=l.sum(f)),l.reshape(e.shape)},b:function(){var l=s,f=Ie(a.shape,u);return f.length>0&&(l=l.sum(f)),l.reshape(a.shape)}}}),"Add")}}),uR=P({addN_:function(r){k(Array.isArray(r),(function(){return"The argument passed to tf.addN() must be a list of tensors"})),k(r.length>=1,(function(){return"Must pass at least one tensor to tf.addN(), but got "+r.length}));var n=r.map((function(a,u){return M(a,"tensors"+u,"addN")})),t=n[0];n.forEach((function(a){if(a.dtype!==t.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")})),n.forEach((function(a){if(!Pe(a.shape,t.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}));var e=n;return W.runKernelFunc((function(a){return a.addN(n)}),e,(function(a){var u={};return n.forEach((function(s,l){u[l]=function(){return a.clone()}})),u}),"AddN")}}),sR=P({addStrict_:function(r,n){var t=M(r,"a","addStrict"),e=M(n,"b","addStrict");return $t(t.shape,e.shape,"Error in addStrict: "),t.add(e)}}),lR=P({atan2_:function(r,n){var t,e=M(r,"a","atan2"),a=M(n,"b","atan2");t=me(e,a),e=t[0],a=t[1];var u=Ht(e.shape,a.shape);return W.runKernelFunc((function(s,l){var f=s.atan2(e,a);return l([e,a]),f}),{$a:e,$b:a},(function(s,l){var f=l[0],h=l[1];return{$a:function(){var p=Lt(f.square(),h.square()),v=s.mul(h.div(p)),m=Ie(f.shape,u);return m.length>0&&(v=v.sum(m)),v.reshape(f.shape)},$b:function(){var p=Lt(f.square(),h.square()),v=Vl(s.mul(f.div(p))),m=Ie(h.shape,u);return m.length>0&&(v=v.sum(m)),v.reshape(h.shape)}}}))}}),ir=P({div_:function(r,n){var t,e=M(r,"a","div"),a=M(n,"b","div");if(t=me(e,a),e=t[0],a=t[1],e.dtype==="int32"&&a.dtype==="int32")return q1(e,a);var u=Ht(e.shape,a.shape);return W.runKernelFunc((function(s,l){var f=s.realDivide(e,a);return l([e,a]),f}),{a:e,b:a},(function(s,l){var f=l[0],h=l[1];return{a:function(){var p=s.div(h.toFloat()),v=Ie(f.shape,u);return v.length>0?p.sum(v).reshape(f.shape):p},b:function(){var p=s.mul(f.toFloat()),v=Ie(h.shape,u);v.length>0&&(p=p.sum(v).reshape(h.shape));var m=h.square();return p.div(m.toFloat()).neg()}}}),"Div")}}),cR=P({divNoNan_:function(r,n){var t,e=M(r,"a","div"),a=M(n,"b","div");e=(t=me(e,a))[0],a=t[1];var u=ir(e,a),s=jt(u),l=a.equal(s);return vi(l,s,u)}}),fR=P({divStrict_:function(r,n){var t=M(r,"a","div"),e=M(n,"b","div");return $t(t.shape,e.shape,"Error in divideStrict: "),t.div(e)}}),q1=P({floorDiv_:function(r,n){var t,e=M(r,"a","floorDiv"),a=M(n,"b","floorDiv");t=me(e,a),e=t[0],a=t[1];var u=Ht(e.shape,a.shape);return W.runKernelFunc((function(s,l){var f=s.floorDiv(e,a);return l([e,a]),f}),{a:e,b:a},(function(s,l){var f=l[0],h=l[1];return{a:function(){var p=s.div(h.toFloat()),v=Ie(f.shape,u);return v.length>0?p.sum(v).reshape(f.shape):p},b:function(){var p=s.mul(f.toFloat()),v=Ie(h.shape,u);v.length>0&&(p=p.sum(v).reshape(h.shape));var m=h.square();return p.div(m.toFloat()).neg()}}}),"FloorDiv")}}),qd=P({maximum_:function(r,n){var t,e=M(r,"a","maximum"),a=M(n,"b","maximum");return t=me(e,a),e=t[0],a=t[1],e.dtype==="bool"&&(e=e.toInt(),a=a.toInt()),Ht(e.shape,a.shape),W.runKernelFunc((function(u,s){var l=u.maximum(e,a);return s([e,a]),l}),{a:e,b:a},(function(u,s){var l=s[0],f=s[1];return{a:function(){return u.mul(l.greaterEqual(f).toFloat())},b:function(){return u.mul(l.less(f).toFloat())}}}),"Maximum")}}),hR=P({maximumStrict_:function(r,n){var t=M(r,"a","maximumStrict"),e=M(n,"b","maximumStrict");return $t(t.shape,e.shape,"Error in maximumStrict: "),t.maximum(e)}}),j1=P({minimum_:function(r,n){var t,e=M(r,"a","minimum"),a=M(n,"b","minimum");return t=me(e,a),e=t[0],a=t[1],e.dtype==="bool"&&(e=e.toInt(),a=a.toInt()),Ht(e.shape,a.shape),W.runKernelFunc((function(u,s){var l=u.minimum(e,a);return s([e,a]),l}),{a:e,b:a},(function(u,s){var l=s[0],f=s[1];return{a:function(){return u.mul(l.lessEqual(f).toFloat())},b:function(){return u.mul(l.greater(f).toFloat())}}}),"Minimum")}}),dR=P({minimumStrict_:function(r,n){var t=M(r,"a","minimumStrict"),e=M(n,"b","minimumStrict");return $t(t.shape,e.shape,"Error in minimumStrict: "),t.minimum(e)}}),pR=P({mod_:function(r,n){var t,e=M(r,"a","mod"),a=M(n,"b","mod");t=me(e,a),e=t[0],a=t[1];var u=Ht(e.shape,a.shape);return W.runKernelFunc((function(s,l){var f=s.mod(e,a);return l([e,a]),f}),{$a:e,$b:a},(function(s,l){var f=l[0],h=l[1];return{$a:function(){var p=Ie(f.shape,u);return p.length>0?s.sum(p).reshape(f.shape):s},$b:function(){var p=s.mul(f.div(h).floor().neg()),v=Ie(h.shape,u);return v.length>0?p.sum(v).reshape(h.shape):p}}}))}}),vR=P({modStrict_:function(r,n){var t=M(r,"a","modStrict"),e=M(n,"b","modStrict");return $t(t.shape,e.shape,"Error in modStrict: "),t.mod(e)}}),rn=P({mul_:function(r,n){var t,e=M(r,"a","mul"),a=M(n,"b","mul");t=me(e,a),e=t[0],a=t[1];var u=Ht(e.shape,a.shape);return W.runKernelFunc((function(s,l){var f=s.multiply(e,a);return l([e,a]),f}),{a:e,b:a},(function(s,l){var f=l[0],h=l[1];return{a:function(){var p=s.mul(h.toFloat()),v=Ie(f.shape,u);return v.length>0?p.sum(v).reshape(f.shape):p},b:function(){var p=s.mul(f.toFloat()),v=Ie(h.shape,u);return v.length>0?p.sum(v).reshape(h.shape):p}}}),"Mul")}}),mR=P({mulStrict_:function(r,n){var t=M(r,"a","mul"),e=M(n,"b","mul");return $t(t.shape,e.shape,"Error in multiplyStrict: "),t.mul(e)}}),Gl=P({pow_:function(r,n){var t,e=M(r,"base","pow"),a=M(n,"exp","pow");t=me(e,a),e=t[0],a=t[1];var u=Ht(e.shape,a.shape),s=[e,a];return W.runKernelFunc((function(l,f){var h=l.pow(e,a);return f([e,a,h]),h}),{a:e,b:a},(function(l,f){var h=f[0],p=f[1],v=f[2];return{a:function(){var m=p.toFloat(),y=l.mul(m.mul(h.pow(m.sub(pt(1))))),x=Ie(h.shape,u);return x.length>0&&(y=y.sum(x)),y.reshape(h.shape)},b:function(){var m=h.greater(0),y=h.log().where(m,jt(h)),x=l.mul(v.mul(y)),w=Ie(p.shape,u);return w.length>0&&(x=x.sum(w)),x.reshape(p.shape)}}}),"Pow",{},s,[!0])}}),gR=P({powStrict_:function(r,n){return $t(r.shape,n.shape,"Error in powStrict: "),r.pow(n)}}),yR=P({squaredDifferenceStrict_:function(r,n){var t=M(r,"a","squaredDifferenceStrict"),e=M(n,"b","squaredDifferenceStrict");return $t(t.shape,e.shape,"Error in squaredDifferenceStrict: "),t.squaredDifference(e)}}),Be=P({sub_:function(r,n){var t,e=M(r,"a","sub"),a=M(n,"b","sub");t=me(e,a),e=t[0],a=t[1];var u=Ht(e.shape,a.shape);return W.runKernelFunc((function(s){return s.subtract(e,a)}),{a:e,b:a},(function(s){return{a:function(){var l=s,f=Ie(e.shape,u);return f.length>0&&(l=l.sum(f)),l.reshape(e.shape)},b:function(){var l=s,f=Ie(a.shape,u);return f.length>0&&(l=l.sum(f)),l.neg().reshape(a.shape)}}}),"Sub")}}),bR=P({subStrict_:function(r,n){var t=M(r,"a","subStrict"),e=M(n,"b","subStrict");return $t(t.shape,e.shape,"Error in subStrict: "),t.sub(e)}}),X1=P({equal_:function(r,n){var t,e=M(r,"a","equal"),a=M(n,"b","equal");return t=me(e,a),e=t[0],a=t[1],Ht(e.shape,a.shape),W.runKernelFunc((function(u){return u.equal(e,a)}),{$a:e,$b:a})}}),xR=P({equalStrict_:function(r,n){var t=M(r,"a","equalStrict"),e=M(n,"b","equalStrict");return $t(t.shape,e.shape,"Error in equalStrict: "),t.equal(e)}}),wR=P({greater_:function(r,n){var t,e=M(r,"a","greater"),a=M(n,"b","greater");return t=me(e,a),e=t[0],a=t[1],Ht(e.shape,a.shape),W.runKernelFunc((function(u){return u.greater(e,a)}),{a:e,b:a},null,"Greater")}}),K1=P({greaterEqual_:function(r,n){var t,e=M(r,"a","greaterEqual"),a=M(n,"b","greaterEqual");return t=me(e,a),e=t[0],a=t[1],Ht(e.shape,a.shape),W.runKernelFunc((function(u,s){var l=u.greaterEqual(e,a);return s([e,a]),l}),{a:e,b:a},(function(u,s){var l=s[0],f=s[1];return{a:function(){return jt(l)},b:function(){return jt(f)}}}),"GreaterEqual")}}),_R=P({greaterEqualStrict_:function(r,n){var t=M(r,"a","greaterEqualStrict"),e=M(n,"b","greaterEqualStrict");return $t(t.shape,e.shape,"Error in greaterEqualStrict: "),t.greaterEqual(e)}}),ER=P({greaterStrict_:function(r,n){var t=M(r,"a","greaterStrict"),e=M(n,"b","greaterStrict");return $t(t.shape,e.shape,"Error in greaterStrict: "),t.greater(e)}}),CR=P({less_:function(r,n){var t,e=M(r,"a","less"),a=M(n,"b","less");return t=me(e,a),e=t[0],a=t[1],Ht(e.shape,a.shape),W.runKernelFunc((function(u){return u.less(e,a)}),{a:e,b:a},null,"Less")}}),SR=P({lessEqual_:function(r,n){var t,e=M(r,"a","lessEqual"),a=M(n,"b","lessEqual");return t=me(e,a),e=t[0],a=t[1],Ht(e.shape,a.shape),W.runKernelFunc((function(u,s){var l=u.lessEqual(e,a);return s([e,a]),l}),{a:e,b:a},null,"LessEqual")}}),RR=P({lessEqualStrict_:function(r,n){var t=M(r,"a","lessEqualStrict"),e=M(n,"b","lessEqualStrict");return $t(t.shape,e.shape,"Error in lessEqualStrict: "),t.lessEqual(e)}}),AR=P({lessStrict_:function(r,n){var t=M(r,"a","lessStrict"),e=M(n,"b","lessStrict");return $t(t.shape,e.shape,"Error in lessStrict: "),t.less(e)}}),TR=P({notEqual_:function(r,n){var t,e=M(r,"a","notEqual"),a=M(n,"b","notEqual");return t=me(e,a),e=t[0],a=t[1],Ht(e.shape,a.shape),W.runKernelFunc((function(u){return u.notEqual(e,a)}),{a:e,b:a},null,"NotEqual")}}),DR=P({notEqualStrict_:function(r,n){var t=M(r,"a","notEqualStrict"),e=M(n,"b","notEqualStrict");return $t(t.shape,e.shape,"Error in notEqualStrict: "),t.notEqual(e)}});function by(r,n){for(var t=[],e=r;e<n;++e)t.push(e);return t}function xy(r){for(var n=[],t=0;t<r.length;++t)for(var e=0;e<r[t].length;++e)n.push(r[t][e]);return n}var jd=P({gather_:function(r,n,t){t===void 0&&(t=0);var e=M(r,"x","gather"),a=M(n,"indices","gather","int32");t=Fe(t,e.shape)[0];var u=(function(s,l,f){for(var h=s.shape[f],p=[],v=1,m=1,y=0;y<f;y++)p.push(s.shape[y]),v*=s.shape[y];for(y=0;y<l.rank;y++)p.push(l.shape[y]);for(y=f+1;y<s.rank;y++)p.push(s.shape[y]),m*=s.shape[y];return{batchSize:v,sliceSize:m,dimSize:h,outputShape:p}})(e,a,t);return W.runKernelFunc((function(s,l){var f=s.gather(e,a.flatten(),t);return l([a]),f}),{x:e,indices:a},(function(s,l){var f=l[0];return{x:function(){var h=e.shape,p=f.size,v=h.slice(0,t),m=v.length,y=h.slice(t,h.length).slice(1),x=y.length,w=by(0,m),_=by(m+1,m+1+x),E=xy([v,[p],y]),R=s.reshape(E),A=f.reshape([p]),S=xy([[m],w,_]),T=R.transpose(S),N=Y1(T,A,e.shape[t]),O=Od(S);return N=N.transpose(O)},indices:function(){return f}}}),"Gather",{axis:t}).reshape(u.outputShape)}}),Y1=P({unsortedSegmentSum_:function(r,n,t){var e=M(r,"x","unsortedSegmentSum"),a=M(n,"segmentIds","unsortedSegmentSum","int32");return k(_e(t),(function(){return"numSegments must be of dtype int"})),W.runKernelFunc((function(u,s){var l=u.unsortedSegmentSum(e,a,t);return s([a]),l}),{$x:e},(function(u,s){var l=s[0];return{$x:function(){return(function(f,h){for(var p=qd(h,jt(h)),v=jd(f,p),m=K1(h,pt(0,"int32")),y=v.rank-m.rank,x=0;x<y;++x)m=Qn(m,x+1);m=$l(m,Ao(v.shape,"bool"));var w=jt(v);return vi(m,v,w)})(u,l)}}}))}}),NR=function(r,n,t){return bt(this,void 0,void 0,(function(){var e,a,u,s,l,f,h,p,v,m,y,x,w;return xt(this,(function(_){switch(_.label){case 0:for(e=M(r,"tensor","boolMask"),a=M(n,"mask","boolMask","bool"),u=t??0,s=a.rank,l=e.shape,k(s>0,(function(){return"mask cannot be scalar"})),$t(l.slice(u,u+s),a.shape,"mask's shape must match the first K dimensions of tensor's shape,"),f=1,h=u;h<u+s;h++)f*=l[h];return p=l.slice(0,u).concat([f],l.slice(u+s)),v=e.reshape(p),m=a.reshape([-1]),[4,W1(m)];case 1:return y=_.sent(),x=y.squeeze([1]),w=jd(v,x,u),r!==e&&e.dispose(),n!==a&&a.dispose(),x.dispose(),v.dispose(),m.dispose(),y.dispose(),[2,w]}}))}))};function Q1(r,n,t,e,a,u,s){u===void 0&&(u="NHWC"),k(r.length===n.rank,(function(){return"Length of inShape ("+r.length+") and rank of dy ("+n.rank+") must match"}));var l=r,f=n,h=!1;n.rank===3&&(h=!0,f=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]),l=[1,r[0],r[1],r[2]]),k(l.length===4,(function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+l.length+"."})),k(f.rank===4,(function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+f.rank})),k(t.rank===4,(function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+t.rank}));var p=u==="NHWC"?l[3]:l[1],v=u==="NHWC"?f.shape[3]:f.shape[1];k(p===t.shape[2],(function(){return"Error in conv2dDerInput: depth of input ("+p+") must match input depth for filter "+t.shape[2]+"."})),k(v===t.shape[3],(function(){return"Error in conv2dDerInput: depth of output ("+v+") must match output depth for filter "+t.shape[3]+"."})),s!=null&&k(_e(a),(function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+a+"."}));var m=zd(u),y=yi(l,t.shape,e,1,a,s,!1,m),x=W.runKernelFunc((function(w,_){var E=w.conv2dDerInput(f,t,y);return _([t,f]),E}),{dy4D:f,filter:t},(function(w,_){var E=_[0],R=_[1];return{dy4D:function(){return $n(w,E,e,a,u,1,s)},filter:function(){return Xd(w,R,E.shape,e,a,u,s)}}}));return h?x.as3D(x.shape[1],x.shape[2],x.shape[3]):x}function Yh(r){var n=(function(u){return typeof u=="number"?[u,u,u]:u.length===2?[u[0],u[1],1]:u})(r),t=n[0],e=n[1],a=n[2];return t===1&&e===1&&a===1}function Z1(r,n,t,e,a){k(r.length===n.rank,(function(){return"Length of inShape ("+r.length+") and rank of dy ("+n.rank+") must match"}));var u=r,s=n,l=!1;n.rank===4&&(l=!0,s=n.as5D(1,n.shape[0],n.shape[1],n.shape[2],n.shape[3]),u=[1,r[0],r[1],r[2],r[3]]);var f=u[4],h=s.shape[4];k(u.length===5,(function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+u.length+"."})),k(s.rank===5,(function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+s.rank})),k(t.rank===5,(function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+t.rank})),k(f===t.shape[3],(function(){return"Error in conv3dDerInput: depth of input ("+f+") must match input depth for filter "+t.shape[3]+"."})),k(h===t.shape[4],(function(){return"Error in conv3dDerInput: depth of output ("+h+") must match output depth for filter "+t.shape[4]+"."}));var p=Pl(u,t.shape,e,1,a),v=W.runKernelFunc((function(m){return m.conv3dDerInput(s,t,p)}),{dy5D:s});return l?v.as4D(v.shape[1],v.shape[2],v.shape[3],v.shape[4]):v}var MR=P({conv1d_:function(r,n,t,e,a,u,s){a===void 0&&(a="NWC"),u===void 0&&(u=1);var l=M(r,"x","conv1d"),f=M(n,"filter","conv1d"),h=l,p=!1;l.rank===2&&(p=!0,h=l.as3D(1,l.shape[0],l.shape[1])),k(h.rank===3,(function(){return"Error in conv1d: input must be rank 3, but got rank "+h.rank+"."})),k(f.rank===3,(function(){return"Error in conv1d: filter must be rank 3, but got rank "+f.rank+"."})),s!=null&&k(_e(e),(function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+e+"."})),k(h.shape[2]===f.shape[1],(function(){return"Error in conv1d: depth of input ("+h.shape[2]+") must match input depth for filter "+f.shape[1]+"."})),k(xn(t,u),(function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+t+" and dilation '"+u+"'"})),k(a==="NWC",(function(){return"Error in conv1d: got dataFormat of "+a+" but only NWC is currently supported."}));var v=f.as4D(1,f.shape[0],f.shape[1],f.shape[2]),m=h.as4D(h.shape[0],1,h.shape[1],h.shape[2]),y=$n(m,v,[1,t],e,"NHWC",[1,u],s);return p?y.as2D(y.shape[2],y.shape[3]):y.as3D(y.shape[0],y.shape[2],y.shape[3])}}),$n=P({conv2d_:function(r,n,t,e,a,u,s){a===void 0&&(a="NHWC"),u===void 0&&(u=[1,1]);var l=M(r,"x","conv2d"),f=M(n,"filter","conv2d"),h=l,p=!1;l.rank===3&&(p=!0,h=l.as4D(1,l.shape[0],l.shape[1],l.shape[2])),k(h.rank===4,(function(){return"Error in conv2d: input must be rank 4, but got rank "+h.rank+"."})),k(f.rank===4,(function(){return"Error in conv2d: filter must be rank 4, but got rank "+f.rank+"."})),s!=null&&k(_e(e),(function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+e+"."}));var v=a==="NHWC"?h.shape[3]:h.shape[1];k(v===f.shape[2],(function(){return"Error in conv2d: depth of input ("+v+") must match input depth for filter "+f.shape[2]+"."})),k(xn(t,u),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+u+"'"}));var m=zd(a),y=yi(h.shape,f.shape,t,u,e,s,!1,m),x=[f,h],w=W.runKernelFunc((function(_,E){var R=_.conv2d(h,f,y);return E([f,h]),R}),{x:h,filter:f},(function(_,E){var R=E,A=R[0],S=R[1];return k(So(u),(function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+u+"'"})),{x:function(){return J1(S.shape,_,A,t,e,a)},filter:function(){return Xd(S,_,A.shape,t,e,a)}}}),"Conv2D",y,x);return p?w.as3D(w.shape[1],w.shape[2],w.shape[3]):w}}),OR=P({conv3d_:function(r,n,t,e,a,u){a===void 0&&(a="NDHWC"),u===void 0&&(u=[1,1,1]);var s=M(r,"x","conv3d"),l=M(n,"filter","conv3d"),f=s,h=!1;s.rank===4&&(h=!0,f=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),k(f.rank===5,(function(){return"Error in conv3d: input must be rank 5, but got rank "+f.rank+"."})),k(l.rank===5,(function(){return"Error in conv3d: filter must be rank 5, but got rank "+l.rank+"."})),k(f.shape[4]===l.shape[3],(function(){return"Error in conv3d: depth of input ("+f.shape[4]+") must match input depth for filter "+l.shape[3]+"."})),k((function(m,y){return Yh(m)||Yh(y)})(t,u),(function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+u+"'"})),k(a==="NDHWC",(function(){return"Error in conv3d: got dataFormat of "+a+" but only NDHWC is currently supported."}));var p=Pl(f.shape,l.shape,t,u,e),v=W.runKernelFunc((function(m,y){var x=m.conv3d(f,l,p);return y([f,l]),x}),{x:f,$filter:l},(function(m,y){k(Yh(u),(function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+u+"'"}));var x=y[0],w=y[1];return{x:function(){return Z1(x.shape,m,w,t,e)},$filter:function(){return(function(_,E,R,A,S){var T=_;_.rank===4&&(T=_.as5D(1,_.shape[0],_.shape[1],_.shape[2],_.shape[3]));var N=E;N.rank===4&&(N=E.as5D(1,E.shape[0],E.shape[1],E.shape[2],E.shape[3])),k(T.rank===5,(function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+T.shape+"."})),k(N.rank===5,(function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+N.shape+"."})),k(R.length===5,(function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+R+"."})),k(T.shape[4]===R[3],(function(){return"Error in conv3dDerFilter: depth of input "+T.shape[4]+") must match input depth in filter ("+R[3]+"."})),k(N.shape[4]===R[4],(function(){return"Error in conv3dDerFilter: depth of dy ("+N.shape[4]+") must match output depth for filter ("+R[4]+")."}));var O=Pl(T.shape,R,A,1,S);return W.runKernelFunc((function(B){return B.conv3dDerFilter(T,N,O)}),{x5D:T,dy5D:N})})(x,m,w.shape,t,e)}}}));return h?v.as4D(v.shape[1],v.shape[2],v.shape[3],v.shape[4]):v}}),Xd=P({conv2dDerFilter_:function(r,n,t,e,a,u,s){u===void 0&&(u="NHWC");var l=r;r.rank===3&&(l=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var f=n;f.rank===3&&(f=n.as4D(1,n.shape[0],n.shape[1],n.shape[2])),k(l.rank===4,(function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+l.shape+"."})),k(f.rank===4,(function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+f.shape+"."})),k(t.length===4,(function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+t+"."}));var h=u==="NHWC"?l.shape[3]:l.shape[1],p=u==="NHWC"?f.shape[3]:f.shape[1];k(h===t[2],(function(){return"Error in conv2dDerFilter: depth of input "+h+") must match input depth in filter ("+t[2]+"."})),k(p===t[3],(function(){return"Error in conv2dDerFilter: depth of dy ("+p+") must match output depth for filter ("+t[3]+")."})),s!=null&&k(_e(a),(function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+a+"."}));var v=zd(u),m=yi(l.shape,t,e,1,a,s,!1,v);return W.runKernelFunc((function(y){return y.conv2dDerFilter(l,f,m)}),{x4D:l,dy4D:f})}}),J1=P({conv2dDerInput_:Q1}),tc=P({depthwiseConv2d_:function(r,n,t,e,a,u,s){u===void 0&&(u=[1,1]);var l=M(r,"x","depthwiseConv2d"),f=M(n,"filter","depthwiseConv2d"),h=l,p=!1;l.rank===3&&(p=!0,h=l.as4D(1,l.shape[0],l.shape[1],l.shape[2])),k(h.rank===4,(function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+h.rank+"."})),k(f.rank===4,(function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+f.rank+"."})),k(h.shape[3]===f.shape[2],(function(){return"Error in depthwiseConv2d: number of input channels ("+h.shape[3]+") must match the inChannels dimension in filter "+f.shape[2]+"."})),u==null&&(u=[1,1]),k(xn(t,u),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+u+"'"})),s!=null&&k(_e(e),(function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+e+"."}));var v=yi(h.shape,f.shape,t,u,e,s,!0),m=[h,f],y=W.runKernelFunc((function(x,w){var _=x.depthwiseConv2D(h,f,v);return w([h,f]),_}),{x:h,filter:f},(function(x,w){k(So(u),(function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+u+"'"}));var _=w[0],E=w[1];return{x:function(){return $1(_.shape,x,E,v)},filter:function(){return tb(_,x,E.shape,v)}}}),"DepthwiseConv2dNative",v,m);return p?y.as3D(y.shape[1],y.shape[2],y.shape[3]):y}}),$1=P({depthwiseConv2dDerInput_:function(r,n,t,e){var a=n,u=!1;n.rank===3&&(u=!0,a=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var s=W.runKernelFunc((function(l){return l.depthwiseConv2DDerInput(a,t,e)}),{dy4D:a});return u?s.as3D(s.shape[1],s.shape[2],s.shape[3]):s}}),tb=P({depthwiseConv2dDerFilter_:function(r,n,t,e){var a=r;r.rank===3&&(a=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var u=n;return u.rank===3&&(u=n.as4D(1,n.shape[0],n.shape[1],n.shape[2])),W.runKernelFunc((function(s){return s.depthwiseConv2DDerFilter(a,u,e)}),{x4D:a,dy4D:u})}}),Kd=P({separableConv2d_:function(r,n,t,e,a,u,s){u===void 0&&(u=[1,1]),s===void 0&&(s="NHWC");var l=M(r,"x","separableConv2d"),f=M(n,"depthwiseFilter","separableConv2d"),h=M(t,"pointwiseFilter","separableConv2d"),p=l,v=!1;if(l.rank===3&&(v=!0,p=l.as4D(1,l.shape[0],l.shape[1],l.shape[2])),s==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");k(p.rank===4,(function(){return"Error in separableConv2d: input must be rank 4, but got rank "+p.rank+"."})),k(f.rank===4,(function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+f.rank+"."})),k(h.rank===4,(function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+f.rank+"."})),k(h.shape[0]===1,(function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+h.shape[0]+"."})),k(h.shape[1]===1,(function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+h.shape[1]+"."}));var m=f.shape[2],y=f.shape[3];k(h.shape[2]===m*y,(function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+m*y+", but got "+h.shape[2]+"."}));var x=tc(p,f,e,a,s,u),w=$n(x,h,1,"valid",s);return v?w.as3D(w.shape[1],w.shape[2],w.shape[3]):w}}),kR=P({conv2dTranspose_:function(r,n,t,e,a,u){return Q1(t,M(r,"x","conv2dTranspose"),M(n,"filter","conv2dTranspose"),e,a,"NHWC",u)}}),IR=P({conv3dTranspose_:function(r,n,t,e,a){return Z1(t,M(r,"x","conv3dTranspose"),M(n,"filter","conv3dTranspose"),e,a)}}),ec=P({matMul_:function(r,n,t,e){var a;t===void 0&&(t=!1),e===void 0&&(e=!1);var u=M(r,"a","matMul"),s=M(n,"b","matMul");a=me(u,s),u=a[0],s=a[1];var l=t?u.shape[u.rank-2]:u.shape[u.rank-1],f=e?s.shape[s.rank-1]:s.shape[s.rank-2],h=t?u.shape[u.rank-1]:u.shape[u.rank-2],p=e?s.shape[s.rank-2]:s.shape[s.rank-1],v=u.shape.slice(0,-2),m=s.shape.slice(0,-2),y=_t(v),x=_t(m);k(u.rank>=2&&s.rank>=2&&u.rank===s.rank,(function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+u.rank+" and "+s.rank+"."})),k(Pe(v,m),(function(){return"Error in matMul: outer dimensions ("+v+") and ("+m+") of Tensors with shapes "+u.shape+" and "+s.shape+" must match."})),k(l===f,(function(){return"Error in matMul: inner shapes ("+l+") and ("+f+") of Tensors with shapes "+u.shape+" and "+s.shape+" and transposeA="+t+" and transposeB="+e+" must match."}));var w=u.shape.slice(0,-2).concat([h,p]),_=t?u.as3D(y,l,h):u.as3D(y,h,l),E=e?s.as3D(x,p,f):s.as3D(x,f,p),R={transposeA:t,transposeB:e};return W.runKernelFunc((function(A,S){var T=A.batchMatMul(_,E,t,e);return S([_,E]),T}),{a:_,b:E},(function(A,S){var T=S,N=T[0],O=T[1];return t||e?!t&&e?{a:function(){return A.matMul(O,!1,!1)},b:function(){return A.matMul(N,!0,!1)}}:t&&!e?{a:function(){return O.matMul(A,!1,!0)},b:function(){return N.matMul(A,!1,!1)}}:{a:function(){return O.matMul(A,!0,!0)},b:function(){return A.matMul(N,!0,!0)}}:{a:function(){return A.matMul(O,!1,!0)},b:function(){return N.matMul(A,!0,!1)}}}),"BatchMatMul",R).reshape(w)}}),BR=P({dot_:function(r,n){var t=M(r,"t1","dot"),e=M(n,"t2","dot");k(!(t.rank!==1&&t.rank!==2||e.rank!==1&&e.rank!==2),(function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+t.rank+" and "+e.rank+"."}));var a=t.rank===1?t.size:t.shape[1],u=e.rank===1?e.size:e.shape[0];return k(a===u,(function(){return"Error in dot: inner dimensions of inputs must match, but got "+a+" and "+u+"."})),t.rank===1&&e.rank===1?t.as2D(1,-1).matMul(e.as2D(-1,1)).asScalar():t.rank===1&&e.rank===2?t.as2D(1,-1).matMul(e.as2D(e.shape[0],e.shape[1])).as1D():t.rank===2&&e.rank===1?t.matMul(e.as2D(-1,1)).as1D():t.matMul(e.as2D(e.shape[0],e.shape[1]))}}),FR=P({outerProduct_:function(r,n){var t=M(r,"v1","outerProduct"),e=M(n,"v2","outerProduct");return k(t.rank===1&&e.rank===1,(function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+t.rank+" and "+e.rank+"."})),t.as2D(-1,1).matMul(e.as2D(1,-1))}}),Wu=P({reverse_:function(r,n){var t=M(r,"x","reverse");if(t.rank===0)return t.clone();var e=Fe(n,t.shape);return W.runKernelFunc((function(a){return a.reverse(t,e)}),{$x:t},(function(a){return{$x:function(){return a.reverse(e)}}})).reshapeAs(t)}}),zR=P({reverse1d_:function(r){var n=M(r,"x","reverse");return k(n.rank===1,(function(){return"Error in reverse1D: x must be rank 1 but got rank "+n.rank+"."})),Wu(n,0)}}),LR=P({reverse2d_:function(r,n){var t=M(r,"x","reverse");return k(t.rank===2,(function(){return"Error in reverse2D: x must be rank 2 but got rank "+t.rank+"."})),Wu(t,n)}}),UR=P({reverse3d_:function(r,n){var t=M(r,"x","reverse");return k(t.rank===3,(function(){return"Error in reverse3D: x must be rank 3 but got rank "+t.rank+"."})),Wu(t,n)}}),PR=P({reverse4d_:function(r,n){var t=M(r,"x","reverse");return k(t.rank===4,(function(){return"Error in reverse4D: x must be rank 4 but got rank "+t.rank+"."})),Wu(t,n)}});function eb(r,n,t,e,a,u){var s=M(r,"x","maxPool"),l=s,f=!1;s.rank===3&&(f=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),k(l.rank===4,(function(){return"Error in maxPool: input must be rank 4 but got rank "+l.rank+"."})),k(xn(t,e),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+e+"'"})),u!=null&&k(_e(a),(function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+u+" but got pad "+a+"."}));var h=Ou(l.shape,n,t,e,a,u);if(h.filterWidth===1&&h.filterHeight===1&&Pe(h.inShape,h.outShape))return s.clone();var p=[l],v=W.runKernelFunc((function(m,y){var x=m.maxPool(l,h);return y([l,x]),x}),{x:l},(function(m,y){var x=y[0],w=y[1];return{x:function(){return(function(_,E,R,A,S,T,N,O){var B=M(_,"dy","maxPoolBackprop"),I=M(E,"input","maxPoolBackprop"),F=M(R,"output","maxPoolBackprop");k(I.rank===B.rank,(function(){return"Rank of input ("+I.rank+") does not match rank of dy ("+B.rank+")"})),k(xn(S,T),(function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+S+" and dilations '"+T+"'"})),k(B.rank===4,(function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+B.rank+"."})),k(I.rank===4,(function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+I.rank+"."}));var G=Ou(I.shape,A,S,T,N,O);return W.runKernelFunc((function(H){return H.maxPoolBackprop(B,I,F,G)}),{$dy:B,$input:I})})(m,x,w,n,t,e,a)}}}),"MaxPool",h,p);return f?v.as3D(v.shape[1],v.shape[2],v.shape[3]):v}function nb(r,n,t,e,a,u){var s=M(r,"x","avgPool","float32");k(xn(t,e),(function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+e+"'"}));var l=s,f=!1;s.rank===3&&(f=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),k(l.rank===4,(function(){return"Error in avgPool: x must be rank 4 but got rank "+l.rank+"."})),u!=null&&k(_e(a),(function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+u+" but got pad "+a+"."}));var h=Ou(l.shape,n,t,e,a,u);if(h.filterWidth===1&&h.filterHeight===1&&Pe(h.inShape,h.outShape))return s.clone();var p=W.runKernelFunc((function(v){return v.avgPool(l,h)}),{x:l},(function(v){return{x:function(){return(function(m,y,x,w,_,E){var R=M(m,"dy","avgPoolBackprop"),A=M(y,"input","avgPoolBackprop");k(A.rank===R.rank,(function(){return"Rank of input ("+A.rank+") does not match rank of dy ("+R.rank+")"})),k(xn(w,_),(function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+w+" and dilations '"+_+"'"}));var S=A,T=R,N=!1;A.rank===3&&(N=!0,S=A.as4D(1,A.shape[0],A.shape[1],A.shape[2]),T=R.as4D(1,R.shape[0],R.shape[1],R.shape[2])),k(T.rank===4,(function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+T.rank+"."})),k(S.rank===4,(function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+S.rank+"."}));var O=Ou(S.shape,x,w,_,E),B=W.runKernelFunc((function(I){return I.avgPoolBackprop(T,S,O)}),{dy4D:T,input4D:S});return N?B.as3D(B.shape[1],B.shape[2],B.shape[3]):B})(v,l,n,t,e,a)}}}),"AvgPool",h);return p=p.cast(s.dtype),f?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}var Ue=P({maxPool_:function(r,n,t,e,a){return eb(r,n,t,1,e,a)}}),qu=P({avgPool_:function(r,n,t,e,a){return nb(r,n,t,1,e,a)}}),HR=P({pool_:function(r,n,t,e,a,u){a==null&&(a=[1,1]),u==null&&(u=1),e===0&&(e="valid");var s=M(r,"x","maxPool"),l=s,f=!1;s.rank===3&&(f=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),k(xn(u,a),(function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+u+" and dilations '"+a+"'"}));var h,p=Ou(l.shape,n,u,a,e),v=[p.dilationHeight,p.dilationWidth];h=e==="same"?(function(S,T){var N=S.map((function(I,F){return I+(I-1)*(T[F]-1)})).map((function(I){return I-1})),O=N.map((function(I){return Math.floor(I/2)})),B=N.map((function(I,F){return I-O[F]}));return N.map((function(I,F){return[O[F],B[F]]}))})([p.filterHeight,p.filterWidth],v):[[0,0],[0,0]];var m=v[0]===1&&v[1]===1,y=(function(S,T,N){var O=N.map((function(et){return et[0]})),B=N.map((function(et){return et[1]})),I=S.concat(O,B),F=T.map((function(et,nt){return(et-I[nt]%et)%et})),G=B.map((function(et,nt){return et+F[nt]})),H=T.map((function(et,nt){return[O[nt],G[nt]]})),at=T.map((function(et,nt){return[0,F[nt]]}));return[H,at]})([p.inHeight,p.inWidth],v,h),x=y[0],w=y[1],_=m?e:"valid",E=m?l:s1(l,v,x),R=(t==="avg"?function(){return nb(E,n,u,1,_)}:function(){return eb(E,n,u,1,_)})(),A=m?R:i1(R,v,w);return f?A.as3D(A.shape[1],A.shape[2],A.shape[3]):A}}),VR=P({maxPool3d_:function(r,n,t,e,a,u,s){u===void 0&&(u="NDHWC");var l=M(r,"x","maxPool3d"),f=l,h=!1;l.rank===4&&(h=!0,f=l.as5D(1,l.shape[0],l.shape[1],l.shape[2],l.shape[3])),s==null&&(s=[1,1,1]),k(f.rank===5,(function(){return"Error in maxPool3d: x must be rank 5 but got rank "+f.rank+"."})),k(u==="NDHWC",(function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+u})),k(xn(t,s),(function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+s+"'"})),a!=null&&k(_e(e),(function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+e+"."}));var p=Ul(f.shape,n,t,s,e,a,u),v=W.runKernelFunc((function(m,y){var x=m.maxPool3d(f,p);return y([f,x]),x}),{x:f},(function(m,y){var x=y[0],w=y[1];return{x:function(){return(function(_,E,R,A,S,T,N,O){var B=M(_,"dy","maxPool3dBackprop"),I=M(E,"input","maxPool3dBackprop"),F=M(R,"output","maxPool3dBackprop"),G=B,H=I,at=F,et=!1;I.rank===4&&(et=!0,G=B.as5D(1,B.shape[0],B.shape[1],B.shape[2],B.shape[3]),H=I.as5D(1,I.shape[0],I.shape[1],I.shape[2],I.shape[3]),at=F.as5D(1,F.shape[0],F.shape[1],F.shape[2],F.shape[3])),k(G.rank===5,(function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+G.rank+"."})),k(H.rank===5,(function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+H.rank+"."})),k(at.rank===5,(function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+at.rank+"."})),T==null&&(T=[1,1,1]),k(xn(S,T),(function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+S+" and dilations '"+T+"'"})),O!=null&&k(_e(N),(function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+O+" but got pad "+N+"."}));var nt=Ul(H.shape,A,S,T,N,O),L=W.runKernelFunc((function(q){return q.maxPool3dBackprop(G,H,at,nt)}),{dy5D:G,input5D:H});return et?L.as4D(L.shape[1],L.shape[2],L.shape[3],L.shape[4]):L})(m,x,w,n,t,s,e,a)}}}));return h?v.as4D(v.shape[1],v.shape[2],v.shape[3],v.shape[4]):v}}),GR=P({avgPool3d_:function(r,n,t,e,a,u,s){u===void 0&&(u="NDHWC");var l=M(r,"x","avgPool3d","float32"),f=l,h=!1;l.rank===4&&(h=!0,f=l.as5D(1,l.shape[0],l.shape[1],l.shape[2],l.shape[3])),s==null&&(s=[1,1,1]),k(f.rank===5,(function(){return"Error in avgPool3d: x must be rank 5 but got rank "+f.rank+"."})),k(u==="NDHWC",(function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+u})),k(xn(t,s),(function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+s+"'"})),a!=null&&k(_e(e),(function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+e+"."}));var p=Ul(f.shape,n,t,s,e,a,u),v=W.runKernelFunc((function(m){return m.avgPool3d(f,p)}),{x:f},(function(m){return{x:function(){return(function(y,x,w,_,E,R,A){var S=M(y,"dy","avgPool3dBackprop"),T=M(x,"input","avgPool3dBackprop"),N=S,O=T,B=!1;T.rank===4&&(B=!0,N=S.as5D(1,S.shape[0],S.shape[1],S.shape[2],S.shape[3]),O=T.as5D(1,T.shape[0],T.shape[1],T.shape[2],T.shape[3])),k(N.rank===5,(function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+N.rank+"."})),k(O.rank===5,(function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+O.rank+"."})),E==null&&(E=[1,1,1]),k(xn(_,E),(function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+_+" and dilations '"+E+"'"})),A!=null&&k(_e(R),(function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+A+" but got pad "+R+"."}));var I=Ul(O.shape,w,_,E,R,A),F=W.runKernelFunc((function(G){return G.avgPool3dBackprop(N,O,I)}),{dy5D:N,input5D:O});return B?F.as4D(F.shape[1],F.shape[2],F.shape[3],F.shape[4]):F})(m,f,n,t,s,e,a)}}}));return v=v.cast(f.dtype),h?v.as4D(v.shape[1],v.shape[2],v.shape[3],v.shape[4]):v}}),Sr=P({slice_:function(r,n,t){var e,a,u=M(r,"x","slice");if(u.rank===0)throw new Error("Slicing scalar is not possible");(e=typeof n=="number"?[n].concat(new Array(u.rank-1).fill(0)):n.length<u.rank?n.concat(new Array(u.rank-n.length).fill(0)):n.slice()).forEach((function(f){k(f!==-1,(function(){return"slice() does not support negative begin indexing."}))})),a=(a=t==null?new Array(u.rank).fill(-1):typeof t=="number"?[t].concat(new Array(u.rank-1).fill(-1)):t.length<u.rank?t.concat(new Array(u.rank-t.length).fill(-1)):t).map((function(f,h){return f>=0?f:(k(f===-1,(function(){return"Negative size values should be exactly -1 but got "+f+" for the slice() size at index "+h+"."})),u.shape[h]-e[h])})),gE(u,e,a);var s=u.shape,l={begin:e,size:a};return W.runKernelFunc((function(f){return f.slice(u,e,a)}),{x:u},(function(f){for(var h=[],p=0;p<f.rank;p++)h.push([e[p],s[p]-e[p]-a[p]]);return{x:function(){return f.pad(h)}}}),"Slice",l)}}),WR=P({slice1d_:function(r,n,t){var e=M(r,"x","slice1d");return k(e.rank===1,(function(){return"slice1d expects a rank-1 tensor, but got a rank-"+e.rank+" tensor"})),Sr(e,[n],[t])}}),qR=P({slice2d_:function(r,n,t){var e=M(r,"x","slice2d");return k(e.rank===2,(function(){return"slice2d expects a rank-2 tensor, but got a rank-"+e.rank+" tensor"})),Sr(e,n,t)}}),rb=P({slice3d_:function(r,n,t){var e=M(r,"x","slice3d");return k(e.rank===3,(function(){return"slice3d expects a rank-3 tensor, but got a rank-"+e.rank+" tensor"})),Sr(e,n,t)}}),jR=P({slice4d_:function(r,n,t){var e=M(r,"x","slice4d");return k(e.rank===4,(function(){return"slice4d expects a rank-4 tensor, but got a rank-"+e.rank+" tensor"})),Sr(e,n,t)}});function ab(r,n,t,e,a){return n.rank<t.rank&&(n=n.reshape(bn(n.shape,e))),r.rank<t.rank&&(r=r.reshape(bn(r.shape,e))),{x:function(){var u=r.mul(t.equal(n).cast(r.dtype));return a==null?u:u.transpose(a)}}}var XR=P({all_:function(r,n,t){n===void 0&&(n=null),t===void 0&&(t=!1);var e=M(r,"x","all","bool"),a=Fe(n,e.shape),u=a,s=Tr(u,e.rank);s!=null&&(e=e.transpose(s),u=Dr(u.length,e.rank));var l=W.runKernelFunc((function(h){return h.all(e,u)}),{$x:e});if(t){var f=bn(l.shape,a);return l.reshape(f)}return l}}),KR=P({any_:function(r,n,t){n===void 0&&(n=null),t===void 0&&(t=!1);var e=M(r,"x","any","bool"),a=Fe(n,e.shape),u=a,s=Tr(u,e.rank);s!=null&&(e=e.transpose(s),u=Dr(u.length,e.rank));var l=W.runKernelFunc((function(h){return h.any(e,u)}),{$x:e});if(t){var f=bn(l.shape,a);return l.reshape(f)}return l}}),YR=P({argMax_:function(r,n){n===void 0&&(n=0);var t=M(r,"x","argMax");n==null&&(n=0);var e=Fe(n,t.shape),a=Tr(e,t.rank);a!=null&&(t=t.transpose(a),e=Dr(e.length,t.rank));var u={axis:e[0]},s=[t];return W.runKernelFunc((function(l,f){var h=l.argMax(t,e[0]);return f([t]),h}),{x:t},(function(l,f){var h=f[0];return{x:function(){return jt(h)}}}),"ArgMax",u,s)}}),QR=P({argMin_:function(r,n){n===void 0&&(n=0);var t=M(r,"x","argMin");n==null&&(n=0);var e=Fe(n,t.shape),a=Tr(e,t.rank);return a!=null&&(t=t.transpose(a),e=Dr(e.length,t.rank)),W.runKernelFunc((function(u,s){var l=u.argMin(t,e[0]);return s([t]),l}),{$x:t},(function(u,s){var l=s[0];return{$x:function(){return jt(l)}}}))}}),ZR=P({logSumExp_:function(r,n,t){n===void 0&&(n=null),t===void 0&&(t=!1);var e=M(r,"x","logSumExp"),a=Fe(n,e.shape),u=e.max(a,!0),s=e.sub(u).exp().sum(a).log(),l=u.reshape(s.shape).add(s);if(t){var f=bn(l.shape,a);return l.reshape(f)}return l}}),nc=P({max_:function(r,n,t){n===void 0&&(n=null),t===void 0&&(t=!1);var e=M(r,"x","max"),a=e,u=Fe(n,e.shape),s=u,l=Tr(s,e.rank);l!=null&&(e=e.transpose(l),s=Dr(s.length,e.rank));var f=[e],h=W.runKernelFunc((function(v,m){var y=v.max(e,s);return m([a,y]),y}),{x:e},(function(v,m){return ab(v,m[1],m[0],u,l)}),"Max",{axes:s},f,[!0]);if(t){var p=bn(h.shape,u);h=h.reshape(p)}return h}}),JR=P({mean_:function(r,n,t){n===void 0&&(n=null),t===void 0&&(t=!1);var e=M(r,"x","mean"),a=Fe(n,e.shape),u=_t($e(e.shape,a)[1]);return Zl((function(s){var l=pt(u);return{value:(l.dtype===s.dtype?s:s.cast(l.dtype)).div(l).sum(n,t),gradFunc:function(f){var h=s.shape.slice();return a.forEach((function(p){h[p]=1})),f.reshape(h).mul(Ao(s.shape,"float32")).div(u)}}}))(e)}}),$R=P({min_:function(r,n,t){n===void 0&&(n=null),t===void 0&&(t=!1);var e=M(r,"x","min"),a=e,u=Fe(n,e.shape),s=u,l=Tr(s,e.rank);l!=null&&(e=e.transpose(l),s=Dr(s.length,e.rank));var f=[e],h=W.runKernelFunc((function(v,m){var y=v.min(e,s);return m([a,y]),y}),{x:e},(function(v,m){return ab(v,m[1],m[0],u,l)}),"Min",{axes:s},f,[!0]);if(t){var p=bn(h.shape,u);h=h.reshape(p)}return h}}),tA=P({moments_:function(r,n,t){n===void 0&&(n=null),t===void 0&&(t=!1);var e=Fe(n,(r=M(r,"x","moments")).shape),a=r.mean(e,t),u=a.shape;t||(u=bn(a.shape,e));var s=r.toFloat().sub(a.reshape(u)).square();return{mean:a,variance:s.mean(e,t)}}}),ib=P({sum_:function(r,n,t){n===void 0&&(n=null),t===void 0&&(t=!1);var e=M(r,"x","sum");e.dtype==="bool"&&(e=e.toInt());var a=Fe(n,e.shape);return Zl((function(u){var s=Tr(a,u.rank),l=a,f=u;s!=null&&(f=u.transpose(s),l=Dr(l.length,u.rank));var h=function(y){var x=u.shape.slice();return a.forEach((function(w){x[w]=1})),y.reshape(x).mul(Ao(u.shape,"float32"))},p={axes:l},v=W.runKernelFunc((function(y){return y.sum(f,l)}),{x:f},(function(y){return{x:function(){return h(y)}}}),"Sum",p);if(t){var m=bn(v.shape,a);v=v.reshape(m)}return{value:v,gradFunc:h}}))(e)}}),eA=P({prod_:function(r,n,t){n===void 0&&(n=null),t===void 0&&(t=!1);var e=M(r,"x","prod");e.dtype==="bool"&&(e=e.toInt());var a=Fe(n,e.shape),u=Tr(a,e.rank),s=a,l=e;u!=null&&(l=e.transpose(u),s=Dr(s.length,e.rank));var f=W.runKernelFunc((function(p){return p.prod(l,s)}),{permutedX:l});if(t){var h=bn(f.shape,a);f=f.reshape(h)}return f}}),ob=P({elu_:function(r){var n=M(r,"x","elu");return W.runKernelFunc((function(t,e){var a=t.elu(n);return e([a]),a}),{$x:n},(function(t,e){var a=e[0];return{$x:function(){return W.runKernelFunc((function(u){return u.eluDer(t,a)}),{dy:t,y:a})}}}))}}),nA=P({leakyRelu_:function(r,n){n===void 0&&(n=.2);var t=M(r,"x","leakyRelu");return qd(pt(n).mul(t),t)}}),ub=P({prelu_:function(r,n){var t=M(r,"x","prelu"),e=M(n,"alpha","prelu");return W.runKernelFunc((function(a,u){var s=a.prelu(t,e);return u([t,e]),s}),{x:t,alpha:e},(function(a,u){var s=u[0],l=u[1],f=s.greater(0);return{x:function(){return vi(f,a,a.mul(l))},alpha:function(){var h=vi(f,jt(a),a.mul(s)),p=Ie(l.shape,a.shape);return p.length>0&&(h=h.sum(p)),h.reshape(l.shape)}}}),"Prelu")}}),ve=P({relu_:function(r){var n=M(r,"x","relu");return n.dtype==="bool"?n.toInt():W.runKernelFunc((function(t,e){var a=t.relu(n);return e([n]),a}),{x:n},(function(t,e){var a=e[0];return{x:function(){return t.mulStrict(a.step().toFloat())}}}),"Relu")}}),sb=P({relu6_:function(r){var n=M(r,"x","relu6");return n.dtype==="bool"?n.toInt():W.runKernelFunc((function(t,e){var a=t.relu6(n);return e([n]),a}),{x:n},(function(t,e){var a=e[0],u=a.lessEqual(6).mul(a.step());return{x:function(){return t.mulStrict(u.toFloat())}}}),"Relu6")}}),rA=P({selu_:function(r){var n=M(r,"x","selu");return W.runKernelFunc((function(t,e){var a=t.selu(n);return e([n]),a}),{$x:n},(function(t,e){var a=e[0];return{$x:function(){var u=a.greater(pt(0)),s=pt(Vd),l=pt(Gd),f=t.mul(l),h=t.mul(s).mul(a.toFloat().exp());return vi(u,f,h)}}}))}}),La=P({transpose_:function(r,n){var t=M(r,"x","transpose");if(n==null&&(n=t.shape.map((function(a,u){return u})).reverse()),k(t.rank===n.length,(function(){return"Error in transpose: rank of input "+t.rank+" must match length of perm "+n+"."})),n.forEach((function(a){k(a>=0&&a<t.rank,(function(){return"All entries in 'perm' must be between 0 and "+(t.rank-1)+" but got "+n}))})),t.rank<=1)return t.clone();var e={perm:n};return W.runKernelFunc((function(a){return a.transpose(t,n)}),{x:t},(function(a){var u=Od(n);return{x:function(){return a.transpose(u)}}}),"Transpose",e)}}),aA=P({localResponseNormalization_:function(r,n,t,e,a){n===void 0&&(n=5),t===void 0&&(t=1),e===void 0&&(e=1),a===void 0&&(a=.5);var u=M(r,"x","localResponseNormalization");k(u.rank===4||u.rank===3,(function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `+u.rank+"."})),k(_e(n),(function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+n+"."}));var s=u,l=!1;u.rank===3&&(l=!0,s=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]));var f=W.runKernelFunc((function(h,p){var v=h.localResponseNormalization4D(s,n,t,e,a);return p([s,v]),v}),{x4D:s},(function(h,p){var v=p[0],m=p[1];return{x4D:function(){return W.runKernelFunc((function(y){return y.LRNGrad(h,v,m,n,t,e,a)}),{})}}}));return l?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f}}),lb=P({norm_:function(r,n,t,e){n===void 0&&(n="euclidean"),t===void 0&&(t=null),e===void 0&&(e=!1);var a=(function l(f,h,p){if(p===void 0&&(p=null),f.rank===0)return f.abs();if(f.rank!==1&&p===null)return l(f.reshape([-1]),h,p);if(f.rank===1||typeof p=="number"||Array.isArray(p)&&p.length===1){if(h===1)return f.abs().sum(p);if(h===1/0)return f.abs().max(p);if(h===-1/0)return f.abs().min(p);if(h==="euclidean"||h===2)return f.abs().pow(pt(2,"int32")).sum(p).sqrt();throw new Error("Error in norm: invalid ord value: "+h)}if(Array.isArray(p)&&p.length===2){if(h===1)return f.abs().sum(p[0]).max(p[1]-1);if(h===1/0)return f.abs().sum(p[1]).max(p[0]);if(h===-1/0)return f.abs().sum(p[1]).min(p[0]);if(h==="fro"||h==="euclidean")return f.square().sum(p).sqrt();throw new Error("Error in norm: invalid ord value: "+h)}throw new Error("Error in norm: invalid axis: "+p)})(r=M(r,"x","norm"),n,t),u=a.shape;if(e){var s=Fe(t,r.shape);u=bn(a.shape,s)}return a.reshape(u)}}),iA=P({basicLSTMCell_:function(r,n,t,e,a,u){var s=M(r,"forgetBias","basicLSTMCell"),l=M(n,"lstmKernel","basicLSTMCell"),f=M(t,"lstmBias","basicLSTMCell"),h=M(e,"data","basicLSTMCell"),p=M(a,"c","basicLSTMCell"),v=M(u,"h","basicLSTMCell"),m=h.concat(v,1).matMul(l).add(f),y=m.shape[0],x=m.shape[1]/4,w=[y,x],_=m.slice([0,0],w),E=m.slice([0,x],w),R=m.slice([0,2*x],w),A=m.slice([0,3*x],w),S=_.sigmoid().mulStrict(E.tanh()).addStrict(p.mulStrict(s.add(R).sigmoid())),T=S.tanh().mulStrict(A.sigmoid());return[S,T]}}),oA=P({multiRNNCell_:function(r,n,t,e){for(var a=M(n,"data","multiRNNCell"),u=kl(t,"c","multiRNNCell"),s=kl(e,"h","multiRNNCell"),l=a,f=[],h=0;h<r.length;h++){var p=r[h](l,u[h],s[h]);f.push(p[0]),f.push(p[1]),l=p[1]}var v=[],m=[];for(h=0;h<f.length;h+=2)v.push(f[h]),m.push(f[h+1]);return[v,m]}}),uA=P({movingAverage_:function(r,n,t,e,a){a===void 0&&(a=!0);var u=M(r,"v","movingAverage"),s=M(n,"x","movingAverage"),l=M(t,"decay","movingAverage");a_(u,s),k(Pe(u.shape,s.shape),(function(){return"Shape mismatch in v and x"}));var f=pt(1),h=f.sub(l),p=s.sub(u).mul(h);if(a){k(e!=null,(function(){return"When using zeroDebias: true, step is required."}));var v=M(e,"step","movingAverage");p=p.div(f.sub(Gl(l,v)))}return u.add(p)}}),sA=P({stridedSlice_:function(r,n,t,e,a,u,s,l,f){if(a===void 0&&(a=0),u===void 0&&(u=0),s===void 0&&(s=0),l===void 0&&(l=0),f===void 0&&(f=0),e==null&&(e=new Array(n.length)),s!==0)throw new Error("ellipsis mask is not yet supported");var h=M(r,"x","stridedSlice"),p=$0(l),v=h.shape.slice();p.forEach((function(_){n[_]=0,t[_]=1,v.splice(_,0,1)})),h=h.reshape(v);for(var m=0;m<h.rank;m++)n[m]=yE(a,n,e,h.shape,m),t[m]=bE(u,t,e,h.shape,m),e[m]=e[m]||1;var y=$0(f);y.forEach((function(_){t[_]=n[_]+1,e[_]=1}));var x=Fd(n,t,e),w=x.filter((function(_,E){return y.indexOf(E)===-1}));return e.every((function(_){return _===1}))?Sr(h,n,x).reshape(w):W.runKernelFunc((function(_){return _.stridedSlice(h,n,t,e)}),{$x:h}).reshape(w)}}),lA=P({topk_:function(r,n,t){n===void 0&&(n=1),t===void 0&&(t=!0);var e=M(r,"x","topk");if(e.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var a=e.shape[e.shape.length-1];if(n>a)throw new Error("'k' passed to topk() must be <= the last dimension ("+a+") but got "+n);var u=W.runKernelFunc((function(s){return s.topk(e,n,t)}),{$x:e});return{values:u[0],indices:u[1]}}}),cA=P({scatterND_:function(r,n,t){var e=M(r,"indices","scatterND","int32"),a=M(n,"updates","scatterND");return mE(a,e,t),W.runKernelFunc((function(u){return u.scatterND(e,a,t)}),{indices:e,updates:a},null,"ScatterNd",{shape:t})}}),Yd=P({fft_:function(r){k(r.dtype==="complex64",(function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+r.dtype+"."}));var n=r.shape[r.shape.length-1],t=r.size/n,e=r.as2D(t,n);return W.runKernelFunc((function(a){return a.fft(e)}),{input:r}).reshape(r.shape)}}),Wl=P({ifft_:function(r){k(r.dtype==="complex64",(function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+r.dtype+"."}));var n=r.shape[r.shape.length-1],t=r.size/n,e=r.as2D(t,n);return W.runKernelFunc((function(a){return a.ifft(e)}),{input:r}).reshape(r.shape)}}),Qd=P({rfft_:function(r,n){k(r.dtype==="float32",(function(){return"The dtype for rfft() must be real value but got "+r.dtype}));var t,e=r.shape[r.shape.length-1],a=r.size/e;if(n!=null&&n<e){var u=r.shape.map((function(E){return 0})),s=r.shape.map((function(E){return E}));s[r.shape.length-1]=n,t=r.slice(u,s),e=n}else if(n!=null&&n>e){var l=r.shape.map((function(E){return E}));l[r.shape.length-1]=n-e,t=r.concat(he(l),r.shape.length-1),e=n}else t=r;var f=t.zerosLike(),h=Ye(t,f).as2D(a,e),p=Yd(h),v=Math.floor(e/2)+1,m=Zn(p),y=xr(p),x=m.split([v,e-v],m.shape.length-1),w=y.split([v,e-v],y.shape.length-1),_=t.shape.slice();return _[t.shape.length-1]=v,Ye(x[0],w[0]).reshape(_)}}),cb=P({irfft_:function(r){var n=r.shape[r.shape.length-1],t=r.size/n;if(n<=2){var e=r.as2D(t,n),a=Wl(e);return Zn(a)}var u=[t,2*(n-1)],s=Zn(r).as2D(t,n),l=xr(r).as2D(t,n),f=s.slice([0,1],[t,n-2]).reverse(1),h=l.slice([0,1],[t,n-2]).reverse(1).mul(pt(-1)),p=s.concat(f,1),v=l.concat(h,1);return e=Ye(p,v).as2D(u[0],u[1]),a=Wl(e),Zn(a)}}),fA=Object.freeze({fft:Yd,ifft:Wl,rfft:Qd,irfft:cb}),hA=P({sparseToDense_:function(r,n,t,e){e===void 0&&(e=0);var a=M(r,"sparseIndices","sparseToDense","int32"),u=M(n,"sparseValues","sparseToDense"),s=M(e,"defaultValue","sparseToDense",u.dtype);return(function(l,f,h,p){if(l.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+l.dtype+".");if(l.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+l.shape+".");var v=l.rank>0?l.shape[0]:1,m=l.rank>1?l.shape[1]:1;if(h.length!==m)throw new Error("outputShape has incorrect number of elements:, "+h.length+", should be: "+m+".");var y=f.size;if(f.rank!==0&&(f.rank!==1||y!==v))throw new Error("sparseValues has incorrect shape "+f.shape+", should be [] or ["+v+"]");if(f.dtype!==p.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")})(a,u,t,s),W.runKernelFunc((function(l){return l.sparseToDense(a,u,t,s)}),{$sparseIndices:a,$sparseValues:u,$defaultValue:s})}}),dA=P({gatherND_:function(r,n){var t=M(n,"indices","gatherND","int32"),e=M(r,"x","gatherND");return W.runKernelFunc((function(a){return a.gatherND(e,t)}),{x:e,indices:t},null,"GatherNd")}}),pA=P({diag_:function(r){var n=M(r,"x","diag").flatten(),t=r.shape.concat(r.shape);return W.runKernelFunc((function(e){return e.diag(n)}),{$x:n}).reshape(t)}}),vA=P({dropout_:function(r,n,t,e){var a=M(r,"x","dropout");if(k(a.dtype==="float32",(function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+a.dtype+" tensor instead."})),k(n>=0&&n<1,(function(){return"rate must be a float in the range [0, 1), but got "+n+"."})),n===0)return r instanceof pe?a.clone():a;var u=(function(f,h){if(h==null)return f.shape.slice();if(Pe(f.shape,h))return h;if(f.shape.length===h.length){for(var p=[],v=0;v<f.shape.length;v++)h[v]==null&&f.shape[v]!=null?p.push(f.shape[v]):p.push(h[v]);return p}return h})(a,t),s=1-n,l=u1(u,0,1,"float32",e).add(s).floor().div(s);return a.mul(l)}});function fb(r,n,t){for(var e=1-r%2,a=new Float32Array(r),u=0;u<r;++u){var s=2*Math.PI*u/(r+e-1);a[u]=n-t*Math.cos(s)}return Te(a,"float32")}var Zd=P({hannWindow_:function(r){return fb(r,.5,.5)}}),hb=P({hammingWindow_:function(r){return fb(r,.54,.46)}}),Jd=P({frame_:function(r,n,t,e,a){e===void 0&&(e=!1),a===void 0&&(a=0);for(var u=0,s=[];u+n<=r.size;)s.push(Sr(r,u,n)),u+=t;if(e)for(;u<r.size;){var l=u+n-r.size,f=Oe([Sr(r,u,n-l),Cr([l],a)]);s.push(f),u+=t}return s.length===0?Ba([],[0,n]):Oe(s).as2D(s.length,n)}}),db=P({stft_:function(r,n,t,e,a){var u;a===void 0&&(a=Zd),e==null&&(u=n,e=Math.floor(Math.pow(2,Math.ceil(Math.log(u)/Math.log(2)))));for(var s=Jd(r,n,t),l=rn(s,a(n)),f=[],h=0;h<s.shape[0];h++)f.push(Qd(l.slice([h,0],[1,n]),e));return Oe(f)}}),mA=Object.freeze({hannWindow:Zd,hammingWindow:hb,frame:Jd,stft:db}),nn,gA=function(r,n,t){return t===void 0&&(t=1),bt(this,void 0,void 0,(function(){var e,a,u,s,l,f,h,p,v,m,y,x,w,_;return xt(this,(function(E){switch(E.label){case 0:return e=M(r,"predictions","inTopK"),a=M(n,"targets","inTopK"),k(e.rank>1,(function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+e.rank})),k(e.rank-1===a.rank,(function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+e.rank+" and targets rank "+a.rank})),$t(e.shape.slice(0,e.shape.length-1),a.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),u=e.shape[e.shape.length-1],k(t>0&&t<=u,(function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+u+"), but got "+t})),[4,e.data()];case 1:return s=E.sent(),[4,a.data()];case 2:for(l=E.sent(),f=[s.length/u,u],p=f[1],v=Du("bool",h=f[0]),m=0;m<h;m++){for(y=m*p,x=s.subarray(y,y+p),w=[],_=0;_<x.length;_++)w.push({value:x[_],index:_});for(w.sort((function(R,A){return A.value-R.value})),v[m]=0,_=0;_<t;_++)if(w[_].index===l[m]){v[m]=1;break}}return r!==e&&e.dispose(),n!==a&&a.dispose(),[2,Ze(v,a.shape,"bool")]}}))}))};(function(r){r[r.NONE=0]="NONE",r[r.MEAN=1]="MEAN",r[r.SUM=2]="SUM",r[r.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(nn||(nn={}));var yA=P({absoluteDifference_:function(r,n,t,e){e===void 0&&(e=nn.SUM_BY_NONZERO_WEIGHTS);var a=M(r,"labels","absoluteDifference"),u=M(n,"predictions","absoluteDifference"),s=null;t!=null&&(s=M(t,"weights","absoluteDifference")),$t(a.shape,u.shape,"Error in absoluteDifference: ");var l=a.sub(u).abs();return na(l,s,e)}}),na=P({computeWeightedLoss_:function(r,n,t){t===void 0&&(t=nn.SUM_BY_NONZERO_WEIGHTS);var e=M(r,"losses","computeWeightedLoss"),a=null;n!=null&&(a=M(n,"weights","computeWeightedLoss"));var u=a==null?e:e.mul(a);if(t===nn.NONE)return u;if(t===nn.SUM)return u.sum();if(t===nn.MEAN){if(a==null)return u.mean();var s=e.size/a.size,l=u.sum().div(a.sum());return s>1?l.div(pt(s)):l}if(t===nn.SUM_BY_NONZERO_WEIGHTS){if(a==null)return u.sum().div(pt(e.size));var f=a.mul(Ao(e.shape)).notEqual(pt(0)).sum().toFloat();return u.sum().div(f)}throw Error("Unknown reduction: "+t)}}),bA=P({cosineDistance_:function(r,n,t,e,a){a===void 0&&(a=nn.SUM_BY_NONZERO_WEIGHTS);var u=M(r,"labels","cosineDistance"),s=M(n,"predictions","cosineDistance"),l=null;e!=null&&(l=M(e,"weights","cosineDistance")),$t(u.shape,s.shape,"Error in cosineDistance: ");var f=pt(1).sub(u.mul(s).sum(t,!0));return na(f,l,a)}}),xA=P({hingeLoss_:function(r,n,t,e){e===void 0&&(e=nn.SUM_BY_NONZERO_WEIGHTS);var a=M(r,"labels","hingeLoss"),u=M(n,"predictions","hingeLoss"),s=null;t!=null&&(s=M(t,"weights","hingeLoss")),$t(a.shape,u.shape,"Error in hingeLoss: ");var l=pt(1);a=pt(2).mul(a).sub(l);var f=l.sub(a.mul(u)).relu();return na(f,s,e)}}),wA=P({huberLoss_:function(r,n,t,e,a){e===void 0&&(e=1),a===void 0&&(a=nn.SUM_BY_NONZERO_WEIGHTS);var u=M(r,"labels","huberLoss"),s=M(n,"predictions","huberLoss"),l=null;t!=null&&(l=M(t,"weights","huberLoss")),$t(u.shape,s.shape,"Error in huberLoss: ");var f=pt(e),h=s.sub(u).abs(),p=j1(h,f),v=h.sub(p),m=pt(.5).mul(p.square()).add(f.mul(v));return na(m,l,a)}}),_A=P({logLoss_:function(r,n,t,e,a){e===void 0&&(e=1e-7),a===void 0&&(a=nn.SUM_BY_NONZERO_WEIGHTS);var u=M(r,"labels","logLoss"),s=M(n,"predictions","logLoss"),l=null;t!=null&&(l=M(t,"weights","logLoss")),$t(u.shape,s.shape,"Error in logLoss: ");var f=pt(1),h=pt(e),p=u.mul(s.add(h).log()).neg().sub(f.sub(u).mul(f.sub(s).add(h).log()));return na(p,l,a)}}),EA=P({meanSquaredError_:function(r,n,t,e){e===void 0&&(e=nn.SUM_BY_NONZERO_WEIGHTS);var a=M(r,"labels","meanSquaredError"),u=M(n,"predictions","meanSquaredError"),s=null;t!=null&&(s=M(t,"weights","meanSquaredError")),$t(a.shape,u.shape,"Error in meanSquaredError: ");var l=a.squaredDifference(u);return na(l,s,e)}}),CA=P({sigmoidCrossEntropy_:function(r,n,t,e,a){e===void 0&&(e=0),a===void 0&&(a=nn.SUM_BY_NONZERO_WEIGHTS);var u=M(r,"multiClassLabels","sigmoidCrossEntropy"),s=M(n,"logits","sigmoidCrossEntropy"),l=null;if(t!=null&&(l=M(t,"weights","sigmoidCrossEntropy")),$t(u.shape,s.shape,"Error in sigmoidCrossEntropy: "),e>0){var f=pt(e),h=pt(1),p=pt(.5);u=u.mul(h.sub(f)).add(p.mul(f))}var v=(function(m,y){var x=M(m,"labels","sigmoidCrossEntropyWithLogits"),w=M(y,"logits","sigmoidCrossEntropyWithLogits");$t(x.shape,w.shape,"Error in sigmoidCrossEntropyWithLogits: ");var _=w.relu(),E=w.mul(x),R=w.abs().neg().exp().log1p();return _.sub(E).add(R)})(u,s);return na(v,l,a)}}),SA=P({softmaxCrossEntropy_:function(r,n,t,e,a){e===void 0&&(e=0),a===void 0&&(a=nn.SUM_BY_NONZERO_WEIGHTS);var u=M(r,"onehotLabels","softmaxCrossEntropy"),s=M(n,"logits","softmaxCrossEntropy"),l=null;if(t!=null&&(l=M(t,"weights","softmaxCrossEntropy")),$t(u.shape,s.shape,"Error in softmaxCrossEntropy: "),e>0){var f=pt(e),h=pt(1),p=pt(u.shape[1]);u=u.mul(h.sub(f)).add(f.div(p))}var v=(function(m,y,x){if(x===void 0&&(x=-1),x===-1&&(x=y.rank-1),x!==y.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+y.rank+" and dim was "+x);return Zl((function(w,_,E){var R=_.logSumExp([x],!0),A=_.toFloat().sub(R);return E([w,A]),{value:A.mul(w).neg().sum([x]),gradFunc:function(S,T){var N=T[0],O=T[1],B=bn(S.shape,[x]);return[S.reshape(B).mul(N.toFloat().sub(O.exp())),S.reshape(B).mul(O.exp().sub(N.toFloat()))]}}}))(m,y)})(u,s);return na(v,l,a)}}),RA=Object.freeze({get Reduction(){return nn},absoluteDifference:yA,computeWeightedLoss:na,cosineDistance:bA,hingeLoss:xA,huberLoss:wA,logLoss:_A,meanSquaredError:EA,sigmoidCrossEntropy:CA,softmaxCrossEntropy:SA});function wy(r,n){return n===void 0&&(n=!1),W.tidy((function(){if(r.shape.length!==2)throw new Error("qr2d() requires a 2D Tensor, but got a "+r.shape.length+"D Tensor.");for(var t=r.shape[0],e=r.shape[1],a=o1(t),u=r.clone(),s=Ba([[1]],[1,1]),l=s.clone(),f=t>=e?e:t,h=function(v){var m,y=u,x=l,w=a;m=W.tidy((function(){var _=u.slice([v,v],[t-v,1]),E=_.norm(),R=u.slice([v,v],[1,1]),A=Ba([[-1]]).where(R.greater(0),Ba([[1]])),S=R.sub(A.mul(E)),T=_.div(S);l=T.shape[0]===1?s.clone():s.concat(T.slice([1,0],[T.shape[0]-1,T.shape[1]]),0);var N=A.matMul(S).div(E).neg(),O=u.slice([v,0],[t-v,e]),B=N.mul(l);if(v===0)u=O.sub(B.matMul(l.transpose().matMul(O)));else{var I=O.sub(B.matMul(l.transpose().matMul(O)));u=u.slice([0,0],[v,e]).concat(I,0)}var F=a.slice([0,v],[t,a.shape[1]-v]);if(v===0)a=F.sub(F.matMul(l).matMul(B.transpose()));else{var G=F.sub(F.matMul(l).matMul(B.transpose()));a=a.slice([0,0],[t,v]).concat(G,1)}return[l,u,a]})),l=m[0],u=m[1],a=m[2],yn([y,x,w])},p=0;p<f;++p)h(p);return!n&&t>e&&(a=a.slice([0,0],[t,e]),u=u.slice([0,0],[e,e])),[a,u]}))}var AA=P({bandPart_:function(r,n,t){if(n%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+n+".");if(t%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+t+".");var e=M(r,"a","bandPart");if(e.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+e.rank+".");var a=e.shape,u=e.shape.slice(-2),s=u[0],l=u[1];if(!(n<=s))throw new Error("bandPart(): numLower ("+n+") must not be greater than the number of rows ("+s+").");if(!(t<=l))throw new Error("bandPart(): numUpper ("+t+") must not be greater than the number of columns ("+l+").");n<0&&(n=s),t<0&&(t=l);var f=Il(0,s,1,"int32").reshape([-1,1]),h=Il(0,l,1,"int32"),p=Be(f,h),v=$l(p.lessEqual(pt(+n,"int32")),p.greaterEqual(pt(-t,"int32"))),m=he([s,l],e.dtype);return Fn(ke(e.reshape([-1,s,l])).map((function(y){return vi(v,y,m)}))).reshape(a)}}),TA=P({gramSchmidt_:function(r){var n;if(Array.isArray(r)){n=!1,k(r!=null&&r.length>0,(function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"}));for(var t=r[0].shape[0],e=function(f){k(r[f].shape[0]===t,(function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+r[f].shape[0]+" vs. "+t+")"}))},a=1;a<r.length;++a)e(a)}else n=!0,r=Id(r,r.shape[0],0).map((function(f){return l1(f,[0])}));k(r.length<=r[0].shape[0],(function(){return"Gram-Schmidt: Number of vectors ("+r.length+") exceeds number of dimensions ("+r[0].shape[0]+")."}));var u=[],s=r,l=function(f){u.push(W.tidy((function(){var h=s[f];if(f>0)for(var p=0;p<f;++p){var v=ib(u[p].mulStrict(h)).mul(u[p]);h=h.sub(v)}return h.div(lb(h,"euclidean"))})))};for(a=0;a<r.length;++a)l(a);return n?Fn(u,0):u}}),DA=P({qr_:function(r,n){if(n===void 0&&(n=!1),r.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+r.rank);if(r.rank===2)return wy(r,n);var t=r.shape.slice(0,r.shape.length-2).reduce((function(s,l){return s*l})),e=ke(r.reshape([t,r.shape[r.shape.length-2],r.shape[r.shape.length-1]]),0),a=[],u=[];return e.forEach((function(s){var l=wy(s,n),f=l[0],h=l[1];a.push(f),u.push(h)})),[Fn(a,0).reshape(r.shape),Fn(u,0).reshape(r.shape)]}}),NA=Object.freeze({bandPart:AA,gramSchmidt:TA,qr:DA});function rc(r,n,t,e,a,u){e==null&&(e=.5),a==null&&(a=Number.NEGATIVE_INFINITY),u==null&&(u=0);var s=r.shape[0];return t=Math.min(t,s),k(0<=e&&e<=1,(function(){return"iouThreshold must be in [0, 1], but was '"+e+"'"})),k(r.rank===2,(function(){return"boxes must be a 2D tensor, but was of rank '"+r.rank+"'"})),k(r.shape[1]===4,(function(){return"boxes must have 4 columns, but 2nd dimension was "+r.shape[1]})),k(n.rank===1,(function(){return"scores must be a 1D tensor"})),k(n.shape[0]===s,(function(){return"scores has incompatible shape with boxes. Expected "+s+", but was "+n.shape[0]})),k(0<=u&&u<=1,(function(){return"softNmsSigma must be in [0, 1], but was '"+u+"'"})),{maxOutputSize:t,iouThreshold:e,scoreThreshold:a,softNmsSigma:u}}var MA=P({resizeBilinear_:function(r,n,t){t===void 0&&(t=!1);var e=M(r,"images","resizeBilinear");k(e.rank===3||e.rank===4,(function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+e.rank+"."})),k(n.length===2,(function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+n+"."}));var a=e,u=!1;e.rank===3&&(u=!0,a=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var s=n[0],l=n[1],f=W.runKernelFunc((function(h,p){return p([a]),h.resizeBilinear(a,s,l,t)}),{x:a},(function(h,p){return{x:function(){return W.runKernelFunc((function(v){return v.resizeBilinearBackprop(h,p[0],t)}),{})}}}),"ResizeBilinear",{alignCorners:t,newHeight:s,newWidth:l});return u?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f}}),OA=P({resizeNearestNeighbor_:function(r,n,t){t===void 0&&(t=!1);var e=M(r,"images","resizeNearestNeighbor");k(e.rank===3||e.rank===4,(function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+e.rank+"."})),k(n.length===2,(function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+n+"."})),k(e.dtype==="float32"||e.dtype==="int32",(function(){return"`images` must have `int32` or `float32` as dtype"}));var a=e,u=!1;e.rank===3&&(u=!0,a=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var s=n[0],l=n[1],f=W.runKernelFunc((function(h,p){return p([a]),h.resizeNearestNeighbor(a,s,l,t)}),{batchImages:a},(function(h,p){return{batchImages:function(){return W.runKernelFunc((function(v){return v.resizeNearestNeighborBackprop(h,p[0],t)}),{})}}}));return u?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f}}),kA=P({nonMaxSuppression_:function(r,n,t,e,a){e===void 0&&(e=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY);var u=M(r,"boxes","nonMaxSuppression"),s=M(n,"scores","nonMaxSuppression"),l=rc(u,s,t,e,a);t=l.maxOutputSize,e=l.iouThreshold,a=l.scoreThreshold;var f={maxOutputSize:t,iouThreshold:e,scoreThreshold:a};return W.runKernelFunc((function(h){return h.nonMaxSuppression(u,s,t,e,a)}),{boxes:u,scores:s},null,"NonMaxSuppressionV3",f)}}),IA=function(r,n,t,e,a){return e===void 0&&(e=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),bt(this,void 0,void 0,(function(){var u,s,l,f,h,p,v;return xt(this,(function(m){switch(m.label){case 0:return u=M(r,"boxes","nonMaxSuppressionAsync"),s=M(n,"scores","nonMaxSuppressionAsync"),l=rc(u,s,t,e,a),t=l.maxOutputSize,e=l.iouThreshold,a=l.scoreThreshold,[4,Promise.all([u.data(),s.data()])];case 1:return f=m.sent(),h=f[0],p=f[1],v=Ld(h,p,t,e,a),u!==r&&u.dispose(),s!==n&&s.dispose(),[2,v]}}))}))},BA=P({nonMaxSuppressionWithScore_:function(r,n,t,e,a,u){e===void 0&&(e=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),u===void 0&&(u=0);var s=M(r,"boxes","nonMaxSuppression"),l=M(n,"scores","nonMaxSuppression"),f=rc(s,l,t,e,a,u),h={maxOutputSize:t=f.maxOutputSize,iouThreshold:e=f.iouThreshold,scoreThreshold:a=f.scoreThreshold,softNmsSigma:u=f.softNmsSigma},p=W.runKernel("NonMaxSuppressionV5",{boxes:s,scores:l},h);return{selectedIndices:p[0],selectedScores:p[1]}}}),FA=function(r,n,t,e,a,u){return e===void 0&&(e=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),u===void 0&&(u=0),bt(this,void 0,void 0,(function(){var s,l,f,h,p,v,m;return xt(this,(function(y){switch(y.label){case 0:return s=M(r,"boxes","nonMaxSuppressionAsync"),l=M(n,"scores","nonMaxSuppressionAsync"),f=rc(s,l,t,e,a,u),t=f.maxOutputSize,e=f.iouThreshold,a=f.scoreThreshold,u=f.softNmsSigma,[4,Promise.all([s.data(),l.data()])];case 1:return h=y.sent(),p=h[0],v=h[1],m=Ud(p,v,t,e,a,u),s!==r&&s.dispose(),l!==n&&l.dispose(),[2,m]}}))}))},zA=P({cropAndResize_:function(r,n,t,e,a,u){var s=M(r,"image","cropAndResize"),l=M(n,"boxes","cropAndResize","float32"),f=M(t,"boxInd","cropAndResize","int32");a=a||"bilinear",u=u||0;var h=l.shape[0];return k(s.rank===4,(function(){return"Error in cropAndResize: image must be rank 4,but got rank "+s.rank+"."})),k(l.rank===2&&l.shape[1]===4,(function(){return"Error in cropAndResize: boxes must be have size ["+h+",4] but had shape "+l.shape+"."})),k(f.rank===1&&f.shape[0]===h,(function(){return"Error in cropAndResize: boxInd must be have size ["+h+"] but had shape "+l.shape+"."})),k(e.length===2,(function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+e.length+"."})),k(e[0]>=1&&e[1]>=1,(function(){return"cropSize must be atleast [1,1], but was "+e})),k(a==="bilinear"||a==="nearest",(function(){return"method must be bilinear or nearest, but was "+a})),W.runKernelFunc((function(p,v){return p.cropAndResize(s,l,f,e,a,u)}),{images:s,boxes:l,boxInd:f},null,"CropAndResize",{method:a,extrapolationValue:u,cropSize:e})}}),$d=Object.freeze({resizeBilinear:MA,resizeNearestNeighbor:OA,nonMaxSuppression:kA,nonMaxSuppressionAsync:IA,nonMaxSuppressionWithScore:BA,nonMaxSuppressionWithScoreAsync:FA,cropAndResize:zA}),tp=function(r,n){return!(r>0)||n==="linear"},ep=function(r,n,t){if(t==null||t==="linear")return r;if(t==="relu")return r.mul(n.step());throw new Error("Gradient for activation "+t+" has not been implemented yet.")},np=function(r,n){var t=n,e=Ie(r.shape,n.shape);return e.length>0&&(t=t.sum(e)),t.reshape(r.shape)},rp=function(r,n,t){if(n==="linear")return r;if(n==="relu")return ve(r);if(n==="elu")return ob(r);if(n==="relu6")return sb(r);if(n==="prelu")return ub(r,t);throw new Error("Unknown fused activation "+n+".")},LA=P({fusedMatMul_:function(r){var n,t=r.a,e=r.b,a=r.transposeA,u=a!==void 0&&a,s=r.transposeB,l=s!==void 0&&s,f=r.bias,h=r.activation,p=h===void 0?"linear":h,v=r.preluActivationWeights;if(tp(W.state.gradientDepth,p)===!1){var m=ec(t,e,u,l);return f!=null&&(m=Lt(m,f)),rp(m,p,v)}var y=M(t,"a","fused matMul"),x=M(e,"b","fused matMul");n=me(y,x),y=n[0],x=n[1];var w=u?y.shape[y.rank-2]:y.shape[y.rank-1],_=l?x.shape[x.rank-1]:x.shape[x.rank-2],E=u?y.shape[y.rank-1]:y.shape[y.rank-2],R=l?x.shape[x.rank-2]:x.shape[x.rank-1],A=y.shape.slice(0,-2),S=x.shape.slice(0,-2),T=_t(A),N=_t(S);k(y.rank>=2&&x.rank>=2&&y.rank===x.rank,(function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+y.rank+" and "+x.rank+"."})),k(Pe(A,S),(function(){return"Error in fused matMul: outer dimensions ("+A+") and ("+S+") of Tensors with shapes "+y.shape+" and "+x.shape+" must match."})),k(w===_,(function(){return"Error in fused matMul: inner shapes ("+w+") and ("+_+") of Tensors with shapes "+y.shape+" and "+x.shape+" and transposeA="+u+" and transposeB="+l+" must match."}));var O,B,I=y.shape.slice(0,-2).concat([E,R]),F=u?y.as3D(T,w,E):y.as3D(T,E,w),G=l?x.as3D(N,R,_):x.as3D(N,_,R);f!=null&&Ht(I,(O=me(O=M(f,"bias","fused matMul"),y)[0]).shape),v!=null&&(B=M(v,"prelu weights","fused matMul"));var H={a:F,b:G};f!=null&&(H.bias=O),v!=null&&(H.preluActivationWeights=B);var at=[F,G];return W.runKernelFunc((function(et,nt){var L=et.fusedBatchMatMul({a:F,b:G,transposeA:u,transposeB:l,bias:O,activation:p,preluActivationWeights:B});return nt([F,G,L]),L}),H,(function(et,nt){var L=nt[0],q=nt[1],K=nt[2],rt=ep(et,K,p),ot={};return f!=null&&(ot={bias:function(){return np(O,rt)}}),Object.assign(u||l?!u&&l?{a:function(){return rt.matMul(q,!1,!1)},b:function(){return rt.matMul(L,!0,!1)}}:u&&!l?{a:function(){return q.matMul(rt,!1,!0)},b:function(){return L.matMul(rt,!1,!1)}}:{a:function(){return q.matMul(rt,!0,!0)},b:function(){return rt.matMul(L,!0,!0)}}:{a:function(){return rt.matMul(q,!1,!0)},b:function(){return L.matMul(rt,!0,!1)}},ot)}),"_FusedMatMul",{transposeA:u,transposeB:l,activation:p},at,[!0]).reshape(I)}}),UA=P({fusedConv2d_:function(r){var n=r.x,t=r.filter,e=r.strides,a=r.pad,u=r.dataFormat,s=u===void 0?"NHWC":u,l=r.dilations,f=l===void 0?[1,1]:l,h=r.dimRoundingMode,p=r.bias,v=r.activation,m=v===void 0?"linear":v,y=r.preluActivationWeights;if(m=m||"linear",tp(W.state.gradientDepth,m)===!1){var x=$n(n,t,e,a,s,f,h);return p!=null&&(x=Lt(x,p)),rp(x,m,y)}var w=M(n,"x","conv2d"),_=M(t,"filter","conv2d"),E=w,R=!1;w.rank===3&&(R=!0,E=w.as4D(1,w.shape[0],w.shape[1],w.shape[2])),k(E.rank===4,(function(){return"Error in fused conv2d: input must be rank 4, but got rank "+E.rank+"."})),k(_.rank===4,(function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+_.rank+"."})),h!=null&&k(_e(a),(function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+h+" but got pad "+a+"."})),k(E.shape[3]===_.shape[2],(function(){return"Error in conv2d: depth of input ("+E.shape[3]+") must match input depth for filter "+_.shape[2]+"."})),k(xn(e,f),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+f+"'"})),k(s==="NHWC",(function(){return"Error in conv2d: got dataFormat of "+s+" but only NHWC is currently supported."}));var A,S,T=yi(E.shape,_.shape,e,f,a,h);p!=null&&(A=me(A=M(p,"bias","fused conv2d"),w)[0],Ht(T.outShape,A.shape)),y!=null&&(S=M(y,"prelu weights","fused conv2d"));var N={x:E,filter:_};p!=null&&(N.bias=A),y!=null&&(N.preluActivationWeights=S);var O=[_,E],B=W.runKernelFunc((function(I,F){var G=I.fusedConv2d({input:E,filter:_,convInfo:T,bias:A,activation:m,preluActivationWeights:S});return F([_,E,G]),G}),N,(function(I,F){var G=F,H=G[0],at=G[1],et=G[2],nt=ep(I,et,m);k(So(f),(function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+f+"'"}));var L={};return p!=null&&(L={bias:function(){return np(A,nt)}}),Object.assign({x:function(){return J1(at.shape,nt,H,e,a)},filter:function(){return Xd(at,nt,H.shape,e,a)}},L)}),"FusedConv2D",{convInfo:T,activation:m},O,[!0]);return R?B.as3D(B.shape[1],B.shape[2],B.shape[3]):B}}),PA=P({fusedDepthwiseConv2d_:function(r){var n=r.x,t=r.filter,e=r.strides,a=r.pad,u=r.dataFormat,s=u===void 0?"NHWC":u,l=r.dilations,f=l===void 0?[1,1]:l,h=r.dimRoundingMode,p=r.bias,v=r.activation,m=v===void 0?"linear":v,y=r.preluActivationWeights;if(tp(W.state.gradientDepth,m)===!1){var x=tc(n,t,e,a,s,f,h);return p!=null&&(x=Lt(x,p)),rp(x,m,y)}var w=M(n,"x","depthwiseConv2d"),_=M(t,"filter","depthwiseConv2d"),E=w,R=!1;w.rank===3&&(R=!0,E=w.as4D(1,w.shape[0],w.shape[1],w.shape[2])),k(E.rank===4,(function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+E.rank+"."})),k(_.rank===4,(function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+_.rank+"."})),k(E.shape[3]===_.shape[2],(function(){return"Error in fused depthwiseConv2d: number of input channels ("+E.shape[3]+") must match the inChannels dimension in filter "+_.shape[2]+"."})),f==null&&(f=[1,1]),k(xn(e,f),(function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+f+"'"})),h!=null&&k(_e(a),(function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+h+" but got pad "+a+"."}));var A,S,T=yi(E.shape,_.shape,e,f,a,h,!0);p!=null&&(A=me(A=M(p,"bias","fused conv2d"),w)[0],Ht(T.outShape,A.shape)),y!=null&&(S=M(y,"prelu weights","fused depthwiseConv2d"));var N={x:E,filter:_};p!=null&&(N.bias=A),y!=null&&(N.preluActivationWeights=S);var O=[_,E],B=W.runKernelFunc((function(I,F){var G=I.fusedDepthwiseConv2D({input:E,filter:_,convInfo:T,bias:A,activation:m,preluActivationWeights:S});return F([_,E,G]),G}),N,(function(I,F){k(So(f),(function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+f+"'"}));var G=F[0],H=F[1],at=F[2],et=ep(I,at,m),nt={};return p!=null&&(nt={bias:function(){return np(A,et)}}),Object.assign({x:function(){return $1(H.shape,et,G,T)},filter:function(){return tb(H,et,G.shape,T)}},nt)}),"FusedDepthwiseConv2D",{convInfo:T,activation:m},O,[!0]);return R?B.as3D(B.shape[1],B.shape[2],B.shape[3]):B}}),HA=Object.freeze({matMul:LA,conv2d:UA,depthwiseConv2d:PA}),VA=Object.freeze({image:$d,linalg:NA,losses:RA,spectral:fA,fused:HA,signal:mA,square:_S,squaredDifference:F1,conv1d:MR,conv2d:$n,conv3d:OR,depthwiseConv2d:tc,separableConv2d:Kd,conv2dTranspose:kR,conv3dTranspose:IR,op:P,batchNormalization2d:JS,batchNormalization3d:$S,batchNormalization4d:tR,batchNormalization:eR,batchNorm:V1,batchNorm2d:nR,batchNorm3d:rR,batchNorm4d:aR,booleanMaskAsync:NR,complex:Ye,real:Zn,imag:xr,concat:Oe,concat1d:H_,concat2d:V_,concat3d:G_,concat4d:W_,split:Id,matMul:ec,dot:BR,outerProduct:FR,reverse:Wu,reverse1d:zR,reverse2d:LR,reverse3d:UR,reverse4d:PR,maxPool:Ue,avgPool:qu,pool:HR,maxPool3d:VR,avgPool3d:GR,slice:Sr,slice1d:WR,slice2d:qR,slice3d:rb,slice4d:jR,abs:ES,acos:CS,acosh:SS,asin:RS,asinh:AS,atan:TS,atanh:DS,ceil:NS,clipByValue:Wd,cos:MS,cosh:OS,erf:kS,exp:xd,expm1:IS,floor:BS,log:FS,log1p:zS,logSigmoid:LS,neg:Vl,reciprocal:US,round:PS,rsqrt:z1,sigmoid:L1,sign:HS,isNaN:VS,isInf:GS,isFinite:WS,sin:qS,sinh:jS,softplus:XS,sqrt:KS,step:YS,tan:QS,tanh:ZS,all:XR,any:KR,argMax:YR,argMin:QR,logSumExp:ZR,max:nc,mean:JR,min:$R,moments:tA,sum:ib,prod:eA,equal:X1,equalStrict:xR,greater:wR,greaterEqual:K1,greaterEqualStrict:_R,greaterStrict:ER,less:CR,lessEqual:SR,lessEqualStrict:RR,lessStrict:AR,notEqual:TR,notEqualStrict:DR,add:Lt,addN:uR,addStrict:sR,atan2:lR,div:ir,divNoNan:cR,divStrict:fR,floorDiv:q1,maximum:qd,maximumStrict:hR,minimum:j1,minimumStrict:dR,mod:pR,modStrict:vR,mul:rn,mulStrict:mR,pow:Gl,powStrict:gR,squaredDifferenceStrict:yR,sub:Be,subStrict:bR,elu:ob,leakyRelu:nA,prelu:ub,relu:ve,relu6:sb,selu:rA,logicalAnd:$l,logicalNot:iR,logicalOr:G1,logicalXor:oR,where:vi,whereAsync:W1,buffer:kt,print:$_,batchToSpaceND:i1,broadcastTo:tE,cast:eE,clone:nE,cumsum:rE,depthToSpace:aE,expandDims:Qn,eye:o1,multinomial:iE,oneHot:md,pad:gi,pad1d:oE,pad2d:uE,pad3d:sE,pad4d:lE,rand:cE,randomNormal:fE,randomGamma:hE,randomUniform:u1,reshape:or,spaceToBatchND:s1,squeeze:l1,stack:Fn,tile:mo,truncatedNormal:dE,unstack:ke,setdiff1dAsync:pE,fill:Cr,linspace:P_,ones:Ao,range:Il,scalar:pt,tensor:Ze,tensor1d:Te,tensor2d:Ba,tensor3d:kd,tensor4d:mn,tensor5d:z_,tensor6d:L_,variable:U_,zeros:he,onesLike:a1,zerosLike:jt,transpose:La,softmax:ea,logSoftmax:wE,localResponseNormalization:aA,norm:lb,gather:jd,unsortedSegmentSum:Y1,basicLSTMCell:iA,multiRNNCell:oA,movingAverage:uA,stridedSlice:sA,topk:lA,scatterND:cA,fft:Yd,ifft:Wl,rfft:Qd,irfft:cb,sparseToDense:hA,gatherND:dA,diag:pA,dropout:vA,hannWindow:Zd,hammingWindow:hb,frame:Jd,stft:db,inTopKAsync:gA});function ft(r,n){Array.isArray(r)||(r=[r]),r.forEach((function(t){t!=null&&k(t.dtype!=="complex64",(function(){return n+" does not support complex64 tensors."}))}))}function Qh(r,n,t,e){if(t==="linear")return r.linear(n);if(t==="relu")return r.relu(n);if(t==="elu")return r.elu(n);if(t==="relu6")return r.relu6(n);if(t==="prelu")return r.prelu(n,e);throw new Error("Activation "+t+" has not been implemented for the CPU backend.")}var GA=(function(r){function n(){var t=r.call(this)||this;return t.blockSize=48,t.firstUse=!0,t.data=new m1(t,W),t}return sr(n,r),n.prototype.write=function(t,e,a){this.firstUse&&(this.firstUse=!1,st().get("IS_NODE")&&Ol(`
============================
Hi there . Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.
============================`));var u={};return this.data.set(u,{values:t,dtype:a}),u},n.prototype.move=function(t,e,a,u){this.data.set(t,{values:e,dtype:u})},n.prototype.numDataIds=function(){return this.data.numDataIds()},n.prototype.read=function(t){return bt(this,void 0,void 0,(function(){return xt(this,(function(e){return[2,this.readSync(t)]}))}))},n.prototype.readSync=function(t){var e=this.data.get(t),a=e.dtype,u=e.complexTensors;return a==="complex64"?bd(this.readSync(u.real.dataId),this.readSync(u.imag.dataId)):this.data.get(t).values},n.prototype.bufferSync=function(t){var e=this.readSync(t.dataId),a=e;if(t.dtype==="string")try{a=e.map((function(u){return Dl(u)}))}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return kt(t.shape,t.dtype,a)},n.prototype.makeOutput=function(t,e,a){var u=this.write(t,e,a);return W.makeTensorFromDataId(u,e,a,this)},n.prototype.disposeData=function(t){if(this.data.has(t)){var e=this.data.get(t).complexTensors;e!=null&&(e.real.dispose(),e.imag.dispose()),this.data.delete(t)}},n.prototype.time=function(t){return bt(this,void 0,void 0,(function(){var e;return xt(this,(function(a){return e=yr(),t(),[2,{kernelMs:yr()-e}]}))}))},n.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},n.prototype.complex=function(t,e){var a=this.makeOutput(null,t.shape,"complex64");return this.data.get(a.dataId).complexTensors={real:W.keep(t.clone()),imag:W.keep(e.clone())},a},n.prototype.real=function(t){return this.data.get(t.dataId).complexTensors.real.clone()},n.prototype.imag=function(t){return this.data.get(t.dataId).complexTensors.imag.clone()},n.prototype.slice=function(t,e,a){if(ft(t,"slice"),p1(t.shape,e,a)){var u=v1(e,t.strides),s=_t(a);return Ze(this.readSync(t.dataId).subarray(u,u+s),a,t.dtype)}for(var l=kt(a,t.dtype),f=this.bufferSync(t),h=0;h<l.size;++h){var p=l.indexToLoc(h).map((function(v,m){return v+e[m]}));l.values[h]=f.get.apply(f,p)}return l.toTensor()},n.prototype.stridedSlice=function(t,e,a,u){ft(t,"stridedSlice");var s=Fd(e,a,u);if(s.some((function(y){return y===0})))return Ze([],s);for(var l=kt(s,t.dtype),f=this.bufferSync(t),h=0;h<l.size;h++){for(var p=l.indexToLoc(h),v=new Array(p.length),m=0;m<v.length;m++)v[m]=p[m]*u[m]+e[m];l.set.apply(l,[f.get.apply(f,v)].concat(p))}return l.toTensor()},n.prototype.diag=function(t){for(var e=this.readSync(t.dataId),a=kt([t.size,t.size],t.dtype),u=a.values,s=0;s<e.length;s++)u[s*t.size+s]=e[s];return a.toTensor()},n.prototype.unstack=function(t,e){for(var a=t.shape[e],u=new Array(t.rank-1),s=0,l=0;l<t.rank;l++)l!==e&&(u[s++]=t.shape[l]);var f=new Array(t.rank).fill(0),h=t.shape.slice();h[e]=1;var p=new Array(a);for(l=0;l<p.length;l++)f[e]=l,p[l]=this.slice(t,f,h).reshape(u);return p},n.prototype.reverse=function(t,e){ft(t,"reverse");for(var a=kt(t.shape,t.dtype),u=this.bufferSync(t),s=function(f){var h=a.indexToLoc(f),p=h.slice();e.forEach((function(v){return p[v]=t.shape[v]-1-p[v]})),a.set.apply(a,[u.get.apply(u,p)].concat(h))},l=0;l<a.size;l++)s(l);return a.toTensor()},n.prototype.concat=function(t,e){var a=this;if(t[0].dtype==="complex64"){var u=t.map((function(y){return Zn(y)})),s=t.map((function(y){return xr(y)}));return Ye(this.concat(u,e),this.concat(s,e))}var l=t.map((function(y){var x=_t(y.shape.slice(e));return y.as2D(-1,x)})),f=Co(l.map((function(y){return y.shape})),1),h=kt(f,t[0].dtype).values;if(l[0].shape[0]===1){var p=0;l.forEach((function(y){h.set(a.readSync(y.dataId),p),p+=y.size}))}else{var v=0;l.forEach((function(y){for(var x=a.readSync(y.dataId),w=0,_=0;_<y.shape[0];++_)for(var E=_*f[1]+v,R=0;R<y.shape[1];++R)h[E+R]=x[w++];v+=y.shape[1]}))}var m=Co(t.map((function(y){return y.shape})),e);return Ze(h,m,t[0].dtype)},n.prototype.neg=function(t){return ft(t,"neg"),this.multiply(pt(-1),t)},n.prototype.add=function(t,e){return t.dtype==="complex64"||e.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),e.cast("complex64"),(function(a,u,s,l){return{real:a+s,imag:u+l}})):this.broadcastedBinaryOp(t,e,Qe(t.dtype,e.dtype),(function(a,u){return a+u}))},n.prototype.addN=function(t){var e=this;ft(t,"addN");for(var a=t.map((function(p){return e.readSync(p.dataId)})),u=kt(t[0].shape,t[0].dtype),s=u.values,l=0;l<t.length;l++)for(var f=a[l],h=0;h<s.length;h++)s[h]+=f[h];return u.toTensor()},n.prototype.softmax=function(t,e){var a=Fe([e],t.shape),u=this.max(t,a),s=bn(u.shape,a),l=this.subtract(t,u.reshape(s)),f=this.exp(l),h=this.sum(f,a).reshape(s);return this.realDivide(f,h)},n.prototype.subtract=function(t,e){return t.dtype==="complex64"||e.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),e.cast("complex64"),(function(a,u,s,l){return{real:a-s,imag:u-l}})):this.broadcastedBinaryOp(t,e,Qe(t.dtype,e.dtype),(function(a,u){return a-u}))},n.prototype.pow=function(t,e){return ft([t,e],"pow"),this.broadcastedBinaryOp(t,e,t.dtype,(function(a,u){return Math.pow(a,u)}))},n.prototype.batchMatMul=function(t,e,a,u){ft([t,e],"matMul");for(var s=a?t.shape[1]:t.shape[2],l=a?t.shape[2]:t.shape[1],f=u?e.shape[1]:e.shape[2],h=t.shape[0],p=this.readSync(t.dataId),v=this.readSync(e.dataId),m=a?[t.strides[0],1,t.strides[1]]:[t.strides[0],t.strides[1],1],y=m[0],x=m[1],w=m[2],_=u?[1,e.strides[1],e.strides[0]]:[e.strides[1],1,e.strides[0]],E=_[0],R=_[1],A=_[2],S=l*f,T=kt([h,l,f],t.dtype),N=T.values,O=this.blockSize,B=0;B<h;B++)for(var I=0;I<l;I+=O)for(var F=0;F<f;F+=O)for(var G=0;G<s;G+=O)for(var H=Math.min(I+O,l),at=Math.min(F+O,f),et=Math.min(G+O,s),nt=I;nt<H;nt++)for(var L=F;L<at;L++){for(var q=0,K=G;K<et;K++)q+=p[B*y+nt*x+K*w]*v[K*E+L*R+B*A];N[B*S+(nt*f+L)]+=q}return T.toTensor()},n.prototype.fusedBatchMatMul=function(t){var e=t.a,a=t.b,u=t.transposeA,s=t.transposeB,l=t.bias,f=t.activation,h=t.preluActivationWeights,p=this.batchMatMul(e,a,u,s);return l&&(p=this.add(p,l)),f&&(p=Qh(this,p,f,h)),p},n.prototype.multiply=function(t,e){return t.dtype==="complex64"||e.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),e.cast("complex64"),(function(a,u,s,l){return{real:a*s-u*l,imag:a*l+u*s}})):this.broadcastedBinaryOp(t,e,Qe(t.dtype,e.dtype),(function(a,u){return a*u}))},n.prototype.realDivide=function(t,e){return ft([t,e],"realDivide"),this.broadcastedBinaryOp(t,e,"float32",(function(a,u){return a/u}))},n.prototype.floorDiv=function(t,e){return ft([t,e],"floorDiv"),this.broadcastedBinaryOp(t,e,"int32",(function(a,u){return Math.floor(a/u)}))},n.prototype.sum=function(t,e){ft(t,"sum"),Mn("sum",e,t.rank);for(var a=$e(t.shape,e),u=a[0],s=a[1],l=he(u,Qe(t.dtype,"int32")),f=_t(s),h=this.readSync(l.dataId),p=this.readSync(t.dataId),v=0;v<h.length;++v){for(var m=v*f,y=0,x=0;x<f;++x)y+=p[m+x];h[v]=y}return l},n.prototype.prod=function(t,e){ft(t,"sum");for(var a=$e(t.shape,e),u=a[0],s=a[1],l=he(u,Qe(t.dtype,"int32")),f=_t(s),h=this.readSync(l.dataId),p=this.readSync(t.dataId),v=0;v<h.length;++v){for(var m=v*f,y=1,x=0;x<f;++x)y*=p[m+x];h[v]=y}return l},n.prototype.unsortedSegmentSum=function(t,e,a){ft(t,"unsortedSegmentSum");for(var u=[],s=t.rank-e.rank,l=0;l<s;++l)e=e.expandDims(l+1);for(l=0;l<a;++l){var f=pt(l,"int32"),h=X1(f,e).asType("float32").mul(t).sum(0);u.push(h)}return Fn(u)},n.prototype.argMin=function(t,e){ft(t,"argMin");var a=[e];Mn("argMin",a,t.rank);for(var u=$e(t.shape,a),s=u[0],l=u[1],f=he(s,"int32"),h=_t(l),p=this.readSync(f.dataId),v=this.readSync(t.dataId),m=0;m<p.length;++m){for(var y=m*h,x=v[y],w=0,_=0;_<h;++_){var E=v[y+_];E<x&&(x=E,w=_)}p[m]=w}return f},n.prototype.argMax=function(t,e){ft(t,"argMax");var a=[e];Mn("argMax",a,t.rank);for(var u=$e(t.shape,a),s=u[0],l=u[1],f=he(s,"int32"),h=_t(l),p=this.readSync(f.dataId),v=this.readSync(t.dataId),m=0;m<p.length;++m){for(var y=m*h,x=v[y],w=0,_=0;_<h;++_){var E=v[y+_];E>x&&(x=E,w=_)}p[m]=w}return f},n.prototype.cumsum=function(t,e,a,u){if(ft(t,"cumsum"),e!==t.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(t.rank-1)+" but got axis="+e);for(var s=Qe(t.dtype,"int32"),l=he(t.shape,s),f=this.readSync(l.dataId),h=this.readSync(t.dataId),p=t.shape[t.rank-1],v=u?function(_,E){return _+p-E-1}:function(_,E){return _+E},m=0;m<h.length;m+=p)for(var y=0;y<p;y++){var x=v(m,y);if(y===0)f[x]=a?0:h[x];else{var w=v(m,y-1);f[x]=a?h[w]+f[w]:h[x]+f[w]}}return l},n.prototype.equal=function(t,e){return ft([t,e],"equal"),this.broadcastedBinaryOp(t,e,"bool",(function(a,u){return a===u?1:0}))},n.prototype.notEqual=function(t,e){return ft([t,e],"notEqual"),this.broadcastedBinaryOp(t,e,"bool",(function(a,u){return a!==u?1:0}))},n.prototype.less=function(t,e){return ft([t,e],"less"),this.broadcastedBinaryOp(t,e,"bool",(function(a,u){return a<u?1:0}))},n.prototype.lessEqual=function(t,e){return ft([t,e],"lessEqual"),this.broadcastedBinaryOp(t,e,"bool",(function(a,u){return a<=u?1:0}))},n.prototype.greater=function(t,e){return ft([t,e],"greater"),this.broadcastedBinaryOp(t,e,"bool",(function(a,u){return a>u?1:0}))},n.prototype.greaterEqual=function(t,e){return ft([t,e],"greaterEqual"),this.broadcastedBinaryOp(t,e,"bool",(function(a,u){return a>=u?1:0}))},n.prototype.logicalNot=function(t){ft(t,"logicalNot");for(var e=this.readSync(t.dataId),a=new Uint8Array(e.length),u=0;u<e.length;++u)a[u]=e[u]?0:1;return this.makeOutput(a,t.shape,"bool")},n.prototype.logicalAnd=function(t,e){return ft([t,e],"logicalAnd"),this.broadcastedBinaryOp(t,e,"bool",(function(a,u){return a&&u}))},n.prototype.logicalOr=function(t,e){return ft([t,e],"logicalOr"),this.broadcastedBinaryOp(t,e,"bool",(function(a,u){return a||u}))},n.prototype.select=function(t,e,a){ft([t,e,a],"select");for(var u=this.readSync(t.dataId),s=this.readSync(e.dataId),l=this.readSync(a.dataId),f=he(e.shape,Qe(e.dtype,a.dtype)),h=this.readSync(f.dataId),p=0,v=t.rank===0||t.rank>1||e.rank===1?1:_t(e.shape.slice(1)),m=0;m<u.length;m++)for(var y=0;y<v;y++)u[m]===1?h[p++]=s[m]:h[p++]=l[m];return f},n.prototype.where=function(t){ft([t],"where");var e=this.readSync(t.dataId);return Pd(t.shape,e)},n.prototype.topk=function(t,e,a){return ft(t,"topk"),C1(this.readSync(t.dataId),t.shape,t.dtype,e)},n.prototype.min=function(t,e){ft(t,"min"),Mn("min",e,t.rank);for(var a=$e(t.shape,e),u=a[0],s=a[1],l=he(u,t.dtype),f=_t(s),h=this.readSync(l.dataId),p=this.readSync(t.dataId),v=0;v<h.length;++v){for(var m=v*f,y=p[m],x=0;x<f;++x){var w=p[m+x];w<y&&(y=w)}h[v]=y}return l},n.prototype.minimum=function(t,e){return ft([t,e],"minimum"),this.broadcastedBinaryOp(t,e,t.dtype,(function(a,u){return Math.min(a,u)}))},n.prototype.mod=function(t,e){return ft([t,e],"mod"),this.broadcastedBinaryOp(t,e,t.dtype,(function(a,u){var s=a%u;return a<0&&u<0||a>=0&&u>=0?s:(s+u)%u}))},n.prototype.max=function(t,e){ft(t,"max"),Mn("max",e,t.rank);for(var a=$e(t.shape,e),u=a[0],s=a[1],l=he(u,t.dtype),f=_t(s),h=this.readSync(l.dataId),p=this.readSync(t.dataId),v=0;v<h.length;++v){for(var m=v*f,y=p[m],x=0;x<f;++x){var w=p[m+x];w>y&&(y=w)}h[v]=y}return l},n.prototype.maximum=function(t,e){return ft([t,e],"maximum"),this.broadcastedBinaryOp(t,e,t.dtype,(function(a,u){return Math.max(a,u)}))},n.prototype.all=function(t,e){ft(t,"all"),Mn("all",e,t.rank);for(var a=$e(t.shape,e),u=a[0],s=a[1],l=he(u,t.dtype),f=_t(s),h=this.readSync(l.dataId),p=this.readSync(t.dataId),v=0;v<h.length;++v){for(var m=v*f,y=p[m],x=0;x<f;++x){var w=p[m+x];y=y&&w}h[v]=y}return l},n.prototype.any=function(t,e){ft(t,"any"),Mn("any",e,t.rank);for(var a=$e(t.shape,e),u=a[0],s=a[1],l=he(u,t.dtype),f=_t(s),h=this.readSync(l.dataId),p=this.readSync(t.dataId),v=0;v<h.length;++v){for(var m=v*f,y=p[m],x=0;x<f;++x){var w=p[m+x];y=y||w}h[v]=y}return l},n.prototype.squaredDifference=function(t,e){return ft([t,e],"squaredDifference"),this.broadcastedBinaryOp(t,e,t.dtype,(function(a,u){var s=a-u;return s*s}))},n.prototype.ceil=function(t){ft(t,"ceil");for(var e=this.readSync(t.dataId),a=new Float32Array(e.length),u=0;u<e.length;++u)a[u]=Math.ceil(e[u]);return this.makeOutput(a,t.shape,"float32")},n.prototype.floor=function(t){ft(t,"floor");for(var e=this.readSync(t.dataId),a=new Float32Array(e.length),u=0;u<e.length;++u)a[u]=Math.floor(e[u]);return this.makeOutput(a,t.shape,"float32")},n.prototype.sign=function(t){ft(t,"x");for(var e=this.readSync(t.dataId),a=new Float32Array(e.length),u=0;u<e.length;++u)e[u]<0?a[u]=-1:e[u]>0?a[u]=1:a[u]=0;return this.makeOutput(a,t.shape,"float32")},n.prototype.isNaN=function(t){ft(t,"x");for(var e=this.readSync(t.dataId),a=new Uint8Array(e.length),u=0;u<e.length;++u)Number.isNaN(e[u])&&(a[u]=1);return this.makeOutput(a,t.shape,"bool")},n.prototype.isInf=function(t){ft(t,"x");for(var e=this.readSync(t.dataId),a=new Uint8Array(e.length),u=0;u<e.length;++u)Math.abs(e[u])===1/0&&(a[u]=1);return this.makeOutput(a,t.shape,"bool")},n.prototype.isFinite=function(t){ft(t,"x");for(var e=this.readSync(t.dataId),a=new Uint8Array(e.length),u=0;u<e.length;++u)Number.isFinite(e[u])&&(a[u]=1);return this.makeOutput(a,t.shape,"bool")},n.prototype.round=function(t){ft(t,"round");for(var e=this.readSync(t.dataId),a=new Float32Array(e.length),u=0;u<e.length;++u){var s=Math.floor(e[u]);e[u]-s<.5?a[u]=Math.floor(e[u]):e[u]-s>.5?a[u]=Math.ceil(e[u]):a[u]=s%2==0?s:s+1}return this.makeOutput(a,t.shape,"float32")},n.prototype.exp=function(t){ft(t,"exp");for(var e=this.readSync(t.dataId),a=new Float32Array(e.length),u=0;u<e.length;++u)a[u]=Math.exp(e[u]);return this.makeOutput(a,t.shape,"float32")},n.prototype.expm1=function(t){ft(t,"expm1");for(var e=this.readSync(t.dataId),a=new Float32Array(e.length),u=0;u<e.length;++u)a[u]=Math.expm1(e[u]);return this.makeOutput(a,t.shape,"float32")},n.prototype.log=function(t){ft(t,"log");for(var e=this.readSync(t.dataId),a=new Float32Array(e.length),u=0;u<e.length;++u){var s=e[u];a[u]=Math.log(s)}return this.makeOutput(a,t.shape,"float32")},n.prototype.log1p=function(t){ft(t,"log1p");for(var e=this.readSync(t.dataId),a=new Float32Array(e.length),u=0;u<e.length;++u){var s=e[u];a[u]=Math.log1p(s)}return this.makeOutput(a,t.shape,"float32")},n.prototype.sqrt=function(t){ft(t,"sqrt");for(var e=this.readSync(t.dataId),a=new Float32Array(e.length),u=0;u<e.length;++u){var s=e[u];a[u]=Math.sqrt(s)}return this.makeOutput(a,t.shape,"float32")},n.prototype.rsqrt=function(t){ft(t,"rsqrt");for(var e=this.readSync(t.dataId),a=new Float32Array(e.length),u=0;u<e.length;++u){var s=e[u];a[u]=1/Math.sqrt(s)}return this.makeOutput(a,t.shape,"float32")},n.prototype.reciprocal=function(t){ft(t,"reciprocal");for(var e=this.readSync(t.dataId),a=new Float32Array(e.length),u=0;u<e.length;++u)a[u]=1/e[u];return this.makeOutput(a,t.shape,"float32")},n.prototype.linear=function(t){return t},n.prototype.relu=function(t){ft(t,"relu");for(var e=he(t.shape,t.dtype),a=this.readSync(e.dataId),u=this.readSync(t.dataId),s=0;s<u.length;++s)a[s]=Math.max(0,u[s]);return e},n.prototype.relu6=function(t){ft(t,"relu");for(var e=he(t.shape,t.dtype),a=this.readSync(e.dataId),u=this.readSync(t.dataId),s=0;s<u.length;++s)a[s]=Math.min(Math.max(0,u[s]),6);return e},n.prototype.prelu=function(t,e){return ft([t,e],"prelu"),this.broadcastedBinaryOp(t,e,t.dtype,(function(a,u){return a<0?u*a:a}))},n.prototype.elu=function(t){ft(t,"elu");for(var e=new Float32Array(t.size),a=this.readSync(t.dataId),u=0;u<a.length;++u){var s=a[u];e[u]=s>=0?s:Math.exp(s)-1}return this.makeOutput(e,t.shape,"float32")},n.prototype.eluDer=function(t,e){ft([t,e],"eluDer");for(var a=new Float32Array(e.size),u=this.readSync(e.dataId),s=this.readSync(t.dataId),l=0;l<u.length;++l){var f=u[l];a[l]=f>=1?s[l]:s[l]*(f+1)}return this.makeOutput(a,e.shape,"float32")},n.prototype.selu=function(t){ft(t,"selu");for(var e=Vd,a=Gd,u=new Float32Array(t.size),s=this.readSync(t.dataId),l=0;l<s.length;++l){var f=s[l];u[l]=f>=0?a*f:e*(Math.exp(f)-1)}return this.makeOutput(u,t.shape,"float32")},n.prototype.clip=function(t,e,a){ft(t,"clip");for(var u=new Float32Array(t.size),s=this.readSync(t.dataId),l=0;l<s.length;++l){var f=s[l];u[l]=f>a?a:f<e?e:f}return this.makeOutput(u,t.shape,"float32")},n.prototype.abs=function(t){for(var e=new Float32Array(t.size),a=this.readSync(t.dataId),u=0;u<a.length;++u)e[u]=Math.abs(a[u]);return this.makeOutput(e,t.shape,"float32")},n.prototype.complexAbs=function(t){for(var e=new Float32Array(t.size),a=this.readSync(t.dataId),u=0;u<t.size;++u){var s=a[2*u],l=a[2*u+1];e[u]=Math.hypot(s,l)}return this.makeOutput(e,t.shape,"float32")},n.prototype.int=function(t){ft(t,"int");for(var e=new Int32Array(t.size),a=this.readSync(t.dataId),u=0;u<a.length;++u)e[u]=a[u];return this.makeOutput(e,t.shape,"int32")},n.prototype.sigmoid=function(t){ft(t,"sigmoid");for(var e=new Float32Array(t.size),a=this.readSync(t.dataId),u=0;u<a.length;++u)e[u]=1/(1+Math.exp(-a[u]));return this.makeOutput(e,t.shape,"float32")},n.prototype.softplus=function(t){ft(t,"softplus");for(var e=Math.log(11920928955078125e-23)+2,a=new Float32Array(t.size),u=this.readSync(t.dataId),s=0;s<u.length;++s){var l=u[s]>-e,f=u[s]<e,h=Math.exp(u[s]),p=void 0;p=f?h:l?u[s]:Math.log(1+h),a[s]=p}return this.makeOutput(a,t.shape,"float32")},n.prototype.sin=function(t){ft(t,"sin");for(var e=new Float32Array(t.size),a=this.readSync(t.dataId),u=0;u<a.length;++u)e[u]=Math.sin(a[u]);return this.makeOutput(e,t.shape,"float32")},n.prototype.cos=function(t){ft(t,"cos");for(var e=new Float32Array(t.size),a=this.readSync(t.dataId),u=0;u<a.length;++u)e[u]=Math.cos(a[u]);return this.makeOutput(e,t.shape,"float32")},n.prototype.tan=function(t){ft(t,"tan");for(var e=new Float32Array(t.size),a=this.readSync(t.dataId),u=0;u<a.length;++u)e[u]=Math.tan(a[u]);return this.makeOutput(e,t.shape,"float32")},n.prototype.asin=function(t){ft(t,"asin");for(var e=new Float32Array(t.size),a=this.readSync(t.dataId),u=0;u<a.length;++u)e[u]=Math.asin(a[u]);return this.makeOutput(e,t.shape,"float32")},n.prototype.acos=function(t){ft(t,"acos");for(var e=new Float32Array(t.size),a=this.readSync(t.dataId),u=0;u<a.length;++u)e[u]=Math.acos(a[u]);return this.makeOutput(e,t.shape,"float32")},n.prototype.atan=function(t){ft(t,"atan");for(var e=new Float32Array(t.size),a=this.readSync(t.dataId),u=0;u<a.length;++u)e[u]=Math.atan(a[u]);return this.makeOutput(e,t.shape,"float32")},n.prototype.atan2=function(t,e){return ft([t,e],"atan2"),this.broadcastedBinaryOp(t,e,t.dtype,(function(a,u){return Math.atan2(a,u)}))},n.prototype.sinh=function(t){ft(t,"sinh");for(var e=new Float32Array(t.size),a=this.readSync(t.dataId),u=0;u<a.length;++u)e[u]=Math.sinh(a[u]);return this.makeOutput(e,t.shape,"float32")},n.prototype.cosh=function(t){ft(t,"cosh");for(var e=new Float32Array(t.size),a=this.readSync(t.dataId),u=0;u<a.length;++u)e[u]=Math.cosh(a[u]);return this.makeOutput(e,t.shape,"float32")},n.prototype.tanh=function(t){ft(t,"tanh");for(var e=new Float32Array(t.size),a=this.readSync(t.dataId),u=0;u<a.length;++u)e[u]=Ww(a[u]);return this.makeOutput(e,t.shape,"float32")},n.prototype.asinh=function(t){ft(t,"asinh");for(var e=new Float32Array(t.size),a=this.readSync(t.dataId),u=0;u<a.length;++u)e[u]=Math.asinh(a[u]);return this.makeOutput(e,t.shape,"float32")},n.prototype.acosh=function(t){ft(t,"acosh");for(var e=new Float32Array(t.size),a=this.readSync(t.dataId),u=0;u<a.length;++u)e[u]=Math.acosh(a[u]);return this.makeOutput(e,t.shape,"float32")},n.prototype.atanh=function(t){ft(t,"atanh");for(var e=new Float32Array(t.size),a=this.readSync(t.dataId),u=0;u<a.length;++u)e[u]=Math.atanh(a[u]);return this.makeOutput(e,t.shape,"float32")},n.prototype.erf=function(t){ft(t,"erf");for(var e=new Float32Array(t.size),a=this.readSync(t.dataId),u=0;u<a.length;++u){var s=Math.sign(a[u]),l=Math.abs(a[u]),f=1/(1+.3275911*l);e[u]=s*(1-((((1.061405429*f-1.453152027)*f+1.421413741)*f-.284496736)*f+.254829592)*f*Math.exp(-l*l))}return this.makeOutput(e,t.shape,"float32")},n.prototype.step=function(t,e){e===void 0&&(e=0),ft(t,"step");for(var a=new Float32Array(t.size),u=this.readSync(t.dataId),s=0;s<u.length;++s){var l=u[s];isNaN(l)?a[s]=NaN:a[s]=l>0?1:e}return this.makeOutput(a,t.shape,"float32")},n.prototype.fusedConv2d=function(t){var e=t.input,a=t.filter,u=t.convInfo,s=t.bias,l=t.activation,f=t.preluActivationWeights,h=this.conv2d(e,a,u);return s&&(h=this.add(h,s)),l&&(h=Qh(this,h,l,f)),h},n.prototype.conv2d=function(t,e,a){ft([t,e],"conv2d");for(var u=a.filterHeight,s=a.filterWidth,l=a.dilationHeight,f=a.dilationWidth,h=a.padInfo.left,p=a.padInfo.top,v=a.dataFormat==="channelsLast",m=kt(a.outShape,t.dtype),y=t.strides[0],x=v?t.strides[1]:t.strides[2],w=v?t.strides[2]:1,_=v?1:t.strides[1],E=m.strides[0],R=v?m.strides[1]:m.strides[2],A=v?m.strides[2]:1,S=v?1:m.strides[1],T=this.readSync(t.dataId),N=this.readSync(e.dataId),O=m.values,B=0;B<a.batchSize;++B)for(var I=B*y,F=B*E,G=0;G<a.outHeight;++G)for(var H=F+G*R,at=G*a.strideHeight-p,et=0;et<u;et++){var nt=at+et*l;if(!(nt<0||nt>=a.inHeight))for(var L=et*e.strides[0],q=I+nt*x,K=0;K<a.outWidth;++K)for(var rt=H+K*A,ot=K*a.strideWidth-h,z=0;z<s;z++){var X=ot+z*f;if(!(X<0||X>=a.inWidth))for(var it=q+X*w,ht=L+z*e.strides[1],dt=0;dt<a.inChannels;++dt){for(var vt=T[it+dt*_],gt=0;gt<a.outChannels;++gt)O[rt+gt*S]+=vt*N[ht+gt];ht+=a.outChannels}}}return m.toTensor()},n.prototype.conv3d=function(t,e,a){for(var u=a.filterDepth,s=a.filterHeight,l=a.filterWidth,f=a.dilationDepth,h=a.dilationHeight,p=a.dilationWidth,v=a.padInfo.front,m=a.padInfo.left,y=a.padInfo.top,x=kt(a.outShape,t.dtype),w=this.readSync(t.dataId),_=this.readSync(e.dataId),E=x.values,R=0;R<a.batchSize;++R)for(var A=R*t.strides[0],S=R*x.strides[0],T=0;T<a.outDepth;++T)for(var N=S+T*x.strides[1],O=T*a.strideDepth-v,B=0;B<u;B++){var I=O+B*f;if(!(I<0||I>=a.inDepth))for(var F=B*e.strides[0],G=A+I*t.strides[1],H=0;H<a.outHeight;++H)for(var at=N+H*x.strides[2],et=H*a.strideHeight-y,nt=0;nt<s;nt++){var L=et+nt*h;if(!(L<0||L>=a.inHeight))for(var q=F+nt*e.strides[1],K=G+L*t.strides[2],rt=0;rt<a.outWidth;++rt)for(var ot=at+rt*a.outChannels,z=rt*a.strideWidth-m,X=0;X<l;X++){var it=z+X*p;if(!(it<0||it>=a.inWidth))for(var ht=q+X*e.strides[2],dt=K+it*a.inChannels,vt=ht,gt=0;gt<a.inChannels;++gt){for(var Tt=w[dt+gt],Rt=0;Rt<a.outChannels;++Rt)E[ot+Rt]+=Tt*_[vt+Rt];vt+=a.outChannels}}}}return x.toTensor()},n.prototype.conv2dDerInput=function(t,e,a){ft([t,e],"conv2dDerInput");for(var u=kt(a.inShape,"float32"),s=u.values,l=this.readSync(t.dataId),f=this.readSync(e.dataId),h=e.strides,p=h[0],v=h[1],m=h[2],y=a.batchSize,x=a.filterHeight,w=a.filterWidth,_=a.inChannels,E=a.inHeight,R=a.inWidth,A=a.outChannels,S=a.outHeight,T=a.outWidth,N=a.strideHeight,O=a.strideWidth,B=a.dataFormat,I=x-1-a.padInfo.top,F=w-1-a.padInfo.left,G=B==="channelsLast",H=u.strides[0],at=G?u.strides[1]:u.strides[2],et=G?u.strides[2]:1,nt=G?1:u.strides[1],L=t.strides[0],q=G?t.strides[1]:t.strides[2],K=G?t.strides[2]:1,rt=G?1:t.strides[1],ot=0;ot<y;++ot)for(var z=0;z<_;++z)for(var X=0;X<E;++X)for(var it=X-I,ht=Math.max(0,Math.ceil(it/N)),dt=Math.min(S,(x+it)/N),vt=0;vt<R;++vt){for(var gt=vt-F,Tt=Math.max(0,Math.ceil(gt/O)),Rt=Math.min(T,(w+gt)/O),ie=0,zt=ht;zt<dt;++zt)for(var Xt=zt*N-it,qt=Tt;qt<Rt;++qt)for(var Jt=L*ot+q*zt+K*qt,oe=p*(x-1-Xt)+v*(w-1-(qt*O-gt))+m*z,ue=0;ue<A;++ue)ie+=l[Jt+rt*ue]*f[oe+ue];s[H*ot+at*X+et*vt+nt*z]=ie}return u.toTensor()},n.prototype.conv3dDerInput=function(t,e,a){for(var u=kt(a.inShape,"float32"),s=u.values,l=u.strides,f=l[0],h=l[1],p=l[2],v=l[3],m=this.readSync(t.dataId),y=t.strides,x=y[0],w=y[1],_=y[2],E=y[3],R=this.readSync(e.dataId),A=e.strides,S=A[0],T=A[1],N=A[2],O=A[3],B=a.batchSize,I=a.filterDepth,F=a.filterHeight,G=a.filterWidth,H=a.inChannels,at=a.inDepth,et=a.inHeight,nt=a.inWidth,L=a.outChannels,q=a.outDepth,K=a.outHeight,rt=a.outWidth,ot=a.strideDepth,z=a.strideHeight,X=a.strideWidth,it=I-1-a.padInfo.front,ht=F-1-a.padInfo.top,dt=G-1-a.padInfo.left,vt=0;vt<B;++vt)for(var gt=0;gt<H;++gt)for(var Tt=0;Tt<at;++Tt)for(var Rt=Tt-it,ie=Math.max(0,Math.ceil(Rt/ot)),zt=Math.min(q,(I+Rt)/ot),Xt=0;Xt<et;++Xt)for(var qt=Xt-ht,Jt=Math.max(0,Math.ceil(qt/z)),oe=Math.min(K,(F+qt)/z),ue=0;ue<nt;++ue){for(var Ln=ue-dt,wn=Math.max(0,Math.ceil(Ln/X)),Ve=Math.min(rt,(G+Ln)/X),cr=0,_n=ie;_n<zt;++_n)for(var fr=_n*ot-Rt,tr=Jt;tr<oe;++tr)for(var Ee=tr*z-qt,er=wn;er<Ve;++er)for(var wi=x*vt+w*_n+_*tr+E*er,Nr=S*(I-1-fr)+T*(F-1-Ee)+N*(G-1-(er*X-Ln))+O*gt,un=0;un<L;++un)cr+=m[wi+un]*R[Nr+un];s[f*vt+h*Tt+p*Xt+v*ue+gt]=cr}return u.toTensor()},n.prototype.conv2dDerFilter=function(t,e,a){ft([t,e],"conv2dDerFilter");for(var u=a.strideHeight,s=a.strideWidth,l=a.filterHeight,f=a.filterWidth,h=a.dataFormat==="channelsLast",p=kt(a.filterShape,"float32"),v=a.padInfo.left,m=a.padInfo.top,y=this.bufferSync(t),x=this.bufferSync(e),w=0;w<l;++w)for(var _=Math.max(0,Math.ceil((m-w)/u)),E=Math.min(a.outHeight,(a.inHeight+m-w)/u),R=0;R<f;++R)for(var A=Math.max(0,Math.ceil((v-R)/s)),S=Math.min(a.outWidth,(a.inWidth+v-R)/s),T=0;T<a.inChannels;++T)for(var N=0;N<a.outChannels;++N){for(var O=0,B=0;B<a.batchSize;++B)for(var I=_;I<E;++I)for(var F=w+I*u-m,G=A;G<S;++G){var H=R+G*s-v;O+=h?y.get(B,F,H,T)*x.get(B,I,G,N):y.get(B,T,F,H)*x.get(B,N,I,G)}p.set(O,w,R,T,N)}return p.toTensor()},n.prototype.conv3dDerFilter=function(t,e,a){for(var u=a.strideDepth,s=a.strideHeight,l=a.strideWidth,f=a.filterDepth,h=a.filterHeight,p=a.filterWidth,v=kt(a.filterShape,"float32"),m=v.values,y=v.strides,x=y[0],w=y[1],_=y[2],E=y[3],R=this.readSync(e.dataId),A=e.strides,S=A[0],T=A[1],N=A[2],O=A[3],B=this.readSync(t.dataId),I=t.strides,F=I[0],G=I[1],H=I[2],at=I[3],et=a.padInfo.front,nt=a.padInfo.left,L=a.padInfo.top,q=0;q<f;++q)for(var K=Math.max(0,Math.ceil((et-q)/u)),rt=Math.min(a.outDepth,(a.inDepth+et-q)/u),ot=q*x,z=0;z<h;++z)for(var X=Math.max(0,Math.ceil((L-z)/s)),it=Math.min(a.outHeight,(a.inHeight+L-z)/s),ht=z*w+ot,dt=0;dt<p;++dt)for(var vt=Math.max(0,Math.ceil((nt-dt)/l)),gt=Math.min(a.outWidth,(a.inWidth+nt-dt)/l),Tt=dt*_+ht,Rt=0;Rt<a.inChannels;++Rt)for(var ie=Rt*E+Tt,zt=0;zt<a.outChannels;++zt){for(var Xt=0,qt=0;qt<a.batchSize;++qt)for(var Jt=qt*F,oe=qt*S,ue=K;ue<rt;++ue)for(var Ln=(q+ue*u-et)*G+Jt,wn=ue*T+oe,Ve=X;Ve<it;++Ve)for(var cr=(z+Ve*s-L)*H+Ln,_n=Ve*N+wn,fr=vt;fr<gt;++fr){var tr=fr*O+_n;Xt+=B[(dt+fr*l-nt)*at+cr+Rt]*R[tr+zt]}m[ie+zt]=Xt}return v.toTensor()},n.prototype.fusedDepthwiseConv2D=function(t){var e=t.input,a=t.filter,u=t.convInfo,s=t.bias,l=t.activation,f=t.preluActivationWeights,h=this.depthwiseConv2D(e,a,u);return s&&(h=this.add(h,s)),l&&(h=Qh(this,h,l,f)),h},n.prototype.depthwiseConv2D=function(t,e,a){ft([t,e],"depthwiseConv2D");for(var u=a.filterHeight,s=a.filterWidth,l=a.dilationHeight,f=a.dilationWidth,h=a.padInfo.left,p=a.padInfo.top,v=a.outChannels/a.inChannels,m=kt(a.outShape,t.dtype),y=this.readSync(t.dataId),x=this.readSync(e.dataId),w=m.values,_=0;_<a.batchSize;++_)for(var E=_*t.strides[0],R=_*m.strides[0],A=0;A<a.outHeight;++A)for(var S=R+A*m.strides[1],T=A*a.strideHeight-h,N=0;N<u;++N){var O=T+N*l;if(!(O<0||O>=a.inHeight))for(var B=N*e.strides[0],I=E+O*t.strides[1],F=0;F<a.outWidth;++F)for(var G=S+F*m.strides[2],H=F*a.strideWidth-p,at=0;at<s;++at){var et=H+at*f;if(!(et<0||et>=a.inWidth))for(var nt=B+at*e.strides[1],L=I+et*a.inChannels,q=G,K=nt,rt=0;rt<a.inChannels;++rt){for(var ot=y[L+rt],z=0;z<v;++z)w[q+z]+=ot*x[K+z];q+=v,K+=v}}}return m.toTensor()},n.prototype.depthwiseConv2DDerInput=function(t,e,a){ft([t,e],"depthwiseConv2DDerInput");for(var u=kt(a.inShape,"float32"),s=u.values,l=u.strides,f=l[0],h=l[1],p=l[2],v=this.readSync(t.dataId),m=t.strides,y=m[0],x=m[1],w=m[2],_=this.readSync(e.dataId),E=e.strides,R=E[0],A=E[1],S=E[2],T=a.batchSize,N=a.filterHeight,O=a.filterWidth,B=a.inChannels,I=a.inHeight,F=a.inWidth,G=a.outChannels,H=a.outHeight,at=a.outWidth,et=a.strideHeight,nt=a.strideWidth,L=N-1-a.padInfo.top,q=O-1-a.padInfo.left,K=G/B,rt=0;rt<T;++rt)for(var ot=0;ot<B;++ot)for(var z=0;z<I;++z)for(var X=z-L,it=Math.max(0,Math.ceil(X/et)),ht=Math.min(H,(N+X)/et),dt=0;dt<F;++dt){for(var vt=dt-q,gt=Math.max(0,Math.ceil(vt/nt)),Tt=Math.min(at,(O+vt)/nt),Rt=0,ie=it;ie<ht;++ie)for(var zt=ie*et-X,Xt=gt;Xt<Tt;++Xt)for(var qt=y*rt+x*ie+w*Xt,Jt=R*(N-1-zt)+A*(O-1-(Xt*nt-vt))+S*ot,oe=0;oe<K;++oe)Rt+=v[qt+(ot*K+oe)]*_[Jt+oe];s[f*rt+h*z+p*dt+ot]=Rt}return u.toTensor()},n.prototype.depthwiseConv2DDerFilter=function(t,e,a){ft([t,e],"depthwiseConv2DDerFilter");for(var u=a.strideHeight,s=a.strideWidth,l=a.filterHeight,f=a.filterWidth,h=kt(a.filterShape,"float32"),p=a.padInfo.left,v=a.padInfo.top,m=a.outChannels/a.inChannels,y=this.bufferSync(t),x=this.bufferSync(e),w=0;w<l;++w)for(var _=Math.max(0,Math.ceil((v-w)/u)),E=Math.min(a.outHeight,(a.inHeight+v-w)/u),R=0;R<f;++R)for(var A=Math.max(0,Math.ceil((p-R)/s)),S=Math.min(a.outWidth,(a.inWidth+p-R)/s),T=0;T<a.outChannels;++T){for(var N=Math.trunc(T/m),O=T%m,B=0,I=0;I<a.batchSize;++I)for(var F=_;F<E;++F)for(var G=w+F*u-v,H=A;H<S;++H){var at=R+H*s-p;B+=y.get(I,G,at,N)*x.get(I,F,H,T)}h.set(B,w,R,N,O)}return h.toTensor()},n.prototype.tile=function(t,e){return ft(t,"tile"),E1(this.bufferSync(t),e)},n.prototype.pad=function(t,e,a){ft(t,"pad");var u=e.map((function(m,y){return m[0]+t.shape[y]+m[1]})),s=e.map((function(m){return m[0]})),l=this.bufferSync(t),f=kt(u,t.dtype);a!==0&&f.values.fill(a);for(var h=0;h<t.size;h++){var p=l.indexToLoc(h),v=p.map((function(m,y){return m+s[y]}));f.set.apply(f,[l.get.apply(l,p)].concat(v))}return f.toTensor()},n.prototype.transpose=function(t,e){ft(t,"transpose");for(var a=new Array(t.rank),u=0;u<a.length;u++)a[u]=t.shape[e[u]];var s=this.readSync(t.dataId),l=kt(a,t.dtype),f=this.bufferSync(t);for(u=0;u<t.size;++u){for(var h=f.indexToLoc(u),p=new Array(h.length),v=0;v<p.length;v++)p[v]=h[e[v]];var m=l.locToIndex(p);l.values[m]=s[u]}return l.toTensor()},n.prototype.gather=function(t,e,a){ft([t,e],"gather");var u=t.shape.slice(),s=this.readSync(e.dataId);u[a]=s.length;for(var l=kt(u,t.dtype),f=this.bufferSync(t),h=0;h<l.size;++h){var p=l.indexToLoc(h),v=p.slice();v[a]=s[p[a]];var m=f.locToIndex(v);l.values[h]=f.values[m]}return l.toTensor()},n.prototype.batchToSpaceND=function(t,e,a){ft([t],"batchToSpaceND");var u=e.reduce((function(v,m){return v*m})),s=Bl(t.shape,e,u),l=Fl(s.length,e.length),f=zl(t.shape,e,u),h=c1(a,e.length),p=f1(f,a,e.length);return t.reshape(s).transpose(l).reshape(f).slice(h,p)},n.prototype.spaceToBatchND=function(t,e,a){ft([t],"spaceToBatchND");var u=e.reduce((function(m,y){return m*y})),s=[[0,0]];s.push.apply(s,a);for(var l=1+e.length;l<t.shape.length;++l)s.push([0,0]);var f=t.pad(s),h=Bl(f.shape,e,u,!1),p=Fl(h.length,e.length,!1),v=zl(f.shape,e,u,!1);return f.reshape(h).transpose(p).reshape(v)},n.prototype.pool=function(t,e,a){ft(t,"pool");for(var u=e.strideHeight,s=e.strideWidth,l=e.dilationHeight,f=e.dilationWidth,h=e.effectiveFilterHeight,p=e.effectiveFilterWidth,v=e.padInfo.top,m=e.padInfo.left,y=a==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,x=this.readSync(t.dataId),w=kt(e.outShape,t.dtype),_=w.values,E=e.outShape[1]*e.outShape[2]*e.outShape[3],R=e.outShape[2]*e.outShape[3],A=e.outShape[3],S=0;S<e.batchSize;++S)for(var T=S*E,N=S*t.strides[0],O=0;O<e.inChannels;++O)for(var B=0;B<e.outHeight;++B)for(var I=B*u-v,F=Math.max(0,I),G=Math.min(e.inHeight,h+I),H=T+B*R,at=0;at<e.outWidth;++at){for(var et=at*s-m,nt=Math.max(0,et),L=Math.min(e.inWidth,p+et),q=y,K=0,rt=0,ot=F;ot<G;ot+=l){for(var z=N+ot*t.strides[1],X=nt;X<L;X+=f){var it=x[z+X*t.strides[2]+O];a==="max"&&it>q?q=it:a==="avg"&&(K+=it,rt++)}if(isNaN(q))break}_[H+at*A+O]=a==="avg"?K/rt:q}return w.toTensor()},n.prototype.maxPool=function(t,e){return this.pool(t,e,"max")},n.prototype.maxPoolPositions=function(t,e){for(var a=kt(e.outShape,"int32"),u=e.strideHeight,s=e.strideWidth,l=e.dilationHeight,f=e.dilationWidth,h=e.effectiveFilterHeight,p=e.effectiveFilterWidth,v=e.padInfo.top,m=e.padInfo.left,y=this.bufferSync(t),x=0;x<e.batchSize;++x)for(var w=0;w<e.inChannels;++w)for(var _=0;_<e.outHeight;++_){for(var E=_*u-v,R=E;R<0;)R+=l;for(var A=Math.min(e.inHeight,h+E),S=0;S<e.outWidth;++S){for(var T=S*s-m,N=T;N<0;)N+=f;for(var O=Math.min(e.inWidth,p+T),B=Number.NEGATIVE_INFINITY,I=-1,F=R;F<A;F+=l)for(var G=F-E,H=N;H<O;H+=f){var at=H-T,et=y.get(x,F,H,w);et>B&&(B=et,I=G*p+at)}a.set(I,x,_,S,w)}}return a.toTensor()},n.prototype.maxPoolBackprop=function(t,e,a,u){ft([e,a],"maxPoolBackprop");for(var s=this.maxPoolPositions(e,u),l=u.strideHeight,f=u.strideWidth,h=u.dilationHeight,p=u.dilationWidth,v=u.effectiveFilterHeight,m=u.effectiveFilterWidth,y=m-1-u.padInfo.left,x=v-1-u.padInfo.top,w=kt(e.shape,"float32"),_=this.bufferSync(s),E=this.bufferSync(t),R=0;R<u.batchSize;++R)for(var A=0;A<u.inChannels;++A)for(var S=0;S<u.inHeight;++S)for(var T=0;T<u.inWidth;++T){for(var N=S-x,O=T-y,B=0,I=0;I<v;I+=h){var F=(N+I)/l;if(!(F<0||F>=u.outHeight||Math.floor(F)!==F))for(var G=0;G<m;G+=p){var H=(O+G)/f;if(!(H<0||H>=u.outWidth||Math.floor(H)!==H)){var at=v*m-1-_.get(R,F,H,A)===I*m+G?1:0;at!==0&&(B+=E.get(R,F,H,A)*at)}}}w.set(B,R,S,T,A)}return w.toTensor()},n.prototype.avgPoolBackprop=function(t,e,a){ft([t,e],"avgPoolBackprop");for(var u=a.strideHeight,s=a.strideWidth,l=a.filterHeight,f=a.filterWidth,h=a.dilationHeight,p=a.dilationWidth,v=a.effectiveFilterHeight,m=a.effectiveFilterWidth,y=m-1-a.padInfo.left,x=v-1-a.padInfo.top,w=kt(e.shape,"float32"),_=1/(l*f),E=this.bufferSync(t),R=0;R<a.batchSize;++R)for(var A=0;A<a.inChannels;++A)for(var S=0;S<a.inHeight;++S)for(var T=0;T<a.inWidth;++T){for(var N=S-x,O=T-y,B=0,I=0;I<v;I+=h){var F=(N+I)/u;if(!(F<0||F>=a.outHeight||Math.floor(F)!==F))for(var G=0;G<m;G+=p){var H=(O+G)/s;H<0||H>=a.outWidth||Math.floor(H)!==H||(B+=E.get(R,F,H,A))}}w.set(B*_,R,S,T,A)}return w.toTensor()},n.prototype.pool3d=function(t,e,a){ft(t,"pool3d");for(var u=e.strideDepth,s=e.strideHeight,l=e.strideWidth,f=e.dilationDepth,h=e.dilationHeight,p=e.dilationWidth,v=e.effectiveFilterDepth,m=e.effectiveFilterHeight,y=e.effectiveFilterWidth,x=e.padInfo.front,w=e.padInfo.top,_=e.padInfo.left,E=a==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,R=this.readSync(t.dataId),A=kt(e.outShape,t.dtype),S=A.values,T=e.outShape[1]*e.outShape[2]*e.outShape[3]*e.outShape[4],N=e.outShape[2]*e.outShape[3]*e.outShape[4],O=e.outShape[3]*e.outShape[4],B=e.outShape[4],I=0;I<e.batchSize;++I)for(var F=I*T,G=I*t.strides[0],H=0;H<e.inChannels;++H)for(var at=0;at<e.outDepth;++at){for(var et=at*u-x,nt=et;nt<0;)nt+=f;for(var L=Math.min(e.inDepth,v+et),q=F+at*N,K=0;K<e.outHeight;++K){for(var rt=K*s-w,ot=rt;ot<0;)ot+=h;for(var z=Math.min(e.inHeight,m+rt),X=q+K*O,it=0;it<e.outWidth;++it){for(var ht=it*l-_,dt=ht;dt<0;)dt+=p;for(var vt=Math.min(e.inWidth,y+ht),gt=X+it*B,Tt=E,Rt=0,ie=0,zt=nt;zt<L;zt+=f){for(var Xt=G+zt*t.strides[1],qt=ot;qt<z;qt+=h){for(var Jt=Xt+qt*t.strides[2],oe=dt;oe<vt;oe+=p){var ue=R[Jt+oe*t.strides[3]+H];if(a==="max"&&ue>Tt?Tt=ue:a==="avg"&&(Rt+=ue,ie++),isNaN(Tt))break}if(isNaN(Tt))break}if(isNaN(Tt))break}S[gt+H]=a==="avg"?Rt/ie:Tt}}}return A.toTensor()},n.prototype.avgPool3d=function(t,e){return ft(t,"avgPool3d"),this.pool3d(t,e,"avg").toFloat()},n.prototype.avgPool3dBackprop=function(t,e,a){ft([t,e],"avgPool3dBackprop");for(var u=a.strideDepth,s=a.strideHeight,l=a.strideWidth,f=a.filterDepth,h=a.filterHeight,p=a.filterWidth,v=a.dilationDepth,m=a.dilationHeight,y=a.dilationWidth,x=a.effectiveFilterDepth,w=a.effectiveFilterHeight,_=a.effectiveFilterWidth,E=x-1-a.padInfo.front,R=_-1-a.padInfo.left,A=w-1-a.padInfo.top,S=kt(e.shape,"float32"),T=1/(f*h*p),N=this.bufferSync(t),O=0;O<a.batchSize;++O)for(var B=0;B<a.inChannels;++B)for(var I=0;I<a.inDepth;++I)for(var F=0;F<a.inHeight;++F)for(var G=0;G<a.inWidth;++G){for(var H=I-E,at=F-A,et=G-R,nt=0,L=0;L<x;L+=v){var q=(H+L)/u;if(!(q<0||q>=a.outDepth||Math.floor(q)!==q))for(var K=0;K<w;K+=m){var rt=(at+K)/s;if(!(rt<0||rt>=a.outHeight||Math.floor(rt)!==rt))for(var ot=0;ot<_;ot+=y){var z=(et+ot)/l;z<0||z>=a.outWidth||Math.floor(z)!==z||(nt+=N.get(O,q,rt,z,B))}}}S.set(nt*T,O,I,F,G,B)}return S.toTensor()},n.prototype.maxPool3d=function(t,e){return ft(t,"maxPool3d"),this.pool3d(t,e,"max").toFloat()},n.prototype.maxPool3dPositions=function(t,e){for(var a=kt(e.outShape,"int32"),u=e.strideDepth,s=e.strideHeight,l=e.strideWidth,f=e.dilationDepth,h=e.dilationHeight,p=e.dilationWidth,v=e.effectiveFilterDepth,m=e.effectiveFilterHeight,y=e.effectiveFilterWidth,x=e.padInfo.front,w=e.padInfo.top,_=e.padInfo.left,E=this.bufferSync(t),R=0;R<e.batchSize;++R)for(var A=0;A<e.inChannels;++A)for(var S=0;S<e.outDepth;++S){for(var T=S*u-x,N=T;N<0;)N+=f;for(var O=Math.min(e.inDepth,v+T),B=0;B<e.outHeight;++B){for(var I=B*s-w,F=I;F<0;)F+=h;for(var G=Math.min(e.inHeight,m+I),H=0;H<e.outWidth;++H){for(var at=H*l-_,et=at;et<0;)et+=p;for(var nt=Math.min(e.inWidth,y+at),L=Number.NEGATIVE_INFINITY,q=-1,K=N;K<O;K+=f)for(var rt=K-T,ot=F;ot<G;ot+=h)for(var z=ot-I,X=et;X<nt;X+=p){var it=X-at,ht=E.get(R,K,ot,X,A);ht>=L&&(L=ht,q=rt*m*y+z*m+it)}a.set(q,R,S,B,H,A)}}}return a.toTensor()},n.prototype.maxPool3dBackprop=function(t,e,a,u){ft([e,a],"maxPool3dBackprop");for(var s=this.maxPool3dPositions(e,u),l=u.strideDepth,f=u.strideHeight,h=u.strideWidth,p=u.dilationDepth,v=u.dilationHeight,m=u.dilationWidth,y=u.effectiveFilterDepth,x=u.effectiveFilterHeight,w=u.effectiveFilterWidth,_=y-1-u.padInfo.front,E=w-1-u.padInfo.left,R=x-1-u.padInfo.top,A=kt(e.shape,"float32"),S=this.bufferSync(s),T=this.bufferSync(t),N=0;N<u.batchSize;++N)for(var O=0;O<u.inChannels;++O)for(var B=0;B<u.inDepth;++B)for(var I=0;I<u.inHeight;++I)for(var F=0;F<u.inWidth;++F){for(var G=B-_,H=I-R,at=F-E,et=0,nt=0;nt<y;nt+=p){var L=(G+nt)/l;if(!(L<0||L>=u.outDepth||Math.floor(L)!==L))for(var q=0;q<x;q+=v){var K=(H+q)/f;if(!(K<0||K>=u.outHeight||Math.floor(K)!==K))for(var rt=0;rt<w;rt+=m){var ot=(at+rt)/h;if(!(ot<0||ot>=u.outWidth||Math.floor(ot)!==ot)){var z=y*x*w-1-S.get(N,L,K,ot,O)===nt*x*w+q*w+rt?1:0;z!==0&&(et+=T.get(N,L,K,ot,O)*z)}}}}A.set(et,N,B,I,F,O)}return A.toTensor()},n.prototype.cast=function(t,e){return b1(t,e,this)},n.prototype.reshape=function(t,e){return yd(t,e)},n.prototype.avgPool=function(t,e){return ft(t,"avgPool"),this.pool(t,e,"avg").toFloat()},n.prototype.resizeBilinear=function(t,e,a,u){ft(t,"resizeBilinear");for(var s=t.shape,l=s[0],f=s[1],h=s[2],p=s[3],v=this.readSync(t.dataId),m=new Float32Array(_t([l,e,a,p])),y=[u&&e>1?f-1:f,u&&a>1?h-1:h],x=[u&&e>1?e-1:e,u&&a>1?a-1:a],w=0,_=y[0]/x[0],E=y[1]/x[1],R=0;R<l;R++)for(var A=0;A<e;A++)for(var S=_*A,T=Math.floor(S),N=S-T,O=Math.min(f-1,Math.ceil(S)),B=R*t.strides[0]+T*t.strides[1],I=R*t.strides[0]+O*t.strides[1],F=0;F<a;F++)for(var G=E*F,H=Math.floor(G),at=G-H,et=Math.min(h-1,Math.ceil(G)),nt=B+H*t.strides[2],L=I+H*t.strides[2],q=B+et*t.strides[2],K=I+et*t.strides[2],rt=0;rt<p;rt++){var ot=v[nt+rt],z=v[L+rt],X=ot+(v[q+rt]-ot)*at,it=X+(z+(v[K+rt]-z)*at-X)*N;m[w++]=it}return Ze(m,[l,e,a,p])},n.prototype.resizeBilinearBackprop=function(t,e,a){ft([t,e],"resizeBilinearBackprop");for(var u=e.shape,s=u[0],l=u[1],f=u[2],h=u[3],p=t.shape,v=p[1],m=p[2],y=new Float32Array(s*l*f*h),x=[a&&v>1?l-1:l,a&&m>1?f-1:f],w=[a&&v>1?v-1:v,a&&m>1?m-1:m],_=x[0]/w[0],E=x[1]/w[1],R=this.readSync(t.dataId),A=0,S=0;S<s;S++)for(var T=S*e.strides[0],N=0;N<v;N++)for(var O=N*_,B=Math.floor(O),I=Math.min(Math.ceil(O),l-1),F=T+B*e.strides[1],G=T+I*e.strides[1],H=O-B,at=1-H,et=0;et<m;et++)for(var nt=et*E,L=Math.floor(nt),q=Math.min(Math.ceil(nt),f-1),K=nt-L,rt=1-K,ot=F+L*e.strides[2],z=F+q*e.strides[2],X=G+L*e.strides[2],it=G+q*e.strides[2],ht=at*rt,dt=at*K,vt=H*rt,gt=H*K,Tt=0;Tt<h;Tt++){var Rt=R[A++];y[ot+Tt]+=Rt*ht,y[z+Tt]+=Rt*dt,y[X+Tt]+=Rt*vt,y[it+Tt]+=Rt*gt}return mn(y,[s,f,l,h],e.dtype)},n.prototype.resizeNearestNeighbor=function(t,e,a,u){ft(t,"resizeNearestNeighbor");for(var s=t.shape,l=s[0],f=s[1],h=s[2],p=s[3],v=this.readSync(t.dataId),m=new Float32Array(l*e*a*p),y=[u&&e>1?f-1:f,u&&a>1?h-1:h],x=[u&&e>1?e-1:e,u&&a>1?a-1:a],w=y[0]/x[0],_=y[1]/x[1],E=0,R=0;R<l;R++)for(var A=R*t.strides[0],S=0;S<e;S++)for(var T=w*S,N=A+Math.min(f-1,u?Math.round(T):Math.floor(T))*t.strides[1],O=0;O<a;O++)for(var B=_*O,I=N+Math.min(h-1,u?Math.round(B):Math.floor(B))*t.strides[2],F=0;F<p;F++){var G=v[I+F];m[E++]=G}return Ze(m,[l,e,a,p],t.dtype)},n.prototype.resizeNearestNeighborBackprop=function(t,e,a){ft([t,e],"resizeNearestNeighborBackprop");for(var u=e.shape,s=u[0],l=u[1],f=u[2],h=u[3],p=t.shape,v=p[1],m=p[2],y=new Float32Array(s*l*f*h),x=this.readSync(t.dataId),w=[a&&v>1?l-1:l,a&&m>1?f-1:f],_=[a&&v>1?v-1:v,a&&m>1?m-1:m],E=w[0]/_[0],R=w[1]/_[1],A=1/E,S=1/R,T=2*Math.ceil(A)+2,N=2*Math.ceil(S)+2,O=0;O<s;O++)for(var B=O*e.strides[0],I=0;I<l;I++)for(var F=B+I*e.strides[1],G=Math.floor(I*A),H=Math.floor(G-T/2),at=0;at<f;at++)for(var et=F+at*e.strides[2],nt=Math.floor(at*S),L=Math.floor(nt-N/2),q=0;q<h;q++){for(var K=0,rt=0;rt<T;rt++){var ot=rt+H;if(!(ot<0||ot>=v)){var z=B+ot*t.strides[1],X=ot*E;if(I===Math.min(l-1,a?Math.round(X):Math.floor(X)))for(var it=0;it<N;it++){var ht=it+L;if(!(ht<0||ht>=m)){var dt=z+ht*t.strides[2],vt=ht*R;at===Math.min(f-1,a?Math.round(vt):Math.floor(vt))&&(K+=x[dt+q])}}}}y[et+q]=K}return mn(y,e.shape,e.dtype)},n.prototype.batchNormalization=function(t,e,a,u,s,l){ft([t,e,a,s,l],"batchNorm");for(var f=this.readSync(t.dataId),h=this.readSync(e.dataId),p=this.readSync(a.dataId),v=s?this.readSync(s.dataId):new Float32Array([1]),m=l?this.readSync(l.dataId):new Float32Array([0]),y=new Float32Array(f.length),x=m.length,w=v.length,_=p.length,E=h.length,R=0,A=0,S=0,T=0,N=0;N<f.length;++N)y[N]=m[R++]+(f[N]-h[A++])*v[S++]/Math.sqrt(p[T++]+u),R>=x&&(R=0),A>=E&&(A=0),S>=w&&(S=0),T>=_&&(T=0);return mn(y,t.shape)},n.prototype.localResponseNormalization4D=function(t,e,a,u,s){ft(t,"localResponseNormalization4D");var l=t.shape[3],f=l-1,h=this.readSync(t.dataId),p=t.size,v=new Float32Array(p);function m(_){for(var E=_%l,R=_-E+Math.max(0,E-e),A=_-E+Math.min(E+e,f),S=0;R<=A;R++){var T=h[R];S+=T*T}return S}for(var y=0;y<p;y++){var x=m(y),w=h[y]*Math.pow(a+u*x,-s);v[y]=w}return mn(v,t.shape)},n.prototype.LRNGrad=function(t,e,a,u,s,l,f){ft(t,"LRNGrad");for(var h=t.shape[3],p=this.readSync(t.dataId),v=this.readSync(e.dataId),m=this.readSync(a.dataId),y=new Float32Array(t.size),x=t.size,w=0;w<x;w++){for(var _=w%h,E=w-_+Math.max(0,_-u),R=w-_+Math.min(h,_+u+1),A=0,S=E;S<R;S++)A+=Math.pow(v[S],2);for(A=l*A+s,S=E;S<R;S++){var T=-2*l*f*v[S]*m[w]/A;w===S&&(T+=Math.pow(A,-f)),T*=p[w],y[S]+=T}}return mn(y,t.shape)},n.prototype.multinomial=function(t,e,a,u){ft(t,"multinomial");for(var s=e?t:ea(t),l=s.shape[0],f=s.shape[1],h=he([l,a],"int32"),p=this.readSync(h.dataId),v=this.readSync(s.dataId),m=0;m<l;++m){var y=m*f,x=new Float32Array(f-1);x[0]=v[y];for(var w=1;w<x.length;++w)x[w]=x[w-1]+v[y+w];for(var _=Ql(u.toString()),E=m*a,R=0;R<a;++R){var A=_();p[E+R]=x.length;for(var S=0;S<x.length;S++)if(A<x[S]){p[E+R]=S;break}}}return h},n.prototype.oneHot=function(t,e,a,u){ft(t,"oneHot");var s=new Float32Array(t.size*e);s.fill(u);for(var l=this.readSync(t.dataId),f=0;f<t.size;++f)l[f]>=0&&l[f]<e&&(s[f*e+l[f]]=a);return Ba(s,[t.size,e],"int32")},n.prototype.nonMaxSuppression=function(t,e,a,u,s){return ft(t,"nonMaxSuppression"),Ld(this.readSync(t.dataId),this.readSync(e.dataId),a,u,s)},n.prototype.fft=function(t){return this.fftBatch(t,!1)},n.prototype.ifft=function(t){return this.fftBatch(t,!0)},n.prototype.fftBatch=function(t,e){for(var a=t.shape[0],u=t.shape[1],s=kt(t.shape,"float32"),l=kt(t.shape,"float32"),f=Zn(t).as2D(a,u),h=xr(t).as2D(a,u),p=0;p<a;p++)for(var v=f.slice([p,0],[1,u]),m=h.slice([p,0],[1,u]),y=Ye(v,m),x=this.readSync(this.fftImpl(y,e).dataId),w=0;w<u;w++){var _=ty(x,w);s.values[p*u+w]=_.real,l.values[p*u+w]=_.imag}return Ye(s.toTensor(),l.toTensor()).as2D(a,u)},n.prototype.fftImpl=function(t,e){var a=t.as1D(),u=a.size;if(this.isExponentOf2(u)){var s=this.fftRadix2(a,u,e).as2D(t.shape[0],t.shape[1]);return e&&(s=Ye(Zn(s).div(pt(u)),xr(s).div(pt(u)))),s}var l=this.readSync(t.dataId),f=(function(h){for(var p=new Float32Array(h.length/2),v=new Float32Array(h.length/2),m=0;m<h.length;m+=2)p[m/2]=h[m],v[m/2]=h[m+1];return{real:p,imag:v}})(this.fourierTransformByMatmul(l,u,e));return Ye(f.real,f.imag).as2D(t.shape[0],t.shape[1])},n.prototype.isExponentOf2=function(t){return(t&t-1)==0},n.prototype.fftRadix2=function(t,e,a){if(e===1)return t;var u=this.readSync(t.dataId),s=e/2,l=(function(E){for(var R=Math.ceil(E.length/4),A=new Float32Array(R),S=new Float32Array(R),T=0;T<E.length;T+=4)A[Math.floor(T/4)]=E[T],S[Math.floor(T/4)]=E[T+1];return{real:A,imag:S}})(u),f=Ye(l.real,l.imag).as1D(),h=(function(E){for(var R=Math.floor(E.length/4),A=new Float32Array(R),S=new Float32Array(R),T=2;T<E.length;T+=4)A[Math.floor(T/4)]=E[T],S[Math.floor(T/4)]=E[T+1];return{real:A,imag:S}})(u),p=Ye(h.real,h.imag).as1D();f=this.fftRadix2(f,s,a),p=this.fftRadix2(p,s,a);var v=(function(E,R){for(var A=new Float32Array(E/2),S=new Float32Array(E/2),T=0;T<Math.ceil(E/2);T++){var N=(R?2:-2)*Math.PI*(T/E);A[T]=Math.cos(N),S[T]=Math.sin(N)}return{real:A,imag:S}})(e,a),m=Ye(v.real,v.imag).mul(p),y=f.add(m),x=f.sub(m),w=Zn(y).concat(Zn(x)),_=xr(y).concat(xr(x));return Ye(w,_).as1D()},n.prototype.fourierTransformByMatmul=function(t,e,a){for(var u=new Float32Array(2*e),s=0;s<e;s++){for(var l=0,f=0,h=0;h<e;h++){var p=EE(s*h,e,a),v=ty(t,h);l+=v.real*p.real-v.imag*p.imag,f+=v.real*p.imag+v.imag*p.real}a&&(l/=e,f/=e),_E(u,l,f,s)}return u},n.prototype.depthToSpace=function(t,e,a){k(a==="NHWC",(function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+a})),k(e>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: "+e}));for(var u=t.shape[0],s=t.shape[1],l=t.shape[2],f=t.shape[3],h=s*e,p=l*e,v=f/(e*e),m=this.readSync(t.dataId),y=new Float32Array(u*h*p*v),x=0,w=0;w<u;++w)for(var _=0;_<h;++_)for(var E=Math.floor(_/e),R=_%e,A=0;A<p;++A)for(var S=Math.floor(A/e),T=(R*e+A%e)*v,N=0;N<v;++N){var O=N+T+f*(S+l*(E+s*w));y[x++]=m[O]}return mn(y,[u,h,p,v])},n.prototype.broadcastedBinaryOp=function(t,e,a,u){var s=Ht(t.shape,e.shape),l=kt(s,a),f=this.readSync(t.dataId),h=this.readSync(e.dataId),p=Oa(t.shape,s),v=Oa(e.shape,s),m=l.values;if(p.length+v.length===0)for(var y=0;y<m.length;++y)m[y]=u(f[y%f.length],h[y%h.length]);else{var x=this.bufferSync(t),w=this.bufferSync(e),_=function(E){var R=l.indexToLoc(E),A=R.slice(-t.rank);p.forEach((function(O){return A[O]=0}));var S=x.locToIndex(A),T=R.slice(-e.rank);v.forEach((function(O){return T[O]=0}));var N=w.locToIndex(T);m[E]=u(f[S],h[N])};for(y=0;y<m.length;++y)_(y)}return l.toTensor()},n.prototype.broadcastedBinaryComplexOp=function(t,e,a){var u=Ht(t.shape,e.shape),s=kt(u,"float32"),l=kt(u,"float32"),f=this.readSync(t.dataId),h=this.readSync(e.dataId),p=Oa(t.shape,u),v=Oa(e.shape,u),m=s.values,y=l.values;if(p.length+v.length===0)for(var x=0;x<m.length;x++){var w=x%f.length,_=x%h.length,E=a(f[2*w],f[2*w+1],h[2*_],h[2*_+1]);m[x]=E.real,y[x]=E.imag}else{var R=this.bufferSync(this.data.get(t.dataId).complexTensors.real),A=this.bufferSync(this.data.get(e.dataId).complexTensors.real),S=function(T){var N=s.indexToLoc(T),O=N.slice(-t.rank);p.forEach((function(H){return O[H]=0}));var B=R.locToIndex(O),I=N.slice(-e.rank);v.forEach((function(H){return I[H]=0}));var F=A.locToIndex(I),G=a(f[2*B],f[2*B+1],h[2*F],h[2*F+1]);m[T]=G.real,y[T]=G.imag};for(x=0;x<m.length;x++)S(x)}return this.complex(s.toTensor(),l.toTensor())},n.prototype.split=function(t,e,a){return _1(t,e,a)},n.prototype.dispose=function(){},n.prototype.floatPrecision=function(){return 32},n.prototype.epsilon=function(){return 1e-7},n.prototype.cropAndResize=function(t,e,a,u,s,l){for(var f=t.shape,h=f[0],p=f[1],v=f[2],m=f[3],y=e.shape[0],x=u[0],w=u[1],_=kt([y,x,w,m],"float32"),E=this.readSync(e.dataId),R=this.readSync(a.dataId),A=this.readSync(t.dataId),S=t.strides,T=_.strides,N=0;N<y;N++){var O=4*N,B=E[O],I=E[O+1],F=E[O+2],G=E[O+3],H=R[N];if(!(H>=h))for(var at=x>1?(F-B)*(p-1)/(x-1):0,et=w>1?(G-I)*(v-1)/(w-1):0,nt=0;nt<x;nt++){var L=x>1?B*(p-1)+nt*at:.5*(B+F)*(p-1);if(L<0||L>p-1)for(var q=0;q<w;q++)for(var K=0;K<m;K++){var rt=K+q*T[2]+nt*T[1]+N*T[0];_.values[rt]=l}else if(s==="bilinear"){var ot=Math.floor(L),z=Math.ceil(L),X=L-ot;for(q=0;q<w;q++)if((zt=w>1?I*(v-1)+q*et:.5*(I+G)*(v-1))<0||zt>v-1)for(K=0;K<m;K++)rt=K+q*T[2]+nt*T[1]+N*T[0],_.values[rt]=l;else{var it=Math.floor(zt),ht=Math.ceil(zt),dt=zt-it;for(K=0;K<m;K++){var vt=A[rt=K+it*S[2]+ot*S[1]+H*S[0]],gt=A[rt=K+ht*S[2]+ot*S[1]+H*S[0]],Tt=A[rt=K+it*S[2]+z*S[1]+H*S[0]],Rt=vt+(gt-vt)*dt,ie=Tt+(A[rt=K+ht*S[2]+z*S[1]+H*S[0]]-Tt)*dt;rt=K+q*T[2]+nt*T[1]+N*T[0],_.values[rt]=Rt+(ie-Rt)*X}}}else for(q=0;q<w;++q){var zt;if((zt=w>1?I*(v-1)+q*et:.5*(I+G)*(v-1))<0||zt>v-1)for(K=0;K<m;K++)rt=K+q*T[2]+nt*T[1]+N*T[0],_.values[rt]=l;else{var Xt=Math.round(zt),qt=Math.round(L);for(K=0;K<m;K++){var Jt=K+Xt*S[2]+qt*S[1]+H*S[0],oe=K+q*T[2]+nt*T[1]+N*T[0];_.values[oe]=A[Jt]}}}}}return _.toTensor()},n.prototype.sparseToDense=function(t,e,a,u){var s=Ll(0,t,a),l=s.sliceRank,f=s.numUpdates,h=s.sliceSize,p=s.strides,v=s.outputSize;return this.scatter(t,e,a,v,h,f,l,p,u,!1)},n.prototype.gatherND=function(t,e){var a=e.shape,u=a[a.length-1],s=h1(t,e),l=s[0],f=s[1],h=s[2],p=s[3];if(f===0)return Ze([],l,t.dtype);for(var v=new Nu([f,h],t.dtype),m=this.readSync(e.dataId),y=this.readSync(t.dataId),x=0;x<f;x++){for(var w=[],_=0,E=0;E<u;E++){var R=m[x*u+E];_+=R*p[E],w.push(R)}if(_<0||_>=t.size/h)throw new Error("Invalid indices: "+w+" does not index into "+t.shape);for(var A=0;A<h;A++)v.values[x*h+A]=y[_*h+A]}return v.toTensor().reshape(l)},n.prototype.scatterND=function(t,e,a){var u=Ll(0,t,a),s=u.sliceRank,l=u.numUpdates,f=u.sliceSize,h=u.strides,p=u.outputSize,v=pt(0);return this.scatter(t,e,a,p,f,l,s,h,v,!0)},n.prototype.fill=function(t,e,a){var u=Tl(a=a||Uu(e),_t(t));return u.fill(e),W.makeTensor(u,t,a,this)},n.prototype.onesLike=function(t){if(t.dtype==="string")throw new Error("onesLike is not supported for string tensors");return this.fill(t.shape,1,t.dtype)},n.prototype.zerosLike=function(t){var e=Tl(t.dtype,_t(t.shape));return this.makeOutput(e,t.shape,t.dtype)},n.prototype.linspace=function(t,e,a){return x1(t,e,a)},n.prototype.scatter=function(t,e,a,u,s,l,f,h,p,v){var m=[u/s,s],y=this.readSync(t.dataId),x=this.readSync(e.dataId);if(u===0)return Ze([],a,e.dtype);var w=new Nu(m,e.dtype);w.values.fill(this.readSync(p.dataId)[0]);for(var _=0;_<l;_++){for(var E=[],R=0,A=0;A<f;A++){var S=y[_*f+A];E.push(S),R+=S*h[A]}if(R<0||R>=u/s)throw new Error("Invalid indices: "+E+" does not index into "+a);for(var T=0;T<s;T++)v?w.values[R*s+T]+=x[_*s+T]:w.values[R*s+T]=e.rank===0?x[0]:x[_*s+T]}return w.toTensor().reshape(a)},n})(g1);W.registerBackend("cpu",(function(){return new GA}),1);for(var Zh=0,_y=[{kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(r){var n=r.inputs,t=r.backend,e=r.attrs,a=n,u=a.boxes,s=a.scores,l=e,f=l.maxOutputSize,h=l.iouThreshold,p=l.scoreThreshold,v=l.softNmsSigma,m=t;ft(u,"NonMaxSuppressionWithScore");var y=Ud(m.data.get(u.dataId).values,m.data.get(s.dataId).values,f,h,p,v);return[y.selectedIndices,y.selectedScores]}},{kernelName:"Square",backendName:"cpu",kernelFunc:function(r){var n=r.inputs,t=r.backend,e=n.x,a=t;ft(e,"square");for(var u=a.data.get(e.dataId).values,s=new Float32Array(u.length),l=0;l<u.length;++l){var f=u[l];s[l]=f*f}return{dataId:a.write(s,e.shape,e.dtype),shape:e.shape,dtype:e.dtype}}},{kernelName:ku,backendName:"cpu",kernelFunc:function(r){var n=r.inputs,t=r.backend,e=n,a=e.a,u=e.b,s=t;ft([a,u],ku);var l=s.data.get(a.dataId).values,f=s.data.get(u.dataId).values,h=(function(m,y,x,w,_,E){var R=Ht(m,y),A=R.length,S=Er(R),T=Du(_,_t(R)),N=m.length,O=y.length,B=Er(m),I=Er(y),F=Oa(m,R),G=Oa(y,R);if(F.length+G.length===0)for(var H=0;H<T.length;++H)T[H]=E(x[H%x.length],w[H%w.length]);else{var at=function(et){var nt=$w(et,A,S),L=nt.slice(-N);F.forEach((function(ot){return L[ot]=0}));var q=q0(L,N,B),K=nt.slice(-O);G.forEach((function(ot){return K[ot]=0}));var rt=q0(K,O,I);T[et]=E(x[q],w[rt])};for(H=0;H<T.length;++H)at(H)}return[T,R]})(a.shape,u.shape,l,f,a.dtype,(function(m,y){var x=m-y;return x*x})),p=h[0],v=h[1];return{dataId:s.write(p,v,a.dtype),shape:v,dtype:a.dtype}}}];Zh<_y.length;Zh++)qy(_y[Zh]);var uo,WA=function(r){this.variableNames=["A"];var n=en(),t=r[0],e=r[1];this.outputShape=r,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+e+".0, "+t+`.0);

        vec4 values = `+n.texture2D+`(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `},qA=function(r){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var n=en(),t=r[0],e=r[1];this.outputShape=r,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(`+e+".0, "+t+`.0);
            vec4 values = `+n.texture2D+`(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        `+n.output+` = result;
      }
    `};for(var Jh=0,Ey=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(r){var n=r.inputs,t=r.backend,e=r.attrs,a=n.pixels,u=e.numChannels,s=typeof HTMLVideoElement<"u"&&a instanceof HTMLVideoElement,l=typeof HTMLImageElement<"u"&&a instanceof HTMLImageElement,f=s?[a.videoWidth,a.videoHeight]:[a.width,a.height],h=f[0],p=f[1],v=[p,h],m=[p,h,u];(l||s)&&(uo==null&&(uo=document.createElement("canvas").getContext("2d")),uo.canvas.width=h,uo.canvas.height=p,uo.drawImage(a,0,0,h,p),a=uo.canvas);var y=t.makeTensorInfo(v,"int32");t.texData.get(y.dataId).usage=kn.PIXELS,t.gpgpu.uploadPixelDataToTexture(t.getTexture(y.dataId),a);var x=st().getBool("WEBGL_PACK")?new qA(m):new WA(m),w=t.runWebGLProgram(x,[y],"int32");return t.disposeData(y.dataId),w}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(r){var n=r.inputs,t=r.backend,e=r.attrs;Ol("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var a=n,u=a.boxes,s=a.scores,l=e,f=l.maxOutputSize,h=l.iouThreshold,p=l.scoreThreshold,v=l.softNmsSigma,m=t,y=Ud(m.readSync(u.dataId),m.readSync(s.dataId),f,h,p,v);return[y.selectedIndices,y.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(r){var n=r.inputs,t=r.backend,e=n.x,a=t,u=new Ft(e.shape,"return x * x;");return a.runWebGLProgram(u,[e],e.dtype)}},{kernelName:ku,backendName:"webgl",kernelFunc:function(r){var n=r.inputs,t=r.backend,e=n,a=e.a,u=e.b,s=t,l=st().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Zr("return (a - b) * (a - b);",a.shape,u.shape):new be("return (a - b) * (a - b);",a.shape,u.shape);return s.compileAndRun(l,[a,u])}}];Jh<Ey.length;Jh++)qy(Ey[Jh]);for(var $h=0,Cy=[{kernelName:"Square",gradFunc:function(r,n){var t=n[0];return{x:function(){return r.mul(t.toFloat().mul(2))}}}},{kernelName:ku,gradFunc:function(r,n){var t=n[0],e=n[1],a=pt(2);return{a:function(){return rn(r,rn(a,Be(t,e)))},b:function(){return rn(r,rn(a,Be(e,t)))}}}}];$h<Cy.length;$h++)Vw(Cy[$h]);var jA=(function(){function r(){}return r.prototype.fetch=function(n,t){return fetch(n,t)},r.prototype.now=function(){return performance.now()},r.prototype.encode=function(n,t){if(t!=="utf-8"&&t!=="utf8")throw new Error("Browser's encoder only supports utf-8, but got "+t);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(n)},r.prototype.decode=function(n,t){return new TextDecoder(t).decode(n)},r})();st().get("IS_BROWSER")&&st().setPlatform("browser",new jA);var td,XA=function(){return require("node-fetch")},KA=(function(){function r(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}return r.prototype.fetch=function(n,t){return st().global.fetch!=null?st().global.fetch(n,t):(td==null&&(td=XA()),td(n,t))},r.prototype.now=function(){var n=process.hrtime();return 1e3*n[0]+n[1]/1e6},r.prototype.encode=function(n,t){if(t!=="utf-8"&&t!=="utf8")throw new Error("Node built-in encoder only supports utf-8, but got "+t);return this.textEncoder.encode(n)},r.prototype.decode=function(n,t){return n.length===0?"":new this.util.TextDecoder(t).decode(n)},r})();st().get("IS_NODE")&&st().setPlatform("node",new KA);var wd={float32:4,int32:4,uint16:2,uint8:1,bool:1},ql=4;function pb(r,n){for(var t={},e=0,a=function(l){var f=l.name,h=l.dtype,p=l.shape,v=_t(p),m=void 0;if("quantization"in l){var y=l.quantization;if(y.dtype!=="uint8"&&y.dtype!=="uint16")throw new Error("Weight "+l.name+" has unknown quantization dtype "+y.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var x=wd[y.dtype],w=r.slice(e,e+v*x),_=y.dtype==="uint8"?new Uint8Array(w):new Uint16Array(w);if(h==="float32")m=Float32Array.from(_,(function(N){return N*y.scale+y.min}));else{if(h!=="int32")throw new Error("Unsupported dtype in weight '"+f+"': "+h);m=Int32Array.from(_,(function(N){return Math.round(N*y.scale+y.min)}))}e+=v*x}else if(h==="string"){var E=_t(l.shape);m=[];for(var R=0;R<E;R++){var A=new Uint32Array(r.slice(e,e+ql))[0];e+=ql;var S=new Uint8Array(r.slice(e,e+A));m.push(S),e+=A}}else{var T=wd[h];if(w=r.slice(e,e+v*T),h==="float32")m=new Float32Array(w);else if(h==="int32")m=new Int32Array(w);else{if(h!=="bool")throw new Error("Unsupported dtype in weight '"+f+"': "+h);m=new Uint8Array(w)}e+=v*T}t[f]=Ze(m,p,h)},u=0,s=n;u<s.length;u++)a(s[u]);return t}function YA(r){if(r===null)throw new Error("Invalid input value: "+JSON.stringify(r));var n=0,t=[];r.forEach((function(u){if(n+=u.byteLength,t.push(u.byteLength===u.buffer.byteLength?u:new u.constructor(u)),!(u instanceof Float32Array||u instanceof Int32Array||u instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+u.constructor.name)}));var e=new Uint8Array(n),a=0;return t.forEach((function(u){e.set(new Uint8Array(u.buffer),a),a+=u.byteLength})),e.buffer}var _d=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function Sy(r){return _d?Buffer.byteLength(r):new Blob([r]).size}function ap(r){var n=0;r.forEach((function(a){n+=a.byteLength}));var t=new Uint8Array(n),e=0;return r.forEach((function(a){t.set(new Uint8Array(a),e),e+=a.byteLength})),t.buffer}function Ry(r){for(r=r.trim();r.endsWith("/");)r=r.slice(0,r.length-1);var n=r.split("/");return n[n.length-1]}function ju(r){if(r.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:r.modelTopology==null?0:Sy(JSON.stringify(r.modelTopology)),weightSpecsBytes:r.weightSpecs==null?0:Sy(JSON.stringify(r.weightSpecs)),weightDataBytes:r.weightData==null?0:r.weightData.byteLength}}var In=(function(){function r(){this.saveRouters=[],this.loadRouters=[]}return r.getInstance=function(){return r.instance==null&&(r.instance=new r),r.instance},r.registerSaveRouter=function(n){r.getInstance().saveRouters.push(n)},r.registerLoadRouter=function(n){r.getInstance().loadRouters.push(n)},r.getSaveHandlers=function(n){return r.getHandlers(n,"save")},r.getLoadHandlers=function(n,t){return r.getHandlers(n,"load",t)},r.getHandlers=function(n,t,e){var a=[];return(t==="load"?r.getInstance().loadRouters:r.getInstance().saveRouters).forEach((function(u){var s=u(n,e);s!==null&&a.push(s)})),a},r})(),yo="://",Fa=(function(){function r(){this.managers={}}return r.getInstance=function(){return r.instance==null&&(r.instance=new r),r.instance},r.registerManager=function(n,t){k(n!=null,(function(){return"scheme must not be undefined or null."})),n.endsWith(yo)&&(n=n.slice(0,n.indexOf(yo))),k(n.length>0,(function(){return"scheme must not be an empty string."}));var e=r.getInstance();k(e.managers[n]==null,(function(){return"A model store manager is already registered for scheme '"+n+"'."})),e.managers[n]=t},r.getManager=function(n){var t=this.getInstance().managers[n];if(t==null)throw new Error("Cannot find model manager for scheme '"+n+"'");return t},r.getSchemes=function(){return Object.keys(this.getInstance().managers)},r})();function Rl(r){if(r.indexOf(yo)===-1)throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+Fa.getSchemes().join(","));return{scheme:r.split(yo)[0],path:r.split(yo)[1]}}function Ay(r,n,t){return t===void 0&&(t=!1),bt(this,void 0,void 0,(function(){var e,a,u,s,l,f,h,p,v;return xt(this,(function(m){switch(m.label){case 0:return k(r!==n,(function(){return"Old path and new path are the same: '"+r+"'"})),k((e=In.getLoadHandlers(r)).length>0,(function(){return"Copying failed because no load handler is found for source URL "+r+"."})),k(e.length<2,(function(){return"Copying failed because more than one ("+e.length+") load handlers for source URL "+r+"."})),a=e[0],k((u=In.getSaveHandlers(n)).length>0,(function(){return"Copying failed because no save handler is found for destination URL "+n+"."})),k(u.length<2,(function(){return"Copying failed because more than one ("+e.length+") save handlers for destination URL "+n+"."})),s=u[0],l=Rl(r).scheme,f=Rl(r).path,h=l===Rl(r).scheme,[4,a.load()];case 1:return p=m.sent(),t&&h?[4,Fa.getManager(l).removeModel(f)]:[3,3];case 2:m.sent(),m.label=3;case 3:return[4,s.save(p)];case 4:return v=m.sent(),!t||h?[3,6]:[4,Fa.getManager(l).removeModel(f)];case 5:m.sent(),m.label=6;case 6:return[2,v.modelArtifactsInfo]}}))}))}var fi="models_store",ka="model_info_store";function vb(){if(!st().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var r=window||self,n=r.indexedDB||r.mozIndexedDB||r.webkitIndexedDB||r.msIndexedDB||r.shimIndexedDB;if(n==null)throw new Error("The current browser does not appear to support IndexedDB.");return n}function Ed(r){var n=r.result;n.createObjectStore(fi,{keyPath:"modelPath"}),n.createObjectStore(ka,{keyPath:"modelPath"})}var bo=(function(){function r(n){if(this.indexedDB=vb(),n==null||!n)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=n}return r.prototype.save=function(n){return bt(this,void 0,void 0,(function(){return xt(this,(function(t){if(n.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,n)]}))}))},r.prototype.load=function(){return bt(this,void 0,void 0,(function(){return xt(this,(function(n){return[2,this.databaseAction(this.modelPath)]}))}))},r.prototype.databaseAction=function(n,t){var e=this;return new Promise((function(a,u){var s=e.indexedDB.open("tensorflowjs",1);s.onupgradeneeded=function(){return Ed(s)},s.onsuccess=function(){var l=s.result;if(t==null){var f=l.transaction(fi,"readonly"),h=f.objectStore(fi).get(e.modelPath);h.onsuccess=function(){if(h.result==null)return l.close(),u(new Error("Cannot find model with path '"+e.modelPath+"' in IndexedDB."));a(h.result.modelArtifacts)},h.onerror=function(w){return l.close(),u(h.error)},f.oncomplete=function(){return l.close()}}else{var p,v=ju(t),m=l.transaction(ka,"readwrite"),y=m.objectStore(ka),x=y.put({modelPath:e.modelPath,modelArtifactsInfo:v});x.onsuccess=function(){var w=(p=l.transaction(fi,"readwrite")).objectStore(fi).put({modelPath:e.modelPath,modelArtifacts:t,modelArtifactsInfo:v});w.onsuccess=function(){return a({modelArtifactsInfo:v})},w.onerror=function(_){var E=(y=m.objectStore(ka)).delete(e.modelPath);E.onsuccess=function(){return l.close(),u(w.error)},E.onerror=function(R){return l.close(),u(w.error)}}},x.onerror=function(w){return l.close(),u(x.error)},m.oncomplete=function(){p==null?l.close():p.oncomplete=function(){return l.close()}}}},s.onerror=function(l){return u(s.error)}}))},r.URL_SCHEME="indexeddb://",r})(),Ty=function(r){return st().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(bo.URL_SCHEME)?(n=r.slice(bo.URL_SCHEME.length),new bo(n)):null;var n};In.registerSaveRouter(Ty),In.registerLoadRouter(Ty);var QA=(function(){function r(){this.indexedDB=vb()}return r.prototype.listModels=function(){return bt(this,void 0,void 0,(function(){var n=this;return xt(this,(function(t){return[2,new Promise((function(e,a){var u=n.indexedDB.open("tensorflowjs",1);u.onupgradeneeded=function(){return Ed(u)},u.onsuccess=function(){var s=u.result,l=s.transaction(ka,"readonly"),f=l.objectStore(ka).getAll();f.onsuccess=function(){for(var h={},p=0,v=f.result;p<v.length;p++){var m=v[p];h[m.modelPath]=m.modelArtifactsInfo}e(h)},f.onerror=function(h){return s.close(),a(f.error)},l.oncomplete=function(){return s.close()}},u.onerror=function(s){return a(u.error)}}))]}))}))},r.prototype.removeModel=function(n){return bt(this,void 0,void 0,(function(){var t=this;return xt(this,(function(e){var a;return n=(a=n).startsWith(bo.URL_SCHEME)?a.slice(bo.URL_SCHEME.length):a,[2,new Promise((function(u,s){var l=t.indexedDB.open("tensorflowjs",1);l.onupgradeneeded=function(){return Ed(l)},l.onsuccess=function(){var f,h=l.result,p=h.transaction(ka,"readwrite"),v=p.objectStore(ka),m=v.get(n);m.onsuccess=function(){if(m.result==null)return h.close(),s(new Error("Cannot find model with path '"+n+"' in IndexedDB."));var y=v.delete(n),x=function(){var w=(f=h.transaction(fi,"readwrite")).objectStore(fi).delete(n);w.onsuccess=function(){return u(m.result.modelArtifactsInfo)},w.onerror=function(_){return s(m.error)}};y.onsuccess=x,y.onerror=function(w){return x(),h.close(),s(m.error)}},m.onerror=function(y){return h.close(),s(m.error)},p.oncomplete=function(){f==null?h.close():f.oncomplete=function(){return h.close()}}},l.onerror=function(f){return s(l.error)}}))]}))}))},r})();if(st().getBool("IS_BROWSER"))try{Fa.registerManager(bo.URL_SCHEME,new QA)}catch{}var Jr="/",po="tensorflowjs_models",mb="info",ZA="model_topology",JA="weight_specs",$A="weight_data",t3="model_metadata";function gb(r){return{info:[po,r,mb].join(Jr),topology:[po,r,ZA].join(Jr),weightSpecs:[po,r,JA].join(Jr),weightData:[po,r,$A].join(Jr),modelMetadata:[po,r,t3].join(Jr)}}function e3(r){var n=r.split(Jr);if(n.length<3)throw new Error("Invalid key format: "+r);return n.slice(1,n.length-1).join(Jr)}var xo=(function(){function r(n){if(!st().getBool("IS_BROWSER")||typeof window>"u"||window.localStorage===void 0)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,n==null||!n)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=n,this.keys=gb(this.modelPath)}return r.prototype.save=function(n){return bt(this,void 0,void 0,(function(){var t,e,a;return xt(this,(function(u){if(n.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(n.modelTopology),e=JSON.stringify(n.weightSpecs),a=ju(n);try{return this.LS.setItem(this.keys.info,JSON.stringify(a)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,e),this.LS.setItem(this.keys.weightData,(function(s){if(_d)return Buffer.from(s).toString("base64");for(var l=new Uint8Array(s),f="",h=0,p=l.length;h<p;h++)f+=String.fromCharCode(l[h]);return btoa(f)})(n.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,userDefinedMetadata:n.userDefinedMetadata})),[2,{modelArtifactsInfo:a}]}catch{throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+a.modelTopologyBytes+", weightSpecsBytes="+a.weightSpecsBytes+", weightDataBytes="+a.weightDataBytes+".")}return[2]}))}))},r.prototype.load=function(){return bt(this,void 0,void 0,(function(){var n,t,e,a,u,s,l;return xt(this,(function(f){if((n=JSON.parse(this.LS.getItem(this.keys.info)))==null)throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if(n.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},(e=JSON.parse(this.LS.getItem(this.keys.topology)))==null)throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(t.modelTopology=e,(a=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))==null)throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(t.weightSpecs=a,(u=this.LS.getItem(this.keys.modelMetadata))!=null&&(s=JSON.parse(u),t.format=s.format,t.generatedBy=s.generatedBy,t.convertedBy=s.convertedBy,t.userDefinedMetadata=s.userDefinedMetadata),(l=this.LS.getItem(this.keys.weightData))==null)throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return t.weightData=(function(h){if(_d){var p=Buffer.from(h,"base64");return p.buffer.slice(p.byteOffset,p.byteOffset+p.byteLength)}for(var v=atob(h),m=new Uint8Array(v.length),y=0;y<v.length;++y)m.set([v.charCodeAt(y)],y);return m.buffer})(l),[2,t]}))}))},r.URL_SCHEME="localstorage://",r})(),Dy=function(r){return st().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(xo.URL_SCHEME)?(n=r.slice(xo.URL_SCHEME.length),new xo(n)):null;var n};In.registerSaveRouter(Dy),In.registerLoadRouter(Dy);var n3=(function(){function r(){k(st().getBool("IS_BROWSER"),(function(){return"Current environment is not a web browser"})),k(typeof window>"u"||window.localStorage!==void 0,(function(){return"Current browser does not appear to support localStorage"})),this.LS=window.localStorage}return r.prototype.listModels=function(){return bt(this,void 0,void 0,(function(){var n,t,e,a,u,s;return xt(this,(function(l){for(n={},t=po+Jr,e=Jr+mb,a=0;a<this.LS.length;++a)(u=this.LS.key(a)).startsWith(t)&&u.endsWith(e)&&(s=e3(u),n[s]=JSON.parse(this.LS.getItem(u)));return[2,n]}))}))},r.prototype.removeModel=function(n){return bt(this,void 0,void 0,(function(){var t,e;return xt(this,(function(a){var u;if(n=(u=n).startsWith(xo.URL_SCHEME)?u.slice(xo.URL_SCHEME.length):u,t=gb(n),this.LS.getItem(t.info)==null)throw new Error("Cannot find model at path '"+n+"'");return e=JSON.parse(this.LS.getItem(t.info)),this.LS.removeItem(t.info),this.LS.removeItem(t.topology),this.LS.removeItem(t.weightSpecs),this.LS.removeItem(t.weightData),[2,e]}))}))},r})();if(st().getBool("IS_BROWSER"))try{Fa.registerManager(xo.URL_SCHEME,new n3)}catch{}var r3="model",a3=".json",i3=".weights.bin";function Ny(r){return new Promise((function(n){return setTimeout(n)})).then(r)}var ed=(function(){function r(n){if(!st().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");n.startsWith(r.URL_SCHEME)&&(n=n.slice(r.URL_SCHEME.length)),n!=null&&n.length!==0||(n=r3),this.modelTopologyFileName=n+a3,this.weightDataFileName=n+i3}return r.prototype.save=function(n){return bt(this,void 0,void 0,(function(){var t,e,a,u,s,l;return xt(this,(function(f){switch(f.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(t=window.URL.createObjectURL(new Blob([n.weightData],{type:"application/octet-stream"})),!(n.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return e=[{paths:["./"+this.weightDataFileName],weights:n.weightSpecs}],a={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,weightsManifest:e},u=window.URL.createObjectURL(new Blob([JSON.stringify(a)],{type:"application/json"})),(s=this.jsonAnchor==null?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,s.href=u,[4,Ny((function(){return s.dispatchEvent(new MouseEvent("click"))}))];case 2:return f.sent(),n.weightData==null?[3,4]:((l=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,l.href=t,[4,Ny((function(){return l.dispatchEvent(new MouseEvent("click"))}))]);case 3:f.sent(),f.label=4;case 4:return[2,{modelArtifactsInfo:ju(n)}]}}))}))},r.URL_SCHEME="downloads://",r})(),o3=(function(){function r(n){if(n==null||n.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+n);this.files=n}return r.prototype.load=function(){return bt(this,void 0,void 0,(function(){var n,t,e=this;return xt(this,(function(a){return n=this.files[0],t=this.files.slice(1),[2,new Promise((function(u,s){var l=new FileReader;l.onload=function(f){var h=JSON.parse(f.target.result),p=h.modelTopology;if(p!=null){t.length===0&&u({modelTopology:p});var v=h.weightsManifest;if(v!=null){var m;try{m=e.checkManifestAndWeightFiles(v,t)}catch(_){return void s(_)}var y=[],x=[],w=[];v.forEach((function(_){_.paths.forEach((function(E){x.push(E),w.push(null)})),y.push.apply(y,_.weights)})),v.forEach((function(_){_.paths.forEach((function(E){var R=new FileReader;R.onload=function(A){var S=A.target.result,T=x.indexOf(E);w[T]=S,w.indexOf(null)===-1&&u({modelTopology:p,weightSpecs:y,weightData:ap(w),format:h.format,generatedBy:h.generatedBy,convertedBy:h.convertedBy,userDefinedMetadata:h.userDefinedMetadata})},R.onerror=function(A){return s("Failed to weights data from file of path '"+E+"'.")},R.readAsArrayBuffer(m[E])}))}))}else s(new Error("weightManifest field is missing from file "+n.name))}else s(new Error("modelTopology field is missing from file "+n.name))},l.onerror=function(f){return s("Failed to read model topology and weights manifest JSON from file '"+n.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},l.readAsText(n)}))]}))}))},r.prototype.checkManifestAndWeightFiles=function(n,t){for(var e=[],a=t.map((function(f){return Ry(f.name)})),u={},s=0,l=n;s<l.length;s++)l[s].paths.forEach((function(f){var h=Ry(f);if(e.indexOf(h)!==-1)throw new Error("Duplicate file basename found in weights manifest: '"+h+"'");if(e.push(h),a.indexOf(h)===-1)throw new Error("Weight file with basename '"+h+"' is not provided.");u[f]=t[a.indexOf(h)]}));if(e.length!==t.length)throw new Error("Mismatch in the number of files in weights manifest ("+e.length+") and the number of weight files provided ("+t.length+").");return u},r})();function My(r,n,t,e){(function(u){k(u!=null&&Array.isArray(u)&&u.length>0,(function(){return"promises must be a none empty array"}))})(r),(function(u,s){k(u>=0&&u<=1,(function(){return"Progress fraction must be in range [0, 1], but got startFraction "+u})),k(s>=0&&s<=1,(function(){return"Progress fraction must be in range [0, 1], but got endFraction "+s})),k(s>=u,(function(){return"startFraction must be no more than endFraction, but got startFraction "+u+" and endFraction "+s}))})(t=t??0,e=e??1);var a=0;return Promise.all(r.map((function(u){return u.then((function(s){var l=t+ ++a/r.length*(e-t);return n(l),s})),u})))}function yb(r,n){return bt(this,void 0,void 0,(function(){var t,e,a,u,s,l,f,h,p;return xt(this,(function(v){switch(v.label){case 0:return n==null&&(n={}),t=n.fetchFunc==null?st().platform.fetch:n.fetchFunc,e=r.map((function(m){return t(m,n.requestInit,{isBinary:!0})})),a=0,u=.5,n.onProgress!=null?[3,2]:[4,Promise.all(e)];case 1:return s=v.sent(),[3,4];case 2:return[4,My(e,n.onProgress,a,u)];case 3:s=v.sent(),v.label=4;case 4:return l=s.map((function(m){return m.arrayBuffer()})),f=.5,h=1,n.onProgress!=null?[3,6]:[4,Promise.all(l)];case 5:return p=v.sent(),[3,8];case 6:return[4,My(l,n.onProgress,f,h)];case 7:p=v.sent(),v.label=8;case 8:return[2,p]}}))}))}function Oy(r){var n=this;return function(t,e,a){return e===void 0&&(e=""),bt(n,void 0,void 0,(function(){var u,s,l,f,h,p,v,m,y,x;return xt(this,(function(w){switch(w.label){case 0:if(u=t.map((function(){return!1})),s={},l=a!=null?a.map((function(){return!1})):[],f=[],t.forEach((function(_,E){var R=0;_.weights.forEach((function(A){var S="quantization"in A?A.quantization.dtype:A.dtype,T=wd[S]*_t(A.shape),N=function(){u[E]=!0,s[E]==null&&(s[E]=[]),s[E].push({manifestEntry:A,groupOffset:R,sizeBytes:T})};a!=null?a.forEach((function(O,B){O===A.name&&(N(),l[B]=!0)})):N(),f.push(A.name),R+=T}))})),!l.every((function(_){return _})))throw h=a.filter((function(_,E){return!l[E]})),new Error("Could not find weights in manifest with names: "+h.join(", ")+`. 
Manifest JSON has weights with names: `+f.join(", ")+".");return p=u.reduce((function(_,E,R){return E&&_.push(R),_}),[]),v=[],p.forEach((function(_){t[_].paths.forEach((function(E){var R=e+(e.endsWith("/")?"":"/")+E;v.push(R)}))})),[4,r(v)];case 1:return m=w.sent(),y={},x=0,p.forEach((function(_){for(var E=t[_].paths.length,R=0,A=0;A<E;A++)R+=m[x+A].byteLength;for(var S=new ArrayBuffer(R),T=new Uint8Array(S),N=0,O=0;O<E;O++){var B=new Uint8Array(m[x+O]);T.set(B,N),N+=B.byteLength}s[_].forEach((function(I){var F=pb(S.slice(I.groupOffset,I.groupOffset+I.sizeBytes),[I.manifestEntry]);for(var G in F)y[G]=F[G]})),x+=E})),[2,y]}}))}))}}In.registerSaveRouter((function(r){return st().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(ed.URL_SCHEME)?(function(n){return n===void 0&&(n="model"),new ed(n)})(r.slice(ed.URL_SCHEME.length)):null}));var bb=(function(){function r(n,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,t.fetchFunc!=null?(k(typeof t.fetchFunc=="function",(function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"})),this.fetch=t.fetchFunc):this.fetch=st().platform.fetch,k(n!=null&&n.length>0,(function(){return"URL path for http must not be null, undefined or empty."})),Array.isArray(n)&&k(n.length===2,(function(){return"URL paths for http must have a length of 2, (actual length is "+n.length+")."})),this.path=n,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}return r.prototype.save=function(n){return bt(this,void 0,void 0,(function(){var t,e,a,u;return xt(this,(function(s){switch(s.label){case 0:if(n.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,e=[{paths:["./model.weights.bin"],weights:n.weightSpecs}],a={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,userDefinedMetadata:n.userDefinedMetadata,weightsManifest:e},t.body.append("model.json",new Blob([JSON.stringify(a)],{type:"application/json"}),"model.json"),n.weightData!=null&&t.body.append("model.weights.bin",new Blob([n.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,t)];case 1:if((u=s.sent()).ok)return[2,{modelArtifactsInfo:ju(n),responses:[u]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+u.status+".")}}))}))},r.prototype.load=function(){return bt(this,void 0,void 0,(function(){var n,t,e,a,u,s,l,f,h,p,v,m;return xt(this,(function(y){switch(y.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(n=y.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+n.status+". Please verify this URL points to the model JSON of the model to load.");y.label=2;case 2:return y.trys.push([2,4,,5]),[4,n.json()];case 3:return t=y.sent(),[3,5];case 4:throw y.sent(),e="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?e+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":e+=" Please make sure the server is serving valid JSON for this request.",new Error(e);case 5:if(a=t.modelTopology,u=t.weightsManifest,s=t.generatedBy,l=t.convertedBy,f=t.format,h=t.userDefinedMetadata,a==null&&u==null)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return u==null?[3,7]:[4,this.loadWeights(u)];case 6:m=y.sent(),p=m[0],v=m[1],y.label=7;case 7:return[2,{modelTopology:a,weightSpecs:p,weightData:v,userDefinedMetadata:h,generatedBy:s,convertedBy:l,format:f}]}}))}))},r.prototype.loadWeights=function(n){return bt(this,void 0,void 0,(function(){var t,e,a,u,s,l,f,h,p,v,m;return xt(this,(function(y){switch(y.label){case 0:for(t=Array.isArray(this.path)?this.path[1]:this.path,e=(function(x){var w=x.lastIndexOf("/"),_=x.lastIndexOf("?"),E=x.substring(0,w),R=_>w?x.substring(_):"";return[E+"/",R]})(t),a=e[0],u=e[1],s=this.weightPathPrefix||a,l=[],f=0,h=n;f<h.length;f++)p=h[f],l.push.apply(l,p.weights);return v=[],n.forEach((function(x){x.paths.forEach((function(w){v.push(s+w+u)}))})),[4,yb(v,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return m=y.sent(),[2,[l,ap(m)]]}}))}))},r.URL_SCHEME_REGEX=/^https?:\/\//,r})();function Cd(r){return r.match(bb.URL_SCHEME_REGEX)!=null}var ky=function(r,n){return typeof fetch>"u"?null:(Array.isArray(r)?r.every((function(t){return Cd(t)})):Cd(r))?Sd(r,{onProgress:n}):null};function Sd(r,n){return new bb(r,n)}In.registerSaveRouter(ky),In.registerLoadRouter(ky);var nd=(function(){function r(n){this.modelArtifacts=n}return r.prototype.load=function(){return bt(this,void 0,void 0,(function(){return xt(this,(function(n){return[2,this.modelArtifacts]}))}))},r})(),u3=(function(){function r(n){this.saveHandler=n}return r.prototype.save=function(n){return bt(this,void 0,void 0,(function(){return xt(this,(function(t){return[2,this.saveHandler(n)]}))}))},r})(),xb=Object.freeze({browserFiles:function(r){return new o3(r)},browserHTTPRequest:function(r,n){return Sd(r,n)},concatenateArrayBuffers:ap,decodeWeights:pb,encodeWeights:function(r,n){return bt(this,void 0,void 0,(function(){var t,e,a,u,s,l=this;return xt(this,(function(f){switch(f.label){case 0:for(t=[],e=[],a=Array.isArray(r)?r.map((function(h){return h.name})):Object.keys(r),u=function(h){var p=a[h],v=Array.isArray(r)?r[h].tensor:r[p];if(v.dtype!=="float32"&&v.dtype!=="int32"&&v.dtype!=="bool"&&v.dtype!=="string")throw new Error("Unsupported dtype in weight '"+p+"': "+v.dtype);var m={name:p,shape:v.shape,dtype:v.dtype};if(v.dtype==="string"){var y=new Promise((function(x){return bt(l,void 0,void 0,(function(){var w,_,E,R,A,S,T;return xt(this,(function(N){switch(N.label){case 0:return[4,v.bytes()];case 1:for(w=N.sent(),_=w.reduce((function(O,B){return O+B.length}),0)+ql*w.length,E=new Uint8Array(_),R=0,A=0;A<w.length;A++)S=w[A],T=new Uint8Array(new Uint32Array([S.length]).buffer),E.set(T,R),R+=ql,E.set(S,R),R+=S.length;return x(E),[2]}}))}))}));e.push(y)}else e.push(v.data());n!=null&&(m.group=n),t.push(m)},s=0;s<a.length;++s)u(s);return[4,Promise.all(e)];case 1:return[2,{data:YA(f.sent()),specs:t}]}}))}))},fromMemory:function(r,n,t,e){return arguments.length===1?r.modelTopology!=null||r.weightSpecs!=null?new nd(r):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new nd({modelTopology:r})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new nd({modelTopology:r,weightSpecs:n,weightData:t,trainingConfig:e}))},getLoadHandlers:function(r,n){return In.getLoadHandlers(r,n)},getModelArtifactsInfoForJSON:ju,getSaveHandlers:function(r){return In.getSaveHandlers(r)},http:Sd,isHTTPScheme:Cd,loadWeights:function(r,n,t,e){return n===void 0&&(n=""),bt(this,void 0,void 0,(function(){return xt(this,(function(a){return[2,Oy((function(u){return yb(u,{requestInit:e})}))(r,n,t)]}))}))},registerLoadRouter:function(r){return In.registerLoadRouter(r)},registerSaveRouter:function(r){return In.registerSaveRouter(r)},weightsLoaderFactory:Oy,withSaveHandler:function(r){return new u3(r)},copyModel:function(r,n){return bt(this,void 0,void 0,(function(){return xt(this,(function(t){return[2,Ay(r,n,!1)]}))}))},listModels:function(){return bt(this,void 0,void 0,(function(){var r,n,t,e,a,u,s;return xt(this,(function(l){switch(l.label){case 0:r=Fa.getSchemes(),n={},t=0,e=r,l.label=1;case 1:return t<e.length?(a=e[t],[4,Fa.getManager(a).listModels()]):[3,4];case 2:for(s in u=l.sent())n[a+yo+s]=u[s];l.label=3;case 3:return t++,[3,1];case 4:return[2,n]}}))}))},moveModel:function(r,n){return bt(this,void 0,void 0,(function(){return xt(this,(function(t){return[2,Ay(r,n,!0)]}))}))},removeModel:function(r){return bt(this,void 0,void 0,(function(){var n;return xt(this,(function(t){return n=Rl(r),[2,Fa.getManager(n.scheme).removeModel(n.path)]}))}))}}),so;P({confusionMatrix_:function(r,n,t){var e=M(r,"labels","confusionMatrix"),a=M(n,"predictions","confusionMatrix");k(t==null||t>0&&Number.isInteger(t),(function(){return"If provided, numClasses must be a positive integer, but got "+t})),k(e.rank===1,(function(){return"Expected the rank of labels to be 1, but got "+e.rank})),k(a.rank===1,(function(){return"Expected the rank of predictions to be 1, but got "+a.rank})),k(e.shape[0]===a.shape[0],(function(){return"Mismatch in the number of examples: "+e.shape[0]+" vs. "+a.shape[0]+". Labels and predictions should have the same number of elements."})),k(t>0&&Number.isInteger(t),(function(){return"numClasses is required to be a positive integer, but got "+t}));var u=md(e.asType("int32"),t),s=md(a.asType("int32"),t);return u.transpose().matMul(s).asType("int32")}});var s3=P({fromPixels_:function(r,n){if(n===void 0&&(n=3),n>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(r==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var t=!1,e=!1,a=!1,u=!1,s=!1;if(r.data instanceof Uint8Array)t=!0;else if(typeof ImageData<"u"&&r instanceof ImageData)e=!0;else if(typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement)a=!0;else if(typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement)u=!0;else{if(r.getContext==null)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+r.constructor.name);s=!0}if(a&&a&&r.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(Wy("FromPixels",W.backendName)!=null)return W.runKernel("FromPixels",{pixels:r},{numChannels:n});var l,f,h=a?[r.videoWidth,r.videoHeight]:[r.width,r.height],p=h[0],v=h[1];if(s?l=r.getContext("2d").getImageData(0,0,p,v).data:e||t?l=r.data:(u||a)&&(so==null&&(so=document.createElement("canvas").getContext("2d")),so.canvas.width=p,so.canvas.height=v,so.drawImage(r,0,0,p,v),l=so.getImageData(0,0,p,v).data),n===4)f=new Int32Array(l);else{var m=p*v;f=new Int32Array(m*n);for(var y=0;y<m;y++)for(var x=0;x<n;++x)f[y*n+x]=l[4*y+x]}return kd(f,[v,p,n],"int32")}}),ip=Object.freeze({toPixels:function(r,n){return bt(this,void 0,void 0,(function(){var t,e,a,u,s,l,f,h,p,v,m,y,x,w,_,E,R,A,S,T,N,O,B;return xt(this,(function(I){switch(I.label){case 0:if(t=M(r,"img","toPixels"),r instanceof pe||(t=t.toInt()),t.rank!==2&&t.rank!==3)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+t.rank+".");if(e=t.shape.slice(0,2),a=e[0],u=e[1],(s=t.rank===2?1:t.shape[2])>4||s===2)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+s);return[4,t.data()];case 1:return l=I.sent(),f=t.min(),h=t.max(),[4,Promise.all([f.data(),h.data()])];case 2:if(p=I.sent(),v=p[0],m=p[1],y=v[0],x=m[0],f.dispose(),h.dispose(),t.dtype==="float32"){if(y<0||x>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+y+" - "+x+"].")}else{if(t.dtype!=="int32")throw new Error("Unsupported type for toPixels: "+t.dtype+". Please use float32 or int32 tensors.");if(y<0||x>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+y+" - "+x+"].")}for(w=t.dtype==="float32"?255:1,_=new Uint8ClampedArray(u*a*4),E=0;E<a*u;++E)R=void 0,A=void 0,S=void 0,T=void 0,s===1?(R=l[E]*w,A=l[E]*w,S=l[E]*w,T=255):s===3?(R=l[3*E]*w,A=l[3*E+1]*w,S=l[3*E+2]*w,T=255):s===4&&(R=l[4*E]*w,A=l[4*E+1]*w,S=l[4*E+2]*w,T=l[4*E+3]*w),_[(N=4*E)+0]=Math.round(R),_[N+1]=Math.round(A),_[N+2]=Math.round(S),_[N+3]=Math.round(T);return n!=null&&(n.width=u,n.height=a,O=n.getContext("2d"),B=new ImageData(_,u,a),O.putImageData(B,0,0)),t!==r&&t.dispose(),[2,_]}}))}))},fromPixels:s3}),l3=(function(){function r(){}return r.prototype.getClassName=function(){return this.constructor.className},r.fromConfig=function(n,t){return new n(t)},r})(),c3=(function(){function r(){this.classNameMap={}}return r.getMap=function(){return r.instance==null&&(r.instance=new r),r.instance},r.register=function(n){r.getMap().classNameMap[n.className]=[n,n.fromConfig]},r})();function bi(r){k(r.className!=null,(function(){return"Class being registered does not have the static className property defined."})),k(typeof r.className=="string",(function(){return"className is required to be a string, but got type "+typeof r.className})),k(r.className.length>0,(function(){return"Class being registered has an empty-string as its className, which is disallowed."})),c3.register(r)}var xi=(function(r){function n(){return r!==null&&r.apply(this,arguments)||this}return sr(n,r),n.prototype.minimize=function(t,e,a){e===void 0&&(e=!1);var u=this.computeGradients(t,a),s=u.value,l=u.grads;if(a!=null){var f=a.map((function(h){return{name:h.name,tensor:l[h.name]}}));this.applyGradients(f)}else this.applyGradients(l);return yn(l),e?s:(s.dispose(),null)},Object.defineProperty(n.prototype,"iterations",{get:function(){return this.iterations_==null&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),n.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},n.prototype.computeGradients=function(t,e){return xE(t,e)},n.prototype.dispose=function(){this.iterations_!=null&&yn(this.iterations_)},n.prototype.saveIterations=function(){return bt(this,void 0,void 0,(function(){return xt(this,(function(t){return this.iterations_==null&&(this.iterations_=0),[2,{name:"iter",tensor:pt(this.iterations_,"int32")}]}))}))},n.prototype.getWeights=function(){return bt(this,void 0,void 0,(function(){return xt(this,(function(t){throw new Error("getWeights() is not implemented for this optimizer yet.")}))}))},n.prototype.setWeights=function(t){return bt(this,void 0,void 0,(function(){return xt(this,(function(e){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())}))}))},n.prototype.extractIterations=function(t){return bt(this,void 0,void 0,(function(){var e;return xt(this,(function(a){switch(a.label){case 0:return e=this,[4,t[0].tensor.data()];case 1:return e.iterations_=a.sent()[0],[2,t.slice(1)]}}))}))},n})(l3);Object.defineProperty(xi,Symbol.hasInstance,{value:function(r){return r.minimize!=null&&r.computeGradients!=null&&r.applyGradients!=null}});var f3=(function(r){function n(t,e,a){a===void 0&&(a=null);var u=r.call(this)||this;return u.learningRate=t,u.rho=e,u.epsilon=a,u.accumulatedGrads=[],u.accumulatedUpdates=[],a==null&&(u.epsilon=W.backend.epsilon()),u}return sr(n,r),n.prototype.applyGradients=function(t){var e=this;(Array.isArray(t)?t.map((function(a){return a.name})):Object.keys(t)).forEach((function(a,u){var s=W.registeredVariables[a];e.accumulatedGrads[u]==null&&(e.accumulatedGrads[u]={originalName:a+"/accum_grad",variable:mt((function(){return jt(s).variable(!1)}))}),e.accumulatedUpdates[u]==null&&(e.accumulatedUpdates[u]={originalName:a+"/accum_var",variable:mt((function(){return jt(s).variable(!1)}))});var l=Array.isArray(t)?t[u].tensor:t[a];if(l!=null){var f=e.accumulatedGrads[u].variable,h=e.accumulatedUpdates[u].variable;mt((function(){var p=f.mul(e.rho).add(l.square().mul(1-e.rho)),v=h.add(e.epsilon).sqrt().div(f.add(e.epsilon).sqrt()).mul(l),m=h.mul(e.rho).add(v.square().mul(1-e.rho));f.assign(p),h.assign(m);var y=v.mul(-e.learningRate).add(s);s.assign(y)}))}})),this.incrementIterations()},n.prototype.dispose=function(){this.accumulatedUpdates!=null&&(yn(this.accumulatedGrads.map((function(t){return t.variable}))),yn(this.accumulatedUpdates.map((function(t){return t.variable}))))},n.prototype.getWeights=function(){return bt(this,void 0,void 0,(function(){var t;return xt(this,(function(e){switch(e.label){case 0:return t=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(t.map((function(a){return{name:a.originalName,tensor:a.variable}})))]}}))}))},n.prototype.setWeights=function(t){return bt(this,void 0,void 0,(function(){var e;return xt(this,(function(a){switch(a.label){case 0:return[4,this.extractIterations(t)];case 1:return t=a.sent(),e=t.length/2,this.accumulatedGrads=t.slice(0,e).map((function(u){return{originalName:u.name,variable:u.tensor.variable(!1)}})),this.accumulatedUpdates=t.slice(e,2*e).map((function(u){return{originalName:u.name,variable:u.tensor.variable(!1)}})),[2]}}))}))},n.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},n.fromConfig=function(t,e){return new t(e.learningRate,e.rho,e.epsilon)},n.className="Adadelta",n})(xi);bi(f3);var h3=(function(r){function n(t,e){e===void 0&&(e=.1);var a=r.call(this)||this;return a.learningRate=t,a.initialAccumulatorValue=e,a.accumulatedGrads=[],a}return sr(n,r),n.prototype.applyGradients=function(t){var e=this;(Array.isArray(t)?t.map((function(a){return a.name})):Object.keys(t)).forEach((function(a,u){var s=W.registeredVariables[a];e.accumulatedGrads[u]==null&&(e.accumulatedGrads[u]={originalName:a+"/accumulator",variable:mt((function(){return Cr(s.shape,e.initialAccumulatorValue).variable(!1)}))});var l=Array.isArray(t)?t[u].tensor:t[a];if(l!=null){var f=e.accumulatedGrads[u].variable;mt((function(){var h=f.add(l.square());f.assign(h);var p=l.div(h.add(W.backend.epsilon()).sqrt()).mul(-e.learningRate).add(s);s.assign(p)}))}})),this.incrementIterations()},n.prototype.dispose=function(){this.accumulatedGrads!=null&&yn(this.accumulatedGrads.map((function(t){return t.variable})))},n.prototype.getWeights=function(){return bt(this,void 0,void 0,(function(){return xt(this,(function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulatedGrads.map((function(e){return{name:e.originalName,tensor:e.variable}})))]}}))}))},n.prototype.setWeights=function(t){return bt(this,void 0,void 0,(function(){return xt(this,(function(e){switch(e.label){case 0:return[4,this.extractIterations(t)];case 1:return t=e.sent(),this.accumulatedGrads=t.map((function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}})),[2]}}))}))},n.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},n.fromConfig=function(t,e){return new t(e.learningRate,e.initialAccumulatorValue)},n.className="Adagrad",n})(xi);bi(h3);var d3=(function(r){function n(t,e,a,u){u===void 0&&(u=null);var s=r.call(this)||this;return s.learningRate=t,s.beta1=e,s.beta2=a,s.epsilon=u,s.accumulatedFirstMoment=[],s.accumulatedSecondMoment=[],mt((function(){s.accBeta1=pt(e).variable(),s.accBeta2=pt(a).variable()})),u==null&&(s.epsilon=W.backend.epsilon()),s}return sr(n,r),n.prototype.applyGradients=function(t){var e=this,a=Array.isArray(t)?t.map((function(u){return u.name})):Object.keys(t);mt((function(){var u=Be(1,e.accBeta1),s=Be(1,e.accBeta2);a.forEach((function(l,f){var h=W.registeredVariables[l];e.accumulatedFirstMoment[f]==null&&(e.accumulatedFirstMoment[f]={originalName:l+"/m",variable:mt((function(){return jt(h).variable(!1)}))}),e.accumulatedSecondMoment[f]==null&&(e.accumulatedSecondMoment[f]={originalName:l+"/v",variable:mt((function(){return jt(h).variable(!1)}))});var p=Array.isArray(t)?t[f].tensor:t[l];if(p!=null){var v=e.accumulatedFirstMoment[f].variable,m=e.accumulatedSecondMoment[f].variable,y=v.mul(e.beta1).add(p.mul(1-e.beta1)),x=m.mul(e.beta2).add(p.square().mul(1-e.beta2)),w=y.div(u),_=x.div(s);v.assign(y),m.assign(x);var E=w.div(_.sqrt().add(e.epsilon)).mul(-e.learningRate).add(h);h.assign(E)}})),e.accBeta1.assign(e.accBeta1.mul(e.beta1)),e.accBeta2.assign(e.accBeta2.mul(e.beta2))})),this.incrementIterations()},n.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&yn(this.accumulatedFirstMoment.map((function(t){return t.variable}))),this.accumulatedSecondMoment!=null&&yn(this.accumulatedSecondMoment.map((function(t){return t.variable})))},n.prototype.getWeights=function(){return bt(this,void 0,void 0,(function(){var t;return xt(this,(function(e){switch(e.label){case 0:return t=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(t.map((function(a){return{name:a.originalName,tensor:a.variable}})))]}}))}))},n.prototype.setWeights=function(t){return bt(this,void 0,void 0,(function(){var e,a=this;return xt(this,(function(u){switch(u.label){case 0:return[4,this.extractIterations(t)];case 1:return t=u.sent(),mt((function(){a.accBeta1.assign(Gl(a.beta1,a.iterations_+1)),a.accBeta2.assign(Gl(a.beta2,a.iterations_+1))})),e=t.length/2,this.accumulatedFirstMoment=t.slice(0,e).map((function(s){return{originalName:s.name,variable:s.tensor.variable(!1)}})),this.accumulatedSecondMoment=t.slice(e,2*e).map((function(s){return{originalName:s.name,variable:s.tensor.variable(!1)}})),[2]}}))}))},n.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},n.fromConfig=function(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon)},n.className="Adam",n})(xi);bi(d3);var p3=(function(r){function n(t,e,a,u,s){u===void 0&&(u=null),s===void 0&&(s=0);var l=r.call(this)||this;return l.learningRate=t,l.beta1=e,l.beta2=a,l.epsilon=u,l.decay=s,l.accumulatedFirstMoment=[],l.accumulatedWeightedInfNorm=[],mt((function(){l.iteration=pt(0).variable(),l.accBeta1=pt(e).variable()})),u==null&&(l.epsilon=W.backend.epsilon()),l}return sr(n,r),n.prototype.applyGradients=function(t){var e=this,a=Array.isArray(t)?t.map((function(u){return u.name})):Object.keys(t);mt((function(){var u=Be(1,e.accBeta1),s=ir(-e.learningRate,e.iteration.mul(e.decay).add(1));a.forEach((function(l,f){var h=W.registeredVariables[l];e.accumulatedFirstMoment[f]==null&&(e.accumulatedFirstMoment[f]={originalName:l+"/m",variable:jt(h).variable(!1)}),e.accumulatedWeightedInfNorm[f]==null&&(e.accumulatedWeightedInfNorm[f]={originalName:l+"/v",variable:jt(h).variable(!1)});var p=Array.isArray(t)?t[f].tensor:t[l];if(p!=null){var v=e.accumulatedFirstMoment[f].variable,m=e.accumulatedWeightedInfNorm[f].variable,y=v.mul(e.beta1).add(p.mul(1-e.beta1)),x=m.mul(e.beta2),w=p.abs(),_=x.maximum(w);v.assign(y),m.assign(_);var E=s.div(u).mul(y.div(_.add(e.epsilon))).add(h);h.assign(E)}})),e.iteration.assign(e.iteration.add(1)),e.accBeta1.assign(e.accBeta1.mul(e.beta1))})),this.incrementIterations()},n.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&yn(this.accumulatedFirstMoment.map((function(t){return t.variable}))),this.accumulatedWeightedInfNorm!=null&&yn(this.accumulatedWeightedInfNorm.map((function(t){return t.variable})))},n.prototype.getWeights=function(){return bt(this,void 0,void 0,(function(){return xt(this,(function(t){throw new Error("getWeights() is not implemented for Adamax yet.")}))}))},n.prototype.setWeights=function(t){return bt(this,void 0,void 0,(function(){return xt(this,(function(e){throw new Error("setWeights() is not implemented for Adamax yet.")}))}))},n.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},n.fromConfig=function(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon,e.decay)},n.className="Adamax",n})(xi);bi(p3);var wb=(function(r){function n(t){var e=r.call(this)||this;return e.learningRate=t,e.setLearningRate(t),e}return sr(n,r),n.prototype.applyGradients=function(t){var e=this;(Array.isArray(t)?t.map((function(a){return a.name})):Object.keys(t)).forEach((function(a,u){var s=Array.isArray(t)?t[u].tensor:t[a];if(s!=null){var l=W.registeredVariables[a];mt((function(){var f=e.c.mul(s).add(l);l.assign(f)}))}})),this.incrementIterations()},n.prototype.setLearningRate=function(t){this.learningRate=t,this.c!=null&&this.c.dispose(),this.c=I_(pt(-t))},n.prototype.dispose=function(){this.c.dispose()},n.prototype.getWeights=function(){return bt(this,void 0,void 0,(function(){return xt(this,(function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()]]}}))}))},n.prototype.setWeights=function(t){return bt(this,void 0,void 0,(function(){return xt(this,(function(e){switch(e.label){case 0:return[4,this.extractIterations(t)];case 1:if((t=e.sent()).length!==0)throw new Error("SGD optimizer does not have settable weights.");return[2]}}))}))},n.prototype.getConfig=function(){return{learningRate:this.learningRate}},n.fromConfig=function(t,e){return new t(e.learningRate)},n.className="SGD",n})(xi);bi(wb);var v3=(function(r){function n(t,e,a){a===void 0&&(a=!1);var u=r.call(this,t)||this;return u.learningRate=t,u.momentum=e,u.useNesterov=a,u.accumulations=[],u.m=pt(u.momentum),u}return sr(n,r),n.prototype.applyGradients=function(t){var e=this;(Array.isArray(t)?t.map((function(a){return a.name})):Object.keys(t)).forEach((function(a,u){var s=W.registeredVariables[a];e.accumulations[u]==null&&(e.accumulations[u]={originalName:a+"/momentum",variable:mt((function(){return jt(s).variable(!1)}))});var l=e.accumulations[u].variable,f=Array.isArray(t)?t[u].tensor:t[a];f!=null&&mt((function(){var h,p=e.m.mul(l).add(f);h=e.useNesterov?e.c.mul(f.add(p.mul(e.m))).add(s):e.c.mul(p).add(s),l.assign(p),s.assign(h)}))})),this.incrementIterations()},n.prototype.dispose=function(){this.m.dispose(),this.accumulations!=null&&yn(this.accumulations.map((function(t){return t.variable})))},n.prototype.setMomentum=function(t){this.momentum=t},n.prototype.getWeights=function(){return bt(this,void 0,void 0,(function(){return xt(this,(function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulations.map((function(e){return{name:e.originalName,tensor:e.variable}})))]}}))}))},n.prototype.setWeights=function(t){return bt(this,void 0,void 0,(function(){return xt(this,(function(e){switch(e.label){case 0:return[4,this.extractIterations(t)];case 1:return t=e.sent(),this.accumulations=t.map((function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}})),[2]}}))}))},n.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},n.fromConfig=function(t,e){return new t(e.learningRate,e.momentum,e.useNesterov)},n.className="Momentum",n})(wb);bi(v3);var m3=(function(r){function n(t,e,a,u,s){e===void 0&&(e=.9),a===void 0&&(a=0),u===void 0&&(u=null),s===void 0&&(s=!1);var l=r.call(this)||this;if(l.learningRate=t,l.decay=e,l.momentum=a,l.epsilon=u,l.accumulatedMeanSquares=[],l.accumulatedMoments=[],l.accumulatedMeanGrads=[],l.centered=s,u==null&&(l.epsilon=W.backend.epsilon()),t==null)throw new Error("learningRate for RMSPropOptimizer must be defined.");return l}return sr(n,r),n.prototype.applyGradients=function(t){var e=this;(Array.isArray(t)?t.map((function(a){return a.name})):Object.keys(t)).forEach((function(a,u){var s=W.registeredVariables[a];e.accumulatedMeanSquares[u]==null&&(e.accumulatedMeanSquares[u]={originalName:a+"/rms",variable:mt((function(){return jt(s).variable(!1)}))}),e.accumulatedMoments[u]==null&&(e.accumulatedMoments[u]={originalName:a+"/momentum",variable:mt((function(){return jt(s).variable(!1)}))}),e.accumulatedMeanGrads[u]==null&&e.centered&&(e.accumulatedMeanGrads[u]={originalName:a+"/mg",variable:mt((function(){return jt(s).variable(!1)}))});var l=Array.isArray(t)?t[u].tensor:t[a];if(l!=null){var f=e.accumulatedMeanSquares[u].variable,h=e.accumulatedMoments[u].variable;mt((function(){var p=f.mul(e.decay).add(l.square().mul(1-e.decay));if(e.centered){var v=e.accumulatedMeanGrads[u].variable,m=v.mul(e.decay).add(l.mul(1-e.decay)),y=h.mul(e.momentum).add(l.mul(e.learningRate).div(p.sub(m.square().add(e.epsilon)).sqrt()));f.assign(p),v.assign(m),h.assign(y);var x=s.sub(y);s.assign(x)}else{var w=f.mul(e.decay).add(l.square().mul(1-e.decay));y=h.mul(e.momentum).add(l.mul(e.learningRate).div(w.add(e.epsilon).sqrt())),f.assign(w),h.assign(y),x=s.sub(y),s.assign(x)}}))}})),this.incrementIterations()},n.prototype.dispose=function(){this.accumulatedMeanSquares!=null&&yn(this.accumulatedMeanSquares.map((function(t){return t.variable}))),this.accumulatedMeanGrads!=null&&this.centered&&yn(this.accumulatedMeanGrads.map((function(t){return t.variable}))),this.accumulatedMoments!=null&&yn(this.accumulatedMoments.map((function(t){return t.variable})))},n.prototype.getWeights=function(){return bt(this,void 0,void 0,(function(){var t;return xt(this,(function(e){switch(e.label){case 0:return t=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&t.push.apply(t,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(t.map((function(a){return{name:a.originalName,tensor:a.variable}})))]}}))}))},n.prototype.setWeights=function(t){return bt(this,void 0,void 0,(function(){var e;return xt(this,(function(a){switch(a.label){case 0:return[4,this.extractIterations(t)];case 1:return t=a.sent(),e=this.centered?t.length/3:t.length/2,this.accumulatedMeanSquares=t.slice(0,e).map((function(u){return{originalName:u.name,variable:u.tensor.variable(!1)}})),this.accumulatedMoments=t.slice(e,2*e).map((function(u){return{originalName:u.name,variable:u.tensor.variable(!1)}})),this.centered&&(this.accumulatedMeanGrads=t.slice(2*e,3*e).map((function(u){return{originalName:u.name,variable:u.tensor.variable(!1)}}))),[2]}}))}))},n.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},n.fromConfig=function(t,e){return new t(e.learningRate,e.decay,e.momentum,e.epsilon,e.centered)},n.className="RMSProp",n})(xi);bi(m3);pe.prototype.squaredDifference=function(r){return F1(this,r)},tt=VA;var Rd=function(r,n){return Rd=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])},Rd(r,n)};function Mt(r,n){Rd(r,n);function t(){this.constructor=r}r.prototype=n===null?Object.create(n):(t.prototype=n.prototype,new t)}var tn=function(){return tn=Object.assign||function(n){for(var t,e=1,a=arguments.length;e<a;e++){t=arguments[e];for(var u in t)Object.prototype.hasOwnProperty.call(t,u)&&(n[u]=t[u])}return n},tn.apply(this,arguments)};function Ct(r,n,t,e){function a(u){return u instanceof t?u:new t(function(s){s(u)})}return new(t||(t=Promise))(function(u,s){function l(p){try{h(e.next(p))}catch(v){s(v)}}function f(p){try{h(e.throw(p))}catch(v){s(v)}}function h(p){p.done?u(p.value):a(p.value).then(l,f)}h((e=e.apply(r,[])).next())})}function St(r,n){var t={label:0,sent:function(){if(u[0]&1)throw u[1];return u[1]},trys:[],ops:[]},e,a,u,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(h){return function(p){return f([h,p])}}function f(h){if(e)throw new TypeError("Generator is already executing.");for(;t;)try{if(e=1,a&&(u=h[0]&2?a.return:h[0]?a.throw||((u=a.return)&&u.call(a),0):a.next)&&!(u=u.call(a,h[1])).done)return u;switch(a=0,u&&(h=[h[0]&2,u.value]),h[0]){case 0:case 1:u=h;break;case 4:return t.label++,{value:h[1],done:!1};case 5:t.label++,a=h[1],h=[0];continue;case 7:h=t.ops.pop(),t.trys.pop();continue;default:if(u=t.trys,!(u=u.length>0&&u[u.length-1])&&(h[0]===6||h[0]===2)){t=0;continue}if(h[0]===3&&(!u||h[1]>u[0]&&h[1]<u[3])){t.label=h[1];break}if(h[0]===6&&t.label<u[1]){t.label=u[1],u=h;break}if(u&&t.label<u[2]){t.label=u[2],t.ops.push(h);break}u[2]&&t.ops.pop(),t.trys.pop();continue}h=n.call(r,t)}catch(p){h=[6,p],a=0}finally{e=u=0}if(h[0]&5)throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}}function Tu(){for(var r=0,n=0,t=arguments.length;n<t;n++)r+=arguments[n].length;for(var e=Array(r),a=0,n=0;n<t;n++)for(var u=arguments[n],s=0,l=u.length;s<l;s++,a++)e[a]=u[s];return e}var hi=(function(){function r(n,t){if(!di(n)||!di(t))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:n,height:t}));this._width=n,this._height=t}return Object.defineProperty(r.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),r.prototype.reverse=function(){return new r(1/this.width,1/this.height)},r})();function ac(r,n){return r instanceof pe&&r.shape.length===n}function g3(r){return ac(r,2)}function ic(r){return ac(r,3)}function za(r){return ac(r,4)}function y3(r){return r%1!==0}function Iy(r){return r%2===0}function op(r,n){n===void 0&&(n=2);var t=Math.pow(10,n);return Math.floor(r*t)/t}function By(r){return r&&r.width&&r.height}function b3(r,n){var t=r.width,e=r.height,a=n/Math.max(e,t);return new hi(Math.round(t*a),Math.round(e*a))}function up(r){return r.reduce(function(n,t){return n.add(t)},new Qt(0,0)).div(new Qt(r.length,r.length))}function Iu(r,n,t){return Array(r).fill(0).map(function(e,a){return n+a*t})}function di(r){return!!r&&r!==1/0&&r!==-1/0&&!isNaN(r)||r===0}function Fy(r){return di(r)&&0<=r&&r<=1}var Qt=(function(){function r(n,t){this._x=n,this._y=t}return Object.defineProperty(r.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),r.prototype.add=function(n){return new r(this.x+n.x,this.y+n.y)},r.prototype.sub=function(n){return new r(this.x-n.x,this.y-n.y)},r.prototype.mul=function(n){return new r(this.x*n.x,this.y*n.y)},r.prototype.div=function(n){return new r(this.x/n.x,this.y/n.y)},r.prototype.abs=function(){return new r(Math.abs(this.x),Math.abs(this.y))},r.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},r.prototype.floor=function(){return new r(Math.floor(this.x),Math.floor(this.y))},r})(),Rr=(function(){function r(n,t){t===void 0&&(t=!0);var e=n||{},a=[e.left,e.top,e.right,e.bottom].every(di),u=[e.x,e.y,e.width,e.height].every(di);if(!u&&!a)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(e));var s=u?[e.x,e.y,e.width,e.height]:[e.left,e.top,e.right-e.left,e.bottom-e.top],l=s[0],f=s[1],h=s[2],p=s[3];r.assertIsValidBox({x:l,y:f,width:h,height:p},"Box.constructor",t),this._x=l,this._y=f,this._width=h,this._height=p}return r.isRect=function(n){return!!n&&[n.x,n.y,n.width,n.height].every(di)},r.assertIsValidBox=function(n,t,e){if(e===void 0&&(e=!1),!r.isRect(n))throw new Error(t+" - invalid box: "+JSON.stringify(n)+", expected object with properties x, y, width, height");if(!e&&(n.width<0||n.height<0))throw new Error(t+" - width ("+n.width+") and height ("+n.height+") must be positive numbers")},Object.defineProperty(r.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"topLeft",{get:function(){return new Qt(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"topRight",{get:function(){return new Qt(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"bottomLeft",{get:function(){return new Qt(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"bottomRight",{get:function(){return new Qt(this.right,this.bottom)},enumerable:!0,configurable:!0}),r.prototype.round=function(){var n=[this.x,this.y,this.width,this.height].map(function(s){return Math.round(s)}),t=n[0],e=n[1],a=n[2],u=n[3];return new r({x:t,y:e,width:a,height:u})},r.prototype.floor=function(){var n=[this.x,this.y,this.width,this.height].map(function(s){return Math.floor(s)}),t=n[0],e=n[1],a=n[2],u=n[3];return new r({x:t,y:e,width:a,height:u})},r.prototype.toSquare=function(){var n=this,t=n.x,e=n.y,a=n.width,u=n.height,s=Math.abs(a-u);return a<u&&(t-=s/2,a+=s),u<a&&(e-=s/2,u+=s),new r({x:t,y:e,width:a,height:u})},r.prototype.rescale=function(n){var t=By(n)?n.width:n,e=By(n)?n.height:n;return new r({x:this.x*t,y:this.y*e,width:this.width*t,height:this.height*e})},r.prototype.pad=function(n,t){var e=[this.x-n/2,this.y-t/2,this.width+n,this.height+t],a=e[0],u=e[1],s=e[2],l=e[3];return new r({x:a,y:u,width:s,height:l})},r.prototype.clipAtImageBorders=function(n,t){var e=this,a=e.x,u=e.y,s=e.right,l=e.bottom,f=Math.max(a,0),h=Math.max(u,0),p=s-f,v=l-h,m=Math.min(p,n-f),y=Math.min(v,t-h);return new r({x:f,y:h,width:m,height:y}).floor()},r.prototype.shift=function(n,t){var e=this,a=e.width,u=e.height,s=this.x+n,l=this.y+t;return new r({x:s,y:l,width:a,height:u})},r.prototype.padAtBorders=function(n,t){var e=this.width+1,a=this.height+1,u=1,s=1,l=e,f=a,h=this.left,p=this.top,v=this.right,m=this.bottom;return v>t&&(l=-v+t+e,v=t),m>n&&(f=-m+n+a,m=n),h<1&&(f=2-h,h=1),p<1&&(f=2-p,p=1),{dy:s,edy:f,dx:u,edx:l,y:p,ey:m,x:h,ex:v,w:e,h:a}},r.prototype.calibrate=function(n){return new r({left:this.left+n.left*this.width,top:this.top+n.top*this.height,right:this.right+n.right*this.width,bottom:this.bottom+n.bottom*this.height}).toSquare().round()},r})(),oc=(function(r){Mt(n,r);function n(t,e,a,u,s){return s===void 0&&(s=!1),r.call(this,{left:t,top:e,right:a,bottom:u},s)||this}return n})(Rr),_b=(function(){function r(n,t,e,a,u){this._imageDims=new hi(u.width,u.height),this._score=n,this._classScore=t,this._className=e,this._box=new Rr(a).rescale(this._imageDims)}return Object.defineProperty(r.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"relativeBox",{get:function(){return new Rr(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),r.prototype.forSize=function(n,t){return new r(this.score,this.classScore,this.className,this.relativeBox,{width:n,height:t})},r})(),zn=(function(r){Mt(n,r);function n(t,e,a){return r.call(this,t,t,"",e,a)||this}return n.prototype.forSize=function(t,e){var a=r.prototype.forSize.call(this,t,e),u=a.score,s=a.relativeBox,l=a.imageDims;return new n(u,s,l)},n})(_b);function x3(r,n,t){t===void 0&&(t=!0);var e=Math.max(0,Math.min(r.right,n.right)-Math.max(r.left,n.left)),a=Math.max(0,Math.min(r.bottom,n.bottom)-Math.max(r.top,n.top)),u=e*a;return t?u/(r.area+n.area-u):u/Math.min(r.area,n.area)}function w3(r){var n=r.map(function(l){return l.x}),t=r.map(function(l){return l.y}),e=n.reduce(function(l,f){return f<l?f:l},1/0),a=t.reduce(function(l,f){return f<l?f:l},1/0),u=n.reduce(function(l,f){return l<f?f:l},0),s=t.reduce(function(l,f){return l<f?f:l},0);return new oc(e,a,u,s)}function Bu(r,n,t,e){e===void 0&&(e=!0);for(var a=n.map(function(l,f){return{score:l,boxIndex:f}}).sort(function(l,f){return l.score-f.score}).map(function(l){return l.boxIndex}),u=[],s=function(){var l=a.pop();u.push(l);for(var f=a,h=[],p=0;p<f.length;p++){var v=f[p],m=r[l],y=r[v];h.push(x3(m,y,e))}a=a.filter(function(x,w){return h[w]<=t})};a.length>0;)s();return u}function Xu(r,n){return mt(function(){var t=n[0],e=n[1],a=n[2],u=Cr(Tu(r.shape.slice(0,3),[1]),t),s=Cr(Tu(r.shape.slice(0,3),[1]),e),l=Cr(Tu(r.shape.slice(0,3),[1]),a),f=Oe([u,s,l],3);return Be(r,f)})}function _3(r,n){return n===void 0&&(n=!1),mt(function(){var t=r.shape.slice(1),e=t[0],a=t[1];if(e===a)return r;var u=Math.abs(e-a),s=Math.round(u*(n?.5:1)),l=e>a?2:1,f=function(y){var x=r.shape.slice();return x[l]=y,Cr(x,0)},h=f(s),p=u-h.shape[l],v=n&&p?f(p):null,m=[v,r,h].filter(function(y){return!!y}).map(function(y){return y.toFloat()});return Oe(m,l)})}function rd(r){return 1/(1+Math.exp(-r))}var sp=(function(r){Mt(n,r);function n(t,e,a,u,s){return s===void 0&&(s=!1),r.call(this,{x:t,y:e,width:a,height:u},s)||this}return n})(Rr),E3=.5,C3=.43,S3=.45,Fu=(function(){function r(n,t,e){e===void 0&&(e=new Qt(0,0));var a=t.width,u=t.height;this._imgDims=new hi(a,u),this._shift=e,this._positions=n.map(function(s){return s.mul(new Qt(a,u)).add(e)})}return Object.defineProperty(r.prototype,"shift",{get:function(){return new Qt(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"relativePositions",{get:function(){var n=this;return this._positions.map(function(t){return t.sub(n._shift).div(new Qt(n.imageWidth,n.imageHeight))})},enumerable:!0,configurable:!0}),r.prototype.forSize=function(n,t){return new this.constructor(this.relativePositions,{width:n,height:t})},r.prototype.shiftBy=function(n,t){return new this.constructor(this.relativePositions,this._imgDims,new Qt(n,t))},r.prototype.shiftByPoint=function(n){return this.shiftBy(n.x,n.y)},r.prototype.align=function(n,t){if(t===void 0&&(t={}),n){var e=n instanceof zn?n.box.floor():new Rr(n);return this.shiftBy(e.x,e.y).align(null,t)}var a=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},t),u=a.useDlibAlignment,s=a.minBoxPadding;return u?this.alignDlib():this.alignMinBbox(s)},r.prototype.alignDlib=function(){var n=this.getRefPointsForAlignment(),t=n[0],e=n[1],a=n[2],u=function(v){return a.sub(v).magnitude()},s=(u(t)+u(e))/2,l=Math.floor(s/S3),f=up(n),h=Math.floor(Math.max(0,f.x-E3*l)),p=Math.floor(Math.max(0,f.y-C3*l));return new sp(h,p,Math.min(l,this.imageWidth+h),Math.min(l,this.imageHeight+p))},r.prototype.alignMinBbox=function(n){var t=w3(this.positions);return t.pad(t.width*n,t.height*n)},r.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},r})(),R3=(function(r){Mt(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.getRefPointsForAlignment=function(){var t=this.positions;return[t[0],t[1],up([t[3],t[4]])]},n})(Fu),A3=(function(r){Mt(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.getJawOutline=function(){return this.positions.slice(0,17)},n.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},n.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},n.prototype.getNose=function(){return this.positions.slice(27,36)},n.prototype.getLeftEye=function(){return this.positions.slice(36,42)},n.prototype.getRightEye=function(){return this.positions.slice(42,48)},n.prototype.getMouth=function(){return this.positions.slice(48,68)},n.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(up)},n})(Fu),zy=(function(){function r(n,t){this._label=n,this._distance=t}return Object.defineProperty(r.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),r.prototype.toString=function(n){return n===void 0&&(n=!0),""+this.label+(n?" ("+op(this.distance)+")":"")},r})(),Ly=(function(r){Mt(n,r);function n(t,e){var a=r.call(this,t)||this;return a._label=e,a}return n.assertIsValidLabeledBox=function(t,e){if(Rr.assertIsValidBox(t,e),!di(t.label))throw new Error(e+" - expected property label ("+t.label+") to be a number")},Object.defineProperty(n.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),n})(Rr),wl=(function(){function r(n,t){if(typeof n!="string")throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(t)||t.some(function(e){return!(e instanceof Float32Array)}))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=n,this._descriptors=t}return Object.defineProperty(r.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),r.prototype.toJSON=function(){return{label:this.label,descriptors:this.descriptors.map(function(n){return Array.from(n)})}},r.fromJSON=function(n){var t=n.descriptors.map(function(e){return new Float32Array(e)});return new r(n.label,t)},r})();(function(r){Mt(n,r);function n(t,e,a,u){var s=r.call(this,t,e)||this;return s._score=a,s._classScore=u,s}return n.assertIsValidPredictedBox=function(t,e){if(Ly.assertIsValidLabeledBox(t,e),!Fy(t.score)||!Fy(t.classScore))throw new Error(e+" - expected properties score ("+t.score+") and ("+t.classScore+") to be a number between [0, 1]")},Object.defineProperty(n.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),n})(Ly);function zu(r){return r.detection instanceof zn}function Lu(r,n){var t={detection:n};return Object.assign({},r,t)}function Eb(){var r=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")},n=function(){throw new Error("readFile - filesystem not available for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D,Image:HTMLImageElement,ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:r,readFile:n}}function Cb(r){var n="";if(!r)try{r=require("fs")}catch(e){n=e.toString()}var t=r?function(e){return new Promise(function(a,u){r.readFile(e,function(s,l){return s?u(s):a(l)})})}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+n)};return{readFile:t}}function Sb(){var r=global.Canvas||global.HTMLCanvasElement,n=global.Image||global.HTMLImageElement,t=function(){if(r)return new r;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},e=function(){if(n)return new n;throw new Error("createImageElement - missing Image implementation for nodejs environment")},a=global.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},u=Cb();return tn({Canvas:r||(function(){function s(){}return s})(),CanvasRenderingContext2D:global.CanvasRenderingContext2D||(function(){function s(){}return s})(),Image:n||(function(){function s(){}return s})(),ImageData:global.ImageData||(function(){function s(){}return s})(),Video:global.HTMLVideoElement||(function(){function s(){}return s})(),createCanvasElement:t,createImageElement:e,fetch:a},u)}function Rb(){return typeof window=="object"&&typeof document<"u"&&typeof HTMLImageElement<"u"&&typeof HTMLCanvasElement<"u"&&typeof HTMLVideoElement<"u"&&typeof ImageData<"u"&&typeof CanvasRenderingContext2D<"u"}function Ab(){return typeof global=="object"&&typeof require=="function"&&typeof ux<"u"&&typeof process<"u"&&!!process.version}var Ne;function T3(){if(!Ne)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return Ne}function Ad(r){Ne=r}function lp(){Rb()&&Ad(Eb()),Ab()&&Ad(Sb())}function D3(r){if(Ne||lp(),!Ne)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var n=r.Canvas,t=n===void 0?Ne.Canvas:n,e=r.Image,a=e===void 0?Ne.Image:e;Ne.Canvas=t,Ne.Image=a,Ne.createCanvasElement=r.createCanvasElement||(function(){return new t}),Ne.createImageElement=r.createImageElement||(function(){return new a}),Ne.ImageData=r.ImageData||Ne.ImageData,Ne.Video=r.Video||Ne.Video,Ne.fetch=r.fetch||Ne.fetch,Ne.readFile=r.readFile||Ne.readFile}var on={getEnv:T3,setEnv:Ad,initialize:lp,createBrowserEnv:Eb,createFileSystem:Cb,createNodejsEnv:Sb,monkeyPatch:D3,isBrowser:Rb,isNodejs:Ab};lp();function cp(r){return!on.isNodejs()&&typeof r=="string"?document.getElementById(r):r}function $r(r){var n=on.getEnv(),t=n.Canvas,e=n.CanvasRenderingContext2D;if(r instanceof e)return r;var a=cp(r);if(!(a instanceof t))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var u=a.getContext("2d");if(!u)throw new Error("resolveContext2d - canvas 2d context is null");return u}var Ia;(function(r){r.TOP_LEFT="TOP_LEFT",r.TOP_RIGHT="TOP_RIGHT",r.BOTTOM_LEFT="BOTTOM_LEFT",r.BOTTOM_RIGHT="BOTTOM_RIGHT"})(Ia||(Ia={}));var Tb=(function(){function r(n){n===void 0&&(n={});var t=n.anchorPosition,e=n.backgroundColor,a=n.fontColor,u=n.fontSize,s=n.fontStyle,l=n.padding;this.anchorPosition=t||Ia.TOP_LEFT,this.backgroundColor=e||"rgba(0, 0, 0, 0.5)",this.fontColor=a||"rgba(255, 255, 255, 1)",this.fontSize=u||14,this.fontStyle=s||"Georgia",this.padding=l||4}return r})(),fp=(function(){function r(n,t,e){e===void 0&&(e={}),this.text=typeof n=="string"?[n]:n instanceof r?n.text:n,this.anchor=t,this.options=new Tb(e)}return r.prototype.measureWidth=function(n){var t=this.options.padding;return this.text.map(function(e){return n.measureText(e).width}).reduce(function(e,a){return e<a?a:e},0)+2*t},r.prototype.measureHeight=function(){var n=this.options,t=n.fontSize,e=n.padding;return this.text.length*t+2*e},r.prototype.getUpperLeft=function(n,t){var e=this.options.anchorPosition,a=e===Ia.BOTTOM_RIGHT||e===Ia.TOP_RIGHT,u=e===Ia.BOTTOM_LEFT||e===Ia.BOTTOM_RIGHT,s=this.measureWidth(n),l=this.measureHeight(),f=a?this.anchor.x-s:this.anchor.x,h=u?this.anchor.y-l:this.anchor.y;if(t){var p=t.width,v=t.height,m=Math.max(Math.min(f,p-s),0),y=Math.max(Math.min(h,v-l),0);return{x:m,y}}return{x:f,y:h}},r.prototype.draw=function(n){var t=cp(n),e=$r(t),a=this.options,u=a.backgroundColor,s=a.fontColor,l=a.fontSize,f=a.fontStyle,h=a.padding;e.font=l+"px "+f;var p=this.measureWidth(e),v=this.measureHeight();e.fillStyle=u;var m=this.getUpperLeft(e,t);e.fillRect(m.x,m.y,p,v),e.fillStyle=s,this.text.forEach(function(y,x){var w=h+m.x,_=h+m.y+(x+1)*l;e.fillText(y,w,_)})},r})(),N3=(function(){function r(n){n===void 0&&(n={});var t=n.boxColor,e=n.lineWidth,a=n.label,u=n.drawLabelOptions;this.boxColor=t||"rgba(0, 0, 255, 1)",this.lineWidth=e||2,this.label=a;var s={anchorPosition:Ia.BOTTOM_LEFT,backgroundColor:this.boxColor};this.drawLabelOptions=new Tb(Object.assign({},s,u))}return r})(),M3=(function(){function r(n,t){t===void 0&&(t={}),this.box=new Rr(n),this.options=new N3(t)}return r.prototype.draw=function(n){var t=$r(n),e=this.options,a=e.boxColor,u=e.lineWidth,s=this.box,l=s.x,f=s.y,h=s.width,p=s.height;t.strokeStyle=a,t.lineWidth=u,t.strokeRect(l,f,h,p);var v=this.options.label;v&&new fp([v],{x:l-u/2,y:f},this.options.drawLabelOptions).draw(n)},r})();function O3(r,n){var t=Array.isArray(n)?n:[n];t.forEach(function(e){var a=e instanceof zn?e.score:zu(e)?e.detection.score:void 0,u=e instanceof zn?e.box:zu(e)?e.detection.box:new Rr(e),s=a?""+op(a):void 0;new M3(u,{label:s}).draw(r)})}function Db(r){var n=on.getEnv(),t=n.Image,e=n.Video;return r instanceof t&&r.complete||r instanceof e&&r.readyState>=3}function k3(r){return new Promise(function(n,t){if(r instanceof on.getEnv().Canvas||Db(r))return n();function e(u){u.currentTarget&&(u.currentTarget.removeEventListener("load",e),u.currentTarget.removeEventListener("error",a),n(u))}function a(u){u.currentTarget&&(u.currentTarget.removeEventListener("load",e),u.currentTarget.removeEventListener("error",a),t(u))}r.addEventListener("load",e),r.addEventListener("error",a)})}function hp(r){var n=on.getEnv(),t=n.Image,e=n.Video;return r instanceof t?new hi(r.naturalWidth,r.naturalHeight):r instanceof e?new hi(r.videoWidth,r.videoHeight):new hi(r.width,r.height)}function uc(r){var n=r.width,t=r.height,e=on.getEnv().createCanvasElement,a=e();return a.width=n,a.height=t,a}function dp(r,n){var t=on.getEnv().ImageData;if(!(r instanceof t)&&!Db(r))throw new Error("createCanvasFromMedia - media has not finished loading yet");var e=hp(r),a=e.width,u=e.height,s=uc({width:a,height:u});return r instanceof t?$r(s).putImageData(r,0,0):$r(s).drawImage(r,0,0,a,u),s}function I3(r,n){return Ct(this,void 0,void 0,function(){var t,e,a,u,s,l;return St(this,function(f){switch(f.label){case 0:return t=on.getEnv().createCanvasElement(),e=r.shape.slice(za(r)?1:0),a=e[0],u=e[1],s=e[2],l=mt(function(){return r.as3D(a,u,s).toInt()}),[4,ip.toPixels(l,t)];case 1:return f.sent(),l.dispose(),[2,t]}})})}function Uy(r){var n=on.getEnv(),t=n.Image,e=n.Canvas,a=n.Video;return r instanceof t||r instanceof e||r instanceof a}function B3(r,n,t){t===void 0&&(t=!1);var e=on.getEnv(),a=e.Image,u=e.Canvas;if(!(r instanceof a||r instanceof u))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var s=hp(r),l=n/Math.max(s.height,s.width),f=l*s.width,h=l*s.height,p=uc({width:n,height:n}),v=r instanceof u?r:dp(r),m=Math.abs(f-h)/2,y=t&&f<h?m:0,x=t&&h<f?m:0;return $r(p).drawImage(v,y,x,f,h),p}var jl=(function(){function r(n,t){var e=this;if(t===void 0&&(t=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(n))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+n);this._treatAsBatchInput=t,this._batchSize=n.length,n.forEach(function(a,u){if(ic(a)){e._imageTensors[u]=a,e._inputDimensions[u]=a.shape;return}if(za(a)){var s=a.shape[0];if(s!==1)throw new Error("NetInput - tf.Tensor4D with batchSize "+s+" passed, but not supported in input array");e._imageTensors[u]=a,e._inputDimensions[u]=a.shape.slice(1);return}var l=a instanceof on.getEnv().Canvas?a:dp(a);e._canvases[u]=l,e._inputDimensions[u]=[l.height,l.width,3]})}return Object.defineProperty(r.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"reshapedInputDimensions",{get:function(){var n=this;return Iu(this.batchSize,0,1).map(function(t,e){return n.getReshapedInputDimensions(e)})},enumerable:!0,configurable:!0}),r.prototype.getInput=function(n){return this.canvases[n]||this.imageTensors[n]},r.prototype.getInputDimensions=function(n){return this._inputDimensions[n]},r.prototype.getInputHeight=function(n){return this._inputDimensions[n][0]},r.prototype.getInputWidth=function(n){return this._inputDimensions[n][1]},r.prototype.getReshapedInputDimensions=function(n){if(typeof this.inputSize!="number")throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");var t=this.getInputWidth(n),e=this.getInputHeight(n);return b3({width:t,height:e},this.inputSize)},r.prototype.toBatchTensor=function(n,t){var e=this;return t===void 0&&(t=!0),this._inputSize=n,mt(function(){var a=Iu(e.batchSize,0,1).map(function(s){var l=e.getInput(s);if(l instanceof pe){var f=za(l)?l:l.expandDims();return f=_3(f,t),(f.shape[1]!==n||f.shape[2]!==n)&&(f=$d.resizeBilinear(f,[n,n])),f.as3D(n,n,3)}if(l instanceof on.getEnv().Canvas)return ip.fromPixels(B3(l,n,t));throw new Error("toBatchTensor - at batchIdx "+s+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+l)}),u=Fn(a.map(function(s){return s.toFloat()})).as4D(e.batchSize,n,n,3);return u})},r})();function He(r){return Ct(this,void 0,void 0,function(){var n,t,e;return St(this,function(a){switch(a.label){case 0:if(r instanceof jl)return[2,r];if(n=Array.isArray(r)?r:[r],!n.length)throw new Error("toNetInput - empty array passed as input");return t=function(u){return Array.isArray(r)?" at input index "+u+":":""},e=n.map(cp),e.forEach(function(u,s){if(!Uy(u)&&!ic(u)&&!za(u))throw typeof n[s]=="string"?new Error("toNetInput -"+t(s)+" string passed, but could not resolve HTMLElement for element id "+n[s]):new Error("toNetInput -"+t(s)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id");if(za(u)){var l=u.shape[0];if(l!==1)throw new Error("toNetInput -"+t(s)+" tf.Tensor4D with batchSize "+l+" passed, but not supported in input array")}}),[4,Promise.all(e.map(function(u){return Uy(u)&&k3(u)}))];case 1:return a.sent(),[2,new jl(e,Array.isArray(r))]}})})}function pp(r,n){return Ct(this,void 0,void 0,function(){var t,e,a,u,s,l,f;return St(this,function(h){switch(h.label){case 0:return t=on.getEnv().Canvas,e=r,r instanceof t?[3,5]:[4,He(r)];case 1:if(a=h.sent(),a.batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return u=a.getInput(0),u instanceof t?(s=u,[3,4]):[3,2];case 2:return[4,I3(u)];case 3:s=h.sent(),h.label=4;case 4:e=s,h.label=5;case 5:return l=$r(e),f=n.map(function(p){return p instanceof zn?p.forSize(e.width,e.height).box.floor():p}).map(function(p){return p.clipAtImageBorders(e.width,e.height)}),[2,f.map(function(p){var v=p.x,m=p.y,y=p.width,x=p.height,w=uc({width:y,height:x});return $r(w).putImageData(l.getImageData(v,m,y,x),0,0),w})]}})})}function vp(r,n){return Ct(this,void 0,void 0,function(){return St(this,function(t){if(!ic(r)&&!za(r))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(za(r)&&r.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,mt(function(){var e=r.shape.slice(za(r)?1:0),a=e[0],u=e[1],s=e[2],l=n.map(function(h){return h instanceof zn?h.forSize(u,a).box:h}).map(function(h){return h.clipAtImageBorders(u,a)}),f=l.map(function(h){var p=h.x,v=h.y,m=h.width,y=h.height;return rb(r.as3D(a,u,s),[v,p,0],[y,m,s])});return f})]})})}function F3(r,n){return Ct(this,void 0,void 0,function(){var t,e;return St(this,function(a){switch(a.label){case 0:return t=on.getEnv().fetch,[4,t(r,n)];case 1:if(e=a.sent(),!(e.status<400))throw new Error("failed to fetch: ("+e.status+") "+e.statusText+", from url: "+e.url);return[2,e]}})})}function z3(r){return Ct(this,void 0,void 0,function(){return St(this,function(n){switch(n.label){case 0:return[4,F3(r)];case 1:return[2,n.sent().json()]}})})}function Nb(r,n){var t=n+"-weights_manifest.json";if(!r)return{modelBaseUri:"",manifestUri:t};if(r==="/")return{modelBaseUri:"/",manifestUri:"/"+t};var e=r.startsWith("http://")?"http://":r.startsWith("https://")?"https://":"";r=r.replace(e,"");var a=r.split("/").filter(function(l){return l}),u=r.endsWith(".json")?a[a.length-1]:t,s=e+(r.endsWith(".json")?a.slice(0,a.length-1):a).join("/");return s=r.startsWith("/")?"/"+s:s,{modelBaseUri:s,manifestUri:s==="/"?"/"+u:s+"/"+u}}function L3(r,n){return Ct(this,void 0,void 0,function(){var t,e,a,u;return St(this,function(s){switch(s.label){case 0:return t=Nb(r,n),e=t.manifestUri,a=t.modelBaseUri,[4,z3(e)];case 1:return u=s.sent(),[2,xb.loadWeights(u,a)]}})})}function U3(r,n,t){t===void 0&&(t=!1);var e=t?hp(n):n,a=e.width,u=e.height;return r.width=a,r.height=u,{width:a,height:u}}var ra=(function(){function r(n){this._name=n,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(r.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),r.prototype.getParamFromPath=function(n){var t=this.traversePropertyPath(n),e=t.obj,a=t.objProp;return e[a]},r.prototype.reassignParamFromPath=function(n,t){var e=this.traversePropertyPath(n),a=e.obj,u=e.objProp;a[u].dispose(),a[u]=t},r.prototype.getParamList=function(){var n=this;return this._paramMappings.map(function(t){var e=t.paramPath;return{path:e,tensor:n.getParamFromPath(e)}})},r.prototype.getTrainableParams=function(){return this.getParamList().filter(function(n){return n.tensor instanceof Eo})},r.prototype.getFrozenParams=function(){return this.getParamList().filter(function(n){return!(n.tensor instanceof Eo)})},r.prototype.variable=function(){var n=this;this.getFrozenParams().forEach(function(t){var e=t.path,a=t.tensor;n.reassignParamFromPath(e,a.variable())})},r.prototype.freeze=function(){var n=this;this.getTrainableParams().forEach(function(t){var e=t.path,a=t.tensor,u=Ze(a.dataSync());a.dispose(),n.reassignParamFromPath(e,u)})},r.prototype.dispose=function(n){n===void 0&&(n=!0),this.getParamList().forEach(function(t){if(n&&t.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+t.path);t.tensor.dispose()}),this._params=void 0},r.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(n){var t=n.tensor;return Array.from(t.dataSync())}).reduce(function(n,t){return n.concat(t)}))},r.prototype.load=function(n){return Ct(this,void 0,void 0,function(){return St(this,function(t){switch(t.label){case 0:return n instanceof Float32Array?(this.extractWeights(n),[2]):[4,this.loadFromUri(n)];case 1:return t.sent(),[2]}})})},r.prototype.loadFromUri=function(n){return Ct(this,void 0,void 0,function(){var t;return St(this,function(e){switch(e.label){case 0:if(n&&typeof n!="string")throw new Error(this._name+".loadFromUri - expected model uri");return[4,L3(n,this.getDefaultModelName())];case 1:return t=e.sent(),this.loadFromWeightMap(t),[2]}})})},r.prototype.loadFromDisk=function(n){return Ct(this,void 0,void 0,function(){var t,e,a,u,s,l,f,h,p,v;return St(this,function(m){switch(m.label){case 0:if(n&&typeof n!="string")throw new Error(this._name+".loadFromDisk - expected model file path");return t=on.getEnv().readFile,e=Nb(n,this.getDefaultModelName()),a=e.manifestUri,u=e.modelBaseUri,s=function(y){return Promise.all(y.map(function(x){return t(x).then(function(w){return w.buffer})}))},l=xb.weightsLoaderFactory(s),p=(h=JSON).parse,[4,t(a)];case 1:return f=p.apply(h,[m.sent().toString()]),[4,l(f,u)];case 2:return v=m.sent(),this.loadFromWeightMap(v),[2]}})})},r.prototype.loadFromWeightMap=function(n){var t=this.extractParamsFromWeigthMap(n),e=t.paramMappings,a=t.params;this._paramMappings=e,this._params=a},r.prototype.extractWeights=function(n){var t=this.extractParams(n),e=t.paramMappings,a=t.params;this._paramMappings=e,this._params=a},r.prototype.traversePropertyPath=function(n){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var t=n.split("/").reduce(function(u,s){if(!u.nextObj.hasOwnProperty(s))throw new Error("traversePropertyPath - object does not have property "+s+", for path "+n);return{obj:u.nextObj,objProp:s,nextObj:u.nextObj[s]}},{nextObj:this.params}),e=t.obj,a=t.objProp;if(!e||!a||!(e[a]instanceof pe))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+n);return{obj:e,objProp:a}},r})();function Bn(r,n,t){return mt(function(){var e=Kd(r,n.depthwise_filter,n.pointwise_filter,t,"same");return e=Lt(e,n.bias),e})}function ad(r,n,t){return t===void 0&&(t=!1),mt(function(){var e=ve(t?Lt($n(r,n.conv0.filters,[2,2],"same"),n.conv0.bias):Bn(r,n.conv0,[2,2])),a=Bn(e,n.conv1,[1,1]),u=ve(Lt(e,a)),s=Bn(u,n.conv2,[1,1]);return ve(Lt(e,Lt(a,s)))})}function _l(r,n,t,e){return t===void 0&&(t=!1),e===void 0&&(e=!0),mt(function(){var a=ve(t?Lt($n(r,n.conv0.filters,e?[2,2]:[1,1],"same"),n.conv0.bias):Bn(r,n.conv0,e?[2,2]:[1,1])),u=Bn(a,n.conv1,[1,1]),s=ve(Lt(a,u)),l=Bn(s,n.conv2,[1,1]),f=ve(Lt(a,Lt(u,l))),h=Bn(f,n.conv3,[1,1]);return ve(Lt(a,Lt(u,Lt(l,h))))})}function ur(r,n,t,e){return t===void 0&&(t="same"),e===void 0&&(e=!1),mt(function(){var a=Lt($n(r,n.filters,[1,1],t),n.bias);return e?ve(a):a})}function aa(r,n){Object.keys(r).forEach(function(t){n.some(function(e){return e.originalPath===t})||r[t].dispose()})}function sc(r,n){return function(t,e,a,u){var s=mn(r(t*e*a*a),[a,a,t,e]),l=Te(r(e));return n.push({paramPath:u+"/filters"},{paramPath:u+"/bias"}),{filters:s,bias:l}}}function mp(r,n){return function(t,e,a){var u=Ba(r(t*e),[t,e]),s=Te(r(e));return n.push({paramPath:a+"/weights"},{paramPath:a+"/bias"}),{weights:u,bias:s}}}var Mb=(function(){function r(n,t,e){this.depthwise_filter=n,this.pointwise_filter=t,this.bias=e}return r})();function gp(r,n){return function(t,e,a){var u=mn(r(9*t),[3,3,t,1]),s=mn(r(t*e),[1,1,t,e]),l=Te(r(e));return n.push({paramPath:a+"/depthwise_filter"},{paramPath:a+"/pointwise_filter"},{paramPath:a+"/bias"}),new Mb(u,s,l)}}function yp(r){return function(n){var t=r(n+"/depthwise_filter",4),e=r(n+"/pointwise_filter",4),a=r(n+"/bias",1);return new Mb(t,e,a)}}function Ha(r,n){return function(t,e,a){var u=r[t];if(!ac(u,e))throw new Error("expected weightMap["+t+"] to be a Tensor"+e+"D, instead have "+u);return n.push({originalPath:t,paramPath:a||t}),u}}function ia(r){var n=r;function t(a){var u=n.slice(0,a);return n=n.slice(a),u}function e(){return n}return{extractWeights:t,getRemainingWeights:e}}function Ob(r,n){var t=sc(r,n),e=gp(r,n);function a(s,l,f,h){h===void 0&&(h=!1);var p=h?t(s,l,3,f+"/conv0"):e(s,l,f+"/conv0"),v=e(l,l,f+"/conv1"),m=e(l,l,f+"/conv2");return{conv0:p,conv1:v,conv2:m}}function u(s,l,f,h){h===void 0&&(h=!1);var p=a(s,l,f,h),v=p.conv0,m=p.conv1,y=p.conv2,x=e(l,l,f+"/conv3");return{conv0:v,conv1:m,conv2:y,conv3:x}}return{extractDenseBlock3Params:a,extractDenseBlock4Params:u}}function P3(r){var n=[],t=ia(r),e=t.extractWeights,a=t.getRemainingWeights,u=Ob(e,n).extractDenseBlock4Params,s=u(3,32,"dense0",!0),l=u(32,64,"dense1"),f=u(64,128,"dense2"),h=u(128,256,"dense3");if(a().length!==0)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:n,params:{dense0:s,dense1:l,dense2:f,dense3:h}}}function kb(r){return function(n){var t=r(n+"/filters",4),e=r(n+"/bias",1);return{filters:t,bias:e}}}function Ib(r,n){var t=Ha(r,n),e=kb(t),a=yp(t);function u(l,f){f===void 0&&(f=!1);var h=f?e(l+"/conv0"):a(l+"/conv0"),p=a(l+"/conv1"),v=a(l+"/conv2");return{conv0:h,conv1:p,conv2:v}}function s(l,f){f===void 0&&(f=!1);var h=f?e(l+"/conv0"):a(l+"/conv0"),p=a(l+"/conv1"),v=a(l+"/conv2"),m=a(l+"/conv3");return{conv0:h,conv1:p,conv2:v,conv3:m}}return{extractDenseBlock3Params:u,extractDenseBlock4Params:s}}function H3(r){var n=[],t=Ib(r,n).extractDenseBlock4Params,e={dense0:t("dense0",!0),dense1:t("dense1"),dense2:t("dense2"),dense3:t("dense3")};return aa(r,n),{params:e,paramMappings:n}}var Bb=(function(r){Mt(n,r);function n(){return r.call(this,"FaceFeatureExtractor")||this}return n.prototype.forwardInput=function(t){var e=this.params;if(!e)throw new Error("FaceFeatureExtractor - load model before inference");return mt(function(){var a=t.toBatchTensor(112,!0),u=[122.782,117.001,104.298],s=Xu(a,u).div(pt(255)),l=_l(s,e.dense0,!0);return l=_l(l,e.dense1),l=_l(l,e.dense2),l=_l(l,e.dense3),l=qu(l,[7,7],[2,2],"valid"),l})},n.prototype.forward=function(t){return Ct(this,void 0,void 0,function(){var e;return St(this,function(a){switch(a.label){case 0:return e=this.forwardInput,[4,He(t)];case 1:return[2,e.apply(this,[a.sent()])]}})})},n.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},n.prototype.extractParamsFromWeigthMap=function(t){return H3(t)},n.prototype.extractParams=function(t){return P3(t)},n})(ra);function wr(r,n){return mt(function(){return Lt(ec(r,n.weights),n.bias)})}function V3(r,n,t){var e=[],a=ia(r),u=a.extractWeights,s=a.getRemainingWeights,l=mp(u,e),f=l(n,t,"fc");if(s().length!==0)throw new Error("weights remaing after extract: "+s().length);return{paramMappings:e,params:{fc:f}}}function G3(r){var n=[],t=Ha(r,n);function e(u){var s=t(u+"/weights",2),l=t(u+"/bias",1);return{weights:s,bias:l}}var a={fc:e("fc")};return aa(r,n),{params:a,paramMappings:n}}function Fb(r){var n={},t={};return Object.keys(r).forEach(function(e){var a=e.startsWith("fc")?t:n;a[e]=r[e]}),{featureExtractorMap:n,classifierMap:t}}var zb=(function(r){Mt(n,r);function n(t,e){var a=r.call(this,t)||this;return a._faceFeatureExtractor=e,a}return Object.defineProperty(n.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),n.prototype.runNet=function(t){var e=this,a=this.params;if(!a)throw new Error(this._name+" - load model before inference");return mt(function(){var u=t instanceof jl?e.faceFeatureExtractor.forwardInput(t):t;return wr(u.as2D(u.shape[0],-1),a.fc)})},n.prototype.dispose=function(t){t===void 0&&(t=!0),this.faceFeatureExtractor.dispose(t),r.prototype.dispose.call(this,t)},n.prototype.loadClassifierParams=function(t){var e=this.extractClassifierParams(t),a=e.params,u=e.paramMappings;this._params=a,this._paramMappings=u},n.prototype.extractClassifierParams=function(t){return V3(t,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},n.prototype.extractParamsFromWeigthMap=function(t){var e=Fb(t),a=e.featureExtractorMap,u=e.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(a),G3(u)},n.prototype.extractParams=function(t){var e=this.getClassifierChannelsIn(),a=this.getClassifierChannelsOut(),u=a*e+a,s=t.slice(0,t.length-u),l=t.slice(t.length-u);return this.faceFeatureExtractor.extractWeights(s),this.extractClassifierParams(l)},n})(ra),Py=["neutral","happy","sad","angry","fearful","disgusted","surprised"],bp=(function(){function r(n){var t=this;if(n.length!==7)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+n.length);Py.forEach(function(e,a){t[e]=n[a]})}return r.prototype.asSortedArray=function(){var n=this;return Py.map(function(t){return{expression:t,probability:n[t]}}).sort(function(t,e){return e.probability-t.probability})},r})(),W3=(function(r){Mt(n,r);function n(t){return t===void 0&&(t=new Bb),r.call(this,"FaceExpressionNet",t)||this}return n.prototype.forwardInput=function(t){var e=this;return mt(function(){return ea(e.runNet(t))})},n.prototype.forward=function(t){return Ct(this,void 0,void 0,function(){var e;return St(this,function(a){switch(a.label){case 0:return e=this.forwardInput,[4,He(t)];case 1:return[2,e.apply(this,[a.sent()])]}})})},n.prototype.predictExpressions=function(t){return Ct(this,void 0,void 0,function(){var e,a,u,s,l=this;return St(this,function(f){switch(f.label){case 0:return[4,He(t)];case 1:return e=f.sent(),[4,this.forwardInput(e)];case 2:return a=f.sent(),[4,Promise.all(ke(a).map(function(h){return Ct(l,void 0,void 0,function(){var p;return St(this,function(v){switch(v.label){case 0:return[4,h.data()];case 1:return p=v.sent(),h.dispose(),[2,p]}})})}))];case 3:return u=f.sent(),a.dispose(),s=u.map(function(h){return new bp(h)}),[2,e.isBatchInput?s:s[0]]}})})},n.prototype.getDefaultModelName=function(){return"face_expression_model"},n.prototype.getClassifierChannelsIn=function(){return 256},n.prototype.getClassifierChannelsOut=function(){return 7},n})(zb);function q3(r){return r.expressions instanceof bp}function Lb(r,n){var t={expressions:n};return Object.assign({},r,t)}function j3(r,n,t,e){var a=Array.isArray(n)?n:[n];a.forEach(function(u){var s=u instanceof bp?u:q3(u)?u.expressions:void 0;if(!s)throw new Error("drawFaceExpressions - expected faceExpressions to be FaceExpressions | WithFaceExpressions<{}> or array thereof");var l=s.asSortedArray(),f=l.filter(function(v){return v.probability>t}),h=zu(u)?u.detection.box.bottomLeft:new Qt(0,0),p=new fp(f.map(function(v){return v.expression+" ("+op(v.probability)+")"}),h);p.draw(r)})}function Ub(r){return zu(r)&&r.landmarks instanceof Fu&&r.unshiftedLandmarks instanceof Fu&&r.alignedRect instanceof zn}function lc(r,n){var t=r.detection.box,e=n.shiftBy(t.x,t.y),a=e.align(),u=r.detection.imageDims,s=new zn(r.detection.score,a.rescale(u.reverse()),u),l={landmarks:e,unshiftedLandmarks:n,alignedRect:s};return Object.assign({},r,l)}function X3(r,n){var t=sc(r,n),e=gp(r,n);function a(s,l,f){var h=e(s,l,f+"/separable_conv0"),p=e(l,l,f+"/separable_conv1"),v=t(s,l,1,f+"/expansion_conv");return{separable_conv0:h,separable_conv1:p,expansion_conv:v}}function u(s,l){var f=e(s,s,l+"/separable_conv0"),h=e(s,s,l+"/separable_conv1"),p=e(s,s,l+"/separable_conv2");return{separable_conv0:f,separable_conv1:h,separable_conv2:p}}return{extractConvParams:t,extractSeparableConvParams:e,extractReductionBlockParams:a,extractMainBlockParams:u}}function K3(r,n){var t=[],e=ia(r),a=e.extractWeights,u=e.getRemainingWeights,s=X3(a,t),l=s.extractConvParams,f=s.extractSeparableConvParams,h=s.extractReductionBlockParams,p=s.extractMainBlockParams,v=l(3,32,3,"entry_flow/conv_in"),m=h(32,64,"entry_flow/reduction_block_0"),y=h(64,128,"entry_flow/reduction_block_1"),x={conv_in:v,reduction_block_0:m,reduction_block_1:y},w={};Iu(n,0,1).forEach(function(A){w["main_block_"+A]=p(128,"middle_flow/main_block_"+A)});var _=h(128,256,"exit_flow/reduction_block"),E=f(256,512,"exit_flow/separable_conv"),R={reduction_block:_,separable_conv:E};if(u().length!==0)throw new Error("weights remaing after extract: "+u().length);return{paramMappings:t,params:{entry_flow:x,middle_flow:w,exit_flow:R}}}function Y3(r,n){var t=Ha(r,n),e=kb(t),a=yp(t);function u(l){var f=a(l+"/separable_conv0"),h=a(l+"/separable_conv1"),p=e(l+"/expansion_conv");return{separable_conv0:f,separable_conv1:h,expansion_conv:p}}function s(l){var f=a(l+"/separable_conv0"),h=a(l+"/separable_conv1"),p=a(l+"/separable_conv2");return{separable_conv0:f,separable_conv1:h,separable_conv2:p}}return{extractConvParams:e,extractSeparableConvParams:a,extractReductionBlockParams:u,extractMainBlockParams:s}}function Q3(r,n){var t=[],e=Y3(r,t),a=e.extractConvParams,u=e.extractSeparableConvParams,s=e.extractReductionBlockParams,l=e.extractMainBlockParams,f=a("entry_flow/conv_in"),h=s("entry_flow/reduction_block_0"),p=s("entry_flow/reduction_block_1"),v={conv_in:f,reduction_block_0:h,reduction_block_1:p},m={};Iu(n,0,1).forEach(function(_){m["main_block_"+_]=l("middle_flow/main_block_"+_)});var y=s("exit_flow/reduction_block"),x=u("exit_flow/separable_conv"),w={reduction_block:y,separable_conv:x};return aa(r,t),{params:{entry_flow:v,middle_flow:m,exit_flow:w},paramMappings:t}}function Pb(r,n,t){return Lt($n(r,n.filters,t,"same"),n.bias)}function id(r,n,t){t===void 0&&(t=!0);var e=t?ve(r):r;return e=Bn(e,n.separable_conv0,[1,1]),e=Bn(ve(e),n.separable_conv1,[1,1]),e=Ue(e,[3,3],[2,2],"same"),e=Lt(e,Pb(r,n.expansion_conv,[2,2])),e}function Z3(r,n){var t=Bn(ve(r),n.separable_conv0,[1,1]);return t=Bn(ve(t),n.separable_conv1,[1,1]),t=Bn(ve(t),n.separable_conv2,[1,1]),t=Lt(t,r),t}var J3=(function(r){Mt(n,r);function n(t){var e=r.call(this,"TinyXception")||this;return e._numMainBlocks=t,e}return n.prototype.forwardInput=function(t){var e=this,a=this.params;if(!a)throw new Error("TinyXception - load model before inference");return mt(function(){var u=t.toBatchTensor(112,!0),s=[122.782,117.001,104.298],l=Xu(u,s).div(pt(256)),f=ve(Pb(l,a.entry_flow.conv_in,[2,2]));return f=id(f,a.entry_flow.reduction_block_0,!1),f=id(f,a.entry_flow.reduction_block_1),Iu(e._numMainBlocks,0,1).forEach(function(h){f=Z3(f,a.middle_flow["main_block_"+h])}),f=id(f,a.exit_flow.reduction_block),f=ve(Bn(f,a.exit_flow.separable_conv,[1,1])),f})},n.prototype.forward=function(t){return Ct(this,void 0,void 0,function(){var e;return St(this,function(a){switch(a.label){case 0:return e=this.forwardInput,[4,He(t)];case 1:return[2,e.apply(this,[a.sent()])]}})})},n.prototype.getDefaultModelName=function(){return"tiny_xception_model"},n.prototype.extractParamsFromWeigthMap=function(t){return Q3(t,this._numMainBlocks)},n.prototype.extractParams=function(t){return K3(t,this._numMainBlocks)},n})(ra);function $3(r){var n=[],t=ia(r),e=t.extractWeights,a=t.getRemainingWeights,u=mp(e,n),s=u(512,1,"fc/age"),l=u(512,2,"fc/gender");if(a().length!==0)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:n,params:{fc:{age:s,gender:l}}}}function tT(r){var n=[],t=Ha(r,n);function e(u){var s=t(u+"/weights",2),l=t(u+"/bias",1);return{weights:s,bias:l}}var a={fc:{age:e("fc/age"),gender:e("fc/gender")}};return aa(r,n),{params:a,paramMappings:n}}var Xl;(function(r){r.FEMALE="female",r.MALE="male"})(Xl||(Xl={}));var eT=(function(r){Mt(n,r);function n(t){t===void 0&&(t=new J3(2));var e=r.call(this,"AgeGenderNet")||this;return e._faceFeatureExtractor=t,e}return Object.defineProperty(n.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),n.prototype.runNet=function(t){var e=this,a=this.params;if(!a)throw new Error(this._name+" - load model before inference");return mt(function(){var u=t instanceof jl?e.faceFeatureExtractor.forwardInput(t):t,s=qu(u,[7,7],[2,2],"valid").as2D(u.shape[0],-1),l=wr(s,a.fc.age).as1D(),f=wr(s,a.fc.gender);return{age:l,gender:f}})},n.prototype.forwardInput=function(t){var e=this;return mt(function(){var a=e.runNet(t),u=a.age,s=a.gender;return{age:u,gender:ea(s)}})},n.prototype.forward=function(t){return Ct(this,void 0,void 0,function(){var e;return St(this,function(a){switch(a.label){case 0:return e=this.forwardInput,[4,He(t)];case 1:return[2,e.apply(this,[a.sent()])]}})})},n.prototype.predictAgeAndGender=function(t){return Ct(this,void 0,void 0,function(){var e,a,u,s,l,f,h=this;return St(this,function(p){switch(p.label){case 0:return[4,He(t)];case 1:return e=p.sent(),[4,this.forwardInput(e)];case 2:return a=p.sent(),u=ke(a.age),s=ke(a.gender),l=u.map(function(v,m){return{ageTensor:v,genderTensor:s[m]}}),[4,Promise.all(l.map(function(v){var m=v.ageTensor,y=v.genderTensor;return Ct(h,void 0,void 0,function(){var x,w,_,E,R;return St(this,function(A){switch(A.label){case 0:return[4,m.data()];case 1:return x=A.sent()[0],[4,y.data()];case 2:return w=A.sent()[0],_=w>.5,E=_?Xl.MALE:Xl.FEMALE,R=_?w:1-w,m.dispose(),y.dispose(),[2,{age:x,gender:E,genderProbability:R}]}})})}))];case 3:return f=p.sent(),a.age.dispose(),a.gender.dispose(),[2,e.isBatchInput?f:f[0]]}})})},n.prototype.getDefaultModelName=function(){return"age_gender_model"},n.prototype.dispose=function(t){t===void 0&&(t=!0),this.faceFeatureExtractor.dispose(t),r.prototype.dispose.call(this,t)},n.prototype.loadClassifierParams=function(t){var e=this.extractClassifierParams(t),a=e.params,u=e.paramMappings;this._params=a,this._paramMappings=u},n.prototype.extractClassifierParams=function(t){return $3(t)},n.prototype.extractParamsFromWeigthMap=function(t){var e=Fb(t),a=e.featureExtractorMap,u=e.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(a),tT(u)},n.prototype.extractParams=function(t){var e=1539,a=t.slice(0,t.length-e),u=t.slice(t.length-e);return this.faceFeatureExtractor.extractWeights(a),this.extractClassifierParams(u)},n})(ra),Hb=(function(r){Mt(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.postProcess=function(t,e,a){var u=a.map(function(l){var f=l.width,h=l.height,p=e/Math.max(h,f);return{width:f*p,height:h*p}}),s=u.length;return mt(function(){var l=function(m,y){return Fn([Cr([68],m),Cr([68],y)],1).as2D(1,136).as1D()},f=function(m,y){var x=u[m],w=x.width,_=x.height;return y(w,_)?Math.abs(w-_)/2:0},h=function(m){return f(m,function(y,x){return y<x})},p=function(m){return f(m,function(y,x){return x<y})},v=t.mul(Cr([s,136],e)).sub(Fn(Array.from(Array(s),function(m,y){return l(h(y),p(y))}))).div(Fn(Array.from(Array(s),function(m,y){return l(u[y].width,u[y].height)})));return v})},n.prototype.forwardInput=function(t){var e=this;return mt(function(){var a=e.runNet(t);return e.postProcess(a,t.inputSize,t.inputDimensions.map(function(u){var s=u[0],l=u[1];return{height:s,width:l}}))})},n.prototype.forward=function(t){return Ct(this,void 0,void 0,function(){var e;return St(this,function(a){switch(a.label){case 0:return e=this.forwardInput,[4,He(t)];case 1:return[2,e.apply(this,[a.sent()])]}})})},n.prototype.detectLandmarks=function(t){return Ct(this,void 0,void 0,function(){var e,a,u,s=this;return St(this,function(l){switch(l.label){case 0:return[4,He(t)];case 1:return e=l.sent(),a=mt(function(){return ke(s.forwardInput(e))}),[4,Promise.all(a.map(function(f,h){return Ct(s,void 0,void 0,function(){var p,v,m,y,x;return St(this,function(w){switch(w.label){case 0:return m=(v=Array).from,[4,f.data()];case 1:return p=m.apply(v,[w.sent()]),y=p.filter(function(_,E){return Iy(E)}),x=p.filter(function(_,E){return!Iy(E)}),[2,new A3(Array(68).fill(0).map(function(_,E){return new Qt(y[E],x[E])}),{height:e.getInputHeight(h),width:e.getInputWidth(h)})]}})})}))];case 2:return u=l.sent(),a.forEach(function(f){return f.dispose()}),[2,e.isBatchInput?u:u[0]]}})})},n.prototype.getClassifierChannelsOut=function(){return 136},n})(zb),Vb=(function(r){Mt(n,r);function n(t){return t===void 0&&(t=new Bb),r.call(this,"FaceLandmark68Net",t)||this}return n.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},n.prototype.getClassifierChannelsIn=function(){return 256},n})(Hb);function nT(r){var n=[],t=Ib(r,n).extractDenseBlock3Params,e={dense0:t("dense0",!0),dense1:t("dense1"),dense2:t("dense2")};return aa(r,n),{params:e,paramMappings:n}}function rT(r){var n=[],t=ia(r),e=t.extractWeights,a=t.getRemainingWeights,u=Ob(e,n).extractDenseBlock3Params,s=u(3,32,"dense0",!0),l=u(32,64,"dense1"),f=u(64,128,"dense2");if(a().length!==0)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:n,params:{dense0:s,dense1:l,dense2:f}}}var aT=(function(r){Mt(n,r);function n(){return r.call(this,"TinyFaceFeatureExtractor")||this}return n.prototype.forwardInput=function(t){var e=this.params;if(!e)throw new Error("TinyFaceFeatureExtractor - load model before inference");return mt(function(){var a=t.toBatchTensor(112,!0),u=[122.782,117.001,104.298],s=Xu(a,u).div(pt(255)),l=ad(s,e.dense0,!0);return l=ad(l,e.dense1),l=ad(l,e.dense2),l=qu(l,[14,14],[2,2],"valid"),l})},n.prototype.forward=function(t){return Ct(this,void 0,void 0,function(){var e;return St(this,function(a){switch(a.label){case 0:return e=this.forwardInput,[4,He(t)];case 1:return[2,e.apply(this,[a.sent()])]}})})},n.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},n.prototype.extractParamsFromWeigthMap=function(t){return nT(t)},n.prototype.extractParams=function(t){return rT(t)},n})(ra),iT=(function(r){Mt(n,r);function n(t){return t===void 0&&(t=new aT),r.call(this,"FaceLandmark68TinyNet",t)||this}return n.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},n.prototype.getClassifierChannelsIn=function(){return 128},n})(Hb);(function(r){Mt(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n})(Vb);function oT(r,n){return Lt(rn(r,n.weights),n.biases)}function xp(r,n,t,e,a){a===void 0&&(a="same");var u=n.conv,s=u.filters,l=u.bias,f=$n(r,s,t,a);return f=Lt(f,l),f=oT(f,n.scale),e?ve(f):f}function uT(r,n){return xp(r,n,[1,1],!0)}function Gb(r,n){return xp(r,n,[1,1],!1)}function Wb(r,n){return xp(r,n,[2,2],!0,"valid")}function sT(r,n){function t(l,f,h){var p=r(l),v=p.length/(f*h*h);if(y3(v))throw new Error("depth has to be an integer: "+v+", weights.length: "+p.length+", numFilters: "+f+", filterSize: "+h);return mt(function(){return La(mn(p,[f,v,h,h]),[2,3,1,0])})}function e(l,f,h,p){var v=t(l,f,h),m=Te(r(f));return n.push({paramPath:p+"/filters"},{paramPath:p+"/bias"}),{filters:v,bias:m}}function a(l,f){var h=Te(r(l)),p=Te(r(l));return n.push({paramPath:f+"/weights"},{paramPath:f+"/biases"}),{weights:h,biases:p}}function u(l,f,h,p){var v=e(l,f,h,p+"/conv"),m=a(f,p+"/scale");return{conv:v,scale:m}}function s(l,f,h,p,v){v===void 0&&(v=!1);var m=u((v?.5:1)*l,f,h,p+"/conv1"),y=u(l,f,h,p+"/conv2");return{conv1:m,conv2:y}}return{extractConvLayerParams:u,extractResidualLayerParams:s}}function lT(r){var n=ia(r),t=n.extractWeights,e=n.getRemainingWeights,a=[],u=sT(t,a),s=u.extractConvLayerParams,l=u.extractResidualLayerParams,f=s(4704,32,7,"conv32_down"),h=l(9216,32,3,"conv32_1"),p=l(9216,32,3,"conv32_2"),v=l(9216,32,3,"conv32_3"),m=l(36864,64,3,"conv64_down",!0),y=l(36864,64,3,"conv64_1"),x=l(36864,64,3,"conv64_2"),w=l(36864,64,3,"conv64_3"),_=l(147456,128,3,"conv128_down",!0),E=l(147456,128,3,"conv128_1"),R=l(147456,128,3,"conv128_2"),A=l(589824,256,3,"conv256_down",!0),S=l(589824,256,3,"conv256_1"),T=l(589824,256,3,"conv256_2"),N=l(589824,256,3,"conv256_down_out"),O=mt(function(){return La(Ba(t(256*128),[128,256]),[1,0])});if(a.push({paramPath:"fc"}),e().length!==0)throw new Error("weights remaing after extract: "+e().length);var B={conv32_down:f,conv32_1:h,conv32_2:p,conv32_3:v,conv64_down:m,conv64_1:y,conv64_2:x,conv64_3:w,conv128_down:_,conv128_1:E,conv128_2:R,conv256_down:A,conv256_1:S,conv256_2:T,conv256_down_out:N,fc:O};return{params:B,paramMappings:a}}function cT(r,n){var t=Ha(r,n);function e(s){var l=t(s+"/scale/weights",1),f=t(s+"/scale/biases",1);return{weights:l,biases:f}}function a(s){var l=t(s+"/conv/filters",4),f=t(s+"/conv/bias",1),h=e(s);return{conv:{filters:l,bias:f},scale:h}}function u(s){return{conv1:a(s+"/conv1"),conv2:a(s+"/conv2")}}return{extractConvLayerParams:a,extractResidualLayerParams:u}}function fT(r){var n=[],t=cT(r,n),e=t.extractConvLayerParams,a=t.extractResidualLayerParams,u=e("conv32_down"),s=a("conv32_1"),l=a("conv32_2"),f=a("conv32_3"),h=a("conv64_down"),p=a("conv64_1"),v=a("conv64_2"),m=a("conv64_3"),y=a("conv128_down"),x=a("conv128_1"),w=a("conv128_2"),_=a("conv256_down"),E=a("conv256_1"),R=a("conv256_2"),A=a("conv256_down_out"),S=r.fc;if(n.push({originalPath:"fc",paramPath:"fc"}),!g3(S))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+S);var T={conv32_down:u,conv32_1:s,conv32_2:l,conv32_3:f,conv64_down:h,conv64_1:p,conv64_2:v,conv64_3:m,conv128_down:y,conv128_1:x,conv128_2:w,conv256_down:_,conv256_1:E,conv256_2:R,conv256_down_out:A,fc:S};return aa(r,n),{params:T,paramMappings:n}}function mr(r,n){var t=uT(r,n.conv1);return t=Gb(t,n.conv2),t=Lt(t,r),t=ve(t),t}function El(r,n){var t=Wb(r,n.conv1);t=Gb(t,n.conv2);var e=qu(r,2,2,"valid"),a=he(e.shape),u=e.shape[3]!==t.shape[3],s=e.shape[1]!==t.shape[1]||e.shape[2]!==t.shape[2];if(s){var l=Tu(t.shape);l[1]=1;var f=he(l);t=Oe([t,f],1);var h=Tu(t.shape);h[2]=1;var p=he(h);t=Oe([t,p],2)}return e=u?Oe([e,a],3):e,t=Lt(e,t),t=ve(t),t}var hT=(function(r){Mt(n,r);function n(){return r.call(this,"FaceRecognitionNet")||this}return n.prototype.forwardInput=function(t){var e=this.params;if(!e)throw new Error("FaceRecognitionNet - load model before inference");return mt(function(){var a=t.toBatchTensor(150,!0).toFloat(),u=[122.782,117.001,104.298],s=Xu(a,u).div(pt(256)),l=Wb(s,e.conv32_down);l=Ue(l,3,2,"valid"),l=mr(l,e.conv32_1),l=mr(l,e.conv32_2),l=mr(l,e.conv32_3),l=El(l,e.conv64_down),l=mr(l,e.conv64_1),l=mr(l,e.conv64_2),l=mr(l,e.conv64_3),l=El(l,e.conv128_down),l=mr(l,e.conv128_1),l=mr(l,e.conv128_2),l=El(l,e.conv256_down),l=mr(l,e.conv256_1),l=mr(l,e.conv256_2),l=El(l,e.conv256_down_out);var f=l.mean([1,2]),h=ec(f,e.fc);return h})},n.prototype.forward=function(t){return Ct(this,void 0,void 0,function(){var e;return St(this,function(a){switch(a.label){case 0:return e=this.forwardInput,[4,He(t)];case 1:return[2,e.apply(this,[a.sent()])]}})})},n.prototype.computeFaceDescriptor=function(t){return Ct(this,void 0,void 0,function(){var e,a,u,s=this;return St(this,function(l){switch(l.label){case 0:return[4,He(t)];case 1:return e=l.sent(),a=mt(function(){return ke(s.forwardInput(e))}),[4,Promise.all(a.map(function(f){return f.data()}))];case 2:return u=l.sent(),a.forEach(function(f){return f.dispose()}),[2,e.isBatchInput?u:u[0]]}})})},n.prototype.getDefaultModelName=function(){return"face_recognition_model"},n.prototype.extractParamsFromWeigthMap=function(t){return fT(t)},n.prototype.extractParams=function(t){return lT(t)},n})(ra);function qb(r,n){var t={descriptor:n};return Object.assign({},r,t)}function jb(r,n){var t={age:n};return Object.assign({},r,t)}function Xb(r,n,t){var e={gender:n,genderProbability:t};return Object.assign({},r,e)}var Kb=(function(){function r(n){var t=n===void 0?{}:n,e=t.minFaceSize,a=t.scaleFactor,u=t.maxNumScales,s=t.scoreThresholds,l=t.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=e||20,this._scaleFactor=a||.709,this._maxNumScales=u||10,this._scoreThresholds=s||[.6,.7,.7],this._scaleSteps=l,typeof this._minFaceSize!="number"||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if(typeof this._scaleFactor!="number"||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if(typeof this._maxNumScales!="number"||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||this._scoreThresholds.length!==3||this._scoreThresholds.some(function(f){return typeof f!="number"}))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(f){return typeof f!="number"})))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(r.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),r})();function dT(r,n){function t(f,h){var p=mn(r(9*f),[3,3,f,1]),v=Te(r(f)),m=Te(r(f)),y=Te(r(f)),x=Te(r(f));return n.push({paramPath:h+"/filters"},{paramPath:h+"/batch_norm_scale"},{paramPath:h+"/batch_norm_offset"},{paramPath:h+"/batch_norm_mean"},{paramPath:h+"/batch_norm_variance"}),{filters:p,batch_norm_scale:v,batch_norm_offset:m,batch_norm_mean:y,batch_norm_variance:x}}function e(f,h,p,v,m){var y=mn(r(f*h*p*p),[p,p,f,h]),x=Te(r(h));return n.push({paramPath:v+"/filters"},{paramPath:v+"/"+(m?"batch_norm_offset":"bias")}),{filters:y,bias:x}}function a(f,h,p,v){var m=e(f,h,p,v,!0),y=m.filters,x=m.bias;return{filters:y,batch_norm_offset:x}}function u(f,h,p){var v=t(f,p+"/depthwise_conv"),m=a(f,h,1,p+"/pointwise_conv");return{depthwise_conv:v,pointwise_conv:m}}function s(){var f=a(3,32,3,"mobilenetv1/conv_0"),h=u(32,64,"mobilenetv1/conv_1"),p=u(64,128,"mobilenetv1/conv_2"),v=u(128,128,"mobilenetv1/conv_3"),m=u(128,256,"mobilenetv1/conv_4"),y=u(256,256,"mobilenetv1/conv_5"),x=u(256,512,"mobilenetv1/conv_6"),w=u(512,512,"mobilenetv1/conv_7"),_=u(512,512,"mobilenetv1/conv_8"),E=u(512,512,"mobilenetv1/conv_9"),R=u(512,512,"mobilenetv1/conv_10"),A=u(512,512,"mobilenetv1/conv_11"),S=u(512,1024,"mobilenetv1/conv_12"),T=u(1024,1024,"mobilenetv1/conv_13");return{conv_0:f,conv_1:h,conv_2:p,conv_3:v,conv_4:m,conv_5:y,conv_6:x,conv_7:w,conv_8:_,conv_9:E,conv_10:R,conv_11:A,conv_12:S,conv_13:T}}function l(){var f=a(1024,256,1,"prediction_layer/conv_0"),h=a(256,512,3,"prediction_layer/conv_1"),p=a(512,128,1,"prediction_layer/conv_2"),v=a(128,256,3,"prediction_layer/conv_3"),m=a(256,128,1,"prediction_layer/conv_4"),y=a(128,256,3,"prediction_layer/conv_5"),x=a(256,64,1,"prediction_layer/conv_6"),w=a(64,128,3,"prediction_layer/conv_7"),_=e(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),E=e(512,9,1,"prediction_layer/box_predictor_0/class_predictor"),R=e(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),A=e(1024,18,1,"prediction_layer/box_predictor_1/class_predictor"),S=e(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),T=e(512,18,1,"prediction_layer/box_predictor_2/class_predictor"),N=e(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),O=e(256,18,1,"prediction_layer/box_predictor_3/class_predictor"),B=e(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),I=e(256,18,1,"prediction_layer/box_predictor_4/class_predictor"),F=e(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),G=e(128,18,1,"prediction_layer/box_predictor_5/class_predictor"),H={box_encoding_predictor:_,class_predictor:E},at={box_encoding_predictor:R,class_predictor:A},et={box_encoding_predictor:S,class_predictor:T},nt={box_encoding_predictor:N,class_predictor:O},L={box_encoding_predictor:B,class_predictor:I},q={box_encoding_predictor:F,class_predictor:G};return{conv_0:f,conv_1:h,conv_2:p,conv_3:v,conv_4:m,conv_5:y,conv_6:x,conv_7:w,box_predictor_0:H,box_predictor_1:at,box_predictor_2:et,box_predictor_3:nt,box_predictor_4:L,box_predictor_5:q}}return{extractMobilenetV1Params:s,extractPredictionLayerParams:l}}function pT(r){var n=[],t=ia(r),e=t.extractWeights,a=t.getRemainingWeights,u=dT(e,n),s=u.extractMobilenetV1Params,l=u.extractPredictionLayerParams,f=s(),h=l(),p=kd(e(5118*4),[1,5118,4]),v={extra_dim:p};if(n.push({paramPath:"output_layer/extra_dim"}),a().length!==0)throw new Error("weights remaing after extract: "+a().length);return{params:{mobilenetv1:f,prediction_layer:h,output_layer:v},paramMappings:n}}function vT(r,n){var t=Ha(r,n);function e(h,p,v){var m=t(h+"/Conv2d_"+p+"_pointwise/weights",4,v+"/filters"),y=t(h+"/Conv2d_"+p+"_pointwise/convolution_bn_offset",1,v+"/batch_norm_offset");return{filters:m,batch_norm_offset:y}}function a(h){var p="mobilenetv1/conv_"+h,v="MobilenetV1/Conv2d_"+h+"_depthwise",m=p+"/depthwise_conv",y=p+"/pointwise_conv",x=t(v+"/depthwise_weights",4,m+"/filters"),w=t(v+"/BatchNorm/gamma",1,m+"/batch_norm_scale"),_=t(v+"/BatchNorm/beta",1,m+"/batch_norm_offset"),E=t(v+"/BatchNorm/moving_mean",1,m+"/batch_norm_mean"),R=t(v+"/BatchNorm/moving_variance",1,m+"/batch_norm_variance");return{depthwise_conv:{filters:x,batch_norm_scale:w,batch_norm_offset:_,batch_norm_mean:E,batch_norm_variance:R},pointwise_conv:e("MobilenetV1",h,y)}}function u(){return{conv_0:e("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:a(1),conv_2:a(2),conv_3:a(3),conv_4:a(4),conv_5:a(5),conv_6:a(6),conv_7:a(7),conv_8:a(8),conv_9:a(9),conv_10:a(10),conv_11:a(11),conv_12:a(12),conv_13:a(13)}}function s(h,p){var v=t(h+"/weights",4,p+"/filters"),m=t(h+"/biases",1,p+"/bias");return{filters:v,bias:m}}function l(h){var p=s("Prediction/BoxPredictor_"+h+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+h+"/box_encoding_predictor"),v=s("Prediction/BoxPredictor_"+h+"/ClassPredictor","prediction_layer/box_predictor_"+h+"/class_predictor");return{box_encoding_predictor:p,class_predictor:v}}function f(){return{conv_0:e("Prediction",0,"prediction_layer/conv_0"),conv_1:e("Prediction",1,"prediction_layer/conv_1"),conv_2:e("Prediction",2,"prediction_layer/conv_2"),conv_3:e("Prediction",3,"prediction_layer/conv_3"),conv_4:e("Prediction",4,"prediction_layer/conv_4"),conv_5:e("Prediction",5,"prediction_layer/conv_5"),conv_6:e("Prediction",6,"prediction_layer/conv_6"),conv_7:e("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:l(0),box_predictor_1:l(1),box_predictor_2:l(2),box_predictor_3:l(3),box_predictor_4:l(4),box_predictor_5:l(5)}}return{extractMobilenetV1Params:u,extractPredictionLayerParams:f}}function mT(r){var n=[],t=vT(r,n),e=t.extractMobilenetV1Params,a=t.extractPredictionLayerParams,u=r["Output/extra_dim"];if(n.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!ic(u))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+u);var s={mobilenetv1:e(),prediction_layer:a(),output_layer:{extra_dim:u}};return aa(r,n),{params:s,paramMappings:n}}function gr(r,n,t){return mt(function(){var e=$n(r,n.filters,t,"same");return e=Lt(e,n.batch_norm_offset),Wd(e,0,6)})}var gT=.0010000000474974513;function yT(r,n,t){return mt(function(){var e=tc(r,n.filters,t,"same");return e=V1(e,n.batch_norm_mean,n.batch_norm_variance,n.batch_norm_offset,n.batch_norm_scale,gT),Wd(e,0,6)})}function bT(r){return[2,4,6,12].some(function(n){return n===r})?[2,2]:[1,1]}function xT(r,n){return mt(function(){var t=null,e=gr(r,n.conv_0,[2,2]),a=[n.conv_1,n.conv_2,n.conv_3,n.conv_4,n.conv_5,n.conv_6,n.conv_7,n.conv_8,n.conv_9,n.conv_10,n.conv_11,n.conv_12,n.conv_13];if(a.forEach(function(u,s){var l=s+1,f=bT(l);e=yT(e,u.depthwise_conv,f),e=gr(e,u.pointwise_conv,[1,1]),l===11&&(t=e)}),t===null)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:e,conv11:t}})}function wT(r,n,t,e,a){var u=r.shape[0],s=Math.min(t,u),l=n.map(function(p,v){return{score:p,boxIndex:v}}).filter(function(p){return p.score>a}).sort(function(p,v){return v.score-p.score}),f=function(p){return p<=e?1:0},h=[];return l.forEach(function(p){if(!(h.length>=s)){for(var v=p.score,m=h.length-1;m>=0;--m){var y=_T(r,p.boxIndex,h[m]);if(y!==0&&(p.score*=f(y),p.score<=a))break}v===p.score&&h.push(p.boxIndex)}}),h}function _T(r,n,t){var e=r.arraySync(),a=Math.min(e[n][0],e[n][2]),u=Math.min(e[n][1],e[n][3]),s=Math.max(e[n][0],e[n][2]),l=Math.max(e[n][1],e[n][3]),f=Math.min(e[t][0],e[t][2]),h=Math.min(e[t][1],e[t][3]),p=Math.max(e[t][0],e[t][2]),v=Math.max(e[t][1],e[t][3]),m=(s-a)*(l-u),y=(p-f)*(v-h);if(m<=0||y<=0)return 0;var x=Math.max(a,f),w=Math.max(u,h),_=Math.min(s,p),E=Math.min(l,v),R=Math.max(_-x,0)*Math.max(E-w,0);return R/(m+y-R)}function ET(r){var n=ke(La(r,[1,0])),t=[Be(n[2],n[0]),Be(n[3],n[1])],e=[Lt(n[0],ir(t[0],pt(2))),Lt(n[1],ir(t[1],pt(2)))];return{sizes:t,centers:e}}function CT(r,n){var t=ET(r),e=t.sizes,a=t.centers,u=ke(La(n,[1,0])),s=ir(rn(xd(ir(u[2],pt(5))),e[0]),pt(2)),l=Lt(rn(ir(u[0],pt(10)),e[0]),a[0]),f=ir(rn(xd(ir(u[3],pt(5))),e[1]),pt(2)),h=Lt(rn(ir(u[1],pt(10)),e[1]),a[1]);return La(Fn([Be(l,s),Be(h,f),Lt(l,s),Lt(h,f)]),[1,0])}function ST(r,n,t){return mt(function(){var e=r.shape[0],a=CT(or(mo(t.extra_dim,[e,1,1]),[-1,4]),or(r,[-1,4]));a=or(a,[e,a.shape[0]/e,4]);var u=L1(Sr(n,[0,0,1],[-1,-1,-1])),s=Sr(u,[0,0,0],[-1,-1,1]);s=or(s,[e,s.shape[1]]);var l=ke(a),f=ke(s);return{boxes:l,scores:f}})}function lo(r,n){return mt(function(){var t=r.shape[0],e=or(ur(r,n.box_encoding_predictor),[t,-1,1,4]),a=or(ur(r,n.class_predictor),[t,-1,3]);return{boxPredictionEncoding:e,classPrediction:a}})}function RT(r,n,t){return mt(function(){var e=gr(r,t.conv_0,[1,1]),a=gr(e,t.conv_1,[2,2]),u=gr(a,t.conv_2,[1,1]),s=gr(u,t.conv_3,[2,2]),l=gr(s,t.conv_4,[1,1]),f=gr(l,t.conv_5,[2,2]),h=gr(f,t.conv_6,[1,1]),p=gr(h,t.conv_7,[2,2]),v=lo(n,t.box_predictor_0),m=lo(r,t.box_predictor_1),y=lo(a,t.box_predictor_2),x=lo(s,t.box_predictor_3),w=lo(f,t.box_predictor_4),_=lo(p,t.box_predictor_5),E=Oe([v.boxPredictionEncoding,m.boxPredictionEncoding,y.boxPredictionEncoding,x.boxPredictionEncoding,w.boxPredictionEncoding,_.boxPredictionEncoding],1),R=Oe([v.classPrediction,m.classPrediction,y.classPrediction,x.classPrediction,w.classPrediction,_.classPrediction],1);return{boxPredictions:E,classPredictions:R}})}var cc=(function(){function r(n){var t=n===void 0?{}:n,e=t.minConfidence,a=t.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=e||.5,this._maxResults=a||100,typeof this._minConfidence!="number"||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if(typeof this._maxResults!="number")throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(r.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),r})(),Yb=(function(r){Mt(n,r);function n(){return r.call(this,"SsdMobilenetv1")||this}return n.prototype.forwardInput=function(t){var e=this.params;if(!e)throw new Error("SsdMobilenetv1 - load model before inference");return mt(function(){var a=t.toBatchTensor(512,!1).toFloat(),u=Be(rn(a,pt(.007843137718737125)),pt(1)),s=xT(u,e.mobilenetv1),l=RT(s.out,s.conv11,e.prediction_layer),f=l.boxPredictions,h=l.classPredictions;return ST(f,h,e.output_layer)})},n.prototype.forward=function(t){return Ct(this,void 0,void 0,function(){var e;return St(this,function(a){switch(a.label){case 0:return e=this.forwardInput,[4,He(t)];case 1:return[2,e.apply(this,[a.sent()])]}})})},n.prototype.locateFaces=function(t,e){return e===void 0&&(e={}),Ct(this,void 0,void 0,function(){var a,u,s,l,f,h,p,v,m,y,x,w,_,E,R,A,S,T,N,O,B;return St(this,function(I){switch(I.label){case 0:return a=new cc(e),u=a.maxResults,s=a.minConfidence,[4,He(t)];case 1:for(l=I.sent(),f=this.forwardInput(l),h=f.boxes,p=f.scores,v=h[0],m=p[0],y=1;y<h.length;y++)h[y].dispose(),p[y].dispose();return _=(w=Array).from,[4,m.data()];case 2:return x=_.apply(w,[I.sent()]),E=.5,R=wT(v,x,u,E,s),A=l.getReshapedInputDimensions(0),S=l.inputSize,T=S/A.width,N=S/A.height,O=v.arraySync(),B=R.map(function(F){var G=[Math.max(0,O[F][0]),Math.min(1,O[F][2])].map(function(q){return q*N}),H=G[0],at=G[1],et=[Math.max(0,O[F][1]),Math.min(1,O[F][3])].map(function(q){return q*T}),nt=et[0],L=et[1];return new zn(x[F],new sp(nt,H,L-nt,at-H),{height:l.getInputHeight(0),width:l.getInputWidth(0)})}),v.dispose(),m.dispose(),[2,B]}})})},n.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},n.prototype.extractParamsFromWeigthMap=function(t){return mT(t)},n.prototype.extractParams=function(t){return pT(t)},n})(ra);(function(r){Mt(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n})(Yb);var AT=.4,TT=[new Qt(.738768,.874946),new Qt(2.42204,2.65704),new Qt(4.30971,7.04493),new Qt(10.246,4.59428),new Qt(12.6868,11.8741)],DT=[new Qt(1.603231,2.094468),new Qt(6.041143,7.080126),new Qt(2.882459,3.518061),new Qt(4.266906,5.178857),new Qt(9.041765,10.66308)],NT=[117.001,114.697,97.404],MT="tiny_yolov2_model",OT="tiny_yolov2_separable_conv_model",Cl=function(r){return typeof r=="number"};function kT(r){if(!r)throw new Error("invalid config: "+r);if(typeof r.withSeparableConvs!="boolean")throw new Error("config.withSeparableConvs has to be a boolean, have: "+r.withSeparableConvs);if(!Cl(r.iouThreshold)||r.iouThreshold<0||r.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+r.iouThreshold);if(!Array.isArray(r.classes)||!r.classes.length||!r.classes.every(function(n){return typeof n=="string"}))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(r.classes));if(!Array.isArray(r.anchors)||!r.anchors.length||!r.anchors.map(function(n){return n||{}}).every(function(n){return Cl(n.x)&&Cl(n.y)}))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(r.anchors));if(r.meanRgb&&(!Array.isArray(r.meanRgb)||r.meanRgb.length!==3||!r.meanRgb.every(Cl)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(r.meanRgb))}function wp(r){return mt(function(){var n=rn(r,pt(.10000000149011612));return Lt(ve(Be(r,n)),n)})}function Na(r,n){return mt(function(){var t=gi(r,[[0,0],[1,1],[1,1],[0,0]]);return t=$n(t,n.conv.filters,[1,1],"valid"),t=Be(t,n.bn.sub),t=rn(t,n.bn.truediv),t=Lt(t,n.conv.bias),wp(t)})}function Ma(r,n){return mt(function(){var t=gi(r,[[0,0],[1,1],[1,1],[0,0]]);return t=Kd(t,n.depthwise_filter,n.pointwise_filter,[1,1],"valid"),t=Lt(t,n.bias),wp(t)})}function IT(r,n){var t=sc(r,n);function e(s,l){var f=Te(r(s)),h=Te(r(s));return n.push({paramPath:l+"/sub"},{paramPath:l+"/truediv"}),{sub:f,truediv:h}}function a(s,l,f){var h=t(s,l,3,f+"/conv"),p=e(l,f+"/bn");return{conv:h,bn:p}}var u=gp(r,n);return{extractConvParams:t,extractConvWithBatchNormParams:a,extractSeparableConvParams:u}}function BT(r,n,t,e){var a=ia(r),u=a.extractWeights,s=a.getRemainingWeights,l=[],f=IT(u,l),h=f.extractConvParams,p=f.extractConvWithBatchNormParams,v=f.extractSeparableConvParams,m;if(n.withSeparableConvs){var y=e[0],x=e[1],w=e[2],_=e[3],E=e[4],R=e[5],A=e[6],S=e[7],T=e[8],N=n.isFirstLayerConv2d?h(y,x,3,"conv0"):v(y,x,"conv0"),O=v(x,w,"conv1"),B=v(w,_,"conv2"),I=v(_,E,"conv3"),F=v(E,R,"conv4"),G=v(R,A,"conv5"),H=S?v(A,S,"conv6"):void 0,at=T?v(S,T,"conv7"):void 0,et=h(T||S||A,5*t,1,"conv8");m={conv0:N,conv1:O,conv2:B,conv3:I,conv4:F,conv5:G,conv6:H,conv7:at,conv8:et}}else{var y=e[0],x=e[1],w=e[2],_=e[3],E=e[4],R=e[5],A=e[6],S=e[7],T=e[8],N=p(y,x,"conv0"),O=p(x,w,"conv1"),B=p(w,_,"conv2"),I=p(_,E,"conv3"),F=p(E,R,"conv4"),G=p(R,A,"conv5"),H=p(A,S,"conv6"),at=p(S,T,"conv7"),et=h(T,5*t,1,"conv8");m={conv0:N,conv1:O,conv2:B,conv3:I,conv4:F,conv5:G,conv6:H,conv7:at,conv8:et}}if(s().length!==0)throw new Error("weights remaing after extract: "+s().length);return{params:m,paramMappings:l}}function FT(r,n){var t=Ha(r,n);function e(l){var f=t(l+"/sub",1),h=t(l+"/truediv",1);return{sub:f,truediv:h}}function a(l){var f=t(l+"/filters",4),h=t(l+"/bias",1);return{filters:f,bias:h}}function u(l){var f=a(l+"/conv"),h=e(l+"/bn");return{conv:f,bn:h}}var s=yp(t);return{extractConvParams:a,extractConvWithBatchNormParams:u,extractSeparableConvParams:s}}function zT(r,n){var t=[],e=FT(r,t),a=e.extractConvParams,u=e.extractConvWithBatchNormParams,s=e.extractSeparableConvParams,l;if(n.withSeparableConvs){var f=n.filterSizes&&n.filterSizes.length||9;l={conv0:n.isFirstLayerConv2d?a("conv0"):s("conv0"),conv1:s("conv1"),conv2:s("conv2"),conv3:s("conv3"),conv4:s("conv4"),conv5:s("conv5"),conv6:f>7?s("conv6"):void 0,conv7:f>8?s("conv7"):void 0,conv8:a("conv8")}}else l={conv0:u("conv0"),conv1:u("conv1"),conv2:u("conv2"),conv3:u("conv3"),conv4:u("conv4"),conv5:u("conv5"),conv6:u("conv6"),conv7:u("conv7"),conv8:a("conv8")};return aa(r,t),{params:l,paramMappings:t}}var Hy;(function(r){r[r.XS=224]="XS",r[r.SM=320]="SM",r[r.MD=416]="MD",r[r.LG=608]="LG"})(Hy||(Hy={}));var _p=(function(){function r(n){var t=n===void 0?{}:n,e=t.inputSize,a=t.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=e||416,this._scoreThreshold=a||.5,typeof this._inputSize!="number"||this._inputSize%32!==0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if(typeof this._scoreThreshold!="number"||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(r.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),r})(),Qb=(function(r){Mt(n,r);function n(t){var e=r.call(this,"TinyYolov2")||this;return kT(t),e._config=t,e}return Object.defineProperty(n.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),n.prototype.runTinyYolov2=function(t,e){var a=Na(t,e.conv0);return a=Ue(a,[2,2],[2,2],"same"),a=Na(a,e.conv1),a=Ue(a,[2,2],[2,2],"same"),a=Na(a,e.conv2),a=Ue(a,[2,2],[2,2],"same"),a=Na(a,e.conv3),a=Ue(a,[2,2],[2,2],"same"),a=Na(a,e.conv4),a=Ue(a,[2,2],[2,2],"same"),a=Na(a,e.conv5),a=Ue(a,[2,2],[1,1],"same"),a=Na(a,e.conv6),a=Na(a,e.conv7),ur(a,e.conv8,"valid",!1)},n.prototype.runMobilenet=function(t,e){var a=this.config.isFirstLayerConv2d?wp(ur(t,e.conv0,"valid",!1)):Ma(t,e.conv0);return a=Ue(a,[2,2],[2,2],"same"),a=Ma(a,e.conv1),a=Ue(a,[2,2],[2,2],"same"),a=Ma(a,e.conv2),a=Ue(a,[2,2],[2,2],"same"),a=Ma(a,e.conv3),a=Ue(a,[2,2],[2,2],"same"),a=Ma(a,e.conv4),a=Ue(a,[2,2],[2,2],"same"),a=Ma(a,e.conv5),a=Ue(a,[2,2],[1,1],"same"),a=e.conv6?Ma(a,e.conv6):a,a=e.conv7?Ma(a,e.conv7):a,ur(a,e.conv8,"valid",!1)},n.prototype.forwardInput=function(t,e){var a=this,u=this.params;if(!u)throw new Error("TinyYolov2 - load model before inference");return mt(function(){var s=t.toBatchTensor(e,!1).toFloat();return s=a.config.meanRgb?Xu(s,a.config.meanRgb):s,s=s.div(pt(256)),a.config.withSeparableConvs?a.runMobilenet(s,u):a.runTinyYolov2(s,u)})},n.prototype.forward=function(t,e){return Ct(this,void 0,void 0,function(){var a;return St(this,function(u){switch(u.label){case 0:return a=this.forwardInput,[4,He(t)];case 1:return[4,a.apply(this,[u.sent(),e])];case 2:return[2,u.sent()]}})})},n.prototype.detect=function(t,e){return e===void 0&&(e={}),Ct(this,void 0,void 0,function(){var a,u,s,l,f,h,p,v,m,y,x,w,_,E,R=this;return St(this,function(A){switch(A.label){case 0:return a=new _p(e),u=a.inputSize,s=a.scoreThreshold,[4,He(t)];case 1:return l=A.sent(),[4,this.forwardInput(l,u)];case 2:return f=A.sent(),h=mt(function(){return ke(f)[0].expandDims()}),p={width:l.getInputWidth(0),height:l.getInputHeight(0)},[4,this.extractBoxes(h,l.getReshapedInputDimensions(0),s)];case 3:return v=A.sent(),f.dispose(),h.dispose(),m=v.map(function(S){return S.box}),y=v.map(function(S){return S.score}),x=v.map(function(S){return S.classScore}),w=v.map(function(S){return R.config.classes[S.label]}),_=Bu(m.map(function(S){return S.rescale(u)}),y,this.config.iouThreshold,!0),E=_.map(function(S){return new _b(y[S],x[S],w[S],m[S],p)}),[2,E]}})})},n.prototype.getDefaultModelName=function(){return""},n.prototype.extractParamsFromWeigthMap=function(t){return zT(t,this.config)},n.prototype.extractParams=function(t){var e=this.config.filterSizes||n.DEFAULT_FILTER_SIZES,a=e?e.length:void 0;if(a!==7&&a!==8&&a!==9)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+a+" filterSizes in config");return BT(t,this.config,this.boxEncodingSize,e)},n.prototype.extractBoxes=function(t,e,a){return Ct(this,void 0,void 0,function(){var u,s,l,f,h,p,v,m,y,x,w,_,E,R,A,S,T,N,O,B,I,F,G,H,at,et,nt,L,q,K=this;return St(this,function(rt){switch(rt.label){case 0:return u=e.width,s=e.height,l=Math.max(u,s),f=l/u,h=l/s,p=t.shape[1],v=this.config.anchors.length,m=mt(function(){var ot=t.reshape([p,p,v,K.boxEncodingSize]),z=ot.slice([0,0,0,0],[p,p,v,4]),X=ot.slice([0,0,0,4],[p,p,v,1]),it=K.withClassScores?ea(ot.slice([0,0,0,5],[p,p,v,K.config.classes.length]),3):pt(0);return[z,X,it]}),y=m[0],x=m[1],w=m[2],_=[],[4,x.array()];case 1:return E=rt.sent(),[4,y.array()];case 2:R=rt.sent(),A=0,rt.label=3;case 3:if(!(A<p))return[3,12];S=0,rt.label=4;case 4:if(!(S<p))return[3,11];T=0,rt.label=5;case 5:return T<v?(N=rd(E[A][S][T][0]),!a||N>a?(O=(S+rd(R[A][S][T][0]))/p*f,B=(A+rd(R[A][S][T][1]))/p*h,I=Math.exp(R[A][S][T][2])*this.config.anchors[T].x/p*f,F=Math.exp(R[A][S][T][3])*this.config.anchors[T].y/p*h,G=O-I/2,H=B-F/2,at={row:A,col:S,anchor:T},this.withClassScores?[4,this.extractPredictedClass(w,at)]:[3,7]):[3,9]):[3,10];case 6:return q=rt.sent(),[3,8];case 7:q={classScore:1,label:0},rt.label=8;case 8:et=q,nt=et.classScore,L=et.label,_.push(tn({box:new oc(G,H,G+I,H+F),score:N,classScore:N*nt,label:L},at)),rt.label=9;case 9:return T++,[3,5];case 10:return S++,[3,4];case 11:return A++,[3,3];case 12:return y.dispose(),x.dispose(),w.dispose(),[2,_]}})})},n.prototype.extractPredictedClass=function(t,e){return Ct(this,void 0,void 0,function(){var a,u,s,l;return St(this,function(f){switch(f.label){case 0:return a=e.row,u=e.col,s=e.anchor,[4,t.array()];case 1:return l=f.sent(),[2,Array(this.config.classes.length).fill(0).map(function(h,p){return l[a][u][s][p]}).map(function(h,p){return{classScore:h,label:p}}).reduce(function(h,p){return h.classScore>p.classScore?h:p})]}})})},n.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],n})(ra),LT=(function(r){Mt(n,r);function n(t){t===void 0&&(t=!0);var e=this,a=Object.assign({},{withSeparableConvs:t,iouThreshold:AT,classes:["face"]},t?{anchors:DT,meanRgb:NT}:{anchors:TT,withClassScores:!0});return e=r.call(this,a)||this,e}return Object.defineProperty(n.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),n.prototype.locateFaces=function(t,e){return Ct(this,void 0,void 0,function(){var a;return St(this,function(u){switch(u.label){case 0:return[4,this.detect(t,e)];case 1:return a=u.sent(),[2,a.map(function(s){return new zn(s.score,s.relativeBox,{width:s.imageWidth,height:s.imageHeight})})]}})})},n.prototype.getDefaultModelName=function(){return this.withSeparableConvs?OT:MT},n.prototype.extractParamsFromWeigthMap=function(t){return r.prototype.extractParamsFromWeigthMap.call(this,t)},n})(Qb),Zb=(function(r){Mt(n,r);function n(){var t=r!==null&&r.apply(this,arguments)||this;return t._name="TinyFaceDetectorOptions",t}return n})(_p),Ku=(function(){function r(){}return r.prototype.then=function(n){return Ct(this,void 0,void 0,function(){var t;return St(this,function(e){switch(e.label){case 0:return t=n,[4,this.run()];case 1:return[2,t.apply(void 0,[e.sent()])]}})})},r.prototype.run=function(){return Ct(this,void 0,void 0,function(){return St(this,function(n){throw new Error("ComposableTask - run is not implemented")})})},r})();function fc(r,n,t,e,a){return a===void 0&&(a=function(u){var s=u.alignedRect;return s}),Ct(this,void 0,void 0,function(){var u,s,l,f,h;return St(this,function(p){switch(p.label){case 0:return u=r.map(function(v){return Ub(v)?a(v):v.detection}),l=e,l?[3,5]:n instanceof pe?[4,vp(n,u)]:[3,2];case 1:return f=p.sent(),[3,4];case 2:return[4,pp(n,u)];case 3:f=p.sent(),p.label=4;case 4:l=f,p.label=5;case 5:return s=l,[4,t(s)];case 6:return h=p.sent(),s.forEach(function(v){return v instanceof pe&&v.dispose()}),[2,h]}})})}function Ep(r,n,t,e,a){return Ct(this,void 0,void 0,function(){var u=this;return St(this,function(s){return[2,fc([r],n,function(l){return Ct(u,void 0,void 0,function(){return St(this,function(f){return[2,t(l[0])]})})},e,a)]})})}function UT(r){return mt(function(){return Fn(ke(r,3).reverse(),3)})}var Sl=2,Kl=12;function PT(r,n){var t=sc(r,n),e=mp(r,n);function a(h,p){var v=Te(r(h));return n.push({paramPath:p}),v}function u(h,p,v){v===void 0&&(v=!1);var m=t(h[0],h[1],3,p+"/conv1"),y=a(h[1],p+"/prelu1_alpha"),x=t(h[1],h[2],3,p+"/conv2"),w=a(h[2],p+"/prelu2_alpha"),_=t(h[2],h[3],v?2:3,p+"/conv3"),E=a(h[3],p+"/prelu3_alpha");return{conv1:m,prelu1_alpha:y,conv2:x,prelu2_alpha:w,conv3:_,prelu3_alpha:E}}function s(){var h=u([3,10,16,32],"pnet"),p=t(32,2,1,"pnet/conv4_1"),v=t(32,4,1,"pnet/conv4_2");return tn(tn({},h),{conv4_1:p,conv4_2:v})}function l(){var h=u([3,28,48,64],"rnet",!0),p=e(576,128,"rnet/fc1"),v=a(128,"rnet/prelu4_alpha"),m=e(128,2,"rnet/fc2_1"),y=e(128,4,"rnet/fc2_2");return tn(tn({},h),{fc1:p,prelu4_alpha:v,fc2_1:m,fc2_2:y})}function f(){var h=u([3,32,64,64],"onet"),p=t(64,128,2,"onet/conv4"),v=a(128,"onet/prelu4_alpha"),m=e(1152,256,"onet/fc1"),y=a(256,"onet/prelu5_alpha"),x=e(256,2,"onet/fc2_1"),w=e(256,4,"onet/fc2_2"),_=e(256,10,"onet/fc2_3");return tn(tn({},h),{conv4:p,prelu4_alpha:v,fc1:m,prelu5_alpha:y,fc2_1:x,fc2_2:w,fc2_3:_})}return{extractPNetParams:s,extractRNetParams:l,extractONetParams:f}}function HT(r){var n=ia(r),t=n.extractWeights,e=n.getRemainingWeights,a=[],u=PT(t,a),s=u.extractPNetParams,l=u.extractRNetParams,f=u.extractONetParams,h=s(),p=l(),v=f();if(e().length!==0)throw new Error("weights remaing after extract: "+e().length);return{params:{pnet:h,rnet:p,onet:v},paramMappings:a}}function VT(r,n){var t=Ha(r,n);function e(p){var v=t(p+"/weights",4,p+"/filters"),m=t(p+"/bias",1);return{filters:v,bias:m}}function a(p){var v=t(p+"/weights",2),m=t(p+"/bias",1);return{weights:v,bias:m}}function u(p){return t(p,1)}function s(p){var v=e(p+"/conv1"),m=u(p+"/prelu1_alpha"),y=e(p+"/conv2"),x=u(p+"/prelu2_alpha"),w=e(p+"/conv3"),_=u(p+"/prelu3_alpha");return{conv1:v,prelu1_alpha:m,conv2:y,prelu2_alpha:x,conv3:w,prelu3_alpha:_}}function l(){var p=s("pnet"),v=e("pnet/conv4_1"),m=e("pnet/conv4_2");return tn(tn({},p),{conv4_1:v,conv4_2:m})}function f(){var p=s("rnet"),v=a("rnet/fc1"),m=u("rnet/prelu4_alpha"),y=a("rnet/fc2_1"),x=a("rnet/fc2_2");return tn(tn({},p),{fc1:v,prelu4_alpha:m,fc2_1:y,fc2_2:x})}function h(){var p=s("onet"),v=e("onet/conv4"),m=u("onet/prelu4_alpha"),y=a("onet/fc1"),x=u("onet/prelu5_alpha"),w=a("onet/fc2_1"),_=a("onet/fc2_2"),E=a("onet/fc2_3");return tn(tn({},p),{conv4:v,prelu4_alpha:m,fc1:y,prelu5_alpha:x,fc2_1:w,fc2_2:_,fc2_3:E})}return{extractPNetParams:l,extractRNetParams:f,extractONetParams:h}}function GT(r){var n=[],t=VT(r,n),e=t.extractPNetParams,a=t.extractRNetParams,u=t.extractONetParams,s=e(),l=a(),f=u();return aa(r,n),{params:{pnet:s,rnet:l,onet:f},paramMappings:n}}function Td(r,n){var t=n[0],e=n[1];return{height:Math.floor(t*r),width:Math.floor(e*r)}}function WT(r,n,t){for(var e=t[0],a=t[1],u=Kl/r,s=[],l=Math.min(e,a)*u,f=0;l>=12;)s.push(u*Math.pow(n,f)),l=l*n,f+=1;return s}var Cp=(function(r){Mt(n,r);function n(t,e,a,u){return r.call(this,{left:t,top:e,right:a,bottom:u},!0)||this}return n})(Rr);function Jb(r){return mt(function(){return rn(Be(r,pt(127.5)),pt(.0078125))})}function wo(r,n){return mt(function(){return Lt(ve(r),rn(n,Vl(ve(Vl(r)))))})}function Sp(r,n,t){return t===void 0&&(t=!1),mt(function(){var e=ur(r,n.conv1,"valid");return e=wo(e,n.prelu1_alpha),e=Ue(e,t?[2,2]:[3,3],[2,2],"same"),e=ur(e,n.conv2,"valid"),e=wo(e,n.prelu2_alpha),e=t?e:Ue(e,[3,3],[2,2],"valid"),e=ur(e,n.conv3,"valid"),e=wo(e,n.prelu3_alpha),e})}function qT(r,n){return mt(function(){var t=Sp(r,n,!0),e=ur(t,n.conv4_1,"valid"),a=Qn(nc(e,3),3),u=ea(Be(e,a),3),s=ur(t,n.conv4_2,"valid");return{prob:u,regions:s}})}function jT(r,n){return mt(function(){var t=Td(n,r.shape.slice(1)),e=t.height,a=t.width,u=$d.resizeBilinear(r,[e,a]),s=Jb(u);return La(s,[0,2,1,3])})}function XT(r,n,t,e){for(var a=[],u=r.arraySync(),s=0;s<r.shape[0];s++)for(var l=0;l<r.shape[1];l++)u[s][l]>=e&&a.push(new Qt(l,s));var f=a.map(function(h){var p=new oc(Math.round((h.y*Sl+1)/t),Math.round((h.x*Sl+1)/t),Math.round((h.y*Sl+Kl)/t),Math.round((h.x*Sl+Kl)/t)),v=u[h.y][h.x],m=n.arraySync(),y=new Cp(m[h.y][h.x][0],m[h.y][h.x][1],m[h.y][h.x][2],m[h.y][h.x][3]);return{cell:p,score:v,region:y}});return f}function KT(r,n,t,e,a){a.stage1=[];var u=n.map(function(m){return mt(function(){var y={scale:m},x=jT(r,m),w=Date.now(),_=qT(x,e),E=_.prob,R=_.regions;y.pnet=Date.now()-w;var A=ke(ke(E,3)[1])[0],S=ke(R)[0];return{scoresTensor:A,regionsTensor:S,scale:m,statsForScale:y}})}),s=u.map(function(m){var y=m.scoresTensor,x=m.regionsTensor,w=m.scale,_=m.statsForScale,E=XT(y,x,w,t);if(y.dispose(),x.dispose(),!E.length)return a.stage1.push(_),[];var R=Date.now(),A=Bu(E.map(function(S){return S.cell}),E.map(function(S){return S.score}),.5);return _.nms=Date.now()-R,_.numBoxes=A.length,a.stage1.push(_),A.map(function(S){return E[S]})}),l=s.reduce(function(m,y){return m.concat(y)},[]),f=[],h=[];if(l.length>0){var p=Date.now(),v=Bu(l.map(function(m){return m.cell}),l.map(function(m){return m.score}),.7);a.stage1_nms=Date.now()-p,h=v.map(function(m){return l[m].score}),f=v.map(function(m){return l[m]}).map(function(m){var y=m.cell,x=m.region;return new oc(y.left+x.left*y.width,y.top+x.top*y.height,y.right+x.right*y.width,y.bottom+x.bottom*y.height).toSquare().round()})}return{boxes:f,scores:h}}function $b(r,n,t){var e=t.width,a=t.height;return Ct(this,void 0,void 0,function(){var u,s,l,f=this;return St(this,function(h){switch(h.label){case 0:return u=$r(r),[4,Promise.all(n.map(function(p){return Ct(f,void 0,void 0,function(){var v,m,y,x,w,_,E,R;return St(this,function(A){return v=p.padAtBorders(r.height,r.width),m=v.y,y=v.ey,x=v.x,w=v.ex,_=x-1,E=m-1,R=u.getImageData(_,E,w-_,y-E),[2,on.isNodejs()?dp(R):createImageBitmap(R)]})})}))];case 1:return s=h.sent(),l=[],s.forEach(function(p){var v=uc({width:e,height:a}),m=$r(v);m.drawImage(p,0,0,e,a);for(var y=m.getImageData(0,0,e,a).data,x=[],w=0;w<y.length;w+=4)x.push(y[w+2]),x.push(y[w+1]),x.push(y[w]);l.push(x)}),[2,l.map(function(p){var v=mt(function(){var m=La(mn(p,[1,e,a,3]),[0,2,1,3]).toFloat();return Jb(m)});return v})]}})})}function YT(r,n){return mt(function(){var t=Sp(r,n),e=or(t,[t.shape[0],n.fc1.weights.shape[0]]),a=wr(e,n.fc1),u=wo(a,n.prelu4_alpha),s=wr(u,n.fc2_1),l=Qn(nc(s,1),1),f=ea(Be(s,l),1),h=wr(u,n.fc2_2),p=ke(f,1)[1];return{scores:p,regions:h}})}function QT(r,n,t,e,a){return Ct(this,void 0,void 0,function(){var u,s,l,f,h,p,v,m,y,x,w,_,E,R;return St(this,function(A){switch(A.label){case 0:return u=Date.now(),[4,$b(r,n,{width:24,height:24})];case 1:return s=A.sent(),a.stage2_extractImagePatches=Date.now()-u,u=Date.now(),l=s.map(function(S){var T=YT(S,e);return S.dispose(),T}),a.stage2_rnet=Date.now()-u,f=l.length>1?Oe(l.map(function(S){return S.scores})):l[0].scores,v=(p=Array).from,[4,f.data()];case 2:return h=v.apply(p,[A.sent()]),f.dispose(),m=h.map(function(S,T){return{score:S,idx:T}}).filter(function(S){return S.score>t}).map(function(S){var T=S.idx;return T}),y=m.map(function(S){return n[S]}),x=m.map(function(S){return h[S]}),w=[],_=[],y.length>0&&(u=Date.now(),E=Bu(y,x,.7),a.stage2_nms=Date.now()-u,R=E.map(function(S){var T=l[m[S]].regions.arraySync();return new Cp(T[0][0],T[0][1],T[0][2],T[0][3])}),_=E.map(function(S){return x[S]}),w=E.map(function(S,T){return y[S].calibrate(R[T])})),l.forEach(function(S){S.regions.dispose(),S.scores.dispose()}),[2,{boxes:w,scores:_}]}})})}function ZT(r,n){return mt(function(){var t=Sp(r,n);t=Ue(t,[2,2],[2,2],"same"),t=ur(t,n.conv4,"valid"),t=wo(t,n.prelu4_alpha);var e=or(t,[t.shape[0],n.fc1.weights.shape[0]]),a=wr(e,n.fc1),u=wo(a,n.prelu5_alpha),s=wr(u,n.fc2_1),l=Qn(nc(s,1),1),f=ea(Be(s,l),1),h=wr(u,n.fc2_2),p=wr(u,n.fc2_3),v=ke(f,1)[1];return{scores:v,regions:h,points:p}})}function JT(r,n,t,e,a){return Ct(this,void 0,void 0,function(){var u,s,l,f,h,p,v,m,y,x,w,_,E,R,A;return St(this,function(S){switch(S.label){case 0:return u=Date.now(),[4,$b(r,n,{width:48,height:48})];case 1:return s=S.sent(),a.stage3_extractImagePatches=Date.now()-u,u=Date.now(),l=s.map(function(T){var N=ZT(T,e);return T.dispose(),N}),a.stage3_onet=Date.now()-u,f=l.length>1?Oe(l.map(function(T){return T.scores})):l[0].scores,v=(p=Array).from,[4,f.data()];case 2:return h=v.apply(p,[S.sent()]),f.dispose(),m=h.map(function(T,N){return{score:T,idx:N}}).filter(function(T){return T.score>t}).map(function(T){var N=T.idx;return N}),y=m.map(function(T){var N=l[T].regions.arraySync();return new Cp(N[0][0],N[0][1],N[0][2],N[0][3])}),x=m.map(function(T,N){return n[T].calibrate(y[N])}),w=m.map(function(T){return h[T]}),_=[],E=[],R=[],x.length>0&&(u=Date.now(),A=Bu(x,w,.7,!1),a.stage3_nms=Date.now()-u,_=A.map(function(T){return x[T]}),E=A.map(function(T){return w[T]}),R=A.map(function(T,N){return Array(5).fill(0).map(function(O,B){var I=l[T].points.arraySync();return new Qt(I[0][B]*(_[N].width+1)+_[N].left,I[0][B+5]*(_[N].height+1)+_[N].top)})})),l.forEach(function(T){T.regions.dispose(),T.scores.dispose(),T.points.dispose()}),[2,{boxes:_,scores:E,points:R}]}})})}var $T=(function(r){Mt(n,r);function n(){return r.call(this,"Mtcnn")||this}return n.prototype.load=function(t){return Ct(this,void 0,void 0,function(){return St(this,function(e){return console.warn("mtcnn is deprecated and will be removed soon"),[2,r.prototype.load.call(this,t)]})})},n.prototype.loadFromDisk=function(t){return Ct(this,void 0,void 0,function(){return St(this,function(e){return console.warn("mtcnn is deprecated and will be removed soon"),[2,r.prototype.loadFromDisk.call(this,t)]})})},n.prototype.forwardInput=function(t,e){return e===void 0&&(e={}),Ct(this,void 0,void 0,function(){var a,u,s,l,f,h,p,v,m,y,x,w,_,E,R,A,S,T,N,O,B;return St(this,function(I){switch(I.label){case 0:if(a=this.params,!a)throw new Error("Mtcnn - load model before inference");if(u=t.canvases[0],!u)throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return s={},l=Date.now(),f=mt(function(){return UT(Qn(ip.fromPixels(u)).toFloat())}),h=function(F){return f.dispose(),s.total=Date.now()-l,F},p=f.shape.slice(1),v=p[0],m=p[1],y=new Kb(e),x=y.minFaceSize,w=y.scaleFactor,_=y.maxNumScales,E=y.scoreThresholds,R=y.scaleSteps,A=(R||WT(x,w,[v,m])).filter(function(F){var G=Td(F,[v,m]);return Math.min(G.width,G.height)>Kl}).slice(0,_),s.scales=A,s.pyramid=A.map(function(F){return Td(F,[v,m])}),S=Date.now(),[4,KT(f,A,E[0],a.pnet,s)];case 1:return T=I.sent(),s.total_stage1=Date.now()-S,T.boxes.length?(s.stage2_numInputBoxes=T.boxes.length,S=Date.now(),[4,QT(u,T.boxes,E[1],a.rnet,s)]):[2,h({results:[],stats:s})];case 2:return N=I.sent(),s.total_stage2=Date.now()-S,N.boxes.length?(s.stage3_numInputBoxes=N.boxes.length,S=Date.now(),[4,JT(u,N.boxes,E[2],a.onet,s)]):[2,h({results:[],stats:s})];case 3:return O=I.sent(),s.total_stage3=Date.now()-S,B=O.boxes.map(function(F,G){return lc(Lu({},new zn(O.scores[G],new sp(F.left/m,F.top/v,F.width/m,F.height/v),{height:v,width:m})),new R3(O.points[G].map(function(H){return H.sub(new Qt(F.left,F.top)).div(new Qt(F.width,F.height))}),{width:F.width,height:F.height}))}),[2,h({results:B,stats:s})]}})})},n.prototype.forward=function(t,e){return e===void 0&&(e={}),Ct(this,void 0,void 0,function(){var a;return St(this,function(u){switch(u.label){case 0:return a=this.forwardInput,[4,He(t)];case 1:return[4,a.apply(this,[u.sent(),e])];case 2:return[2,u.sent().results]}})})},n.prototype.forwardWithStats=function(t,e){return e===void 0&&(e={}),Ct(this,void 0,void 0,function(){var a;return St(this,function(u){switch(u.label){case 0:return a=this.forwardInput,[4,He(t)];case 1:return[2,a.apply(this,[u.sent(),e])]}})})},n.prototype.getDefaultModelName=function(){return"mtcnn_model"},n.prototype.extractParamsFromWeigthMap=function(t){return GT(t)},n.prototype.extractParams=function(t){return HT(t)},n})(ra),tD=.4,eD=[new Qt(1.603231,2.094468),new Qt(6.041143,7.080126),new Qt(2.882459,3.518061),new Qt(4.266906,5.178857),new Qt(9.041765,10.66308)],nD=[117.001,114.697,97.404],rD=(function(r){Mt(n,r);function n(){var t=this,e={withSeparableConvs:!0,iouThreshold:tD,classes:["face"],anchors:eD,meanRgb:nD,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};return t=r.call(this,e)||this,t}return Object.defineProperty(n.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),n.prototype.locateFaces=function(t,e){return Ct(this,void 0,void 0,function(){var a;return St(this,function(u){switch(u.label){case 0:return[4,this.detect(t,e)];case 1:return a=u.sent(),[2,a.map(function(s){return new zn(s.score,s.relativeBox,{width:s.imageWidth,height:s.imageHeight})})]}})})},n.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},n.prototype.extractParamsFromWeigthMap=function(t){return r.prototype.extractParamsFromWeigthMap.call(this,t)},n})(Qb),an={ssdMobilenetv1:new Yb,tinyFaceDetector:new rD,tinyYolov2:new LT,mtcnn:new $T,faceLandmark68Net:new Vb,faceLandmark68TinyNet:new iT,faceRecognitionNet:new hT,faceExpressionNet:new W3,ageGenderNet:new eT},tx=(function(r){Mt(n,r);function n(t,e,a){var u=r.call(this)||this;return u.parentTask=t,u.input=e,u.extractedFaces=a,u}return n})(Ku),Rp=(function(r){Mt(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.run=function(){return Ct(this,void 0,void 0,function(){var t,e,a=this;return St(this,function(u){switch(u.label){case 0:return[4,this.parentTask];case 1:return t=u.sent(),[4,fc(t,this.input,function(s){return Ct(a,void 0,void 0,function(){return St(this,function(l){switch(l.label){case 0:return[4,Promise.all(s.map(function(f){return an.faceExpressionNet.predictExpressions(f)}))];case 1:return[2,l.sent()]}})})},this.extractedFaces)];case 2:return e=u.sent(),[2,t.map(function(s,l){return Lb(s,e[l])})]}})})},n.prototype.withAgeAndGender=function(){return new Np(this,this.input)},n})(tx),Ap=(function(r){Mt(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.run=function(){return Ct(this,void 0,void 0,function(){var t,e;return St(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return t=a.sent(),t?[4,Ep(t,this.input,function(u){return an.faceExpressionNet.predictExpressions(u)},this.extractedFaces)]:[2];case 2:return e=a.sent(),[2,Lb(t,e)]}})})},n.prototype.withAgeAndGender=function(){return new Mp(this,this.input)},n})(tx),Tp=(function(r){Mt(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.withAgeAndGender=function(){return new Op(this,this.input)},n.prototype.withFaceDescriptors=function(){return new Ip(this,this.input)},n})(Rp),Dp=(function(r){Mt(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.withAgeAndGender=function(){return new kp(this,this.input)},n.prototype.withFaceDescriptor=function(){return new Bp(this,this.input)},n})(Ap),ex=(function(r){Mt(n,r);function n(t,e,a){var u=r.call(this)||this;return u.parentTask=t,u.input=e,u.extractedFaces=a,u}return n})(Ku),Np=(function(r){Mt(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.run=function(){return Ct(this,void 0,void 0,function(){var t,e,a=this;return St(this,function(u){switch(u.label){case 0:return[4,this.parentTask];case 1:return t=u.sent(),[4,fc(t,this.input,function(s){return Ct(a,void 0,void 0,function(){return St(this,function(l){switch(l.label){case 0:return[4,Promise.all(s.map(function(f){return an.ageGenderNet.predictAgeAndGender(f)}))];case 1:return[2,l.sent()]}})})},this.extractedFaces)];case 2:return e=u.sent(),[2,t.map(function(s,l){var f=e[l],h=f.age,p=f.gender,v=f.genderProbability;return jb(Xb(s,p,v),h)})]}})})},n.prototype.withFaceExpressions=function(){return new Rp(this,this.input)},n})(ex),Mp=(function(r){Mt(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.run=function(){return Ct(this,void 0,void 0,function(){var t,e,a,u,s;return St(this,function(l){switch(l.label){case 0:return[4,this.parentTask];case 1:return t=l.sent(),t?[4,Ep(t,this.input,function(f){return an.ageGenderNet.predictAgeAndGender(f)},this.extractedFaces)]:[2];case 2:return e=l.sent(),a=e.age,u=e.gender,s=e.genderProbability,[2,jb(Xb(t,u,s),a)]}})})},n.prototype.withFaceExpressions=function(){return new Ap(this,this.input)},n})(ex),Op=(function(r){Mt(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.withFaceExpressions=function(){return new Tp(this,this.input)},n.prototype.withFaceDescriptors=function(){return new Ip(this,this.input)},n})(Np),kp=(function(r){Mt(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.withFaceExpressions=function(){return new Dp(this,this.input)},n.prototype.withFaceDescriptor=function(){return new Bp(this,this.input)},n})(Mp),nx=(function(r){Mt(n,r);function n(t,e){var a=r.call(this)||this;return a.parentTask=t,a.input=e,a}return n})(Ku),Ip=(function(r){Mt(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.run=function(){return Ct(this,void 0,void 0,function(){var t,e;return St(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return t=a.sent(),[4,fc(t,this.input,function(u){return Promise.all(u.map(function(s){return an.faceRecognitionNet.computeFaceDescriptor(s)}))},null,function(u){return u.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return e=a.sent(),[2,e.map(function(u,s){return qb(t[s],u)})]}})})},n.prototype.withFaceExpressions=function(){return new Tp(this,this.input)},n.prototype.withAgeAndGender=function(){return new Op(this,this.input)},n})(nx),Bp=(function(r){Mt(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.run=function(){return Ct(this,void 0,void 0,function(){var t,e;return St(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return t=a.sent(),t?[4,Ep(t,this.input,function(u){return an.faceRecognitionNet.computeFaceDescriptor(u)},null,function(u){return u.landmarks.align(null,{useDlibAlignment:!0})})]:[2];case 2:return e=a.sent(),[2,qb(t,e)]}})})},n.prototype.withFaceExpressions=function(){return new Dp(this,this.input)},n.prototype.withAgeAndGender=function(){return new kp(this,this.input)},n})(nx),rx=(function(r){Mt(n,r);function n(t,e,a){var u=r.call(this)||this;return u.parentTask=t,u.input=e,u.useTinyLandmarkNet=a,u}return Object.defineProperty(n.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?an.faceLandmark68TinyNet:an.faceLandmark68Net},enumerable:!0,configurable:!0}),n})(Ku),aD=(function(r){Mt(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.run=function(){return Ct(this,void 0,void 0,function(){var t,e,a,u,s,l=this;return St(this,function(f){switch(f.label){case 0:return[4,this.parentTask];case 1:return t=f.sent(),e=t.map(function(h){return h.detection}),this.input instanceof pe?[4,vp(this.input,e)]:[3,3];case 2:return u=f.sent(),[3,5];case 3:return[4,pp(this.input,e)];case 4:u=f.sent(),f.label=5;case 5:return a=u,[4,Promise.all(a.map(function(h){return l.landmarkNet.detectLandmarks(h)}))];case 6:return s=f.sent(),a.forEach(function(h){return h instanceof pe&&h.dispose()}),[2,t.map(function(h,p){return lc(h,s[p])})]}})})},n.prototype.withFaceExpressions=function(){return new Tp(this,this.input)},n.prototype.withAgeAndGender=function(){return new Op(this,this.input)},n.prototype.withFaceDescriptors=function(){return new Ip(this,this.input)},n})(rx),iD=(function(r){Mt(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.run=function(){return Ct(this,void 0,void 0,function(){var t,e,a,u,s;return St(this,function(l){switch(l.label){case 0:return[4,this.parentTask];case 1:return t=l.sent(),t?(e=t.detection,this.input instanceof pe?[4,vp(this.input,[e])]:[3,3]):[2];case 2:return u=l.sent(),[3,5];case 3:return[4,pp(this.input,[e])];case 4:u=l.sent(),l.label=5;case 5:return a=u,[4,this.landmarkNet.detectLandmarks(a[0])];case 6:return s=l.sent(),a.forEach(function(f){return f instanceof pe&&f.dispose()}),[2,lc(t,s)]}})})},n.prototype.withFaceExpressions=function(){return new Dp(this,this.input)},n.prototype.withAgeAndGender=function(){return new kp(this,this.input)},n.prototype.withFaceDescriptor=function(){return new Bp(this,this.input)},n})(rx),ax=(function(r){Mt(n,r);function n(t,e){e===void 0&&(e=new cc);var a=r.call(this)||this;return a.input=t,a.options=e,a}return n})(Ku),ix=(function(r){Mt(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.run=function(){return Ct(this,void 0,void 0,function(){var t,e,a,u;return St(this,function(s){switch(s.label){case 0:return t=this,e=t.input,a=t.options,a instanceof Kb?[4,an.mtcnn.forward(e,a)]:[3,2];case 1:return[2,s.sent().map(function(l){return l.detection})];case 2:if(u=a instanceof Zb?function(l){return an.tinyFaceDetector.locateFaces(l,a)}:a instanceof cc?function(l){return an.ssdMobilenetv1.locateFaces(l,a)}:a instanceof _p?function(l){return an.tinyYolov2.locateFaces(l,a)}:null,!u)throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,u(e)]}})})},n.prototype.runAndExtendWithFaceDetections=function(){var t=this;return new Promise(function(e){return Ct(t,void 0,void 0,function(){var a;return St(this,function(u){switch(u.label){case 0:return[4,this.run()];case 1:return a=u.sent(),[2,e(a.map(function(s){return Lu({},s)}))]}})})})},n.prototype.withFaceLandmarks=function(t){return t===void 0&&(t=!1),new aD(this.runAndExtendWithFaceDetections(),this.input,t)},n.prototype.withFaceExpressions=function(){return new Rp(this.runAndExtendWithFaceDetections(),this.input)},n.prototype.withAgeAndGender=function(){return new Np(this.runAndExtendWithFaceDetections(),this.input)},n})(ax);(function(r){Mt(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.run=function(){return Ct(this,void 0,void 0,function(){var t,e;return St(this,function(a){switch(a.label){case 0:return[4,new ix(this.input,this.options)];case 1:return t=a.sent(),e=t[0],t.forEach(function(u){u.score>e.score&&(e=u)}),[2,e]}})})},n.prototype.runAndExtendWithFaceDetection=function(){var t=this;return new Promise(function(e){return Ct(t,void 0,void 0,function(){var a;return St(this,function(u){switch(u.label){case 0:return[4,this.run()];case 1:return a=u.sent(),[2,e(a?Lu({},a):void 0)]}})})})},n.prototype.withFaceLandmarks=function(t){return t===void 0&&(t=!1),new iD(this.runAndExtendWithFaceDetection(),this.input,t)},n.prototype.withFaceExpressions=function(){return new Ap(this.runAndExtendWithFaceDetection(),this.input)},n.prototype.withAgeAndGender=function(){return new Mp(this.runAndExtendWithFaceDetection(),this.input)},n})(ax);function oD(r,n){return n===void 0&&(n=new cc),new ix(r,n)}function uD(r,n){if(r.length!==n.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var t=Array.from(r),e=Array.from(n);return Math.sqrt(t.map(function(a,u){return a-e[u]}).reduce(function(a,u){return a+Math.pow(u,2)},0))}(function(){function r(n,t){t===void 0&&(t=.6),this._distanceThreshold=t;var e=Array.isArray(n)?n:[n];if(!e.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var a=1,u=function(){return"person "+a++};this._labeledDescriptors=e.map(function(s){if(s instanceof wl)return s;if(s instanceof Float32Array)return new wl(u(),[s]);if(s.descriptor&&s.descriptor instanceof Float32Array)return new wl(u(),[s.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}return Object.defineProperty(r.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),r.prototype.computeMeanDistance=function(n,t){return t.map(function(e){return uD(e,n)}).reduce(function(e,a){return e+a},0)/(t.length||1)},r.prototype.matchDescriptor=function(n){var t=this;return this.labeledDescriptors.map(function(e){var a=e.descriptors,u=e.label;return new zy(u,t.computeMeanDistance(n,a))}).reduce(function(e,a){return e.distance<a.distance?e:a})},r.prototype.findBestMatch=function(n){var t=this.matchDescriptor(n);return t.distance<this.distanceThreshold?t:new zy("unknown",t.distance)},r.prototype.toJSON=function(){return{distanceThreshold:this.distanceThreshold,labeledDescriptors:this.labeledDescriptors.map(function(n){return n.toJSON()})}},r.fromJSON=function(n){var t=n.labeledDescriptors.map(function(e){return wl.fromJSON(e)});return new r(t,n.distanceThreshold)},r})();function ox(r,n){var t=new hi(n.width,n.height),e=t.width,a=t.height;if(e<=0||a<=0)throw new Error("resizeResults - invalid dimensions: "+JSON.stringify({width:e,height:a}));if(Array.isArray(r))return r.map(function(l){return ox(l,{width:e,height:a})});if(Ub(r)){var u=r.detection.forSize(e,a),s=r.unshiftedLandmarks.forSize(u.box.width,u.box.height);return lc(Lu(r,u),s)}return zu(r)?Lu(r,r.detection.forSize(e,a)):r instanceof Fu||r instanceof zn?r.forSize(e,a):r}function sD(r,n){const t="/Face-Detectormodels",e=pi.useRef(!1);pi.useEffect(()=>{if(!r.current||!n.current)return;const a=async()=>{await Promise.all([await an.tinyFaceDetector.loadFromUri(t),await an.faceLandmark68Net.loadFromUri(t),await an.faceExpressionNet.loadFromUri(t),an.ageGenderNet.loadFromUri(t)]);const s=await navigator.mediaDevices.getUserMedia({video:!0});r.current.srcObject=s,r.current.onloadedmetadata=()=>{r.current.play(),u()}},u=async()=>{if(e.current)return;e.current=!0;const s=r.current,l=n.current,f=s.getBoundingClientRect(),h={width:f.width,height:f.height};l.width=f.width,l.height=f.height,U3(l,h);const p=async()=>{const v=await oD(r.current,new Zb).withFaceLandmarks().withFaceExpressions().withAgeAndGender(),m=ox(v,h);l.getContext("2d").clearRect(0,0,l.width,l.height),O3(l,m),j3(l,m,.05),requestAnimationFrame(p),console.log(v),m.forEach(x=>{const{age:w,detection:_,gender:E}=x,R=_.box,A=`${Math.round(w)} yrs ${E}`;new fp([A],R.bottomRight).draw(l)})};p()};return a(),()=>{r.current?.srcObject&&r.current.srcObject.getTracks().forEach(s=>s.stop())}},[r,n])}function lD(){const r=pi.useRef(null),n=pi.useRef(null),t=async()=>{try{const e=await navigator.mediaDevices.getUserMedia({video:!0});r.current.srcObject=e}catch(e){console.error("Camera error:",e)}};return sD(r,n),Me.jsxs(Me.Fragment,{children:[Me.jsx(Lw,{}),Me.jsxs("main",{className:"z-10 w-full max-w-4xl px-4 py-8 flex flex-col items-center gap-8",children:[Me.jsx(Bw,{}),Me.jsx("button",{onClick:t,children:"Start Camera"}),Me.jsx("div",{className:"relative group w-full max-w-180 mx-auto",children:Me.jsxs("div",{id:"video-container",className:"relative w-fit mx-auto bg-slate-800 rounded-2xl overflow-hidden shadow-2xl border border-slate-700 ring-1 ring-white/10",children:[Me.jsx(Fw,{ref:r}),Me.jsx(zw,{ref:n})]})})]})]})}Iw.createRoot(document.getElementById("root")).render(Me.jsx(pi.StrictMode,{children:Me.jsx(lD,{})}))});export default cD();
